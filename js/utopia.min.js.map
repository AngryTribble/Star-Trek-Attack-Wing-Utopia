{"version":3,"file":"utopia.min.js","sources":["../../src/js/utopia-dragdrop.js","../../src/js/utopia-fleet-builder.js","../../src/js/utopia-fleet-export.js","../../src/js/utopia-missions.js","../../src/js/utopia-search.js","../../src/js/utopia-set-viewer.js","../../src/js/utopia-tooltip.js","../../src/js/utopia.js","../../src/js/common/components/utopia-card-faction.js","../../src/js/common/components/utopia-card-resource.js","../../src/js/common/components/utopia-card-ship-class.js","../../src/js/common/components/utopia-card-ship.js","../../src/js/common/components/utopia-card-token.js","../../src/js/common/components/utopia-card-upgrade.js","../../src/js/common/components/utopia-card.js","../../src/js/common/components/utopia-fleet-builder.js","../../src/js/common/utopia-valueof.js","../../src/js/common/components/utopia-fleet-export.js","../../src/js/common/filters/fleet-card-named-filter.js","../../src/js/common/filters/ship-card-named-filter.js","../../src/js/common/utopia-card-faction-service.js","../../src/js/common/utopia-card-faction.js","../../src/js/common/utopia-card-loader.js","../../src/js/common/utopia-card-resource.js","../../src/js/common/utopia-card-rules.js","../../src/js/common/utopia-card-ship-class.js","../../src/js/common/utopia-card-ship.js","../../src/js/common/utopia-card-token.js","../../src/js/common/utopia-card-upgrade.js","../../src/js/common/utopia-card.js","../utopia-templates.js"],"sourcesContent":["var module = angular.module(\"utopia-dragdrop\", []);\n\nmodule.directive('draggable', function () {\n    return {\n\t\t\n\t\tscope: {\n\t\t\tdragItem: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\",\n\t\t},\n\t\n\t\tlink: function (scope, element) {\n\t\t\t\n\t\t\telement.prop( \"draggable\", true );\n\n\t\t\telement.on(\"dragstart\", function(ev) {\n\t\t\t\tscope.$apply(function(){\n\t\t\t\t\tscope.dragStore.item = scope.dragItem;\n\t\t\t\t\tscope.dragStore.source = scope.dragSource;\n\t\t\t\t});\n\t\t\t\telement.addClass(\"dragging\");\n\t\t\t\tev.originalEvent.dataTransfer.effectAllowed = 'move';\n\t\t\t\tev.originalEvent.dataTransfer.setData(\"text/plain\",\"google\");\n\t\t\t});\n\t\t\t\n\t\t\telement.on(\"dragend\", function(ev) {\n\t\t\t\telement.removeClass(\"dragging\");\n                scope.$apply(function (scope) {\n\t\t\t\t\tdelete scope.dragStore.item;\n\t\t\t\t\tdelete scope.dragStore.source;\n                });\n\t\t\t});\n\t\t\t\n\t\t\telement.on(\"click\", function(ev) {\n\t\t\t\tscope.$apply(function(){\n\t\t\t\t\tif( scope.dragStore.item != scope.dragItem) {\n\t\t\t\t\t\tscope.dragStore.item = scope.dragItem;\n\t\t\t\t\t\tscope.dragStore.source = scope.dragSource;\n\t\t\t\t\t} else\n\t\t\t\t\t\tdelete scope.dragStore.item;\n\t\t\t\t});\n\t\t\t\tev.preventDefault();\n\t\t\t\treturn false;\n\t\t\t});\n\n\t\t}\n\t\t\n\t};\n});\n\nmodule.directive('droppable', function () {\n    return {\n        scope: {\n            drop: \"&\",\n\t\t\tcanDrop: \"&\",\n            dragStore: \"=\"\n        },\n        link: function (scope, element) {\n\t\t\t\n\t\t\telement.on( \"dragover\", function(ev) {\n\t\t\t\tif( scope.canDrop({ \"$item\": scope.dragStore.item }) ) {\n\t\t\t\t\telement.addClass(\"drag-over\");\n\t\t\t\t\tev.preventDefault();\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\telement.on( \"dragenter\", function(ev) {\n\t\t\t\tif( scope.canDrop({ \"$item\": scope.dragStore.item }) )\n\t\t\t\t\telement.addClass(\"drag-over\");\n\t\t\t});\n\t\t\t\n\t\t\telement.on( \"dragleave\", function(ev) {\n\t\t\t\telement.removeClass(\"drag-over\");\n\t\t\t});\n\t\t\t\n\t\t\telement.on( \"drop\", function(ev) {\n\n\t\t\t\telement.removeClass(\"drag-over\");\n\t\t\t\t\n                scope.$apply(function (scope) {\n\t\t\t\t\tscope.drop( {\"$item\": scope.dragStore.item} )\n\t\t\t\t\tdelete scope.dragStore.item;\n                });\n\t\t\t\t\n\t\t\t\tev.preventDefault();\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t\telement.on(\"click\", function(ev) {\n\t\t\t\tscope.$apply(function(){\n\t\t\t\t\tif( scope.dragStore.item ) {\n\t\t\t\t\t\tscope.drop( {\"$item\": scope.dragStore.item} )\n\t\t\t\t\t\tdelete scope.dragStore.item;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tev.preventDefault();\n\t\t\t});\n\n        }\n    };\n});","var module = angular.module(\"utopia-fleet-builder\", [\"utopia-card-upgrade\",\"utopia-dragdrop\"]);\n\nmodule.directive( \"fleetBuilder\", [ \"$filter\", function($filter) {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tfleet: \"=\",\n\t\t\tcards: \"=\",\n\t\t\tsearchOptions: \"=\",\n\t\t\tdragStore: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"fleet-builder.html\",\n\n\t\tcontroller: [ \"$scope\", \"isMobile\", function($scope, isMobile) {\n\n\t\t\t$scope.isMobile = isMobile;\n\n\t\t\t$scope.$watch( \"fleet\", function(fleet) {\n\t\t\t\tlocation.hash = btoa( angular.toJson( $scope.saveFleet(fleet) ) );\n\t\t\t}, true );\n\n\t\t\t$scope.$on( \"removeFromFleet\", function(ev, card) {\n\n\t\t\t\t$scope.removeFromFleet( card, $scope.fleet );\n\n\t\t\t} );\n\n\t\t\t$scope.$on( \"zoom\", function(ev, zoom) {\n\t\t\t\t$scope.zoom = zoom;\n\t\t\t});\n\n\t\t\t$scope.setSearchTypes = function(types) {\n\n\t\t\t\t$.each( $scope.searchOptions.types, function(typeName,typeOption) {\n\t\t\t\t\ttypeOption.search = $.inArray(typeName, types) >= 0;\n\t\t\t\t});\n\n\t\t\t\tif( $scope.searchOptions.columns < 1 )\n\t\t\t\t\t$scope.searchOptions.columns = 1;\n\n\t\t\t};\n\n\t\t\t$scope.addFleetShip = function(fleet, ship) {\n\n\t\t\t\t// Check uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(ship, fleet);\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canJoinFleet = valueOf(ship,\"canJoinFleet\",ship,fleet);\n\t\t\t\tif( !canJoinFleet ) {\n\t\t\t\t\tconsole.log(\"joinFleet stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Fail if other\n\t\t\t\tif( other && other != ship ) {\n\t\t\t\t\tconsole.log(\"upgrade uniquenes check failed\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If other is this, user is moving card within fleet\n\t\t\t\tif( other ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet );\n\t\t\t\t}\n\n\t\t\t\t// Clone ship\n\t\t\t\t//ship = $.extend(true,{},ship);\n\t\t\t\tship = angular.copy(ship);\n\n\t\t\t\tfleet.ships.push( ship );\n\n\t\t\t\treturn ship;\n\n\t\t\t};\n\n\t\t\t// TODO replace references\n\t\t\t$scope.getUpgradeSlots = $filter(\"upgradeSlots\");\n\n\t\t\t$scope.isUpgradeCompatible = function(upgrade, upgradeSlot, ship, fleet) {\n\n\t\t\t\t// Ignore drop on self\n\t\t\t\tif( upgrade == upgradeSlot.occupant )\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Construct list of all slot types\n\t\t\t\tvar slotTypes = valueOf(upgradeSlot,\"type\",ship,fleet);\n\n\t\t\t\tif( upgrade.type == \"question\" ) {\n\t\t\t\t\t// Invoke special logic for question type cards\n\t\t\t\t\treturn upgrade.isSlotCompatible && upgrade.isSlotCompatible(slotTypes);\n\t\t\t\t} else {\n\t\t\t\t\t// Check normal types\n\t\t\t\t\treturn $.inArray( upgrade.type, slotTypes ) >= 0;\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\tvar valueOf = $filter(\"valueOf\");\n\n\t\t\t$scope.setUpgrade = function(fleet, ship, upgradeSlot, upgrade) {\n\n\t\t\t\t// Check slot type\n\t\t\t\tif( !$scope.isUpgradeCompatible(upgrade, upgradeSlot, ship, fleet) ) {\n\t\t\t\t\tconsole.log(\"wrong slot type\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check for drop onto self\n\t\t\t\tif( upgradeSlot.occupant == upgrade )\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(upgrade,\"canEquip\",ship,fleet,upgradeSlot);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by special card rule\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check faction interceptors\n\t\t\t\tvar canEquipFaction = valueOf(upgrade,\"canEquipFaction\",ship,fleet,upgradeSlot);\n\t\t\t\tif( !canEquipFaction ) {\n\t\t\t\t\tconsole.log(\"equip stopped by faction-specific special card rule\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Slot-specific restrictions\n\t\t\t\tif( upgradeSlot.canEquip && !upgradeSlot.canEquip(upgrade,ship,fleet,upgradeSlot) ) {\n\t\t\t\t\tconsole.log(\"upgrade rejected by slot\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(upgrade, fleet);\n\n\t\t\t\t// Fail if other\n\t\t\t\tif( other && other != upgrade && other != upgradeSlot.occupant ) {\n\t\t\t\t\tconsole.log(\"upgrade uniquenes check failed\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If other is this, and user is moving card within fleet\n\t\t\t\tif( other && other != upgradeSlot.occupant ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, upgradeSlot.occupant );\n\t\t\t\t}\n\n\t\t\t\tupgradeSlot.occupant = angular.copy(upgrade);\n\n\t\t\t\t// Trigger onEquip handlers\n\t\t\t\tvalueOf(upgradeSlot.occupant,\"onEquip\",ship,fleet);\n\n\t\t\t\treturn upgradeSlot.occupant;\n\n\t\t\t};\n\n\t\t\t$scope.setShipResource = function(fleet,ship,resource) {\n\n\t\t\t\tif( !fleet.resource || resource.type != fleet.resource.slotType ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(resource,\"canEquip\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by special card rule\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(resource, fleet);\n\n\t\t\t\t// Fail if other\n\t\t\t\tif( other && other != upgrade && other != ship.resource ) {\n\t\t\t\t\tconsole.log(\"upgrade uniquenes check failed\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tship.resource = angular.copy(resource);\n\n\t\t\t\treturn ship.resource;\n\n\t\t\t};\n\n\t\t\t$scope.setShipCaptain = function(fleet,ship,captain) {\n\n\t\t\t\tif( captain.type != \"captain\" ) {\n\t\t\t\t\tconsole.log(\"card is not a captain\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(captain,\"canEquipCaptain\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(captain, fleet);\n\n\t\t\t\tif( other && other != captain && other != ship.captain ) {\n\t\t\t\t\tconsole.log( \"captain already in fleet\" );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Move if already in fleet\n\t\t\t\tif( other && other != ship.captain ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, ship.captain );\n\t\t\t\t}\n\n\t\t\t\t//ship.captain = $.extend(true,{}, captain);\n\t\t\t\tship.captain = angular.copy(captain);\n\n\t\t\t\treturn ship.captain;\n\n\t\t\t};\n\n\t\t\t$scope.setShipConstruction = function(fleet, ship, construction) {\n\t\t\t\tif( construction.type != \"starship_construction\" ) {\n\t\t\t\t\tconsole.log(\"card is not a starship_construction\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(construction,\"canEquipConstruction\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tship.construction = angular.copy(construction);\n\t\t\t\treturn ship.construction;\n\t\t\t};\n\n\t\t\t$scope.fleetHasAdmiral = function( fleet ) {\n\n\t\t\t\tvar hasAdmiral = false;\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.admiral ) {\n\t\t\t\t\t\thasAdmiral = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn hasAdmiral;\n\n\t\t\t};\n\n\t\t\t$scope.fleetHasAmbassador = function( fleet ) {\n\n\t\t\t\tvar hasAmbassador = false;\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.ambassador ) {\n\t\t\t\t\t\thasAmbassador = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn hasAmbassador;\n\n\t\t\t};\n\n\t\t\t$scope.setShipAdmiral = function(fleet,ship,admiral) {\n\n\t\t\t\tif( admiral.type != \"admiral\" )\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(admiral,\"canEquipAdmiral\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(admiral, fleet);\n\n\t\t\t\tif( other && other != admiral && other != ship.admiral ) {\n\t\t\t\t\tconsole.log( \"admiral already in fleet\" );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Move if already in fleet\n\t\t\t\tif( other && other != ship.admiral ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, ship.admiral );\n\t\t\t\t}\n\n\t\t\t\t//ship.admiral = $.extend(true,{}, admiral);\n\t\t\t\tship.admiral = angular.copy(admiral);\n\n\t\t\t\treturn ship.admiral;\n\n\t};\n\n\t\t\t\t$scope.setShipAmbassador = function(fleet,ship,ambassador) {\n\n\t\t\t\t\tif( ambassador.type != \"ambassador\" )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t// Check interceptors\n\t\t\t\t\tvar canEquip = valueOf(ambassador,\"canEquipAmbassador\",ship,fleet);\n\t\t\t\t\tif( !canEquip ) {\n\t\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t// Uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(ambassador, fleet);\n\n\t\t\t\tif( other && other != ambassador && other != ship.ambassador ) {\n\t\t\t\t\tconsole.log( \"ambassador already in fleet\" );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Move if already in fleet\n\t\t\t\tif( other && other != ship.ambassador ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, ship.ambassador );\n\t\t\t\t}\n\n\t\t\t\t//ship.ambassador = $.extend(true,{}, ambassador);\n\t\t\t\tship.ambassador = angular.copy(ambassador);\n\n\t\t\t\treturn ship.ambassador;\n\n\t\t\t};\n\n\t\t\t$scope.findOtherInFleet = function( card, fleet ) {\n\n\t\t\t\tvar clash = false;\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\n\t\t\t\t\tif( card == ship || isUniqueClash(card, ship) ) {\n\t\t\t\t\t\tclash = ship;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.captain || isUniqueClash(card, ship.captain)) {\n\t\t\t\t\t\tclash = ship.captain;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.admiral || isUniqueClash(card, ship.admiral)) {\n\t\t\t\t\t\tclash = ship.admiral;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.ambassador || isUniqueClash(card, ship.ambassador)) {\n\t\t\t\t\t\tclash = ship.ambassador;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each( $scope.getUpgradeSlots(ship), function(j, upgradeSlot) {\n\t\t\t\t\t\tif( card == upgradeSlot.occupant || isUniqueClash(card, upgradeSlot.occupant) ) {\n\t\t\t\t\t\t\tclash = upgradeSlot.occupant;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tif( clash )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t} );\n\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\t$.each( fleet.resource.upgradeSlots || [], function(i, upgradeSlot) {\n\t\t\t\t\t\tif( card == upgradeSlot.occupant || isUniqueClash(card, upgradeSlot.occupant) ) {\n\t\t\t\t\t\t\tclash = upgradeSlot.occupant;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\treturn clash;\n\n\t\t\t};\n\n\t\t\tfunction isUniqueClash( card, other ) {\n\t\t\t\treturn other && card.unique && other.unique && card.name == other.name && card.mirror == other.mirror ? other : false;\n\t\t\t}\n\n\t\t\t$scope.removeFromFleet = function( card, fleet, replaceWith ) {\n\n\t\t\t\tif( !card )\n\t\t\t\t\treturn false;\n\n\t\t\t\tif( card == fleet.resource )\n\t\t\t\t\tdelete fleet.resource;\n\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\t$.each( fleet.resource.upgradeSlots || [], function(j,slot) {\n\t\t\t\t\t\tif( card == slot.occupant ) {\n\t\t\t\t\t\t\tif( replaceWith && $scope.isUpgradeCompatible( replaceWith, slot ) )\n\t\t\t\t\t\t\t\tslot.occupant = replaceWith;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdelete slot.occupant;\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\n\t\t\t\t\tif( card == ship ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"ship\" )\n\t\t\t\t\t\t\tfleet.ships[i] = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfleet.ships.splice(i,1);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.resource ) {\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.captain ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"captain\" )\n\t\t\t\t\t\t\tship.captain = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.captain;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.admiral ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"admiral\" )\n\t\t\t\t\t\t\tship.admiral = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.admiral;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.ambassador ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"ambassador\" )\n\t\t\t\t\t\t\tship.ambassador = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.ambassador;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.construction ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"construction\" )\n\t\t\t\t\t\t\tship.construction = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.construction;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar found = false;\n\n\t\t\t\t\t$.each( $scope.getUpgradeSlots(ship), function(j,slot) {\n\t\t\t\t\t\tif( card == slot.occupant ) {\n\t\t\t\t\t\t\tif( replaceWith && $scope.isUpgradeCompatible( replaceWith, slot ) )\n\t\t\t\t\t\t\t\tslot.occupant = replaceWith;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdelete slot.occupant;\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\treturn !found;\n\t\t\t\t});\n\n\t\t\t\t// Trigger onRemove handlers\n\t\t\t\tvalueOf(card,\"onRemove\",{},fleet);\n\n\t\t\t};\n\n\t\t\t$scope.getTotalCost = function(ship, fleet) {\n\n\t\t\t\tvar valueOf = $filter(\"valueOf\");\n\n\t\t\t\tvar cost = valueOf(ship, \"cost\", ship, fleet);\n\n\t\t\t\tif( ship.resource ) {\n\t\t\t\t\tif( !valueOf(ship.resource,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.resource,\"cost\",ship,fleet);\n\t\t\t\t}\n\n\t\t\t\tif( ship.captain )\n\t\t\t\t\tif( !valueOf(ship.captain,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.captain,\"cost\",ship,fleet);\n\n\t\t\t\tif( ship.admiral )\n\t\t\t\t\tif( !valueOf(ship.admiral,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.admiral,\"cost\",ship,fleet);\n\n\t\t\t\tif( ship.ambassador )\n\t\t\t\t\tif( !valueOf(ship.ambassador,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.ambassador,\"cost\",ship,fleet);\n\t\t\t\t\n\t\t\t\tif( ship.construction && !valueOf(ship.construction,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.construction,\"cost\",ship,fleet);\n\n\t\t\t\t$.each( $scope.getUpgradeSlots(ship), function(i,slot) {\n\t\t\t\t\tif( slot.occupant )\n\t\t\t\t\t\tif( !valueOf(slot.occupant,\"free\",ship,fleet) )\n\t\t\t\t\t\t\tcost += valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t});\n\t\t\t\tship.totalCost = cost;\n\t\t\t\treturn cost;\n\t\t\t};\n\n\t\t\t$scope.getFleetCost = function(fleet) {\n\n\t\t\t\tvar cost = fleet.resource ? valueOf(fleet.resource,\"cost\",{},fleet) : 0;\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\t\t\t\t\tcost += $scope.getTotalCost(ship,fleet);\n\t\t\t\t});\n\t\t\t\tfleet.totalCost = cost;\n\t\t\t\treturn cost;\n\n\t\t\t};\n\n\t\t\t$scope.setFleetResource = function(fleet, resource) {\n\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\t$scope.removeFromFleet(fleet.resource, fleet);\n\n\t\t\t\tfleet.resource = resource;\n\n\t\t\t};\n\n\t\t\t// TODO Move save/load to new module\n\t\t\t$scope.saveFleet = function(fleet) {\n\n\t\t\t\tvar savedFleet = {\n\t\t\t\t\tships: []\n\t\t\t\t};\n\n\t\t\t\t// TODO Might need to save more data for some resources\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\tsavedFleet.resource = saveCard(fleet.resource);\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\t\t\t\t\tsavedFleet.ships.push( saveCard(ship) );\n\t\t\t\t});\n\n\t\t\t\treturn savedFleet;\n\n\t\t\t};\n\n\t\t\tfunction saveCard(card) {\n\n\t\t\t\tif( !card )\n\t\t\t\t\treturn {};\n\n\t\t\t\tvar saved = {\n\t\t\t\t\tid: card.type+\":\"+card.id\n\t\t\t\t};\n\n\t\t\t\tif( card.resource )\n\t\t\t\t\tsaved.resource = saveCard(card.resource);\n\n\t\t\t\tif( card.captain )\n\t\t\t\t\tsaved.captain = saveCard(card.captain);\n\n\t\t\t\tif( card.admiral )\n\t\t\t\t\tsaved.admiral = saveCard(card.admiral);\n\n\t\t\t\tif( card.ambassador )\n\t\t\t\t\tsaved.ambassador = saveCard(card.ambassador);\n\t\t\t\t\n\t\t\t\tif( card.construction )\n\t\t\t\t\tsaved.construction = saveCard(card.construction);\n\n\t\t\t\tvar upgrades = [];\n\t\t\t\t// TODO Consider switching ship.upgrades to .upgradeSlots\n\t\t\t\t$.each( card.upgrades || [], function(i, slot) {\n\t\t\t\t\tvar savedSlot = {};\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tsavedSlot = saveCard(slot.occupant);\n\t\t\t\t\t}\n\t\t\t\t\tupgrades.push(savedSlot);\n\t\t\t\t});\n\t\t\t\tif( upgrades.length > 0 )\n\t\t\t\t\tsaved.upgrades = upgrades;\n\n\t\t\t\tvar upgradeSlots = [];\n\t\t\t\t$.each( card.upgradeSlots || [], function(i, slot) {\n\t\t\t\t\tvar savedSlot = {};\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tsavedSlot = saveCard(slot.occupant);\n\t\t\t\t\t}\n\t\t\t\t\tupgradeSlots.push(savedSlot);\n\t\t\t\t});\n\t\t\t\tif( upgradeSlots.length > 0 )\n\t\t\t\t\tsaved.upgradeSlots = upgradeSlots;\n\n\t\t\t\treturn saved;\n\n\t\t\t}\n\n\t\t\t$scope.findCardById = function(cards, id) {\n\n\t\t\t\tvar match = false;\n\t\t\t\t$.each( cards, function(i, card) {\n\t\t\t\t\tif( card.type+\":\"+card.id == id ) {\n\t\t\t\t\t\tmatch = card;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} )\n\t\t\t\treturn match;\n\n\t\t\t};\n\n\t\t\tfunction loadCard(fleet, cards, savedCard, ship) {\n\n\t\t\t\tvar card = angular.copy( $scope.findCardById(cards, savedCard.id) );\n\n\t\t\t\tif( !card ) {\n\t\t\t\t\tconsole.log(\"unable to load card\",savedCard.id);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar promulgate = function(card) {\n\n\t\t\t\t\tif( savedCard.resource ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.resource, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar resource = $scope.setShipResource( fleet, card, result.card );\n\t\t\t\t\t\t\tif( resource )\n\t\t\t\t\t\t\t\tresult.promulgate(resource);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.captain ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.captain, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar captain = $scope.setShipCaptain( fleet, card, result.card );\n\t\t\t\t\t\t\tif( captain )\n\t\t\t\t\t\t\t\tresult.promulgate(captain);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.admiral ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.admiral, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar admiral = $scope.setShipAdmiral( fleet, card, result.card );\n\t\t\t\t\t\t\tif( admiral )\n\t\t\t\t\t\t\t\tresult.promulgate(admiral);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.ambassador ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.ambassador, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar ambassador = $scope.setShipAmbassador( fleet, card, result.card );\n\t\t\t\t\t\t\tif( ambassador )\n\t\t\t\t\t\t\t\tresult.promulgate(ambassador);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.construction ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.construction, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar construction = $scope.setShipConstruction( fleet, card, result.card );\n\t\t\t\t\t\t\tif( construction )\n\t\t\t\t\t\t\t\tresult.promulgate(construction);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each( savedCard.upgrades || [], function(i, savedUpgrade) {\n\n\t\t\t\t\t\tif( savedUpgrade && savedUpgrade.id ) {\n\t\t\t\t\t\t\tvar result = loadCard( fleet, cards, savedUpgrade, card );\n\t\t\t\t\t\t\tif( !result )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tvar upgrade = $scope.setUpgrade( fleet, card, card.upgrades[i], result.card );\n\t\t\t\t\t\t\tif( !upgrade )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tresult.promulgate(upgrade);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t\t$.each( savedCard.upgradeSlots || [], function(i, savedUpgrade) {\n\n\t\t\t\t\t\tif( savedUpgrade && savedUpgrade.id ) {\n\t\t\t\t\t\t\tvar result = loadCard( fleet, cards, savedUpgrade, ship || card );\n\t\t\t\t\t\t\tif( !result )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tvar upgrade = $scope.setUpgrade( fleet, ship || card, card.upgradeSlots[i], result.card );\n\t\t\t\t\t\t\tif( !upgrade )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tresult.promulgate(upgrade);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\treturn { card: card, promulgate: promulgate };\n\n\t\t\t}\n\n\t\t\t$scope.loadFleet = function(cards, savedFleet) {\n\n\t\t\t\tvar fleet = { ships: [] };\n\n\t\t\t\tif( savedFleet.resource ) {\n\t\t\t\t\tresult = loadCard( fleet, cards, savedFleet.resource );\n\t\t\t\t\tif( result ) {\n\t\t\t\t\t\tfleet.resource = result.card;\n\t\t\t\t\t\tresult.promulgate(fleet.resource);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$.each( savedFleet.ships, function(i, savedShip) {\n\n\t\t\t\t\tvar result = loadCard( fleet, cards, savedShip );\n\n\t\t\t\t\tif( !result )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar ship = $scope.addFleetShip( fleet, result.card )\n\t\t\t\t\tif( !ship )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tresult.promulgate(ship);\n\n\t\t\t\t});\n\n\t\t\t\treturn fleet;\n\n\t\t\t}\n\n\t\t\tvar hashFleet = false;\n\t\t\ttry {\n\t\t\t\thashFleet = location.hash ? angular.fromJson( atob( location.hash.substring(1) ) ) : false;\n\t\t\t} catch(e) {}\n\n\t\t\t$scope.$on(\"cardsLoaded\", function() {\n\t\t\t\tif( hashFleet ) {\n\t\t\t\t\thashFleet = $scope.loadFleet( $scope.cards, hashFleet );\n\t\t\t\t\tif( hashFleet ) {\n\n\t\t\t\t\t\t$scope.fleet = hashFleet;\n\n\t\t\t\t\t\tif( $scope.fleet.ships.length > 0 ) {\n\n\t\t\t\t\t\t\t// Hide empty slots when loading a fleet.. so it looks nice.\n\t\t\t\t\t\t\t$.each( hashFleet.ships, function(i,ship) {\n\t\t\t\t\t\t\t\tship.hideEmptySlots = true;\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t// Also hide search\n\t\t\t\t\t\t\t$scope.searchOptions.columns = 0;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t}]\n\n\t};\n\n}]);\n","var module = angular.module(\"utopia-fleet-export\", []);\n\nmodule.directive( \"fleetExport\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tfleet: \"=\",\n\t\t\tsets: \"=\",\n\t\t\tsearchOptions: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"fleet-export.html\",\n\n\t\tlink: function(scope,element) {\n\n\t\t\t$(element).find(\"textarea\").focus(function() {\n\t\t\t\t$this = $(this);\n\n\t\t\t\t$this.select();\n\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t$this.select();\n\t\t\t\t}, 1);\n\n\t\t\t\t// Work around WebKit's little problem\n\t\t\t\t$this.mouseup(function() {\n\t\t\t\t\t// Prevent further mouseup intervention\n\t\t\t\t\t$this.unbind(\"mouseup\");\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t});\n\n\t\t},\n\n\t\tcontroller: [ \"$scope\", \"$filter\", function($scope, $filter) {\n\n\t\t\t$scope.fleetText = \"\";\n\t\t\t$scope.showSetNames = false;\n\t\t\t//ttsExportStyle should not load at start.\n\t\t\t$scope.ttsExportStyle = false;\n\n\t\t\tvar valueOf = $filter(\"valueOf\");\n\n\t\t\t$scope.$watch( \"fleet\", function(fleet) {\n\t\t\t\tfleetToText(fleet);\n\t\t\t}, true );\n\n\t\t\t$scope.$watch( \"showSetNames\", function() {\n\t\t\t\tfleetToText($scope.fleet);\n\t\t\t});\n\n\t\t\t//allow script to use ttsExportStyle\n\n\t\t\t// $scope.$watch( \"fleet\", function(fleet) {\n\t\t\t// \tfleetToText(fleet);\n\t\t\t// }, true );\n\n\t\t\t$scope.$watch( \"exportType\", function() {\n\t\t\t\tfleetToText($scope.fleet);\n\t\t\t});\n\n\t\t\tfunction fleetToText(fleet) {\n\t\t\t\t// if ($scope.ttsExportStyle) ttsToText(fleet);\n\t\t\t\tif ($scope.exportType == \"fleetSheet\") fleetSheet(fleet);\n\t\t\t\telse if ($scope.exportType == \"tts\") ttsToText(fleet);\n\t\t\t\telse {\n\t\t\t\t\tvar fleetText = \"\";\n\n\t\t\t\t\tvar totalCost = 0;\n\n\t\t\t\t\tfleetText += \"Save your URL for easy Reloading\\n\\n\";\n\n\t\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\n\t\t\t\t\t\tvar res = cardToText(ship,ship,fleet);\n\t\t\t\t\t\tfleetText += res.text + \"Ship Total: \" + res.cost + \" SP\\n\\n\";\n\t\t\t\t\t\ttotalCost += res.cost;\n\n\t\t\t\t\t});\n\n\t\t\t\t\tif( fleet.resource ) {\n\t\t\t\t\t\tvar res = cardToText(fleet.resource,{},fleet);\n\t\t\t\t\t\tfleetText += \"Resource: \" + res.text + \"\\n\";\n\t\t\t\t\t\ttotalCost += res.cost;\n\t\t\t\t\t}\n\n\t\t\t\t\tfleetText += \"Fleet Total: \" + totalCost + \" SP\\n\\n\";\n\n\t\t\t\t\tfleetText += `Generated by Utopia ${window.location.href.split('#')[0].replace('index.html','')}`;\n\n\t\t\t\t\t$scope.fleetText = fleetText;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//ttsToText function to act independent of fleetToText\n\t\t\tfunction ttsToText(fleet) {\n\n\t\t\t\tvar ttsText = \"\";\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\n\t\t\t\t\tvar res = cardToAltTextTTS(ship,ship,fleet);\n\t\t\t\t\tttsText += res.text + \"\\n\";\n\t\t\t\t});\n\n\t\t\t\tif( fleet.resource ) {\n\t\t\t\t\tvar res = cardToAltTextTTS(fleet.resource,{},fleet);\n\t\t\t\t\tttsText += res.text + \"\\n\";\n\t\t\t\t}\n\n\t\t\t\tttsText += \"\\n\\n------------------------------------------\\n\"\n\t\t\t\tttsText += \"Generated by Utopia for Tabletop Simulator\";\n\t\t\t\t$scope.fleetText = ttsText;\n\n\t\t\t}\n\n\t\t\tfunction getSetNames(sets) {\n\t\t\t\tvar names = \"\";\n\t\t\t\t$.each( sets, function(i,id) {\n\t\t\t\t\tnames += $scope.sets[id] ? $scope.sets[id].name : id;\n\t\t\t\t\tif( i < sets.length-1 )\n\t\t\t\t\t\tnames += \", \";\n\t\t\t\t});\n\t\t\t\treturn names;\n\t\t\t}\n\n\n\t\t\tfunction cardToText(card, ship, fleet, indent, hideCost) {\n\n\t\t\t\tvar text = \"\";\n\t\t\t\tindent = indent || 0;\n\t\t\t\tfor( var i = 0; i < indent; i ++ )\n\t\t\t\t\ttext += \"- \";\n\n\t\t\t\tvar cost = valueOf(card,\"cost\",ship,fleet);\n\t\t\t\tvar free = valueOf(card,\"free\",ship,fleet);\n\t\t\t\tvar countSlotCost = true;\n\n\t\t\t\tif( card.type == \"resource\" )\n\t\t\t\t\tcountSlotCost = false;\n\n\t\t\t\ttext += card.name;\n\t\t\t\t//Lets cut out the dead weight\n\t\t\t\tif( card.type == \"captain\" )\n\t\t\t\t\ttext += \" \" + card.skill + \" (Captain)\";\n\t\t\t\tif( card.type == \"admiral\" )\n\t\t\t\t\ttext += \" (Admiral)\";\n\t\t\t\tif( card.type == \"ambassador\" )\n\t\t\t\t\ttext += \" (Ambassador)\";\n\t\t\t\tif( card.type == \"starship_construction\")\n\t\t\t\t  text += \" \";\n\t\t\t\tif( card.type == \"fleet-captain\" )\n\t\t\t\t\ttext += \" Fleet Captain\";\n\t\t\t\tif( card.type == \"flagship\" )\n\t\t\t\t\ttext += \" Flagship\";\n\t\t\t\tif( card.type == \"faction\" )\n\t\t\t\t\ttext += \" Faction\";\n\n\t\t\t\tif( card.type == \"ship\" ) {\n\t\t\t\t\t// Show class name for generic ships\n\t\t\t\t\ttext += card.unique ? \"\" : \" (\"+card.class+\")\";\n\t\t\t\t} else if( $scope.showSetNames ){\n\t\t\t\t\t// Show set names for non-ships\n\t\t\t\t\ttext += card.set ? \" (\" + getSetNames(card.set) + \")\" : \"\";\n\t\t\t\t}\n\n\t\t\t\t// Show cost if appropriate\n\t\t\t\tif( free )\n\t\t\t\t\tcost = 0;\n\t\t\t\tif( !hideCost )\n\t\t\t\t\ttext += \" [\" + cost + \"]\";\n\t\t\t\ttext += \"\\n\";\n\n\t\t\t\tif( card.resource ) {\n\t\t\t\t\tvar res = cardToText(card.resource, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.captain ) {\n\t\t\t\t\tvar res = cardToText(card.captain, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.admiral ) {\n\t\t\t\t\tvar res = cardToText(card.admiral, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.ambassador ) {\n\t\t\t\t\tvar res = cardToText(card.ambassador, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.construction ) {\n\t\t\t\t\tvar res = cardToText(card.construction, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\t$.each( card.upgrades || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar res = cardToText(slot.occupant, ship, fleet, indent+1);\n\t\t\t\t\t\ttext += res.text;\n\t\t\t\t\t\tif( countSlotCost )\n\t\t\t\t\t\t\tcost += res.cost;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$.each( card.upgradeSlots || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar res = cardToText(slot.occupant, ship, fleet, indent+1, !countSlotCost);\n\t\t\t\t\t\ttext += res.text;\n\t\t\t\t\t\tif( countSlotCost )\n\t\t\t\t\t\t\tcost += res.cost;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { cost: cost, text: text };\n\t\t\t}\n\n\t\t\t//Trying to see if I can make it only spit out the needed card by using the ID instead of the Name\n\t\t\tfunction cardToAltTextTTS(card, ship, fleet) {\n\n\t\t\t\tvar text = \"\";\n\n\t\t\t\tif( card.type == \"ship\" && !card.unique) {\n\t\t\t\t\t// Show class ID for generic ships\n\t\t\t\t\ttext = card.id;\n\t\t\t\t} else text = card.id;\n\n\t\t\t\ttext += \"\\n\";\n\t\t\t\tif( card.resource ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.resource, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.captain ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.captain, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.admiral ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.admiral, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.ambassador ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.ambassador, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.construction ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.construction, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\t$.each( card.upgrades || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar resB = cardToAltTextTTS(slot.occupant, ship, fleet);\n\t\t\t\t\t\ttext += resB.text;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$.each( card.upgradeSlots || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar resB = cardToAltTextTTS(slot.occupant, ship, fleet);\n\t\t\t\t\t\ttext += resB.text;\n\t\t\t\t\t\t// if( countSlotCost )\n\t\t\t\t\t\t// \tcost += resB.cost;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { cost: 0, text: text };\n\t\t\t};\n\n\t\t\tfunction fleetSheet(fleet) {\n\t\t\t\tvar fleetData = {cost:fleet.totalCost, ships:[], resource:{}};\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tvar cards = [];\n\t\t\t\t\tcardToFleetData(ship, ship, fleet, cards);\n\t\t\t\t\tcards = $.grep(cards,function(n){ return n == 0 || n });\n\t\t\t\t\tcards.sort(function(a,b){ return a.priority - b.priority; });\n\t\t\t\t\t$.each( cards, function(j, card){\n\t\t\t\t\t\tdelete card['priority'];\n\t\t\t\t\t\tcard.index = j;\n\t\t\t\t\t});\n\t\t\t\t\tfleetData.ships.push({cards:cards.slice(), cost:ship.totalCost});\n\t\t\t\t});\n\n\t\t\t\tif( fleet.resource ) {\n\t\t\t\t\tfleetData.resource.name = fleet.resource.name;\n\t\t\t\t\tfleetData.resource.cost = valueOf(fleet.resource,\"cost\",{},fleet);\n\t\t\t\t}\n\n\t\t\t\tfleetData.ships.sort(function(a,b){ return b.cost - a.cost; });\n\n\t\t\t\t$scope.fleetText = JSON.stringify(fleetData, null, 2);\n\n\t\t\t};\n\n\t\t\tfunction cardToFleetData(card, ship, fleet, card_stack) {\n\n\t\t\t\tvar data = {name:card.name,\n\t\t\t\t\t\t\t\t\t\ttype:typeConvert(card.type),\n\t\t\t\t\t\t\t\t\t\tfaction:factionConvert(card.factions),\n\t\t\t\t\t\t\t\t\t\tcost:valueOf(card,\"cost\",ship,fleet),\n\t\t\t\t\t\t\t\t\t\tpriority:0\n\t\t\t\t\t\t\t\t\t };\n\n\t\t    console.log(`${card} the data: ${data}`);\n\t\t\t\tif (card.type == \"ship\" && !card.unique)\n\t\t\t\t\tdata.name = \"Generic \" + card.class;\n\n\t\t\t\tswitch(data.type){\n\t\t\t\t\tcase \"Ship\":\n\t\t\t\t\t\tdata.priority = 0; break;\n\t\t\t\t\tcase \"Captain\":\n\t\t\t\t\t\tdata.priority = 1; break;\n\t\t\t\t\tcase \"Admiral\":\n\t\t\t\t\t\tdata.priority = 2; break;\n\t\t\t\t\tcase \"Ambassador\":\n\t\t\t\t\t\tdata.priority = 3; break;\n\t\t\t\t\tcase \"Starship Construction\":\n\t\t\t\t\t  data.priority = 4; break;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tdata.priority = 4;\n\t\t\t\t}\n\n\t\t\t\tcard_stack.push(data);\n\n\t\t\t\tif( card.resource ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.resource, ship, fleet, card_stack));\n\t\t\t\t}\n\t\t\t\tif( card.captain ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.captain, ship, fleet, card_stack));\n\t\t\t\t}\n\t\t\t\tif( card.admiral ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.admiral, ship, fleet, card_stack));\n\t\t\t\t}\n\t\t\t\tif( card.ambassador ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.ambassador, ship, fleet, card_stack));\n\t\t\t\t}\n\n\t\t\t\tif( card.construction ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.construction, ship, fleet, card_stack));\n\t\t\t\t}\n\n\t\t\t\tif(card.upgrades && card.upgrades.length > 0){\n\t\t\t\t\t$.each( card.upgrades, function(i,slot) {\n\t\t\t\t\t\tif( slot.occupant )\n\t\t\t\t\t\t\tcard_stack.push(cardToFleetData(slot.occupant, ship, fleet, card_stack));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif(card.upgradeSlots && card.upgradeSlots.length > 0){\n\t\t\t\t\t$.each( card.upgradeSlots || [], function(i,slot) {\n\t\t\t\t\t\tif( slot.occupant )\n\t\t\t\t\t\t\tcard_stack.push(cardToFleetData(slot.occupant, ship, fleet, card_stack));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfunction factionConvert(factionList){\n\t\t\t  var factions = {\n\t\t\t    \"federation\":\"FED\",\n\t\t\t    \"klingon\":\"KLI\",\n\t\t\t    \"romulan\":\"ROM\",\n\t\t\t    \"dominion\":\"DOM\",\n\t\t\t    \"borg\":\"BOR\",\n\t\t\t    \"species-8472\":\"SPE\",\n\t\t\t    \"kazon\":\"KAZ\",\n\t\t\t    \"xindi\":\"XIN\",\n\t\t\t    \"bajoran\":\"BAJ\",\n\t\t\t    \"ferengi\":\"FER\",\n\t\t\t    \"vulcan\":\"VUL\",\n\t\t\t    \"independent\":\"IND\",\n\t\t\t    \"mirror-universe\":\"MIR\",\n\t\t\t    \"q-continuum\":\"Q\"\n\t\t\t  }\n\t\t\t  var updatedFactionList = [];\n\t\t\t  $.each( factionList, function(i, faction){\n\t\t\t    if(faction in factions) updatedFactionList.push(factions[faction]);\n\t\t\t    else console.error(\"Unknown Faction: \" + faction);\n\t\t\t  });\n\t\t\t  return updatedFactionList.join('/');\n\t\t\t};\n\n\t\t\tfunction typeConvert(cardType){\n\t\t\t  var typeTable = {\n\t\t\t    \"ship\":\"Ship\",\n\t\t\t    \"captain\":\"Captain\",\n\t\t\t    \"admiral\":\"A\",\n          \"ambassador\":\"M\",\n          \"construction\": \"Starship Construction\",\n  \t\t    \"crew\":\"C\",\n\t\t\t    \"talent\":\"E\",\n\t\t\t    \"tech\":\"T\",\n\t\t\t    \"weapon\":\"W\",\n\t\t\t    \"borg\":\"B\",\n\t\t\t    \"squadron\":\"S\"\n\t\t\t  };\n\t\t\t\treturn typeTable[cardType];\n\t\t\t};\n\n\t\t}]\n\n\t};\n\n} );\n","var module = angular.module(\"utopia-missions\", [\"utopia\"]);\n\nmodule.controller( \"UtopiaSetCtrl\", [ \"$scope\", \"cardLoader\",  function($scope, cardLoader) {\n\n\t$scope.missionSets = {};\n\t$scope.missionList = [];\n\n\t$scope.viewer = {};\n\t$scope.activeSet = false;\n\t$scope.setCards = [];\n\t\n\tcardLoader( $scope.missionSets, function() {\n\n\t\tvar sourceID = location.hash ? location.hash.substring(1) : false;\n\t\t\n\t\t$.each( Object.keys( $scope.missionSets ), function(i, sourceID) {\n\t\t\tvar missionSet = $scope.missionSets[sourceID];\n\t\t\tif( missionSet.sourceID == sourceID || missionSet.name == sourceID )\n\t\t\t{$scope.viewer.missionSets = missionSet;\n\t\t\t$scope.missionList.push(missionSet);\n\t\t};\n\t\t\n\t});\n\t\n\t$scope.$watch( \"viewer.missionSets\", function(missionSet) {\n\t\t\n\t\t$scope.missionSetCards = [];\n\t\tif( missionSet ) {\n\t\t\tlocation.hash = missionSet.sourceID;\n\t\t\t$.each( $scope.cards, function(i, card) {\n\t\t\t\tif( $.inArray( missionSet.sourceID, card.missionSet ) >= 0 )\n\t\t\t\t\t$scope.setCards.push( card );\n\t\t\t});\n\t\t\t$scope.setCards.sort(displaySort);\n\t\t}\n\t\t\n\t} );\n\t\n} )\n\n}]);","var module = angular.module(\"utopia-search\", [\"utopia-card\", \"utopia-dragdrop\", \"utopia-card-loader\", \"utopia-card-rules\"]);\n\nmodule.filter( \"cardFilter\", [ \"$factions\", \"$filter\", function($factions, $filter) {\n\n\treturn function( cards, options ) {\n\n\t\tvar valueOf = $filter(\"valueOf\");\n\n\t\treturn $.map( cards, function(card) {\n\n\t\t\t// Uniqueness options\n\t\t\tif( options.unique && !card.unique && !options.generic )\n\t\t\t\treturn null;\n\n\t\t\tif( options.generic && card.unique && !options.unique)\n\t\t\t\treturn null;\n\n\t\t\t// Filter by selected expansions\n\t\t\tif( card.set && !options.ignoreSetsFilter && options.sets ) {\n\t\t\t\tvar setSelected = false;\n\t\t\t\t$.each( card.set, function(i,id) {\n\t\t\t\t\tif( options.sets[id].search )\n\t\t\t\t\t\tsetSelected = true;\n\t\t\t\t});\n\t\t\t\tif( !setSelected )\n\t\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Custom filter\n\t\t\tif( options.filterField && options.filterOperator && options.filterValue ) {\n\t\t\t\tvar value = valueOf(card,options.filterField);\n\t\t\t\tif( !value )\n\t\t\t\t\treturn null;\n\t\t\t\tswitch( options.filterOperator ) {\n\t\t\t\t\tcase \"<\": if( value >= options.filterValue ) return null; break;\n\t\t\t\t\tcase \"<=\": if( value > options.filterValue ) return null; break;\n\t\t\t\t\tcase \"=\": if( value != options.filterValue ) return null; break;\n\t\t\t\t\tcase \">=\": if( value < options.filterValue ) return null; break;\n\t\t\t\t\tcase \">\": if( value <= options.filterValue ) return null; break;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Text search\n\t\t\tif( options.query ) {\n\t\t\t\tif( card.name.toLowerCase().indexOf( options.query.toLowerCase() ) < 0 &&\n\t\t\t\t\t( !card.class || card.class.toLowerCase().indexOf( options.query.toLowerCase() ) < 0 ) &&\n\t\t\t\t\t( card.text.toLowerCase().indexOf( options.query.toLowerCase() ) < 0 ) )\n\t\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// Type selection\n\t\t\tvar noneSelected = true;\n\t\t\t$.each( options.types, function(name, data) {\n\t\t\t\tif( data.search ) {\n\t\t\t\t\tnoneSelected = false;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif( !(noneSelected || options.types[card.type].search) )\n\t\t\t\treturn null;\n\n\t\t\t// Check if we are checking a ship card and we've filtered on a\n\t\t\t// type of maneuver, check and see if this is a valid maneuver.\n\t\t\tif (options.maneuverType){\n\t\t\t\tif (card.type == \"ship\"){\n\t\t\t\t\tvar hasFilteredManeuver = false;\n\t\t\t\t\tvar maneuvers = [];\n\n\t\t\t\t\t// Build a more useful maneuver object and define a reverse\n\t\t\t\t\t$.each(Object.keys(card.classData.maneuvers), function(i, speed){\n\t\t\t\t\t\tif ($.isNumeric(speed)){\n\t\t\t\t\t\t\tvar direction_keys = Object.keys(card.classData.maneuvers[speed]);\n\t\t\t\t\t\t\t$.each(direction_keys, function(j, direction){\n\t\t\t\t\t\t\t\tmaneuver_object = {};\n\t\t\t\t\t\t\t\tmaneuver_object.direction = direction;\n\t\t\t\t\t\t\t\tmaneuver_object.difficulty = card.classData.maneuvers[speed][direction];\n\t\t\t\t\t\t\t\tmaneuver_object.speed = parseInt(speed, 10);\n\t\t\t\t\t\t\t\tif (maneuver_object.speed < 0){\n\t\t\t\t\t\t\t\t\tmaneuver_object.direction = 'reverse';\n\t\t\t\t\t\t\t\t\tmaneuver_object.speed = Math.abs(maneuver_object.speed);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tmaneuvers.push(maneuver_object);\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\t// Check all of the maneuvers against the selected maneuver direction\n\t\t\t\t\t// and, if specified, the maneuver difficulty (color)\n\t\t\t\t\t$.each(maneuvers, function(i, maneuver){\n\t\t\t\t\t\tif (options.maneuverDifficulty){\n\t\t\t\t\t\t\tif (maneuver.direction == options.maneuverType &&\n\t\t\t\t\t\t\t\t  maneuver.difficulty == options.maneuverDifficulty)\n\t\t\t\t\t\t\t\thasFilteredManeuver = true;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (maneuver.direction == options.maneuverType){\n\t\t\t\t\t\t\t\thasFilteredManeuver = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!hasFilteredManeuver) return null;\n\n\t\t\t\t} else {\n\t\t\t\t\t// If we got here, we are filtering on ship manuevers but the current\n\t\t\t\t\t// card isn't a ship, so skip it.\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// Resources skip faction\n\t\t\tif( card.type == \"resource\" )\n\t\t\t\treturn card;\n\n\t\t\t// Faction selection\n\t\t\tvar noneSelected = true;\n\t\t\tvar hasAFaction = false;\n\t\t\t$.each( options.factions, function(name, data) {\n\t\t\t\tif( data.search ) {\n\t\t\t\t\tnoneSelected = false;\n\t\t\t\t\thasAFaction |= $factions.hasFaction(card,name);\n\t\t\t\t}\n\t\t\t});\n\t\t\tif( !(noneSelected || hasAFaction) )\n\t\t\t\treturn null;\n\n\t\t\treturn card;\n\t\t});\n\n\t}\n\n}]);\n\nmodule.filter( \"sortBy\", [ \"$filter\", function($filter) {\n\n\treturn function( cards, sortBy, ascending ) {\n\t\tascending = ascending === true || ascending == \"true\";\n\t\treturn $filter(\"orderBy\")( cards, function(card) {\n\t\t\tvar value = $filter(\"valueOf\")(card,sortBy);\n\t\t\treturn value || 0;\n\t\t}, !ascending );\n\t};\n\n}]);\n\nmodule.directive( \"search\", function() {\n\n\treturn  {\n\n\t\tscope: {\n\t\t\tcards: \"=\",\n\t\t\tsets: \"=\",\n\t\t\tsetList: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tsearch: \"=searchOptions\",\n\t\t\tdefaults: \"=\",\n\t\t},\n\n\t\ttemplateUrl: \"search.html\",\n\n\t\tcontroller: [ \"$scope\", \"$factions\", function($scope, $factions) {\n\n\t\t\t// Set initial search parameters\n\t\t\t$scope.search = {\n\t\t\t\tquery: \"\",\n\t\t\t\tunique: false,\n\t\t\t\tgeneric: false,\n\t\t\t\tfactions: {},\n\t\t\t\ttypes: { \"ship\": {}, \"captain\": {}, \"admiral\": {} },\n\t\t\t\tcolumns: 1,\n\t\t\t\tsortBy: \"cost\",\n\t\t\t\tascending: \"false\",\n\t\t\t\tmaneuverType: \"\",\n\t\t\t\tmaneuverDifficulty: \"\",\n\t\t\t\tfilterField: \"\",\n\t\t\t\tfilterOperator: \"<=\",\n\t\t\t\tfilterValue: \"\",\n\t\t\t};\n\n\t\t\t$scope.defaults = localStorage.defaults ? angular.fromJson( localStorage.defaults ) : {};\n\n\t\t\t// Load search defaults\n\t\t\tif( $scope.defaults.search )\n\t\t\t\tangular.copy( $scope.defaults.search, $scope.search );\n\t\t\telse\n\t\t\t\t$scope.defaults.search = angular.copy($scope.search);\n\n\t\t\t// Clears search parameters\n\t\t\t$scope.resetSearch = function() {\n\t\t\t\t$scope.search.query = \"\";\n\t\t\t\t$scope.search.unique = false;\n\t\t\t\t$scope.search.generic = false;\n\t\t\t\t$.each( $scope.search.factions, function(i,faction) {\n\t\t\t\t\tfaction.search = false;\n\t\t\t\t} );\n\t\t\t\t$.each( $scope.search.types, function(i,types) {\n\t\t\t\t\ttypes.search = false;\n\t\t\t\t} );\n\t\t\t\t$scope.search.sortBy = $scope.defaults.search.sortBy || \"name\";\n\t\t\t\t$scope.search.ascending = $scope.defaults.search.ascending || \"true\";\n\t\t\t\t$scope.search.maneuverType = \"\";\n\t\t\t\t$scope.search.maneuverDifficulty = \"\";\n\t\t\t\t$scope.search.filterField = \"\";\n\t\t\t\t$scope.search.filterOperator = \"<=\";\n\t\t\t\t$scope.search.filterValue = \"\";\n\t\t\t};\n\n\t\t\t// Controls search results expand/collapse\n\t\t\t$scope.modifySearchColumns = function(amount) {\n\n\t\t\t\t$scope.search.columns += amount;\n\n\t\t\t\tif( $scope.search.columns < 0 )\n\t\t\t\t\t$scope.search.columns = 0;\n\n\t\t\t\tif( $scope.search.columns > 5 )\n\t\t\t\t\t$scope.search.columns = 5;\n\n\t\t\t};\n\n\t\t\t// Reset result display count when search changes\n\t\t\t$scope.$watch( \"search\", function() {\n\t\t\t\t$scope.resultLimit = 10;\n\t\t\t}, true);\n\n\t\t\t// Store changes to expansions filter\n\t\t\t$scope.$watch( \"search.sets\", function(sets) {\n\t\t\t\tif( sets )\n\t\t\t\t\tlocalStorage.sets = angular.toJson( sets );\n\t\t\t}, true);\n\n\t\t\t// Store changes to expansions filter\n\t\t\t$scope.$watch( \"defaults\", function(defaults) {\n\t\t\t\tif( defaults )\n\t\t\t\t\tlocalStorage.defaults = angular.toJson( defaults );\n\t\t\t}, true);\n\n\t\t\t// Construct faction list from hard-coded list\n\t\t\t$.each( $factions.list, function(i, faction) {\n\t\t\t\t$scope.search.factions[faction.toLowerCase().replace(/ /g,\"-\")] = {};\n\t\t\t});\n\n\t\t\t$scope.sortables = [\n\t\t\t\t{\n\t\t\t\t\tvalue: \"name\",\n\t\t\t\t\tname: \"Name\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"cost\",\n\t\t\t\t\tname: \"Cost\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"attack\",\n\t\t\t\t\tname: \"Attack\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"agility\",\n\t\t\t\t\tname: \"Agility\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"hull\",\n\t\t\t\t\tname: \"Hull\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"shields\",\n\t\t\t\t\tname: \"Shields\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"skill\",\n\t\t\t\t\tname: \"Skill Value\"\n\t\t\t\t}\n\t\t\t];\n\n\t\t\t$scope.maneuvers = [\n\t\t\t\t// TODO Un-comment straight when we add more maneuver filters\n\t\t\t\t// {\n\t\t\t\t// \tvalue: \"straight\",\n\t\t\t\t// \tname: \"Straight\"\n\t\t\t\t// },\n\t\t\t\t{\n\t\t\t\t\tvalue: \"bank\",\n\t\t\t\t\tname: \"Bank\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"turn\",\n\t\t\t\t\tname: \"Turn\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"about\",\n\t\t\t\t\tname: \"Come About\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"reverse\",\n\t\t\t\t\tname: \"Full Astern\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"spin\",\n\t\t\t\t\tname: \"Spin\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"stop\",\n\t\t\t\t\tname: \"Stop\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"flank\",\n\t\t\t\t\tname: \"Flank\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"45-degree-rotate\",\n\t\t\t\t\tname: \"Rotate 45 Degrees\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"90-degree-rotate\",\n\t\t\t\t\tname: \"Rotate 90 Degrees\"\n\t\t\t\t}\n\t\t\t]\n\n\t\t\t$scope.difficulty_list = [\n\t\t\t\t{\n\t\t\t\t\tvalue: \"green\",\n\t\t\t\t\tname: \"Green\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"white\",\n\t\t\t\t\tname: \"White\"\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tvalue: \"red\",\n\t\t\t\t\tname: \"Red\"\n\t\t\t\t}\n\t\t\t]\n\n\t\t\t$scope.$on( \"cardsLoaded\", function() {\n\t\t\t\t// Construct list of card types from those available\n\t\t\t\t$.each( $scope.cards, function(i, card) {\n\t\t\t\t\tif( !$scope.search.types[card.type] )\n\t\t\t\t\t\t$scope.search.types[card.type] = {};\n\t\t\t\t});\n\n\t\t\t\t// Load stored owned expansions\n\t\t\t\ttry {\n\t\t\t\t\t$scope.search.sets = localStorage.sets ? angular.fromJson( localStorage.sets ) : {};\n\t\t\t\t\t$scope.defaults = localStorage.defaults ? angular.fromJson( localStorage.defaults ) : {};\n\t\t\t\t} catch(e) {\n\t\t\t\t\t$scope.search.sets = {};\n\t\t\t\t\t$scope.defaults = {};\n\t\t\t\t}\n\n\t\t\t\t// Add new sets to filter\n\t\t\t\t$.each( $scope.sets, function(i, set) {\n\t\t\t\t\tif( !$scope.search.sets[set.id] ) {\n\t\t\t\t\t\tconsole.log(\"New set: \" + set.name);\n\t\t\t\t\t\t$scope.search.sets[set.id] = { search: true };\n\t\t\t\t\t}\n\t\t\t\t\t$scope.setList.push( set );\n\t\t\t\t});\n\t\t\t});\n\n\t\t\t// Uncheck all sets\n\t\t\t$scope.uncheckAllSets = function() {\n\t\t\t\t$.each( $scope.search.sets, function(i,set) {\n\t\t\t\t\tset.search = false;\n\t\t\t\t} );\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Export owned sets for import into another browser session\n\t\t\t */\n\t\t\t$scope.exportSets = function() {\n\t\t\t\tvar filename = 'utopia_owned_sets.json';\n\t\t\t\tvar ownedSets = JSON.stringify($scope.search.sets, null, 2);\n\t\t\t\tvar encodedSets = encodeURIComponent(ownedSets);\n\t\t\t\tvar encodingInfo = \"data:application/json;charset=utf-8,\"\n\t\t\t\tvar element = document.createElement('a');\n\t\t\t\tconsole.log(\"Exporting owned sets to the file \" + filename);\n\n\t\t\t\t// Generate a file download link and provide the encoded data\n\t\t\t\t// as the file source\n\t\t\t\telement.setAttribute('href', encodingInfo + encodedSets);\n\t\t\t\telement.setAttribute('download', filename);\n\t\t\t\telement.style.display = 'none';\n\t\t\t\tdocument.body.appendChild(element);\n\n\t\t\t\t// Autoclick the link and then remove the link\n\t\t\t\telement.click();\n\t\t\t\tdocument.body.removeChild(element);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Import an owned sets list from a json file\n\t\t\t * @param  {Object} inputFile The file data from the HTML File input type\n\t\t\t */\n\t\t\t$scope.importSets = function(inputFile) {\n\t\t\t\t// Multiselect should not have been on so grab the first file in the\n\t\t\t\t// array\n\t\t\t\tvar importFile = inputFile.files[0];\n\n\t\t\t\t// Create a FileReader object and create a holding place for the data\n\t\t\t\t// in the file\n\t\t\t\tvar reader = new FileReader();\n\t\t\t\tvar rawSetData = \"\";\n\n\t\t\t\t// Override the FileReader onload function to read the file in and,\n\t\t\t\t// upon completion, set the data to the processImport function for\n\t\t\t\t// processing into the browser storage\n\t\t\t\treader.onload = function(event) {\n\t\t\t\t\trawSetData = event.target.result;\n\t\t\t\t\t$scope.processSetsImport(rawSetData);\n\t\t\t\t};\n\n\t\t\t\tconsole.info(\"Opening \" + importFile.name + \" saved set file...\")\n\n\t\t\t\t// Read the file using the FileReader object with the overridden onload\n\t\t\t\treader.readAsText(importFile);\n\t\t\t};\n\n\t\t\t/**\n\t\t\t * Convert the read-in data to a JSON object and write to the browser\n\t\t\t * storage\n\t\t\t *\n\t\t\t * @param  {String} importedData Raw text imported from a file\n\t\t\t */\n\t\t\t$scope.processSetsImport = function(importedData) {\n\t\t\t\t// Parse the text to a JSON data object\n\t\t\t\tvar importedSets = JSON.parse(importedData);\n\t\t\t\tvar errorCount = 0;\n\t\t\t\t$.each(importedSets, function(i, set){\n\t\t\t\t\tif (\"search\" in set == false) errorCount++;\n\t\t\t\t});\n\n\t\t\t\t// If we found objects in the import file that didn't have the expected\n\t\t\t\t// keys, declare an error and return without loading the file into\n\t\t\t\t// the application.\n\t\t\t\tif (errorCount > 0){\n\t\t\t\t\tconsole.error(\"Owned set file import failed with \" + errorCount + \" errors found in file.\")\n\t\t\t\t} else {\n\t\t\t\t\t// Write the imported data to the file store\n\t\t\t\t\tlocalStorage.sets = angular.toJson( importedSets );\n\n\t\t\t\t\t// Refresh the application to accept the imported data\n\t\t\t\t\twindow.location.reload(true);\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Check all sets\n\t\t\t$scope.checkAllSets = function() {\n\t\t\t\t$.each( $scope.search.sets, function(i,set) {\n\t\t\t\t\tset.search = true;\n\t\t\t\t} );\n\t\t\t};\n\n\t\t}]\n\t};\n\n} );\n\nmodule.directive( \"searchFilterGroup\", function() {\n\n\treturn  {\n\n\t\tscope: {\n\t\t\ttitle: \"@\",\n\t\t},\n\n\t\ttemplateUrl: \"search-filter-group.html\",\n\n\t\ttransclude: true,\n\n\t\tlink: function(scope,element,attrs) {\n\t\t\tif( attrs.open != undefined )\n\t\t\t\tscope.showContent = true;\n\t\t},\n\n\t};\n\n} );\n","var module = angular.module(\"utopia-set-viewer\", [\"utopia\"]);\n\nmodule.controller( \"UtopiaSetCtrl\", [ \"$scope\", \"$filter\", \"cardLoader\", \"$factions\", function($scope, $filter, cardLoader, $factions) {\n\n\t$scope.cards = [];\n\t$scope.sets = {};\n\t$scope.setList = [];\n\t$scope.shipClasses = {};\n\t$scope.token = {};\n\n\t$scope.viewer = {};\n\t$scope.activeSet = false;\n\t$scope.setCards = [];\n\t\n\tcardLoader( $scope.cards, $scope.sets, $scope.shipClasses, $scope.token, function() {\n\n\t\tvar setId = location.hash ? location.hash.substring(1) : false;\n\t\t\n\t\t$.each( Object.keys( $scope.sets ), function(i, id) {\n\t\t\tvar set = $scope.sets[id];\n\t\t\tif( set.id == setId || set.name == setId )\n\t\t\t\t$scope.viewer.set = set;\n\t\t\t$scope.setList.push(set);\n\t\t});\n\t\t\n\t});\n\t\n\t$scope.$watch( \"viewer.set\", function(set) {\n\t\t\n\t\t$scope.setCards = [];\n\t\tif( set ) {\n\t\t\tlocation.hash = set.id;\n\t\t\t$.each( $scope.cards, function(i, card) {\n\t\t\t\tif( $.inArray( set.id, card.set ) >= 0 )\n\t\t\t\t\t$scope.setCards.push( card );\n\t\t\t});\n\t\t\t$scope.setCards.sort(displaySort);\n\t\t}\n\t\t\n\t} );\n\t\n\tfunction typeSort(a,b) {\n\t\tif( a.cost > b.cost )\n\t\t\treturn -1;\n\t\tif( b.cost > a.cost )\n\t\t\treturn 1;\n\t\treturn 0;\n\t}\n\t\n\tfunction displaySort(a,b) {\n\t\tif( a.type == \"ship\" && a.unique )\n\t\t\treturn -1;\n\t\tif( b.type == \"ship\" && b.unique )\n\t\t\treturn 1;\n\t\tif( a.type == b.type )\n\t\t\treturn typeSort(a,b);\n\t\tif( a.type == \"ship\" )\n\t\t\treturn -1;\n\t\tif( b.type == \"ship\" )\n\t\t\treturn 1;\n\t\tif( a.type == \"captain\" )\n\t\t\treturn -1;\n\t\tif( b.type == \"captain\" )\n\t\t\treturn 1;\n\t\tif( a.type == \"admiral\" )\n\t\t\treturn -1;\n\t\tif( b.type == \"admiral\" )\n\t\t\treturn 1;\n\t\tif( a.type == \"talent\" )\n\t\t\treturn -1;\n\t\tif( b.type == \"talent\" )\n\t\t\treturn 1;\n\t\tif( a.type == \"weapon\" )\n\t\t\treturn -1;\n\t\tif( b.type == \"weapon\" )\n\t\t\treturn 1;\n\t\tif( a.type == \"tech\" )\n\t\t\treturn -1;\n\t\tif( b.type == \"tech\" )\n\t\t\treturn 1;\n\t\tif( a.type == \"crew\" )\n\t\t\treturn -1;\n\t\tif( b.type == \"crew\" )\n\t\t\treturn 1;\n\t\treturn 0;\n\t}\n\t\n}] );","var module = angular.module(\"utopia-tooltip\", []);\n\nmodule.directive( \"tooltip\", [ \"$filter\", function($filter) {\n\t\n\treturn {\n\t\t\n\t\tscope: {\n\t\t\ttooltip: \"&\",\n\t\t\ttooltipPosition: \"@\",\n\t\t\ttooltipShow: \"=\"\n\t\t},\n\t\t\n\t\trestrict: \"A\",\n\t\t\n\t\tlink: function(scope,element,attrs) {\n\t\t\t\n\t\t\tvar initialised = false;\n\t\t\t\n\t\t\tscope.$watch( \"tooltipShow\", function(show) {\n\t\t\t\t\n\t\t\t\tif( show && !initialised ) {\n\t\t\t\t\t\n\t\t\t\t\tinitialised = true;\n\t\t\t\t\t\n\t\t\t\t\t$(element).data(\"powertipjq\",$(\"<div></div>\"));\n\t\t\t\t\t$(element).powerTip({ placement: scope.tooltipPosition || 'ne-alt' });\n\t\t\t\t\n\t\t\t\t\tvar icons = $filter(\"icons\");\n\t\t\t\t\t\t\n\t\t\t\t\t$(element).on( \"powerTipRender\", function() {\n\t\t\t\t\t\t\n\t\t\t\t\t\tvar div = $(\"<table class='card-tooltip'></table>\");\n\t\t\t\t\t\t\n\t\t\t\t\t\t$.each( scope.tooltip(), function(i,mod) {\n\t\t\t\t\t\t\tdiv.append( \"<tr><td>\" + icons(mod.source) + \"</td><td>\" + (mod.value > 0 && i > 0 ? \"+\" : \"\") + mod.value + \"</tr>\" );\n\t\t\t\t\t\t});\n\t\t\t\t\t\t\n\t\t\t\t\t\t$(\"#powerTip\").html(div);\n\t\t\t\t\t\t\n\t\t\t\t\t} );\n\t\t\t\t\t\n\t\t\t\t\tscope.$on(\"$destroy\", function() {\n\t\t\t\t\t\t$(element).powerTip(\"destroy\");\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t}\n\t\t\t\t\n\t\t\t});\n\t\t\t\n\t\t}\n\t\t\n\t}\n\t\n}]);","var module = angular.module(\"utopia\", [\"ngSanitize\", \"utopia-search\", \"utopia-card\", \"utopia-fleet-builder\", \"utopia-fleet-export\", \"utopia-card-loader\", \"utopia-card-rules\"]);\n\nmodule.factory( \"isMobile\", function() {\n\t// From detectmobilebrowsers.com\n\tvar userAgent = navigator.userAgent||navigator.vendor||window.opera;\n\treturn /(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test( userAgent )\n\t\t\t\t\t\t||\n\t\t\t\t\t  /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test( userAgent.substr(0,4) );\n} );\n\nmodule.controller( \"UtopiaCtrl\", [ \"$scope\", \"$filter\", \"cardLoader\", \"$factions\", function($scope, $filter, cardLoader, $factions) {\n\n\t$scope.defaults = {};\n\ttry {\n\t\t$scope.defaults = localStorage.defaults ? angular.fromJson( localStorage.defaults ) : false;\n\t} catch(e) {\n\t\t$scope.defaults = {};\n\t}\n\t\n\t$scope.drag = {};\n\t$scope.cards = [];\n\t$scope.sets = {};\n\t$scope.setList = [];\n\t$scope.shipClasses = {};\n\t$scope.token = {};\n\t$scope.activeFleet = { ships: [] };\n\n\t$scope.loading = true;\n\t\n\tcardLoader( $scope.cards, $scope.sets, $scope.shipClasses, $scope.token, function() {\n\n\t\t$scope.$broadcast(\"cardsLoaded\");\n\t\t$scope.loading = false;\n\t\t\n\t});\n\t\n\t// Store changes to defaults\n\t$scope.$watch( \"defaults\", function(defaults) {\n\t\tif( defaults )\n\t\t\tlocalStorage.defaults = angular.toJson( defaults );\n\t}, true);\n\n\t// TODO This is messy. Broadcasting event emitted from search.\n\t$scope.$on( \"removeFromFleetDropped\", function(ev, card) {\n\t\t$scope.$broadcast( \"removeFromFleet\", card );\n\t} );\n\t\n\t$scope.keypress = function(ev) {\n\t\tif( ev.which == 26 || (ev.which == 122 && ev.ctrlKey) ) {\n\t\t\t$scope.zoom = !$scope.zoom;\n\t\t\t$scope.$broadcast(\"zoom\",$scope.zoom);\n\t\t}\n\t}\n\t\n}]);\n","var module = angular.module(\"utopia-card-faction\", []);\n\nmodule.directive( \"cardFaction\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tfaction: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-faction.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-resource\", []);\n\nmodule.directive( \"cardResource\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tresource: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-resource.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );\n","var module = angular.module(\"utopia-card-ship-class\", []);\n\nmodule.directive( \"cardShipClass\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tshipClass: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-ship-class.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\t\t\t\n\t\t\t$scope.abs = Math.abs;\n\t\t\t\n\t\t\t$scope.speeds = [];\n\t\t\t\n\t\t\tvar m = $scope.shipClass.maneuvers;\n\t\t\t\n\t\t\tfor( var speed = m.max; speed >= m.min; speed-- ) {\n\t\t\t\tif( speed != 0 || m[\"0\"] )\n\t\t\t\t\t$scope.speeds.push(speed);\n\t\t\t}\n\t\t\t\n\t\t\tif( $scope.speeds.length < 7 && m.min > -2 )\n\t\t\t\t$scope.speeds.push(9);\n\t\t\tif( $scope.speeds.length < 7 && m.min > -1 )\n\t\t\t\t$scope.speeds.push(9);\n\t\t\t\n\t\t\twhile( $scope.speeds.length < 7 )\n\t\t\t\t$scope.speeds.unshift(9);\n\t\t\t\n\t\t\t$scope.getBaseTileName = function(ship) {\n\t\t\t\treturn ship.unique ? ship.name : ship.class;\n\t\t\t}\n\t\t\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-ship\", []);\n\nmodule.directive( \"cardShip\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-ship.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-token\", []);\n\nmodule.directive( \"cardToken\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\ttoken: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-token.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-upgrade\", []);\n\nmodule.directive( \"cardUpgrade\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tupgrade: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-upgrade.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t\t$scope.range = function(size) {\n\t\t\t\treturn new Array(size);\n\t\t\t};\n\t\t\t\n\t\t\t$scope.isDefined = function(value) {\n\t\t\t\treturn value !== undefined;\n\t\t\t};\n\t\t\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card\", [\"utopia-tooltip\", \"utopia-card-ship\", \"utopia-card-ship-class\", \"utopia-card-upgrade\", \"utopia-card-resource\", \"utopia-dragdrop\", \"utopia-valueof\"]);\n\nmodule.directive( \"card\", function() {\n\t\n\treturn  {\n\t\t\n\t\tscope: {\n\t\t\tcard: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"@\",\n\t\t},\n\t\t\n\t\trestrict: \"E\",\n\t\t\n\t\ttemplateUrl: \"card.html\",\n\t\t\n\t};\n\t\n} );\n\nmodule.filter( \"icons\", function() {\n\n\treturn function( text ) {\n\t\treturn text.replace( /\\[([^\\]]*)\\]/g, \"<i class='fs fs-$1'></i>\" ).replace( /\\n/g, \"<br/>\" );\n\t};\n\n});","var module = angular.module(\"utopia-fleet-builder\", [\"utopia-card-upgrade\",\"utopia-dragdrop\"]);\n\nmodule.directive( \"fleetBuilder\", [ \"$filter\", function($filter) {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tfleet: \"=\",\n\t\t\tcards: \"=\",\n\t\t\tsearchOptions: \"=\",\n\t\t\tdragStore: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"fleet-builder.html\",\n\n\t\tcontroller: [ \"$scope\", \"isMobile\", function($scope, isMobile) {\n\n\t\t\t$scope.isMobile = isMobile;\n\n\t\t\t$scope.$watch( \"fleet\", function(fleet) {\n\t\t\t\tlocation.hash = btoa( angular.toJson( $scope.saveFleet(fleet) ) );\n\t\t\t}, true );\n\n\t\t\t$scope.$on( \"removeFromFleet\", function(ev, card) {\n\n\t\t\t\t$scope.removeFromFleet( card, $scope.fleet );\n\n\t\t\t} );\n\n\t\t\t$scope.$on( \"zoom\", function(ev, zoom) {\n\t\t\t\t$scope.zoom = zoom;\n\t\t\t});\n\n\t\t\t$scope.setSearchTypes = function(types) {\n\n\t\t\t\t$.each( $scope.searchOptions.types, function(typeName,typeOption) {\n\t\t\t\t\ttypeOption.search = $.inArray(typeName, types) >= 0;\n\t\t\t\t});\n\n\t\t\t\tif( $scope.searchOptions.columns < 1 )\n\t\t\t\t\t$scope.searchOptions.columns = 1;\n\n\t\t\t};\n\n\t\t\t$scope.addFleetShip = function(fleet, ship) {\n\n\t\t\t\t// Check uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(ship, fleet);\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canJoinFleet = valueOf(ship,\"canJoinFleet\",ship,fleet);\n\t\t\t\tif( !canJoinFleet ) {\n\t\t\t\t\tconsole.log(\"joinFleet stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Fail if other\n\t\t\t\tif( other && other != ship ) {\n\t\t\t\t\tconsole.log(\"upgrade uniquenes check failed\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If other is this, user is moving card within fleet\n\t\t\t\tif( other ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet );\n\t\t\t\t}\n\n\t\t\t\t// Clone ship\n\t\t\t\t//ship = $.extend(true,{},ship);\n\t\t\t\tship = angular.copy(ship);\n\n\t\t\t\tfleet.ships.push( ship );\n\n\t\t\t\treturn ship;\n\n\t\t\t};\n\n\t\t\t// TODO replace references\n\t\t\t$scope.getUpgradeSlots = $filter(\"upgradeSlots\");\n\n\t\t\t$scope.isUpgradeCompatible = function(upgrade, upgradeSlot, ship, fleet) {\n\n\t\t\t\t// Ignore drop on self\n\t\t\t\tif( upgrade == upgradeSlot.occupant )\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Construct list of all slot types\n\t\t\t\tvar slotTypes = valueOf(upgradeSlot,\"type\",ship,fleet);\n\n\t\t\t\tif( upgrade.type == \"question\" ) {\n\t\t\t\t\t// Invoke special logic for question type cards\n\t\t\t\t\treturn upgrade.isSlotCompatible && upgrade.isSlotCompatible(slotTypes);\n\t\t\t\t} else {\n\t\t\t\t\t// Check normal types\n\t\t\t\t\treturn $.inArray( upgrade.type, slotTypes ) >= 0;\n\t\t\t\t}\n\n\t\t\t};\n\n\t\t\tvar valueOf = $filter(\"valueOf\");\n\n\t\t\t$scope.setUpgrade = function(fleet, ship, upgradeSlot, upgrade) {\n\n\t\t\t\t// Check slot type\n\t\t\t\tif( !$scope.isUpgradeCompatible(upgrade, upgradeSlot, ship, fleet) ) {\n\t\t\t\t\tconsole.log(\"wrong slot type\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check for drop onto self\n\t\t\t\tif( upgradeSlot.occupant == upgrade )\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(upgrade,\"canEquip\",ship,fleet,upgradeSlot);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by special card rule\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check faction interceptors\n\t\t\t\tvar canEquipFaction = valueOf(upgrade,\"canEquipFaction\",ship,fleet,upgradeSlot);\n\t\t\t\tif( !canEquipFaction ) {\n\t\t\t\t\tconsole.log(\"equip stopped by faction-specific special card rule\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Slot-specific restrictions\n\t\t\t\tif( upgradeSlot.canEquip && !upgradeSlot.canEquip(upgrade,ship,fleet,upgradeSlot) ) {\n\t\t\t\t\tconsole.log(\"upgrade rejected by slot\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(upgrade, fleet);\n\n\t\t\t\t// Fail if other\n\t\t\t\tif( other && other != upgrade && other != upgradeSlot.occupant ) {\n\t\t\t\t\tconsole.log(\"upgrade uniquenes check failed\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// If other is this, and user is moving card within fleet\n\t\t\t\tif( other && other != upgradeSlot.occupant ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, upgradeSlot.occupant );\n\t\t\t\t}\n\n\t\t\t\tupgradeSlot.occupant = angular.copy(upgrade);\n\n\t\t\t\t// Trigger onEquip handlers\n\t\t\t\tvalueOf(upgradeSlot.occupant,\"onEquip\",ship,fleet);\n\n\t\t\t\treturn upgradeSlot.occupant;\n\n\t\t\t};\n\n\t\t\t$scope.setShipResource = function(fleet,ship,resource) {\n\n\t\t\t\tif( !fleet.resource || resource.type != fleet.resource.slotType ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(resource,\"canEquip\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by special card rule\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(resource, fleet);\n\n\t\t\t\t// Fail if other\n\t\t\t\tif( other && other != upgrade && other != ship.resource ) {\n\t\t\t\t\tconsole.log(\"upgrade uniquenes check failed\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tship.resource = angular.copy(resource);\n\n\t\t\t\treturn ship.resource;\n\n\t\t\t};\n\n\t\t\t$scope.setShipCaptain = function(fleet,ship,captain) {\n\n\t\t\t\tif( captain.type != \"captain\" ) {\n\t\t\t\t\tconsole.log(\"card is not a captain\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(captain,\"canEquipCaptain\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(captain, fleet);\n\n\t\t\t\tif( other && other != captain && other != ship.captain ) {\n\t\t\t\t\tconsole.log( \"captain already in fleet\" );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Move if already in fleet\n\t\t\t\tif( other && other != ship.captain ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, ship.captain );\n\t\t\t\t}\n\n\t\t\t\t//ship.captain = $.extend(true,{}, captain);\n\t\t\t\tship.captain = angular.copy(captain);\n\n\t\t\t\treturn ship.captain;\n\n\t\t\t};\n\n\t\t\t$scope.setShipConstruction = function(fleet, ship, construction) {\n\t\t\t\tif( construction.type != \"starship_construction\" ) {\n\t\t\t\t\tconsole.log(\"card is not a starship_construction\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(construction,\"canEquipConstruction\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tship.construction = angular.copy(construction);\n\t\t\t\treturn ship.construction;\n\t\t\t};\n\n\t\t\t$scope.fleetHasAdmiral = function( fleet ) {\n\n\t\t\t\tvar hasAdmiral = false;\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.admiral ) {\n\t\t\t\t\t\thasAdmiral = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn hasAdmiral;\n\n\t\t\t};\n\n\t\t\t$scope.fleetHasAmbassador = function( fleet ) {\n\n\t\t\t\tvar hasAmbassador = false;\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.ambassador ) {\n\t\t\t\t\t\thasAmbassador = true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn hasAmbassador;\n\n\t\t\t};\n\n\t\t\t$scope.setShipAdmiral = function(fleet,ship,admiral) {\n\n\t\t\t\tif( admiral.type != \"admiral\" )\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Check interceptors\n\t\t\t\tvar canEquip = valueOf(admiral,\"canEquipAdmiral\",ship,fleet);\n\t\t\t\tif( !canEquip ) {\n\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(admiral, fleet);\n\n\t\t\t\tif( other && other != admiral && other != ship.admiral ) {\n\t\t\t\t\tconsole.log( \"admiral already in fleet\" );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Move if already in fleet\n\t\t\t\tif( other && other != ship.admiral ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, ship.admiral );\n\t\t\t\t}\n\n\t\t\t\t//ship.admiral = $.extend(true,{}, admiral);\n\t\t\t\tship.admiral = angular.copy(admiral);\n\n\t\t\t\treturn ship.admiral;\n\n\t};\n\n\t\t\t\t$scope.setShipAmbassador = function(fleet,ship,ambassador) {\n\n\t\t\t\t\tif( ambassador.type != \"ambassador\" )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t// Check interceptors\n\t\t\t\t\tvar canEquip = valueOf(ambassador,\"canEquipAmbassador\",ship,fleet);\n\t\t\t\t\tif( !canEquip ) {\n\t\t\t\t\t\tconsole.log(\"equip stopped by interceptor\");\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t// Uniqueness\n\t\t\t\tvar other = $scope.findOtherInFleet(ambassador, fleet);\n\n\t\t\t\tif( other && other != ambassador && other != ship.ambassador ) {\n\t\t\t\t\tconsole.log( \"ambassador already in fleet\" );\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// Move if already in fleet\n\t\t\t\tif( other && other != ship.ambassador ) {\n\t\t\t\t\t$scope.removeFromFleet( other, fleet, ship.ambassador );\n\t\t\t\t}\n\n\t\t\t\t//ship.ambassador = $.extend(true,{}, ambassador);\n\t\t\t\tship.ambassador = angular.copy(ambassador);\n\n\t\t\t\treturn ship.ambassador;\n\n\t\t\t};\n\n\t\t\t$scope.findOtherInFleet = function( card, fleet ) {\n\n\t\t\t\tvar clash = false;\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\n\t\t\t\t\tif( card == ship || isUniqueClash(card, ship) ) {\n\t\t\t\t\t\tclash = ship;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.captain || isUniqueClash(card, ship.captain)) {\n\t\t\t\t\t\tclash = ship.captain;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.admiral || isUniqueClash(card, ship.admiral)) {\n\t\t\t\t\t\tclash = ship.admiral;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.ambassador || isUniqueClash(card, ship.ambassador)) {\n\t\t\t\t\t\tclash = ship.ambassador;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each( $scope.getUpgradeSlots(ship), function(j, upgradeSlot) {\n\t\t\t\t\t\tif( card == upgradeSlot.occupant || isUniqueClash(card, upgradeSlot.occupant) ) {\n\t\t\t\t\t\t\tclash = upgradeSlot.occupant;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tif( clash )\n\t\t\t\t\t\treturn false;\n\n\t\t\t\t} );\n\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\t$.each( fleet.resource.upgradeSlots || [], function(i, upgradeSlot) {\n\t\t\t\t\t\tif( card == upgradeSlot.occupant || isUniqueClash(card, upgradeSlot.occupant) ) {\n\t\t\t\t\t\t\tclash = upgradeSlot.occupant;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\treturn clash;\n\n\t\t\t};\n\n\t\t\tfunction isUniqueClash( card, other ) {\n\t\t\t\treturn other && card.unique && other.unique && card.name == other.name && card.mirror == other.mirror ? other : false;\n\t\t\t}\n\n\t\t\t$scope.removeFromFleet = function( card, fleet, replaceWith ) {\n\n\t\t\t\tif( !card )\n\t\t\t\t\treturn false;\n\n\t\t\t\tif( card == fleet.resource )\n\t\t\t\t\tdelete fleet.resource;\n\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\t$.each( fleet.resource.upgradeSlots || [], function(j,slot) {\n\t\t\t\t\t\tif( card == slot.occupant ) {\n\t\t\t\t\t\t\tif( replaceWith && $scope.isUpgradeCompatible( replaceWith, slot ) )\n\t\t\t\t\t\t\t\tslot.occupant = replaceWith;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdelete slot.occupant;\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\n\t\t\t\t\tif( card == ship ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"ship\" )\n\t\t\t\t\t\t\tfleet.ships[i] = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tfleet.ships.splice(i,1);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.resource ) {\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.captain ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"captain\" )\n\t\t\t\t\t\t\tship.captain = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.captain;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.admiral ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"admiral\" )\n\t\t\t\t\t\t\tship.admiral = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.admiral;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.ambassador ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"ambassador\" )\n\t\t\t\t\t\t\tship.ambassador = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.ambassador;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tif( card == ship.construction ) {\n\t\t\t\t\t\tif( replaceWith && replaceWith.type == \"construction\" )\n\t\t\t\t\t\t\tship.construction = replaceWith;\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\tdelete ship.construction;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\n\t\t\t\t\tvar found = false;\n\n\t\t\t\t\t$.each( $scope.getUpgradeSlots(ship), function(j,slot) {\n\t\t\t\t\t\tif( card == slot.occupant ) {\n\t\t\t\t\t\t\tif( replaceWith && $scope.isUpgradeCompatible( replaceWith, slot ) )\n\t\t\t\t\t\t\t\tslot.occupant = replaceWith;\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\tdelete slot.occupant;\n\t\t\t\t\t\t\tfound = true;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\treturn !found;\n\t\t\t\t});\n\n\t\t\t\t// Trigger onRemove handlers\n\t\t\t\tvalueOf(card,\"onRemove\",{},fleet);\n\n\t\t\t};\n\n\t\t\t$scope.getTotalCost = function(ship, fleet) {\n\n\t\t\t\tvar valueOf = $filter(\"valueOf\");\n\n\t\t\t\tvar cost = valueOf(ship, \"cost\", ship, fleet);\n\n\t\t\t\tif( ship.resource ) {\n\t\t\t\t\tif( !valueOf(ship.resource,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.resource,\"cost\",ship,fleet);\n\t\t\t\t}\n\n\t\t\t\tif( ship.captain )\n\t\t\t\t\tif( !valueOf(ship.captain,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.captain,\"cost\",ship,fleet);\n\n\t\t\t\tif( ship.admiral )\n\t\t\t\t\tif( !valueOf(ship.admiral,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.admiral,\"cost\",ship,fleet);\n\n\t\t\t\tif( ship.ambassador )\n\t\t\t\t\tif( !valueOf(ship.ambassador,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.ambassador,\"cost\",ship,fleet);\n\t\t\t\t\n\t\t\t\tif( ship.construction && !valueOf(ship.construction,\"free\",ship,fleet) )\n\t\t\t\t\t\tcost += valueOf(ship.construction,\"cost\",ship,fleet);\n\n\t\t\t\t$.each( $scope.getUpgradeSlots(ship), function(i,slot) {\n\t\t\t\t\tif( slot.occupant )\n\t\t\t\t\t\tif( !valueOf(slot.occupant,\"free\",ship,fleet) )\n\t\t\t\t\t\t\tcost += valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t});\n\t\t\t\tship.totalCost = cost;\n\t\t\t\treturn cost;\n\t\t\t};\n\n\t\t\t$scope.getFleetCost = function(fleet) {\n\n\t\t\t\tvar cost = fleet.resource ? valueOf(fleet.resource,\"cost\",{},fleet) : 0;\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\t\t\t\t\tcost += $scope.getTotalCost(ship,fleet);\n\t\t\t\t});\n\t\t\t\tfleet.totalCost = cost;\n\t\t\t\treturn cost;\n\n\t\t\t};\n\n\t\t\t$scope.setFleetResource = function(fleet, resource) {\n\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\t$scope.removeFromFleet(fleet.resource, fleet);\n\n\t\t\t\tfleet.resource = resource;\n\n\t\t\t};\n\n\t\t\t// TODO Move save/load to new module\n\t\t\t$scope.saveFleet = function(fleet) {\n\n\t\t\t\tvar savedFleet = {\n\t\t\t\t\tships: []\n\t\t\t\t};\n\n\t\t\t\t// TODO Might need to save more data for some resources\n\t\t\t\tif( fleet.resource )\n\t\t\t\t\tsavedFleet.resource = saveCard(fleet.resource);\n\n\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\t\t\t\t\tsavedFleet.ships.push( saveCard(ship) );\n\t\t\t\t});\n\n\t\t\t\treturn savedFleet;\n\n\t\t\t};\n\n\t\t\tfunction saveCard(card) {\n\n\t\t\t\tif( !card )\n\t\t\t\t\treturn {};\n\n\t\t\t\tvar saved = {\n\t\t\t\t\tid: card.type+\":\"+card.id\n\t\t\t\t};\n\n\t\t\t\tif( card.resource )\n\t\t\t\t\tsaved.resource = saveCard(card.resource);\n\n\t\t\t\tif( card.captain )\n\t\t\t\t\tsaved.captain = saveCard(card.captain);\n\n\t\t\t\tif( card.admiral )\n\t\t\t\t\tsaved.admiral = saveCard(card.admiral);\n\n\t\t\t\tif( card.ambassador )\n\t\t\t\t\tsaved.ambassador = saveCard(card.ambassador);\n\t\t\t\t\n\t\t\t\tif( card.construction )\n\t\t\t\t\tsaved.construction = saveCard(card.construction);\n\n\t\t\t\tvar upgrades = [];\n\t\t\t\t// TODO Consider switching ship.upgrades to .upgradeSlots\n\t\t\t\t$.each( card.upgrades || [], function(i, slot) {\n\t\t\t\t\tvar savedSlot = {};\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tsavedSlot = saveCard(slot.occupant);\n\t\t\t\t\t}\n\t\t\t\t\tupgrades.push(savedSlot);\n\t\t\t\t});\n\t\t\t\tif( upgrades.length > 0 )\n\t\t\t\t\tsaved.upgrades = upgrades;\n\n\t\t\t\tvar upgradeSlots = [];\n\t\t\t\t$.each( card.upgradeSlots || [], function(i, slot) {\n\t\t\t\t\tvar savedSlot = {};\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tsavedSlot = saveCard(slot.occupant);\n\t\t\t\t\t}\n\t\t\t\t\tupgradeSlots.push(savedSlot);\n\t\t\t\t});\n\t\t\t\tif( upgradeSlots.length > 0 )\n\t\t\t\t\tsaved.upgradeSlots = upgradeSlots;\n\n\t\t\t\treturn saved;\n\n\t\t\t}\n\n\t\t\t$scope.findCardById = function(cards, id) {\n\n\t\t\t\tvar match = false;\n\t\t\t\t$.each( cards, function(i, card) {\n\t\t\t\t\tif( card.type+\":\"+card.id == id ) {\n\t\t\t\t\t\tmatch = card;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} )\n\t\t\t\treturn match;\n\n\t\t\t};\n\n\t\t\tfunction loadCard(fleet, cards, savedCard, ship) {\n\n\t\t\t\tvar card = angular.copy( $scope.findCardById(cards, savedCard.id) );\n\n\t\t\t\tif( !card ) {\n\t\t\t\t\tconsole.log(\"unable to load card\",savedCard.id);\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\tvar promulgate = function(card) {\n\n\t\t\t\t\tif( savedCard.resource ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.resource, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar resource = $scope.setShipResource( fleet, card, result.card );\n\t\t\t\t\t\t\tif( resource )\n\t\t\t\t\t\t\t\tresult.promulgate(resource);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.captain ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.captain, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar captain = $scope.setShipCaptain( fleet, card, result.card );\n\t\t\t\t\t\t\tif( captain )\n\t\t\t\t\t\t\t\tresult.promulgate(captain);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.admiral ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.admiral, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar admiral = $scope.setShipAdmiral( fleet, card, result.card );\n\t\t\t\t\t\t\tif( admiral )\n\t\t\t\t\t\t\t\tresult.promulgate(admiral);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.ambassador ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.ambassador, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar ambassador = $scope.setShipAmbassador( fleet, card, result.card );\n\t\t\t\t\t\t\tif( ambassador )\n\t\t\t\t\t\t\t\tresult.promulgate(ambassador);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif( savedCard.construction ) {\n\t\t\t\t\t\tvar result = loadCard(fleet, cards, savedCard.construction, card);\n\t\t\t\t\t\tif( result ) {\n\t\t\t\t\t\t\tvar construction = $scope.setShipConstruction( fleet, card, result.card );\n\t\t\t\t\t\t\tif( construction )\n\t\t\t\t\t\t\t\tresult.promulgate(construction);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t$.each( savedCard.upgrades || [], function(i, savedUpgrade) {\n\n\t\t\t\t\t\tif( savedUpgrade && savedUpgrade.id ) {\n\t\t\t\t\t\t\tvar result = loadCard( fleet, cards, savedUpgrade, card );\n\t\t\t\t\t\t\tif( !result )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tvar upgrade = $scope.setUpgrade( fleet, card, card.upgrades[i], result.card );\n\t\t\t\t\t\t\tif( !upgrade )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tresult.promulgate(upgrade);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t\t$.each( savedCard.upgradeSlots || [], function(i, savedUpgrade) {\n\n\t\t\t\t\t\tif( savedUpgrade && savedUpgrade.id ) {\n\t\t\t\t\t\t\tvar result = loadCard( fleet, cards, savedUpgrade, ship || card );\n\t\t\t\t\t\t\tif( !result )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tvar upgrade = $scope.setUpgrade( fleet, ship || card, card.upgradeSlots[i], result.card );\n\t\t\t\t\t\t\tif( !upgrade )\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\tresult.promulgate(upgrade);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t\treturn { card: card, promulgate: promulgate };\n\n\t\t\t}\n\n\t\t\t$scope.loadFleet = function(cards, savedFleet) {\n\n\t\t\t\tvar fleet = { ships: [] };\n\n\t\t\t\tif( savedFleet.resource ) {\n\t\t\t\t\tresult = loadCard( fleet, cards, savedFleet.resource );\n\t\t\t\t\tif( result ) {\n\t\t\t\t\t\tfleet.resource = result.card;\n\t\t\t\t\t\tresult.promulgate(fleet.resource);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t$.each( savedFleet.ships, function(i, savedShip) {\n\n\t\t\t\t\tvar result = loadCard( fleet, cards, savedShip );\n\n\t\t\t\t\tif( !result )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tvar ship = $scope.addFleetShip( fleet, result.card )\n\t\t\t\t\tif( !ship )\n\t\t\t\t\t\treturn;\n\n\t\t\t\t\tresult.promulgate(ship);\n\n\t\t\t\t});\n\n\t\t\t\treturn fleet;\n\n\t\t\t}\n\n\t\t\tvar hashFleet = false;\n\t\t\ttry {\n\t\t\t\thashFleet = location.hash ? angular.fromJson( atob( location.hash.substring(1) ) ) : false;\n\t\t\t} catch(e) {}\n\n\t\t\t$scope.$on(\"cardsLoaded\", function() {\n\t\t\t\tif( hashFleet ) {\n\t\t\t\t\thashFleet = $scope.loadFleet( $scope.cards, hashFleet );\n\t\t\t\t\tif( hashFleet ) {\n\n\t\t\t\t\t\t$scope.fleet = hashFleet;\n\n\t\t\t\t\t\tif( $scope.fleet.ships.length > 0 ) {\n\n\t\t\t\t\t\t\t// Hide empty slots when loading a fleet.. so it looks nice.\n\t\t\t\t\t\t\t$.each( hashFleet.ships, function(i,ship) {\n\t\t\t\t\t\t\t\tship.hideEmptySlots = true;\n\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t// Also hide search\n\t\t\t\t\t\t\t$scope.searchOptions.columns = 0;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t}]\n\n\t};\n\n}]);\n","var module = angular.module(\"utopia-valueof\", []);\n\nmodule.filter( \"removeDashes\", [ \"$filter\", function($filter) {\n\n\treturn function( str ) {\n\t\treturn str ? str.replace(/\\-/g,\" \") : str;\n\t}\n\n}]);\n\nmodule.factory( \"globalInterceptors\", function() {\n\treturn {\n\t\t// Prevent all cards from ever having a negative cost\n\t\tcost: {\n\t\t\tpriority: 1000, // Must be last to run\n\t\t\tsource: \"Cost cannot be negative\",\n\t\t\thidden: true,\n\t\t\tfn: function(card,ship,fleet,cost) {\n\t\t\t\tcost = cost instanceof Function ? cost(card,ship,fleet) : cost;\n\t\t\t\treturn cost < 0 ? 0 : cost;\n\t\t\t}\n\t\t}\n\t}\n} );\n\nmodule.filter( \"upgradeSlots\", function() {\n\n\treturn function( ship ) {\n\n\t\tvar toCheck = [];\n\t\tif( ship.resource && ship.resource.upgradeSlots )\n\t\t\ttoCheck = toCheck.concat(ship.resource.upgradeSlots);\n\t\tif( ship.captain && ship.captain.upgradeSlots )\n\t\t\ttoCheck = toCheck.concat(ship.captain.upgradeSlots);\n\t\tif( ship.admiral && ship.admiral.upgradeSlots )\n\t\t\ttoCheck = toCheck.concat(ship.admiral.upgradeSlots);\n\t\tif( ship.ambassador && ship.ambassador.upgradeSlots )\n\t\t\ttoCheck = toCheck.concat(ship.ambassador.upgradeSlots);\n\t\tif( ship.construction && ship.construction.upgradeSlots)\n\t\t\ttoCheck = toCheck.concat(ship.construction.upgradeSlots);\n\n\t\ttoCheck = toCheck.concat( ship.upgrades ).concat( ship.upgradeSlots );\n\n\t\tvar slots = [];\n\n\t\twhile( toCheck.length > 0 ) {\n\t\t\tvar slot = toCheck.shift();\n\t\t\tif( slot ) {\n\t\t\t\tslots.push( slot );\n\t\t\t\tif( slot.occupant && slot.occupant.upgradeSlots && !slot.faceDown )\n\t\t\t\t\ttoCheck = slot.occupant.upgradeSlots.concat( toCheck );\n\t\t\t}\n\t\t}\n\n\t\treturn slots;\n\n\t}\n\n} );\n\nfunction wrapInterceptors( interceptors, source, destArr ) {\n\n\tvar source = source.type ? \"[\"+source.type+\"] \" + source.name : source;\n\n\tif( interceptors instanceof Function || !interceptors.length )\n\t\tinterceptors = [interceptors];\n\n\t$.each( interceptors, function(i,interceptor) {\n\t\tif( interceptor instanceof Function )\n\t\t\tdestArr.push( { fn: interceptor, priority: 50, source: source } );\n\t\telse if( interceptor.fn ) {\n\t\t\tinterceptor.priority = interceptor.priority || 50;\n\t\t\tinterceptor.source = interceptor.source || source;\n\t\t\tdestArr.push( interceptor );\n\t\t} else {\n\t\t\tconsole.log( \"Invalid interceptor\", interceptor );\n\t\t}\n\t} );\n\n}\n\nmodule.filter( \"shipInterceptors\", [ \"$filter\", function($filter) {\n\n\tvar upgradeSlots = $filter(\"upgradeSlots\");\n\n\treturn function( card, ship, type, field, upgradeSlot ) {\n\n\t\tvar interceptors = [];\n\n\t\tvar slots = upgradeSlots(ship);\n\n\t\t$.each( slots, function(i, slot) {\n\t\t\tif( slot.occupant && slot.occupant.intercept[type][field] && !slot.faceDown )\n\t\t\t\twrapInterceptors( slot.occupant.intercept[type][field], slot.occupant, interceptors );\n\t\t\tif( (upgradeSlot && slot == upgradeSlot) || (card == slot.occupant) ) {\n\t\t\t\tif( slot.intercept && slot.intercept[type] && slot.intercept[type][field] ) {\n\t\t\t\t\twrapInterceptors( slot.intercept[type][field], slot.source || \"Unknown\", interceptors );\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\tif( ship.resource && ship.resource.intercept[type][field] )\n\t\t\twrapInterceptors( ship.resource.intercept[type][field], ship.resource, interceptors );\n\n\t\tif( ship.captain && ship.captain.intercept[type][field] )\n\t\t\twrapInterceptors( ship.captain.intercept[type][field], ship.captain, interceptors );\n\n\t\tif( ship.admiral && ship.admiral.intercept[type][field] )\n\t\t\twrapInterceptors( ship.admiral.intercept[type][field], ship.admiral, interceptors );\n\n\t\tif( ship.ambassador && ship.ambassador.intercept[type][field] )\n\t\t\t\twrapInterceptors( ship.ambassador.intercept[type][field], ship.ambassador, interceptors );\n\n\t\tif( ship.construction && ship.construction.intercept[type][field] )\n\t\t\t\twrapInterceptors( ship.construction.intercept[type][field], ship.construction, interceptors );\n\n\t\tif( ship.intercept && ship.intercept[type][field] )\n\t\t\twrapInterceptors( ship.intercept[type][field], ship, interceptors );\n\n\t\treturn interceptors;\n\n\t}\n\n}]);\n\nmodule.filter( \"interceptors\", [ \"$filter\",\"globalInterceptors\", function($filter, globalInterceptors) {\n\n\tvar shipInterceptors = $filter(\"shipInterceptors\");\n\n\treturn function( card, ship, fleet, field, upgradeSlot ) {\n\n\t\tvar interceptors = [];\n\n\t\tif( card.intercept && card.intercept.self && card.intercept.self[field] )\n\t\t\twrapInterceptors(card.intercept.self[field], card, interceptors);\n\n\t\tif( ship )\n\t\t\tinterceptors = interceptors.concat( shipInterceptors(card,ship,\"ship\",field,upgradeSlot) );\n\n\t\tif( fleet ) {\n\n\t\t\t$.each( fleet.ships || [], function(i, ship) {\n\t\t\t\tinterceptors = interceptors.concat( shipInterceptors(card,ship,\"fleet\",field) );\n\t\t\t});\n\n\t\t\tif( fleet.resource ) {\n\t\t\t\tinterceptors = interceptors.concat( shipInterceptors(card,fleet.resource,\"fleet\",field) );\n\t\t\t}\n\n\t\t}\n\n\t\tif( globalInterceptors[field] )\n\t\t\tinterceptors = interceptors.concat( globalInterceptors[field] );\n\n\t\treturn interceptors;\n\n\t}\n\n}]);\n\nmodule.filter( \"valueOf\", [ \"$filter\", function($filter) {\n\n\tvar interceptorsFilter = $filter(\"interceptors\");\n\n\treturn function( card, field, ship, fleet, upgradeSlot, options ) {\n\n\t\t// for future reference use let instead of var \n\t\t// var is function scoped meaning it is available anywhere inside the function and 'hoisted' to the top of the function\n\t\t// let is block scoped meaning it is only available within the block it is defined in( think '{' and '}' pairs) and is not hoisted to the top of the function\n\t\t// let is also not reassignable, meaning you can't redefine it in the same block\n\t\t// let is also not hoisted to the top of the function, so it is only available after it is defined\n\t\t// const is block scoped and not reassignable, but it is also not hoisted to the top of the function and is only available after it is defined\n\t\t// so I think it would be better to use let or const instead of var in most cases, var has some weird behavior that can lead to bugs\n\t\tlet data = card[field];\n\n\t\tdata = data instanceof Function ? data(card, ship, fleet) : data;\n\n\t\tlet modifiers = [ { source: \"Printed Value\", value: data } ];\n\n\t\tif( ship ) {\n\n\t\t\tlet interceptors = interceptorsFilter( card, ship, fleet, field, upgradeSlot );\n\n\t\t\tinterceptors.sort( function(a,b) {\n\t\t\t\treturn a.priority > b.priority ? 1 : -1;\n\t\t\t});\n\n\t\t\t// Replace $.each with a standard for loop - minor improvement\n\t\t\tfor (let i = 0; i < interceptors.length; i++) {\n\t\t\t\tlet interceptor = interceptors[i];\n\t\t\t\tlet dataBefore = data;\n\t\t\t\tdata = interceptor.fn(card, ship, fleet, data);\n\t\t\t\tif (data != dataBefore && !interceptor.hidden) {\n\t\t\t\t\tdata = data instanceof Function ? data(card, ship, fleet) : data;\n\t\t\t\t\tdataBefore = dataBefore instanceof Function ? dataBefore(card, ship, fleet) : dataBefore;\n\t\t\t\t\tif (data != dataBefore) {\n\t\t\t\t\t\tmodifiers.push({ source: interceptor.source, value: (data - dataBefore) });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t\tif( data instanceof Function )\n\t\t\tdata = data(card, ship, fleet);\n\n\t\tif( options && options.modifiers )\n\t\t\treturn modifiers;\n\n\t\treturn data;\n\n\t}\n\n}]);\n","var module = angular.module(\"utopia-fleet-export\", []);\n\nmodule.directive( \"fleetExport\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tfleet: \"=\",\n\t\t\tsets: \"=\",\n\t\t\tsearchOptions: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"fleet-export.html\",\n\n\t\tlink: function(scope,element) {\n\n\t\t\t$(element).find(\"textarea\").focus(function() {\n\t\t\t\t$this = $(this);\n\n\t\t\t\t$this.select();\n\n\t\t\t\twindow.setTimeout(function() {\n\t\t\t\t\t$this.select();\n\t\t\t\t}, 1);\n\n\t\t\t\t// Work around WebKit's little problem\n\t\t\t\t$this.mouseup(function() {\n\t\t\t\t\t// Prevent further mouseup intervention\n\t\t\t\t\t$this.unbind(\"mouseup\");\n\t\t\t\t\treturn false;\n\t\t\t\t});\n\t\t\t});\n\n\t\t},\n\n\t\tcontroller: [ \"$scope\", \"$filter\", function($scope, $filter) {\n\n\t\t\t$scope.fleetText = \"\";\n\t\t\t$scope.showSetNames = false;\n\t\t\t//ttsExportStyle should not load at start.\n\t\t\t$scope.ttsExportStyle = false;\n\n\t\t\tvar valueOf = $filter(\"valueOf\");\n\n\t\t\t$scope.$watch( \"fleet\", function(fleet) {\n\t\t\t\tfleetToText(fleet);\n\t\t\t}, true );\n\n\t\t\t$scope.$watch( \"showSetNames\", function() {\n\t\t\t\tfleetToText($scope.fleet);\n\t\t\t});\n\n\t\t\t//allow script to use ttsExportStyle\n\n\t\t\t// $scope.$watch( \"fleet\", function(fleet) {\n\t\t\t// \tfleetToText(fleet);\n\t\t\t// }, true );\n\n\t\t\t$scope.$watch( \"exportType\", function() {\n\t\t\t\tfleetToText($scope.fleet);\n\t\t\t});\n\n\t\t\tfunction fleetToText(fleet) {\n\t\t\t\t// if ($scope.ttsExportStyle) ttsToText(fleet);\n\t\t\t\tif ($scope.exportType == \"fleetSheet\") fleetSheet(fleet);\n\t\t\t\telse if ($scope.exportType == \"tts\") ttsToText(fleet);\n\t\t\t\telse {\n\t\t\t\t\tvar fleetText = \"\";\n\n\t\t\t\t\tvar totalCost = 0;\n\n\t\t\t\t\tfleetText += \"Save your URL for easy Reloading\\n\\n\";\n\n\t\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\n\t\t\t\t\t\tvar res = cardToText(ship,ship,fleet);\n\t\t\t\t\t\tfleetText += res.text + \"Ship Total: \" + res.cost + \" SP\\n\\n\";\n\t\t\t\t\t\ttotalCost += res.cost;\n\n\t\t\t\t\t});\n\n\t\t\t\t\tif( fleet.resource ) {\n\t\t\t\t\t\tvar res = cardToText(fleet.resource,{},fleet);\n\t\t\t\t\t\tfleetText += \"Resource: \" + res.text + \"\\n\";\n\t\t\t\t\t\ttotalCost += res.cost;\n\t\t\t\t\t}\n\n\t\t\t\t\tfleetText += \"Fleet Total: \" + totalCost + \" SP\\n\\n\";\n\n\t\t\t\t\tfleetText += `Generated by Utopia ${window.location.href.split('#')[0].replace('index.html','')}`;\n\n\t\t\t\t\t$scope.fleetText = fleetText;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t//ttsToText function to act independent of fleetToText\n\t\t\tfunction ttsToText(fleet) {\n\n\t\t\t\tvar ttsText = \"\";\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\n\t\t\t\t\tvar res = cardToAltTextTTS(ship,ship,fleet);\n\t\t\t\t\tttsText += res.text + \"\\n\";\n\t\t\t\t});\n\n\t\t\t\tif( fleet.resource ) {\n\t\t\t\t\tvar res = cardToAltTextTTS(fleet.resource,{},fleet);\n\t\t\t\t\tttsText += res.text + \"\\n\";\n\t\t\t\t}\n\n\t\t\t\tttsText += \"\\n\\n------------------------------------------\\n\"\n\t\t\t\tttsText += \"Generated by Utopia for Tabletop Simulator\";\n\t\t\t\t$scope.fleetText = ttsText;\n\n\t\t\t}\n\n\t\t\tfunction getSetNames(sets) {\n\t\t\t\tvar names = \"\";\n\t\t\t\t$.each( sets, function(i,id) {\n\t\t\t\t\tnames += $scope.sets[id] ? $scope.sets[id].name : id;\n\t\t\t\t\tif( i < sets.length-1 )\n\t\t\t\t\t\tnames += \", \";\n\t\t\t\t});\n\t\t\t\treturn names;\n\t\t\t}\n\n\n\t\t\tfunction cardToText(card, ship, fleet, indent, hideCost) {\n\n\t\t\t\tvar text = \"\";\n\t\t\t\tindent = indent || 0;\n\t\t\t\tfor( var i = 0; i < indent; i ++ )\n\t\t\t\t\ttext += \"- \";\n\n\t\t\t\tvar cost = valueOf(card,\"cost\",ship,fleet);\n\t\t\t\tvar free = valueOf(card,\"free\",ship,fleet);\n\t\t\t\tvar countSlotCost = true;\n\n\t\t\t\tif( card.type == \"resource\" )\n\t\t\t\t\tcountSlotCost = false;\n\n\t\t\t\ttext += card.name;\n\t\t\t\t//Lets cut out the dead weight\n\t\t\t\tif( card.type == \"captain\" )\n\t\t\t\t\ttext += \" \" + card.skill + \" (Captain)\";\n\t\t\t\tif( card.type == \"admiral\" )\n\t\t\t\t\ttext += \" (Admiral)\";\n\t\t\t\tif( card.type == \"ambassador\" )\n\t\t\t\t\ttext += \" (Ambassador)\";\n\t\t\t\tif( card.type == \"starship_construction\")\n\t\t\t\t  text += \" \";\n\t\t\t\tif( card.type == \"fleet-captain\" )\n\t\t\t\t\ttext += \" Fleet Captain\";\n\t\t\t\tif( card.type == \"flagship\" )\n\t\t\t\t\ttext += \" Flagship\";\n\t\t\t\tif( card.type == \"faction\" )\n\t\t\t\t\ttext += \" Faction\";\n\n\t\t\t\tif( card.type == \"ship\" ) {\n\t\t\t\t\t// Show class name for generic ships\n\t\t\t\t\ttext += card.unique ? \"\" : \" (\"+card.class+\")\";\n\t\t\t\t} else if( $scope.showSetNames ){\n\t\t\t\t\t// Show set names for non-ships\n\t\t\t\t\ttext += card.set ? \" (\" + getSetNames(card.set) + \")\" : \"\";\n\t\t\t\t}\n\n\t\t\t\t// Show cost if appropriate\n\t\t\t\tif( free )\n\t\t\t\t\tcost = 0;\n\t\t\t\tif( !hideCost )\n\t\t\t\t\ttext += \" [\" + cost + \"]\";\n\t\t\t\ttext += \"\\n\";\n\n\t\t\t\tif( card.resource ) {\n\t\t\t\t\tvar res = cardToText(card.resource, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.captain ) {\n\t\t\t\t\tvar res = cardToText(card.captain, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.admiral ) {\n\t\t\t\t\tvar res = cardToText(card.admiral, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.ambassador ) {\n\t\t\t\t\tvar res = cardToText(card.ambassador, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\tif( card.construction ) {\n\t\t\t\t\tvar res = cardToText(card.construction, ship, fleet, indent+1);\n\t\t\t\t\ttext += res.text;\n\t\t\t\t\tcost += res.cost;\n\t\t\t\t}\n\n\t\t\t\t$.each( card.upgrades || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar res = cardToText(slot.occupant, ship, fleet, indent+1);\n\t\t\t\t\t\ttext += res.text;\n\t\t\t\t\t\tif( countSlotCost )\n\t\t\t\t\t\t\tcost += res.cost;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$.each( card.upgradeSlots || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar res = cardToText(slot.occupant, ship, fleet, indent+1, !countSlotCost);\n\t\t\t\t\t\ttext += res.text;\n\t\t\t\t\t\tif( countSlotCost )\n\t\t\t\t\t\t\tcost += res.cost;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { cost: cost, text: text };\n\t\t\t}\n\n\t\t\t//Trying to see if I can make it only spit out the needed card by using the ID instead of the Name\n\t\t\tfunction cardToAltTextTTS(card, ship, fleet) {\n\n\t\t\t\tvar text = \"\";\n\n\t\t\t\tif( card.type == \"ship\" && !card.unique) {\n\t\t\t\t\t// Show class ID for generic ships\n\t\t\t\t\ttext = card.id;\n\t\t\t\t} else text = card.id;\n\n\t\t\t\ttext += \"\\n\";\n\t\t\t\tif( card.resource ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.resource, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.captain ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.captain, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.admiral ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.admiral, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.ambassador ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.ambassador, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\tif( card.construction ) {\n\t\t\t\t\tvar resB = cardToAltTextTTS(card.construction, ship, fleet);\n\t\t\t\t\ttext += resB.text;\n\t\t\t\t}\n\n\t\t\t\t$.each( card.upgrades || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar resB = cardToAltTextTTS(slot.occupant, ship, fleet);\n\t\t\t\t\t\ttext += resB.text;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\t$.each( card.upgradeSlots || [], function(i,slot) {\n\t\t\t\t\tif( slot.occupant ) {\n\t\t\t\t\t\tvar resB = cardToAltTextTTS(slot.occupant, ship, fleet);\n\t\t\t\t\t\ttext += resB.text;\n\t\t\t\t\t\t// if( countSlotCost )\n\t\t\t\t\t\t// \tcost += resB.cost;\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn { cost: 0, text: text };\n\t\t\t};\n\n\t\t\tfunction fleetSheet(fleet) {\n\t\t\t\tvar fleetData = {cost:fleet.totalCost, ships:[], resource:{}};\n\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tvar cards = [];\n\t\t\t\t\tcardToFleetData(ship, ship, fleet, cards);\n\t\t\t\t\tcards = $.grep(cards,function(n){ return n == 0 || n });\n\t\t\t\t\tcards.sort(function(a,b){ return a.priority - b.priority; });\n\t\t\t\t\t$.each( cards, function(j, card){\n\t\t\t\t\t\tdelete card['priority'];\n\t\t\t\t\t\tcard.index = j;\n\t\t\t\t\t});\n\t\t\t\t\tfleetData.ships.push({cards:cards.slice(), cost:ship.totalCost});\n\t\t\t\t});\n\n\t\t\t\tif( fleet.resource ) {\n\t\t\t\t\tfleetData.resource.name = fleet.resource.name;\n\t\t\t\t\tfleetData.resource.cost = valueOf(fleet.resource,\"cost\",{},fleet);\n\t\t\t\t}\n\n\t\t\t\tfleetData.ships.sort(function(a,b){ return b.cost - a.cost; });\n\n\t\t\t\t$scope.fleetText = JSON.stringify(fleetData, null, 2);\n\n\t\t\t};\n\n\t\t\tfunction cardToFleetData(card, ship, fleet, card_stack) {\n\n\t\t\t\tvar data = {name:card.name,\n\t\t\t\t\t\t\t\t\t\ttype:typeConvert(card.type),\n\t\t\t\t\t\t\t\t\t\tfaction:factionConvert(card.factions),\n\t\t\t\t\t\t\t\t\t\tcost:valueOf(card,\"cost\",ship,fleet),\n\t\t\t\t\t\t\t\t\t\tpriority:0\n\t\t\t\t\t\t\t\t\t };\n\n\t\t    console.log(`${card} the data: ${data}`);\n\t\t\t\tif (card.type == \"ship\" && !card.unique)\n\t\t\t\t\tdata.name = \"Generic \" + card.class;\n\n\t\t\t\tswitch(data.type){\n\t\t\t\t\tcase \"Ship\":\n\t\t\t\t\t\tdata.priority = 0; break;\n\t\t\t\t\tcase \"Captain\":\n\t\t\t\t\t\tdata.priority = 1; break;\n\t\t\t\t\tcase \"Admiral\":\n\t\t\t\t\t\tdata.priority = 2; break;\n\t\t\t\t\tcase \"Ambassador\":\n\t\t\t\t\t\tdata.priority = 3; break;\n\t\t\t\t\tcase \"Starship Construction\":\n\t\t\t\t\t  data.priority = 4; break;\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tdata.priority = 4;\n\t\t\t\t}\n\n\t\t\t\tcard_stack.push(data);\n\n\t\t\t\tif( card.resource ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.resource, ship, fleet, card_stack));\n\t\t\t\t}\n\t\t\t\tif( card.captain ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.captain, ship, fleet, card_stack));\n\t\t\t\t}\n\t\t\t\tif( card.admiral ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.admiral, ship, fleet, card_stack));\n\t\t\t\t}\n\t\t\t\tif( card.ambassador ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.ambassador, ship, fleet, card_stack));\n\t\t\t\t}\n\n\t\t\t\tif( card.construction ){\n\t\t\t\t\tcard_stack.push(cardToFleetData(card.construction, ship, fleet, card_stack));\n\t\t\t\t}\n\n\t\t\t\tif(card.upgrades && card.upgrades.length > 0){\n\t\t\t\t\t$.each( card.upgrades, function(i,slot) {\n\t\t\t\t\t\tif( slot.occupant )\n\t\t\t\t\t\t\tcard_stack.push(cardToFleetData(slot.occupant, ship, fleet, card_stack));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tif(card.upgradeSlots && card.upgradeSlots.length > 0){\n\t\t\t\t\t$.each( card.upgradeSlots || [], function(i,slot) {\n\t\t\t\t\t\tif( slot.occupant )\n\t\t\t\t\t\t\tcard_stack.push(cardToFleetData(slot.occupant, ship, fleet, card_stack));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t};\n\n\t\t\tfunction factionConvert(factionList){\n\t\t\t  var factions = {\n\t\t\t    \"federation\":\"FED\",\n\t\t\t    \"klingon\":\"KLI\",\n\t\t\t    \"romulan\":\"ROM\",\n\t\t\t    \"dominion\":\"DOM\",\n\t\t\t    \"borg\":\"BOR\",\n\t\t\t    \"species-8472\":\"SPE\",\n\t\t\t    \"kazon\":\"KAZ\",\n\t\t\t    \"xindi\":\"XIN\",\n\t\t\t    \"bajoran\":\"BAJ\",\n\t\t\t    \"ferengi\":\"FER\",\n\t\t\t    \"vulcan\":\"VUL\",\n\t\t\t    \"independent\":\"IND\",\n\t\t\t    \"mirror-universe\":\"MIR\",\n\t\t\t    \"q-continuum\":\"Q\"\n\t\t\t  }\n\t\t\t  var updatedFactionList = [];\n\t\t\t  $.each( factionList, function(i, faction){\n\t\t\t    if(faction in factions) updatedFactionList.push(factions[faction]);\n\t\t\t    else console.error(\"Unknown Faction: \" + faction);\n\t\t\t  });\n\t\t\t  return updatedFactionList.join('/');\n\t\t\t};\n\n\t\t\tfunction typeConvert(cardType){\n\t\t\t  var typeTable = {\n\t\t\t    \"ship\":\"Ship\",\n\t\t\t    \"captain\":\"Captain\",\n\t\t\t    \"admiral\":\"A\",\n          \"ambassador\":\"M\",\n          \"construction\": \"Starship Construction\",\n  \t\t    \"crew\":\"C\",\n\t\t\t    \"talent\":\"E\",\n\t\t\t    \"tech\":\"T\",\n\t\t\t    \"weapon\":\"W\",\n\t\t\t    \"borg\":\"B\",\n\t\t\t    \"squadron\":\"S\"\n\t\t\t  };\n\t\t\t\treturn typeTable[cardType];\n\t\t\t};\n\n\t\t}]\n\n\t};\n\n} );\n","module.filter( \"fleetCardNamed\", [ \"$filter\", function($filter) {\n\n\tvar shipCardNamed = $filter(\"shipCardNamed\");\n\n\treturn function( fleet, name ) {\n\n\t\tif( !fleet ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar match = false;\n\t\t$.each( fleet.ships, function(i, ship) {\n\t\t\tmatch = shipCardNamed(ship, name);\n\t\t\tif( match )\n\t\t\t\treturn false;\n\t\t});\n\n\t\treturn match;\n\n\t}\n\n}]);","\nmodule.filter( \"shipCardNamed\", [ \"$filter\", function($filter) {\n\n\tvar upgradeSlotsFilter = $filter(\"upgradeSlots\");\n\n\treturn function( ship, name ) {\n\t\tif( ship.name == name )\n\t\t\treturn ship;\n\n\t\tif( ship.captain && ship.captain.name == name )\n\t\t\treturn ship.captain;\n\n\t\tvar match = false;\n\t\t$.each( upgradeSlotsFilter(ship), function(i, slot) {\n\t\t\tif( slot.occupant && slot.occupant.name == name ) {\n\t\t\t\tmatch = slot.occupant;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\n\t\treturn match;\n\n\t}\n\n}]);","\nmodule.factory( \"$factions\", [ \"$filter\", function($filter) {\n\tvar valueOf = $filter(\"valueOf\");\n\n\t    // \"Game elements(implied any) of a sub-faction also count as their corresponding prime faction. This means that a Vulcan ship also counts\n\t    //  as a Federation ship, but a Federation ship does not count as a Vulcan ship.\"\n\n\t    // each faction paired with either itself or it's prime faction as a lookup solves this particular check\n\t\t\t// and continues to check all 'factions' as they should\n\t\t\t// because if they have a prime faction they are considered as that prime by the game rules\n\t\t\t// and if they are not they are their own 'prime faction'\n\n\t\t\t// this also has huge savings on code and complexity by handling the game's rule here as the $factions.hasFaction() func\n\t\t\t// is called less frequently and leaving the exceptional situations more to the indvidual card rules instead of implementing\n\t\t\t// a global game rule one card at a time\n\t    let primeFactionLookup = {\n\t            'federation': 'federation',\n\t                'vulcan': \"federation\",\n\t                'bajoran': \"federation\",\n\t                'klingon': 'klingon',\n\t                'romulan': 'romulan',\n\t                'dominion': 'dominion',\n\t                'independent': 'independent',\n\t                'ferengi': 'independent',\n\t                'kazon': 'independent',\n\t                'xindi': 'independent',\n\t                'borg' :'borg',\n\t                'mirror-universe': 'mirror-universe',\n\t                'species-8472': 'species-8472',\n\t                'q-continuum': 'q-continuum'\n\t            };\n\n\t    // get an array of the prime factions for the set of cardFactions as an array of strings\n\t    let getPrimeFactions = (cardFactions) => cardFactions.reduce(\n\t                (primeFactions, cardFaction) => {\n\t                    let primeFaction = primeFactionLookup[cardFaction];\n\t                    if (!primeFactions.includes(primeFaction))\n\t                        primeFactions.push(primeFaction);\n\n\t                    return primeFactions;\n\t              }, []);\n\n\t    // returns true when Card A's prime factions and Card B's prime factions intersect and therefore have the same 'prime faction' for card rules\n\t    let primeFactionMatch = (cardFaction, otherFaction) => {\n\t        return getPrimeFactions([cardFaction]).some(cardPrimeFaction => getPrimeFactions([otherFaction]).includes(cardPrimeFaction) );\n\t    }\n\n\t    var factions = {\n\t        hasFaction: function(card, faction, ship, fleet) {\n\t            if( !card )\n\t                return false;\n\t            let factions =  valueOf(card,\"factions\",ship,fleet) || [];\n\t            let primeFactions = getPrimeFactions(factions);\n\n\t            // true if it's the faction of the card OR any of the card's faction's 'prime faction'\n\t            let isConsideredInFaction = factions.includes(faction) || primeFactions.includes(faction);\n\t            return isConsideredInFaction;\n\t        },\n\t\t\thasAnyFaction: function(card, factions, ship, fleet) {\n\t\t\t\treturn factions.some(f => this.hasFaction(card, f, ship, fleet));\n\t\t\t},\n\t        match: function(card, other, ship, fleet) {\n\t            var match = false;\n\t            $.each( valueOf(card,\"factions\",ship,fleet), function(i, cardFaction) {\n\t                $.each( valueOf(other,\"factions\",ship,fleet), function(i, otherFaction) {\n\t                    //console.debug(`${card.id}:${card.name}:${cardFaction} -- ${other.id}:${other.name}:${otherFaction} ${card.name} prime factions match(${primeFactionMatch(cardFaction,  otherFaction)}): ${getPrimeFactions([cardFaction])}; ${other.id}:${other.name} prime factions: ${getPrimeFactions([otherFaction])}`);\n\t                    if( cardFaction == otherFaction || primeFactionMatch(cardFaction,  otherFaction) ) {\n\t                        match = true;\n\t                        return false;\n\t                    }\n\t                });\n\t                if( match )\n\t                    return false;\n\t            });\n\t            return match;\n\t        },\n\t        matchByPrimeFaction: function(card, other, ship, fleet) {\n\t            var match = false;\n\t            $.each( valueOf(card,\"factions\",ship,fleet), function(i, cardFaction) {\n\t                $.each( valueOf(other,\"factions\",ship,fleet), function(i, otherFaction) {\n\t                    if( primeFactionMatch(cardFaction,  otherFaction) ) {\n\t                        match = true;\n\t                        return false;\n\t                    }\n\t                });\n\t                if( match )\n\t                    return false;\n\t            });\n\t            return match;\n\t        },\n\t        list: [ \"Federation\", \"Klingon\", \"Vulcan\", \"Romulan\", \"Bajoran\", \"Dominion\", \"Independent\", \"Borg\", \"Ferengi\", \"Species 8472\", \"Kazon\", \"Mirror Universe\", \"Xindi\", \"Q Continuum\" ],\n\t    }\n\t    factions.listCodified = $.map( factions.list, function(name) {\n\t        return name.toLowerCase().replace(/ /g,\"-\");\n\t    } );\n\t    return factions;\n}]);","var module = angular.module(\"utopia-card-faction\", []);\n\nmodule.directive( \"cardFaction\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tfaction: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-faction.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-loader\", [\"utopia-card-rules\",\"utopia-card-ship\",\"utopia-card-upgrade\",\"utopia-card-resource\",\"utopia-card-faction\",\"utopia-card-token\"]);\n\nmodule.factory( \"cardLoader\", [ \"$http\", \"$filter\", \"cardRules\", \"$factions\", function($http, $filter, cardRules, $factions) {\n\n\tvar valueOf = $filter(\"valueOf\");\n\n\treturn function(cards, sets, shipClasses, token, callback) {\n\n\t\tfunction isDuplicate(card, cards) {\n\t\t\tvar dupe = false;\n\t\t\t$.each( cards, function(i,other) {\n\t\t\t\tif( card.id == other.id && card.type == other.type ) {\n\t\t\t\t\tdupe = true;\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn dupe;\n\t\t}\n\n\t\tvar shipDefaults = {\n\t\t\tcanJoinFleet: true,\n\t\t\tintercept: { ship:{}, fleet: {} }\n\t\t};\n\n\t\tfunction loadShip(ship) {\n\n\t\t\tif( isDuplicate(ship, cards) ) {\n\t\t\t\tconsole.log( \"Duplicate card definition ignored\", ship.id );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Set mirror flag\n\t\t\tif (ship.id !== \"S385\" && ship.id !== \"S318\") {\n\t\t\tship.mirror = $factions.hasFaction(ship, \"mirror-universe\");\n\t\t\t}\n\n\t\t\t// Expand shorthand upgrade slots\n\t\t\tfor( var i = 0; i < ship.upgrades.length; i++ )\n\t\t\t\tif( typeof ship.upgrades[i] == \"string\" )\n\t\t\t\t\tship.upgrades[i] = { type: [ ship.upgrades[i] ], source: \"ship\" };\n\n\t\t\t$.extend(true, ship, shipDefaults);\n\n\t\t\t// Add squadron equip rule\n\t\t\t// TODO Player can remove ship with hull > 3 after this check\n\t\t\tif( ship.squadron ) {\n\t\t\t\tship.canJoinFleet = function(ship,ship2,fleet) {\n\t\t\t\t\tvar numShipsHull4Plus = 0;\n\t\t\t\t\tvar numSquadrons = 0;\n\t\t\t\t\t$.each(fleet.ships,function(i,ship) {\n\t\t\t\t\t\tif( ship.squadron )\n\t\t\t\t\t\t\tnumSquadrons++;\n\t\t\t\t\t\telse if( ship.hull >= 4 )\n\t\t\t\t\t\t\tnumShipsHull4Plus++;\n\t\t\t\t\t});\n\t\t\t\t\treturn numShipsHull4Plus > numSquadrons;\n\t\t\t\t};\n\t\t\t}\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[ship.type+\":\"+ship.id] )\n\t\t\t\t$.extend( true, ship, cardRules[ship.type+\":\"+ship.id] );\n\n\t\t\t$.each( ship.upgradeSlots || [], function(i,slot) {\n\t\t\t\tif( !slot.source )\n\t\t\t\t\tslot.source = ship.name;\n\t\t\t} );\n\n\t\t\t// Add faction penalties to cost calculation\n\t\t\tif( ship.intercept.ship.cost )\n\t\t\t\tship.intercept.ship.cost = [ship.intercept.ship.cost];\n\t\t\telse\n\t\t\t\tship.intercept.ship.cost = [];\n\n\t\t\tship.intercept.ship.cost.push( {\n\t\t\t\tsource: \"Faction Penalty\",\n\t\t\t\tpriority: 1,\n\t\t\t\tfn: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\tif( !$factions.match( upgrade, ship, ship, fleet ) ) {\n\t\t\t\t\t\tvar penalty = valueOf(upgrade,\"factionPenalty\",ship,fleet);\n\t\t\t\t\t\treturn (cost instanceof Function ? cost(upgrade, ship, fleet, 0) : cost ) + penalty;\n\t\t\t\t\t}\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t});\n\n\n\t\t\tcards.push(ship);\n\n\t\t}\n\n\t\tvar captainDefaults = {\n\t\t\tintercept: { ship: {}, fleet: {} },\n\t\t\tcanEquip: true,\n\t\t\tcanEquipCaptain: true,\n\t\t\tcanEquipFaction: true,\n\t\t\tshowType: true,\n\t\t};\n\n\t\tfunction loadCaptain(captain) {\n\n\t\t\tif( isDuplicate(captain, cards) ) {\n\t\t\t\tconsole.log( \"Duplicate card definition ignored\", captain.id );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.extend(true, captain, captainDefaults);\n\n\t\t\tif( captain.factionPenalty == undefined )\n\t\t\t\tcaptain.factionPenalty = 1;\n\n\t\t\t// Set mirror flag\n\t\t\tcaptain.mirror = $factions.hasFaction(captain, \"mirror-universe\");\n\n\t\t\t// Add talent slots\n\t\t\tcaptain.upgradeSlots = [];\n\t\t\tfor( var i = 0; i < captain.talents || 0; i++ )\n\t\t\t\tcaptain.upgradeSlots.push( { type: [\"talent\"], source: captain.name } );\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[captain.type+\":\"+captain.id] )\n\t\t\t\t$.extend( true, captain, cardRules[captain.type+\":\"+captain.id] );\n\n\t\t\t// Set the source of any special upgrade slots\n\t\t\t$.each( captain.upgradeSlots || [], function(i,slot) {\n\t\t\t\tif( !slot.source )\n\t\t\t\t\tslot.source = captain.name;\n\t\t\t} );\n\n\t\t\tcards.push( captain );\n\n\t\t}\n\n\t\tvar admiralDefaults = {\n\t\t\tintercept: { ship: {}, fleet: {} },\n\t\t\tcanEquip: true,\n\t\t\tcanEquipAdmiral: true,\n\t\t\tcanEquipFaction: true,\n\t\t\tisSkillModifier: true,\n\t\t\tshowType: true\n\t\t};\n\n\t\tfunction loadAdmiral(admiral) {\n\n\t\t\tif( isDuplicate(admiral, cards) ) {\n\t\t\t\tconsole.log( \"Duplicate card definition ignored\", admiral.id );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.extend(true, admiral, admiralDefaults);\n\n\t\t\tif( admiral.factionPenalty == undefined )\n\t\t\t\tadmiral.factionPenalty = 3;\n\n\t\t\t// Set mirror flag\n\t\t\tadmiral.mirror = $factions.hasFaction(admiral, \"mirror-universe\");\n\n\t\t\t// Add talent slots\n\t\t\tadmiral.upgradeSlots = [];\n\t\t\tfor( var i = 0; i < admiral.talents || 0; i++ )\n\t\t\t\tadmiral.upgradeSlots.push( { type: [\"talent\"], source: admiral.name } );\n\n\t\t\t// Add skill modifier to Captain skill evaluation\n\t\t\tadmiral.intercept.ship.skill = function(upgrade,ship,fleet,skill) {\n\t\t\t\tif( upgrade == ship.captain ) {\n\t\t\t\t\tskill = (skill instanceof Function ? skill(upgrade,ship,fleet,0) : skill) + admiral.skill;\n\t\t\t\t}\n\t\t\t\treturn skill;\n\t\t\t};\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[admiral.type+\":\"+admiral.id] )\n\t\t\t\t$.extend( true, admiral, cardRules[admiral.type+\":\"+admiral.id] );\n\n\t\t\t// Set the source of any special upgrade slots\n\t\t\t$.each( admiral.upgradeSlots || [], function(i,slot) {\n\t\t\t\tif( !slot.source )\n\t\t\t\t\tslot.source = admiral.name;\n\t\t\t} );\n\n\t\t\tcards.push( admiral );\n\n\t\t}\n\n\t\tvar ambassadorDefaults = {\n\t\t\tintercept: { ship: {}, fleet: {} },\n\t\t\tcanEquip: true,\n\t\t\tcanEquipAmbassador: true,\n\t\t\tcanEquipFaction: true,\n\t\t\tisSkillModifier: true,\n\t\t\tshowType: true\n\t\t};\n\n\t\tfunction loadAmbassador(ambassador) {\n\n\t\t\tif( isDuplicate(ambassador, cards) ) {\n\t\t\t\tconsole.log( \"Duplicate card definition ignored\", ambassador.id );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.extend(true, ambassador, ambassadorDefaults);\n\n\t\t\tif( ambassador.factionPenalty == undefined )\n\t\t\t\tambassador.factionPenalty = 0;\n\n\t\t\t// Set mirror flag\n\t\t\tambassador.mirror = $factions.hasFaction(ambassador, \"mirror-universe\");\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[ambassador.type+\":\"+ambassador.id] )\n\t\t\t\t$.extend( true, ambassador, cardRules[ambassador.type+\":\"+ambassador.id] );\n\n\t\t\t// Set the source of any special upgrade slots\n\t\t\t$.each( ambassador.upgradeSlots || [], function(i,slot) {\n\t\t\t\tif( !slot.source )\n\t\t\t\t\tslot.source = ambassador.name;\n\t\t\t} );\n\n\t\t\tcards.push( ambassador );\n\n\t\t}\n\n\t\tvar constructionDefaults = {\n\t\t\tintercept: { ship: {}, fleet: {} },\n\t\t\tcanEquipConstruction: true,\n\t\t};\n\n\t\tfunction loadConstruction(construction) {\n      console.log(`Load construction card: ${construction.type}:${construction.id}`);\n\t\t\tconsole.dir(construction);\n\t\t\t$.extend(true, construction, constructionDefaults);\n\n\t\t\tif(construction.factionPenalty == undefined )\n\t\t\t\tconstruction.factionPenalty = 0;\n\n\t\t\t// Set mirror flag\n\t\t\tconstruction.mirror = $factions.hasFaction(construction, \"mirror-universe\");\n\n\t\t\tconstruction.upgradeSlots = [];\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[construction.type+\":\"+construction.id] )\n\t\t\t\t$.extend( true, construction, cardRules[construction.type+\":\"+construction.id] );\n\n\t\t\t// Set the source of any special upgrade slots\n\t\t\t$.each( construction.upgradeSlots || [], function(i,slot) {\n\t\t\t\tif( !slot.source )\n\t\t\t\t\tslot.source = construction.name;\n\t\t\t} );\n\n\t\t\tcards.push( construction );\n\n\t\t}\n\n\t\tvar upgradeDefaults = {\n\t\t\tintercept: { ship: {}, fleet: {} },\n\t\t\tcanEquip: true,\n\t\t\tcanEquipFaction: true\n\t\t};\n\n\t\tfunction loadUpgrade(upgrade) {\n\n\t\t\tif( isDuplicate(upgrade, cards) ) {\n\t\t\t\tconsole.log( \"Duplicate card definition ignored\", upgrade.id );\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t$.extend(true, upgrade, upgradeDefaults);\n\n\t\t\tif( upgrade.factionPenalty == undefined )\n\t\t\t\tupgrade.factionPenalty = 1;\n\n\t\t\t// Set mirror flag\n\t\t\tupgrade.mirror = $factions.hasFaction(upgrade, \"mirror-universe\");\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[upgrade.type+\":\"+upgrade.id] ) \n\t\t\t\t$.extend( true, upgrade, cardRules[upgrade.type+\":\"+upgrade.id] );\n\t\t\t\n\t\t\t// Set the source of any special upgrade slots\n\t\t\t$.each( upgrade.upgradeSlots || [], function(i,slot) {\n\t\t\t\tif( !slot.source )\n\t\t\t\t\tslot.source = upgrade.name;\n\t\t\t} );\n\n\t\t\tcards.push( upgrade );\n\n\t\t}\n\n\t\t// TODO Lots of extra logic for specific resources\n\t\t// Flagship, Fleet Captain, Officer Cards, Attack Fighters, Officer Exchange Program, Sideboard, High Yield Photons\n\t\t// The rest should just be a card with a fixed cost.\n\n\t\tvar resourceDefaults = {\n\t\t\tintercept: { ship: {}, fleet: {} },\n\t\t\tcanEquip: true,\n\t\t\tcanEquipFaction: true\n\t\t};\n\n\t\tfunction loadResource(resource) {\n\n\t\t\t$.extend(true, resource, resourceDefaults);\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[resource.type+\":\"+resource.id] )\n\t\t\t\t$.extend( true, resource, cardRules[resource.type+\":\"+resource.id] );\n\n\t\t\tcards.push(resource);\n\t\t}\n\n\t\t// For resource special cards or anything else that doesn't need any special handling\n\t\tfunction loadOther(card) {\n\n\t\t\t// TODO Find a better home for this. Should strictly be in rules, but would be too verbose.\n\t\t\tif( card.type == \"fleet-captain\" ) {\n\n\t\t\t\tfor( var i = 0; i < card.talentAdd; i++ )\n\t\t\t\t\t// Special talent slot, which allows a free talent if captain already has an empty talent slot\n\t\t\t\t\tcard.upgradeSlots.push( {\n\t\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\t\tsource: \"Fleet Captain\",\n\t\t\t\t\t\trules: \"Free talent if Captain has an empty talent slot\",\n\t\t\t\t\t\tshowOnCard: true,\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\tcost: {\n\t\t\t\t\t\t\t\t\tpriority: -1,\n\t\t\t\t\t\t\t\t\tfn: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\t\t\t\t\tif( !ship.captain )\n\t\t\t\t\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t\t\t\tvar slots = $filter(\"upgradeSlots\")(ship.captain);\n\t\t\t\t\t\t\t\t\t\tvar emptyTalentSlot = false;\n\t\t\t\t\t\t\t\t\t\t$.each(slots, function(i,slot) {\n\t\t\t\t\t\t\t\t\t\t\tif( slot.type.indexOf(\"talent\") >= 0 && !slot.occupant )\n\t\t\t\t\t\t\t\t\t\t\t\temptyTalentSlot = true;\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\treturn emptyTalentSlot ? 0 : cost;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\tfor( var i = 0; i < card.techAdd; i++ )\n\t\t\t\t\tcard.upgradeSlots.push( { type: [\"tech\"], source: \"Fleet Captain\", showOnCard: true } );\n\t\t\t\tfor( var i = 0; i < card.weaponAdd; i++ )\n\t\t\t\t\tcard.upgradeSlots.push( { type: [\"weapon\"], source: \"Fleet Captain\", showOnCard: true } );\n\t\t\t\tfor( var i = 0; i < card.crewAdd; i++ )\n\t\t\t\t\tcard.upgradeSlots.push( { type: [\"crew\"], source: \"Fleet Captain\", showOnCard: true } );\n\n\t\t\t\t// Add skill modifier to Captain skill evaluation\n\t\t\t\tcard.intercept.ship.skill = function(upgrade,ship,fleet,skill) {\n\t\t\t\t\tif( upgrade == ship.captain ) {\n\t\t\t\t\t\tskill = (skill instanceof Function ? skill(upgrade,ship,fleet,0) : skill) + card.skill;\n\t\t\t\t\t}\n\t\t\t\t\treturn skill;\n\t\t\t\t};\n\n\t\t\t}\n\n\t\t\t// TODO Same as above\n\t\t\tif( card.type == \"flagship\" ) {\n\t\t\t\tvar flagship = card;\n\t\t\t\tflagship.intercept.ship = {\n\t\t\t\t\tattack: function(card,ship,fleet,attack) {\n\t\t\t\t\t\tif( card == ship && ship.type != \"flagship\" )\n\t\t\t\t\t\t\treturn (attack instanceof Function ? attack(card,ship,fleet,0) : attack) + flagship.attack;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\tagility: function(card,ship,fleet,agility) {\n\t\t\t\t\t\tif( card == ship && ship.type != \"flagship\" )\n\t\t\t\t\t\t\treturn (agility instanceof Function ? agility(card,ship,fleet,0) : agility) + flagship.agility;\n\t\t\t\t\t\treturn agility;\n\t\t\t\t\t},\n\t\t\t\t\thull: function(card,ship,fleet,hull) {\n\t\t\t\t\t\tif( card == ship && ship.type != \"flagship\" )\n\t\t\t\t\t\t\treturn (hull instanceof Function ? hull(card,ship,fleet,0) : hull) + flagship.hull;\n\t\t\t\t\t\treturn hull;\n\t\t\t\t\t},\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship && ship.type != \"flagship\" )\n\t\t\t\t\t\t\treturn (shields instanceof Function ? shields(card,ship,fleet,0) : shields) + flagship.shields;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tif( card.type == \"token\") {\n\t\t\t\tif( token[card.id] ) {\n\t\t\t\t\tconsole.log(\"Duplicate token\",card.id,card.name);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\ttoken[card.id] = card;\n\t\t\t}\n\n\t\t\t// Apply specific card rules\n\t\t\tif( cardRules[card.type+\":\"+card.id] )\n\t\t\t\t$.extend( true, card, cardRules[card.type+\":\"+card.id] );\n\n\t\t\tcards.push(card);\n\n\t\t}\n\n\t\tfunction loadSet(set) {\n\n\t\t\tif( sets[set.id] ) {\n\t\t\t\tconsole.log(\"Duplicate set\",set.id,set.name);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tsets[set.id] = set;\n\n\t\t}\n\n\t\tfunction loadShipClass(shipClass) {\n\n\t\t\tif( shipClasses[shipClass.id] ) {\n\t\t\t\tconsole.log(\"Duplicate ship class\",shipClass.id,shipClass.name,shipClasses[shipClass.id].name);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tshipClasses[shipClass.id] = shipClass;\n\n\t\t}\n\n\t\tfunction loadCopies( copies ) {\n\n\t\t\t$.each( copies || [], function(i,copy) {\n\t\t\t\t$.each( cards, function(i,card) {\n\t\t\t\t\tif( card.id == copy.of ) {\n\t\t\t\t\t\tcard.set = card.set.concat(copy.set);\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\n\t\t}\n\n\t\t$http.get( \"data/data.json\" ).success( function(data) {\n\n\t\t\tvar copies = [];\n\n\t\t\t$.each( data.sets || [], function(i,set) {\n\t\t\t\tif( set.type == \"copy\" )\n\t\t\t\t\tcopies.push(set);\n\t\t\t\telse\n\t\t\t\t\tloadSet(set);\n\t\t\t});\n\n\t\t\t$.each( data.ships || [], function(i,ship) {\n\t\t\t\tif( ship.type == \"copy\" )\n\t\t\t\t\tcopies.push(ship);\n\t\t\t\telse\n\t\t\t\t\tloadShip(ship);\n\t\t\t});\n\n\t\t\t$.each( data.shipClasses || [], function(i,shipClass) {\n\t\t\t\tif( shipClass.type == \"copy\" )\n\t\t\t\t\tcopies.push(shipClass);\n\t\t\t\telse\n\t\t\t\t\tloadShipClass(shipClass);\n\t\t\t});\n\n\t\t\t$.each( data.captains || [], function(i,captain) {\n\t\t\t\tif( captain.type == \"copy\" )\n\t\t\t\t\tcopies.push(captain);\n\t\t\t\telse\n\t\t\t\t\tloadCaptain(captain);\n\t\t\t});\n\n\t\t\t$.each( data.admirals || [], function(i,admiral) {\n\t\t\t\tif( admiral.type == \"copy\" )\n\t\t\t\t\tcopies.push(admiral);\n\t\t\t\telse\n\t\t\t\t\tloadAdmiral(admiral);\n\t\t\t});\n\n\t\t\t$.each( data.ambassadors || [], function(i,ambassador) {\n\t\t\t\tif( ambassador.type == \"copy\" )\n\t\t\t\t\tcopies.push(ambassador);\n\t\t\t\telse\n\t\t\t\t\tloadAmbassador(ambassador);\n\t\t\t});\n\n\t\t\t$.each( data.starship_construction || [], function(i, construction) {\n\t\t\t\tif( construction.type == \"copy\" )\n\t\t\t\t\tcopies.push(construction);\n\t\t\t\telse\n\t\t\t\t\tloadConstruction(construction);\n\t\t\t});\n\n\t\t\t$.each( data.upgrades || [], function(i,upgrade) {\n\t\t\t\tif( upgrade.type == \"copy\" )\n\t\t\t\t\tcopies.push(upgrade);\n\t\t\t\telse\n\t\t\t\t\tloadUpgrade(upgrade);\n\t\t\t});\n\n\t\t\t$.each( data.resources || [], function(i,resource) {\n\t\t\t\tif( resource.type == \"copy\" )\n\t\t\t\t\tcopies.push(resource);\n\t\t\t\telse\n\t\t\t\t\tloadResource(resource);\n\t\t\t});\n\n\t\t\t$.each( data.others || [], function(i,card) {\n\t\t\t\tif( card.type == \"copy\" )\n\t\t\t\t\tcopies.push(card);\n\t\t\t\telse\n\t\t\t\t\tloadOther(card);\n\t\t\t});\n\n\t\t\tloadCopies(copies);\n\n\t\t\t// Assign classes to ships\n\t\t\t$.each( cards, function(i,card) {\n\t\t\t\tif( card.type == \"ship\" ) {\n\t\t\t\t\tif( card.classId && shipClasses[card.classId] ) {\n\t\t\t\t\t\tcard.classData = shipClasses[card.classId];\n\t\t\t\t\t} else {\n\t\t\t\t\t\t$.each( shipClasses, function(id,shipClass) {\n\t\t\t\t\t\t\tif( shipClass.name == card.class ) {\n\t\t\t\t\t\t\t\tcard.classId = id;\n\t\t\t\t\t\t\t\tcard.classData = shipClass;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\tif( !card.classId || !card.classData || !shipClasses[card.classId] )\n\t\t\t\t\t\tconsole.log( \"No class for ship\", card.id, card.name, card.class, card.classId );\n\t\t\t\t}\n\t\t\t\tif( card.hasTokenInfo && token[card.tokenId] ) {\n\t\t\t\t\tcard.tokenData = token[card.tokenId];\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif( callback )\n\t\t\t\tcallback();\n\n\t\t});\n\n\t};\n\n}]);\n","var module = angular.module(\"utopia-card-resource\", []);\n\nmodule.directive( \"cardResource\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tresource: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-resource.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );\n","var module = angular.module(\"utopia-card-rules\", [\"utopia-valueof\"]);\n\nmodule.factory( \"cardRules\", [ \"$filter\", \"$factions\", function($filter, $factions) {\n\n\tvar valueOf = $filter(\"valueOf\");\n\n\tvar onePerShip = function(name) {\n\t\treturn function(upgrade,ship,fleet) {\n\n\t\t\tvar alreadyEquipped = false;\n\t\t\tvar slots = $filter(\"upgradeSlots\")(ship);\n\t\t\t$.each( slots, function(i,slot) {\n\t\t\t\tif( slot.occupant && slot.occupant != upgrade && slot.occupant.name == name ) {\n\t\t\t\t\talreadyEquipped = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\treturn !alreadyEquipped;\n\n\t\t};\n\t};\n\n\tvar upgradeTypes = [\"crew\",\"weapon\",\"tech\",\"talent\",\"question\",\"borg\"];\n\n\tvar isUpgrade = function(card) {\n\t\treturn $.inArray( card.type, upgradeTypes ) >= 0;\n\t};\n\n\tvar resolve = function(card,ship,fleet,value) {\n\t\treturn value instanceof Function ? value(card,ship,fleet) : value;\n\t};\n\n\tvar hasFaction = $factions.hasFaction;\n\n\t//Add a new var to serch for the value of the modifyer \"Printed Value\"\n//\tvar printedValue = upgrade.printedValue;\n\n\n\tvar cloneSlot = function(count, slot) {\n\t\tvar slots = [slot];\n\t\tfor( var i = 1; i < count; i++ )\n\t\t\tslots.push( angular.copy(slot) );\n\t\treturn slots;\n\t};\n\n\tvar createFirstMajeSlot = function() {\n\t\treturn {\n\t\t\ttype: [\"talent\"],\n\t\t\trules: \"First Maje Only\",\n\t\t\thide: function(slot,ship,fleet) {\n\t\t\t\treturn !hasFaction(ship.captain,\"kazon\",ship,fleet);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\tconsole.log(canEquip);\n\t\t\t\t\t\tif( card.name != \"First Maje\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tvar getSlotType = function(upgrade,ship) {\n\t\tvar type = [\"weapon\"];\n\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i, slot) {\n\t\t\tif( slot.occupant && slot.occupant.name == upgrade.source ) {\n\t\t\t\t//console.log(slot.type, i);\n\t\t\t\ttype = slot.type;\n\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\n\t\treturn type;\n\t}\n\n\t/**\n\t * A function to check if assigned upgrade type matches or slot matches as appropriate\n\t *\n\t * @param {string} type Upgrade/Slot type to check against\n\t * @param {Object} upgrade The upgrade who's assigned slot we want to check\n\t * @param {Object} ship The current assigned ship\n\t * @returns {boolean}\n\t */\n\tvar checkUpgrade = function(type, upgrade, ship){\n\t\t/** Default return value is false */\n\t\tvar returnValue = false;\n\n\t\tif (upgrade.type == type)\n\t\t\treturnValue = true;\n\n\t\t/** Only check for question type upgrades with countsAsUpgrade set to true */\n\t\telse if (upgrade.type == \"question\" && upgrade.countsAsUpgrade) {\n\t\t\t/** List of slots on current ship */\n\t\t\tvar slots = $filter(\"upgradeSlots\")(ship);\n\n\t\t\t/** Loop over all of the slots on the ship */\n\t\t\tfor ( var i = 0; i < slots.length; i++){\n\n\t\t\t\t/** See if the slot is occupied by the upgrade and is the right type */\n\t\t\t\tif (slots[i].occupant &&\n\t\t\t\t\t  slots[i].occupant.id == upgrade.id &&\n\t\t\t\t\t  $.inArray(type, slots[i].type) > -1){\n\n\t\t\t\t\t\t/** If so, set to return true and break out of the loop */\n\t\t\t\t\t\treturnValue = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn returnValue;\n\t}\n\n\tvar getOccupiedSlot = function(upgrade, ship){\n\t\tvar id = upgrade.id;\n\t\tfor ( var i = 0; i < ship.upgrades.length; i++) {\n\t\t\tvar slotUpgrade = ship.upgrades[i];\n\t\t\tif (slotUpgrade?.occupant?.id == id) {\n\t\t\t\treturn slotUpgrade;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tvar hasDaharMaster = function(card){\n\t\tvar foundDaharMasterTalent = false;\n\t\tcard.upgradeSlots.forEach(element => {\n\t\t\tif (element.occupant) {\n\t\t\t\tif (element.occupant.name === \"Dahar Master\") {\n\t\t\t\t\tfoundDaharMasterTalent = true;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\treturn foundDaharMasterTalent\n\n\t}\n\n\t\n\t// the following return object represents a massive lookup table to resolve special card rules by a key of \"cardType:cardId\"\n\treturn {\n\n\t//Generic Captains\n\t\t//Federation\n\t\t\"captain:Cap101\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"bajoran\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1;\n\t\t\t},\n\t\t},\n\n\t\t//Bajoran\n\t\t\"captain:Cap112\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"federation\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"It Won't Be Installed Until Tuesday Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"It Won't Be Installed Until Tuesday\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\t//Vulcan\n\t\t\"captain:Cap115\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"bajoran\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"federation\", ship, fleet ) ? 0 : 1;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"It Won't Be Installed Until Tuesday Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"It Won't Be Installed Until Tuesday\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\t//independent\n\t\t\"captain:Cap111\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"kazon\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"xindi\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Ferengi\n\t\t\"captain:Cap114\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"independent\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"kazon\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"xindi\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Kazon\n\t\t\"captain:Cap113\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"independent\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"xindi\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Xindi\n\t\t\"captain:Cap116\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"kazon\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"independent\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\n//These Are The Voyages\n\t\n\t//Enterprise NX-01\n\t\"ship:S404\":{\n\t\tupgradeSlots: [ {\n\t\t\ttype: [\"starship_construction\"],\n\t\t\trules: \"May equip Federation Prototype\",\n\t\t\tcanEquipConstruction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.construction.id == \"Con001\"\n\t\t\t}\n\t\t}]\n\t},\t\n\n\t//Jonathan Archer\n\t\"captain:Cap039\":{\n\t\t//Adds 1 crew upgrade slot and 1 slot for Porthos (the best boy)\n\t\tupgradeSlots: [ {}, { \n\t\t\ttype: [\"crew\"]\n\t\t},\n\t\t{\ttype: [\"crew\"],\n\t\t\trules: \"Porthos Only\",\n\t\t\tcanEquip: function(upgrade) {\n\t\t\t\treturn upgrade.id == \"C447\";\n\t\t\t}\n\t\t} ]\n\t},\n\n\t//Erika Hernandez\n\t\"captain:Cap042\":{\n\t\t//Adds 1 crew upgrade slot\n\t\tupgradeSlots: [ {}, {\n\t\t\ttype: [\"crew\"]\n\t\t}],\n\t\t//Can only be equipped to a Federation NX Class\n\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Federation NX Class\"\n\t\t}\n\t},\n\n\t//Edward Jellico\n\t\"captain:Cap050\":{\n\t\tupgradeSlots: [ {} ],\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\treturn ship.hull >= 5;\n\t\t}\n\t},\n\n\t//James T. Kirk (Admiral)\n\t\"admiral:A044\": {\n\t\tupgradeSlots: [ {},\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//T'Pol\n\t\"crew:C436\":{\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//William T. Riker\n\t\"crew:C440\":{\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Malcolm Reed\n\t\"crew:C444\": {\n\t\tupgradeSlots: [ {\n\t\t\ttype: [\"weapon\"],\n\t\t\trules: \"May equip Phase Cannons for free\",\n\t\t\tCanEquip: function(upgrade) {\n\t\t\t\treturn upgrade.name == \"Phase Cannons\";\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif (!$factions.match(card,ship,ship,fleet) )\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\telse if( $factions.match(card,ship,ship,fleet) )\n\t\t\t\t\treturn 0;\n\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}]\n\n\t},\n\n\t//Charles Tucker III\n\t\"crew:C445\" :{\n\t\t//Can only be equipped to ships with a Hull of 3 or less\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn ship.hull <= 3;\n\t\t}\n\t},\n\t\n\t//J. Hayes\n\t\"crew:C446\":{\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) +1;\n\t\t\t\t\treturn skill;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Porthos\n\t\"crew:C447\":{\n\t\t//Can only be equipped to a Federation Captain\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//Reginald Barclay\n\t\"crew:C463\": {\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\"],\n\t\t\t\trules: \"You may only equip ? upgrades in this slot\"\n\t\t\t}\n\t\t],\n\t\t//Can only be equipped to a Federation Captain\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship, \"federation\", ship, fleet) || hasFaction(ship, \"bajoran\", ship, fleet) || hasFaction(ship, \"vulcan\", ship, fleet);\n\t\t},\n\t},\n\n\t//Katherine Pulaski\n\t\"crew:C465\": {\n\t\t//Can only be equipped to a Federation Captain\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//Padraig Daniels\n\t\"crew:C468\":{\n\t\t//Can only be equipped to a Federation Ship\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship, \"federation\", ship, fleet) || hasFaction(ship, \"bajoran\", ship, fleet) || hasFaction(ship, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//Sito Jaxa\n\t\"crew:C472\": {\n\t\t//Can only be equipped to a Federation Captain\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//Tasha Yar\n\t\"crew:C476\":{\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"weapon\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Miles O'Brien\n\t\"crew:C477\": {\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\"],\n\t\t\t\trules: \"May equip Transporter Room Upgrade\",\n\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\treturn upgrade.id == \"T308\";\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\n\t//Leah Brahms\n\t\"crew:C478\": {\n\t\t//Can only be equipped to a Federation Ship\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship, \"federation\", ship, fleet) || hasFaction(ship, \"bajoran\", ship, fleet) || hasFaction(ship, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//These Are The Voayages...\n\t\"talent:E233\": {\n\t\t//Can only be equipped to a Federation Captain\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//Explore Strange New Worlds...\n\t\"talent:E234\": {\n\t\t//Can only be equipped to a Federation Captain\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//To Boldly Go...\n\t\"talent:E235\": {\n\t\t//Can only be equipped to a Federation Captain\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t}\n\t},\n\n\t//Fly Her Apart Then!\n\t\"talent:E236\": {\n\t\t//Can only be equipped to a Federation Captain and an Excelsior Class ship\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet) || $factions.hasFaction(ship.captain,\"bajoran\", ship, fleet) || $factions.hasFaction(ship.captain,\"vulcan\", ship, fleet) ) && ship.class == \"Excelsior Class\";\n\t\t}\n\t},\n\t\n\t//It Won't Be Installed Until Tuesday\n\t\"talent:E237\": {\n\t\t//Can only be equipped to a Federation Captain and an Excelsior Class ship\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet) || $factions.hasFaction(ship.captain,\"bajoran\", ship, fleet) || $factions.hasFaction(ship.captain,\"vulcan\", ship, fleet) ) && ship.captain.skill <= 5;\n\t\t}\t\t\n\t},\n\n\t//Tuesday (Crew)\n\t\"crew:C483\": {\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"crew\"],\n\t\t\t\trules: \"Costs -2 SP\",\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) -2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t}, \n\n\t//Tuesday (Weapon)\n\t\"weapon:W251\": {\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"weapon\"],\n\t\t\t\trules: \"Costs -2 SP\",\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) -2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t},\n\n\t//Tuesday (Tech)\n\t\"tech:T312\": {\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\"],\n\t\t\t\trules: \"Costs -2 SP\",\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) -2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t},\n\n\t//Phase Cannons\n\t\"weapon:W247\": {\n\t\t//Can only equip one and to a Federation NX Class only\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Federation NX Class\" && onePerShip(\"Phase Cannons\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\t//Type 8 Phaser Array\n\t\"weapon:W249\": {\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\tif( ship.attack <= 3 )\n\t\t\t\treturn true;\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t//Transporter Room\n\t\"tech:T308\": {\n\t\t//Can only equip one\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Transporter Room\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\t//Enhanced Tractor Emitters\n\t\"tech:T309\": {\n\t\t//Can only equip one\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Enhanced Tractor Emitters\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\t//Navigational Deflector\n\t\"tech:T311\": {\n\t\t//Can only equip one\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Navigational Deflector\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\t//Tea, Earl Grey, Hot\n\t\"question:Q034\": {\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Tea, Earl Grey, Hot\")(upgrade,ship,fleet);\n\t\t},\n\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >=0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t},\n\n\t\t//All non-Federation ships pay +1 SP to equip\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship && !$factions.hasFaction(ship, \"federation\", ship, fleet) || $factions.hasFaction(ship, \"bajoran\", ship, fleet) || $factions.hasFaction(ship, \"vulcan\", ship, fleet))\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) +1;\n\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t},\n\n\t//Tactical Data Link\n\t\"question:Q035\": {\n\t\ttype: \"question\",\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >=0;\n\t\t},\n\t\t//Can only equip one and to a Sovereign Class\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Sovereign Class\" && onePerShip(\"Tactical Data Link\");\n\t\t}\n\t},\n\t\n\n\t//Systems Upgrade\n\t\"question:Q036\": {\n\t\ttype: \"question\",\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0;\n\t\t},\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\"]\n\t\t\t}\n\t\t],\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\treturn shields;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tcanEquip: onePerShip(\"Systems Upgrade\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn ($factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || $factions.hasFaction(ship,\"vulcan\", ship, fleet));\n\t\t}\n\t},\n\n\t//James T. Kirk Admiral Slot\n\t\"question:Q037\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t},\n\t\ttype: \"question\",\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray(\"tech\", slotTypes) >=0 || $.inArray( \"weapon\", slotTypes ) >=0 || $.inArray( \"crew\", slotTypes) >= 0;\n\t\t},\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"admiral\"],\n\t\t\t\trules: \"May equip Federation Admiral with a cost of 4 SP or less.\"\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t}\n\t\t\t}\n\t\t],\n\t},\n\n\t//Enhanced Hull Plating\n\t\"starship_construction:Con003\": {\n\t\t//Can only equip one and to a Federation NX Class\n\t\tcanEquipConstruction: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Federation NX Class\" && onePerShip(\"Enhanced Hull Plating\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\t//Dominion War Retrofit\n\t\"starship_construction:Con004\": {\n\t\t//Creates a new tech, weapon, or crew slot\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\", \"weapon\", \"crew\"]\n\t\t\t}\n\t\t],\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\t//Adds +1 Shield to the stat bar when equipped to a ship\n\t\t\t\tshields: function(card, ship, fleet, shields) {\n\t\t\t\t\tif( card == ship) {\n\t\t\t\t\t\treturn resolve(card, ship, fleet, shields) +1;\n\t\t\t\t\t}\n\t\t\t\t\treturn shields;\n\t\t\t\t},\n\t\t\t\t//Adds +1 Hull stat to the Miranda, Excelsior, and Galaxy Classes\n\t\t\t\thull: function(card, ship, fleet, hull) {\n\t\t\t\t\tif (ship.class == \"Miranda Class\" || ship.class == \"Excelsior Class\" || ship.class == \"Galaxy Class\") {\n\t\t\t\t\t\treturn resolve(card,ship,fleet,hull) +1;\n\t\t\t\t\t}\n\t\t\t\t\treturn hull;\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\t//Can only be equipped to a Federation, Klingon, or Romulan ship.\n\t\tcanEquipConstruction: function(upgrade,ship,fleet) {\n\t\t\treturn ship && ( $factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || $factions.hasFaction(ship,\"vulcan\", ship, fleet) || $factions.hasFaction(ship,\"klingon\", ship, fleet) || $factions.hasFaction(ship,\"romulan\", ship,fleet) );\n\t\t}\n\t},\n\n//Adversaires of the Delta Quadrant\n\n\t//Iden\n\t\"captain:Cap037\":{\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcanEquipAdmiral: function (captain, ship, fleet) {\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t\tcanEquipAmbassador: function (captain, ship, fleet) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Dala\n\t\"captain:Cap031\" : {\n\t\t//Creates a new crew slot\n\t\tupgradeSlots: [{},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t],\n\t},\n\n\t//Turanj\n\t\"crew:C427\": {\n\t\t//Creates a new crew slot\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t} \n\t\t]\n\t},\n\t\n\t// Vidiian Guard\n\t\"crew:C432\": {\n    \tcanEquip: function(upgrade, ship, fleet) {\n        \treturn onePerShip(\"Vidiian Guard\");\n    \t},\n    \tintercept: {\n        \tship: {\n            \tskill: function(card, ship, fleet, skill) {\n                \t// Check if the captain ID matches\n                \tif( ship.captain && ship.captain.id === \"Cap033\" || ship.captain.name === \"Nadirum\" || ship.captain.id === \"Cap448\" || ship.captain.id === \"Cap706\")\n\t\t\t\t\treturn resolve(card,ship,fleet,skill) +2;\n\t\t\t\treturn skill;\n            \t}\n        \t}\n    \t}\n\t},\n\n\t//Kovin\n\t\"crew:C434\":{\n\t\t//Creates a new weapon slot\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"weapon\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Donik\n\t\"crew:C435\": {\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Hirogen Warship\";\n\t\t}\n\t},\n\n\t//Life of Piracy\n\t\"talent:E232\": {\n\t\tcanEquip: onePerShip(\"Life Of Piracy\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"independent\", ship, fleet) || hasFaction(ship.captain, \"ferengi\", ship, fleet) || hasFaction(ship.captain, \"kazon\", ship, fleet) || hasFaction(ship.captain, \"xindi\", ship, fleet);\n\t\t}\n\t},\n\n\t//Tetryon Particle Weapon\n\t\"weapon:W243\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn (ship.class == \"Nerada-Type\")\n\t\t}\n\t},\n\n\t//Isokinetic Cannon\n\t\"weapon:W244\":{\n\t\tcanEquip: onePerShip(\"Isokinetic Cannon\"),\n\t\tattack: 0,\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\t//Attack is the same as primary weapon +1\n\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\tif ( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) +1;\n\t\t\t\treturn attack;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t},\n\n\t//Targeted Phaser Strike\n\t\"weapon:W245\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Targeted Phaser Strike\");\n\t\t}\n\t},\n\n\t//Grapplers\n\t\"weapon:W246\":{\n\t\tattack: 0,\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\t//Attack is the same as primary weapon +1\n\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\tif ( ship )\n\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) +1;\n\t\t\t\t\treturn attack;\t\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t},\n\n\t//Regenerative Shielding\n\t\"tech:T302\": {\n\t\tcanEquip: onePerShip(\"Regenerative Shielding\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn (ship.class == \"Numiri Patrol Ship\")\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\treturn shields;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Refractive Shielding\n\t\"tech:T303\": {\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Refractive Shielding\")(upgrade,ship,fleet)\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) +1;\n\t\t\t\t\treturn shields;\t\n\t\t\t\t},\n\t\t\t\tagility: function(card,ship,fleet,agility) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\treturn resolve(card,ship,fleet,agility) +1;\n\t\t\t\t\treturn agility;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Translocator\n\t\"tech:T304\": {\n\t\tcanEquip: onePerShip(\"Translocator\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship,\"independent\",ship,fleet) || hasFaction(ship,\"ferengi\",ship,fleet) || hasFaction(ship,\"kazon\",ship,fleet) || hasFaction(ship,\"xindi\",ship,fleet);\n\t\t}\n\t},\n\n\t//Stealth Mode\n\t\"tech:T305\": {\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Hirogen Warship\" && onePerShip(\"Stealth Mode\");\n\t}\n},\n\n\t//Improved Deflector Screens\n\t\"tech:T306\": {\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.hull <=3 && onePerShip(\"Improved Deflector Screens\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\t//Monotanium Armor Plating\n\t\"tech:T307\":{\n\t\tcanEquip: onePerShip(\"Monotanium Armor Plating\")\n\t},\n\n\t//Weiss\n\t\"question:Q032\": {\n\t\ttype: \"question\",\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"crew\", slotTypes ) >= 0 || $.inArray( \"tech\", slotTypes ) >=0;\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Kejal\n\t\"question:Q033\": {\n\t\ttype: \"question\",\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"crew\", slotTypes ) >= 0 || $.inArray( \"tech\", slotTypes ) >=0;\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Photonic Field Generator\n\t\"question:Q031\": {\n\t\ttype: \"question\",\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"tech\", slotTypes ) >=0;\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\n//Lost in the Delta Quadrant\n\n\t//U.S.S. Intrepid NCC-74600\n\t\"ship:S386\": {\n\t\tintercept:{\n\t\t\tship: {\n\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\tif( upgrade.name == \"Variable Geometry Pylons\" || upgrade.name == \"Bio-Neural Circuitry\")\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) -1;\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Rudolph Ransom\n\t\"captain:Cap022\":{\n\t\t//Creates a new crew slot\n\t\tupgradeSlots: [{},\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t}\n\t\t],\n\t},\n\n\t//Magnus Hansen\n\t\"captain:Cap023\" :{\n\t\t//Can only be equipped to ships with a Hull of 3 or less\n\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\treturn ship.hull <= 3;\n\t\t}\n\t},\n\n\t//Chakotay - Captain\n\t\"captain:Cap024\":{\n\t\t//Creates a new crew slot\n\t\tupgradeSlots: [{},\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Chakotay - Crew\n\t\"crew:C405\": {\n\t\t//Creates a new crew slot\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n\t\n\t//Tom Paris\n\t\"captain:Cap025\":{\n\t\t//Can only be equipped to ships with a Hull of 3 of less\n\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\treturn ship.hull <= 3;\n\t\t}\n\t},\n\n// The Doctor - Captain\n\"captain:Cap028\": {\n    // Creates two new Captain slots\n    upgradeSlots: [\n        {},\n        {\n            type: [\"captain\"],\n            rules: \"Captain to place under The Doctor \\n Both cards must combine for a total cost of 6 SP\",\n            intercept: {\n                ship: {\n                    free: function() {\n                        return true;\n                    },\n                    canEquip: function(card, ship, fleet, canEquip) {\n                        if (!$factions.hasFaction(card, \"federation\", ship, fleet)) {\n                            return false;\n                        }\n                        // Calculate the cost of the other captain slot\n                        var otherSlotCost = 0;\n                        $.each($filter(\"upgradeSlots\")(ship), function(i, slot) {\n                            if (slot.type && slot.type.includes(\"captain\") && slot.occupant && slot.source === \"The Doctor\") {\n                                otherSlotCost = valueOf(slot.occupant, \"cost\", ship, fleet);\n                            }\n                        });\n                        // Check if combined cost exceeds 6 SP\n                        return otherSlotCost + valueOf(card, \"cost\", ship, fleet) <= 6 && canEquip;\n                    },\n\t\t\t\t\ttalents: 0\n                }\n            }\n        },\n        {\n            type: [\"captain\"],\n            rules: \"Captain to place under The Doctor \\n Both cards must combine for a total cost of 6 SP\",\n            intercept: {\n                ship: {\n                    free: function() {\n                        return true;\n                    },\n                    canEquip: function(card, ship, fleet, canEquip) {\n                        if (!$factions.hasFaction(card, \"federation\", ship, fleet)) {\n                            return false;\n                        }\n                        // Calculate the cost of the other captain slot\n                        var otherSlotCost = 0;\n                        $.each($filter(\"upgradeSlots\")(ship), function(i, slot) {\n                            if (slot.type && slot.type.includes(\"captain\") && slot.occupant && slot.source === \"The Doctor\") {\n                                otherSlotCost = valueOf(slot.occupant, \"cost\", ship, fleet);\n                            }\n                        });\n                        // Check if combined cost exceeds 6 SP\n                        return otherSlotCost + valueOf(card, \"cost\", ship, fleet) <= 6 && canEquip;\n                    }\n                }\n            }\n        }\n    ]\n},\n\n\t//The Doctor - Question\n\t\"question:Q028\":{\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >=0;\n\t\t}\n\t},\n\n\t//Marla Gilmore\n\t\"crew:C410\":{\n\t\t//Creates a new tech slot\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Erin Hansen\n\t\"crew:C413\":{\n\t\t//Can only be equipped to a Aerie Class\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Aerie Class\"\n\t\t}\n\t},\n\n\t//Timothy Lang\n\t\"crew:C418\":{\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\t//Gives the Captain a +1 Skill boost\n\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) +1;\n\t\t\t\t\treturn skill;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Seven of Nine\n\t\"crew:C422\":{\n\t\t//Creates a new Tech or Borg slot\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\", \"borg\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Aaron Cavit\n\t\"crew:C423\":{\n\t\t//Creates a new Crew slot\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Lower Decks\n\t\"crew:C426\": {\n    \t// Adds 2 crew slots for Lower Deck keyworded crew\n    \tupgradeSlots: [\n        \t{\n            \ttype: [\"crew\"],\n            \trules: \"Lower Decks Crew\",\n            \t// Can only equip crew cards with Lower Deck keyword.\n            \tcanEquip: function(upgrade) {\n                \tconst lowerDeckCrewIDs = [\"C414\", \"C415\", \"C416\", \"C417\", \"C418\", \"C419\", \"C460\", \"C461\", \"C470\", \"C471\", \"C472\", \"C473\", \"C474\", \"C480\", \"C481\", \"C482\"];\n                \treturn lowerDeckCrewIDs.includes(upgrade.id);\n            \t}\n        \t},\n        \t{\n            \ttype: [\"crew\"],\n            \trules: \"Lower Decks Crew\",\n            \t// Can only equip crew cards with Lower Deck keyword.\n            \tcanEquip: function(upgrade) {\n                \tconst lowerDeckCrewIDs = [\"C414\", \"C415\", \"C416\", \"C417\", \"C418\", \"C419\", \"C460\", \"C461\", \"C470\", \"C471\", \"C472\", \"C473\", \"C474\", \"C480\", \"C481\", \"C482\"];\n                \treturn lowerDeckCrewIDs.includes(upgrade.id);\n            \t}\n        \t}\n    \t]\n\t},\n    \n\t//Tactical Superiority Commander\n\t\"talent:E231\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.captain.skill >= 8;\n\t\t}\n\t},\n\n\t//Gravimetric Torpedoes\n\t\"weapon:W241\": {\n\t\t//Only one can be equipped to a ship with a hull of 4 or greater\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.hull >= 4 && onePerShip(\"Gravimetric Torpedoes\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\t\n\t//Photonic Missles\n\t\"weapon:W242\":{\n\t\t//Can only be equipped to a Delta Flyer Class\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Delta Flyer Class\" && onePerShip(\"Photonic Missles\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\t//Temporal Shielding\n\t\"tech:T296\":{\n\t\tcanEquip: onePerShip(\"Temporal Shielding\"),\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\treturn resolve(card,ship,fleet,shields) +1;\n\t\t\t\treturn shields;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Multi-Adaptive Shields\n\t\"tech:T297\":{\n\t\t//Only one can be equipped to a Federation ship\n\t\tcanEquip: onePerShip(\"Multi-Adaptive Shields\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship, \"federation\", ship, fleet) || hasFaction(ship, \"bajoran\", ship, fleet) || hasFaction(ship, \"vulcan\", ship, fleet);\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\treturn resolve(card,ship,fleet,shields) +1;\n\t\t\t\treturn shields;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\n\n\t//Bio-Neural Circitry\n\t\"tech:T298\":{\n\t\tcanEquip: onePerShip(\"Bio-Neural Circuitry\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship, \"federation\", ship, fleet) || hasFaction(ship, \"bajoran\", ship, fleet) || hasFaction(ship, \"vulcan\", ship, fleet);\n\t\t},\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship.class == \"Intrepid Class\" || ship.class == \"Sovereign Class\" || ship.class == \"Luna Class\") {\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) +0;\n\t\t\t\t} else {\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) +3;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t\n\t},\n\n\t//Variable Geometry Pylons\n\t\"tech:T299\":{\n\t\t//Can only have one equipped to an Intrepid Class\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Intrepid Class\" && onePerShip(\"Variable Geometry Pylons\")(upgrade,ship,fleet);\n\t\t}\n\t},\n\n\n\t//Astrometrics Lab\n\t\"tech:T300\":{\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\"]\n\t\t\t}\n\t\t],\n\t\tcanEquip: onePerShip(\"Astrometrics Lab\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn ship && ( $factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || $factions.hasFaction(ship,\"vulcan\", ship, fleet) ) && ship.hull >= 4;\n\t\t},\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship.class == \"Intrepid Class\" || ship.class == \"Sovereign Class\" || ship.class == \"Luna Class\") {\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) +0;\n\t\t\t\t} else {\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) +2;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t},\n\n\t//Re-Chargeable Shield Emitters\n\t\"tech:T301\":{\n\t\t//Can only have one equipped to a Nova Class\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class ==\"Nova Class\" && onePerShip(\"Re-Chargeable Shield Emitters\")(upgrade,ship,fleet);\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\treturn resolve(card,ship,fleet,shields) +1;\n\t\t\t\treturn shields;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Coffee, Black\n\t\"question:Q029\":{\n\t\t//Can only have one equipped to a Federation Captain\n\t\tcanEquip: onePerShip(\"Coffee, Black\"),\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship.captain, \"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet);\n\t\t},\n\t\t//Can be equipped to any slot\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t},\n\t\t//Clone slot it takes\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t}\n\t\t\t}\n\t\t]\n\t},\n\n\n\t//U.S.S. Voyager (Year of Hell)\n\t\"question:Q030\": {\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn (ship.id == \"S385\");\n\t\t},\n\t\t//Can be equipped to any slot\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0 || $.inArray( \"borg\", slotTypes ) >= 0;\n\t\t},\t\t\n\t\t//Clone slot it takes\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\", \"weapon\", \"crew\", \"borg\"],\n\t\t\t\trules: \"Costs -2 SP. Only equip Upgrade cards for slot that was replaced.\",\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) -2;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t]\t\n\t},\n\n\t//Ablative Generator\n\t\"starship_construction:Con002\": {\n\t\tcanEquip: onePerShip(\"Ablative Generator\"),\n\t\tcanEquipConstruction: function(upgrade,ship,fleet) {\n\t\t\treturn ship.hull >= 4 && ship.shields >= 3;\n\t\t},\n\t\tcost: 0,\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\t//Cost is the same as ships printed Hull Value +2\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship )\n\t\t\t\t\t\treturn valueOf(ship,\"hull\",ship,fleet) +2;\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n},\n\n//Alliance Part III\n\n\t//Engineer\n\t\"crew:C398\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Engineer\");\n\t\t}\n\t},\n\n\t//Cunning\n\t\"talent:E224\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Cunning\");\n\t\t}\n\t},\n\n\t//Disruptor Sweep\n\t\"weapon:W233\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Disruptor Sweep\");\n\t\t}\n\t},\n\n\t//Thruster Efficiency\n\t\"tech:T289\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Thruster Efficiency\") && (ship.class == \"K'Vort Class\" || ship.class == \"B'Rel Class\");\n\t\t}\n\t},\n\n\t//Helmsman\n\t\"crew:C399\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Helmsman\");\n\t\t}\n\t},\n\n\t//Engineer\n\t\"crew:C401\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Engineer\");\n\t\t}\n\t},\n\n\t//Science Officer\n\t\"crew:C400\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Science Officer\");\n\t\t}\n\t},\n\n\t//Sub-Commander\n\t\"crew:C403\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Sub-Commander\");\n\t\t}\n\t},\n\n\t//Tactical Officer\n\t\"crew:C404\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Tactical Officer\");\n\t\t}\n\t},\n\n\t//Ops Officer\n\t\"crew:C402\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Ops Officer\");\n\t\t}\n\t},\n\n\t//Suspicious\n\t\"talent:E229\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Suspicious\");\n\t\t}\n\t},\n\n\t//Opportunistic\n\t\"talent:E228\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Opportunistic\");\n\t\t}\n\t},\n\n\t//Ambush Tactics\n\t\"talent:E227\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Ambush Tactics\") && hasFaction(ship,\"romulan\",ship,fleet);\n\t\t}\n\t},\n\n\t//Heavy Disruptor\n\t\"weapon:W238\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Heavy Disruptor\") && (ship.class == \"D'deridex Class\");\n\t\t}\n\t},\n\n\t//Heavy Plasma Torpedo\n\t\"weapon:W237\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Heavy Plasma Torpedo\") && hasFaction(ship,\"romulan\",ship,fleet);\n\t\t}\n\t},\n\n\t//Ventral Disruptors\n\t\"weapon:W235\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Ventral Disruptors\");\n\t\t}\n\t},\n\n\t//Integrated Cloak\n\t\"weapon:W234\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Integrated Cloak\") && hasFaction(ship,\"romulan\",ship,fleet);\n\t\t}\n\t},\n\n\t//Ventral Thrusters\n\t\"tech:T294\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Ventral Thrusters\");\n\t\t}\n\t},\n\n\t//Muon Feedback Beam\n\t\"tech:T293\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Muon Feedback Beam\");\n\t\t}\n\t},\n\n\t//Plasma Coil Overcharge\n\t\"tech:T290\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Plasma Coil Overcharge\");\n\t\t}\n\t},\n\n\t//Deep Cloak\n\t\"tech:T292\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship,\"romulan\",ship,fleet);\n\t\t}\n\t},\n\n//Alliance Part II\n\n\t//Evasive Maneuvers\n\t\"talent:E219\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class.indexOf(\"K'Vort Class\") >= 0 && onePerShip(\"Evasive Maneuvers\");\n\t\t}\n\t},\n\n\t//Strafing Run\n\t\"talent:E222\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Strafing Run\") && (ship.class == \"K'Vort Class\" || ship.class == \"B'Rel Class\");\n\t\t}\n\t},\n\n\t//Fight With Honor\n\t\"talent:E221\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t\t}\n\t},\n\n\t//Eye For An Eye\n\t\"talent:E223\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t\t}\n\t},\n\n\t//Forward Battery\n\t\"weapon:W228\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Forward Battery\") && (ship.class == \"Vor'cha Class\" || ship.class == \"Negh'var Class\");\n\t\t}\n\t},\n\n\t//Disruptor Overcharge\n\t\"weapon:W229\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Disruptor Overcharge\") && (ship.class == \"Vor'cha Class\");\n\t\t}\n\t},\n\n\t//Converging Fire\n\t\"weapon:W232\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Converging Fire\") && (ship.class == \"Vor'cha Class\" || ship.class == \"Negh'var Class\");\n\t\t}\n\t},\n\n\t//Torpedo Fusillade\n\t\"weapon:W231\":{\n\t\tattack: 0,\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\t// Attack is same as ship primary weapon\n\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\tif( ship )\n\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\treturn attack;\n\t\t\t\t},\n\t\t\t\t// Cost is primary weapon\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship )\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Photon Torpedoes\n\t\"weapon:W230\":{\n\t\tattack: 0,\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\t// Attack is same as ship primary + 1\n\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\tif( ship )\n\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\treturn attack;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Enhanced Thrusters\n\t\"tech:T288\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Enhanced Thrusters\") && (ship.class == \"K'Vort Class\" || ship.class == \"B'Rel Class\");\n\t\t}\n\t},\n\n\t//Reactor Vent\n\t\"tech:T283\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Reactor Vent\");\n\t\t}\n\t},\n\n\t//Secondary Cloaking Coil\n\t\"tech:T285\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Secondary Cloaking Coil\");\n\t\t}\n\t},\n\n\t//Extend Shields\n\t\"tech:T281\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Extend Shields\");\n\t\t}\n\t},\n\n\t//Passive Sensors\n\t\"tech:T287\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Passive Sensors\");\n\t\t}\n\t},\n\n\t//Reinforced Hull\n\t\"tech:T286\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Reinforced Hull\") && ship.hull >=4;\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\thull: function(card,ship,fleet,hull) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\treturn resolve(card,ship,fleet,hull) + 2;\n\t\t\t\t\treturn hull;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t},\n\n\t//Secondary Relays\n\t\"tech:T282\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Secondary Relays\");\n\t\t}\n\t},\n\n\t//First Officer\n\t\"crew:C397\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"First Officer\");\n\t\t}\n\t},\n\n\t//Weapons Officer\n\t\"crew:C396\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Weapons Officer\");\n\t\t}\n\t},\n\n\t//Operations Officer\n\t\"crew:C395\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Operations Officer\");\n\t\t}\n\t},\n\n\t//Science Officer\n\t\"crew:C392\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Science Officer\");\n\t\t}\n\t},\n\n\t//Engineering Officer\n\t\"crew:C391\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Engineering Officer\");\n\t\t}\n\t},\n\n\t//Tactical Officer\n\t\"crew:C394\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Tactical Officer\");\n\t\t}\n\t},\n\n\t//Helmsman\n\t\"crew:C393\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Helmsman\");\n\t\t}\n\t},\n\n//Ships of the Line\n\n//Fleet Coordination\n\"talent:E213\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet) && hasFaction(ship.captain,\"federation\", ship, fleet) || hasFaction(ship.captain,\"bajoran\", ship, fleet) || hasFaction(ship.captain,\"vulcan\", ship, fleet);\n\t}\n},\n\n//Task Force Commander\n\"talent:E214\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"federation\", ship, fleet) || hasFaction(ship.captain, \"bajoran\", ship, fleet) || hasFaction(ship.captain, \"vulcan\", ship, fleet) && hasFaction(ship.captain,\"federation\", ship, fleet) || hasFaction(ship.captain,\"bajoran\", ship, fleet) || hasFaction(ship.captain,\"vulcan\", ship, fleet);\n\t}\n},\n\n//Shakedown Cruise Commander\n\"talent:E215\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship.captain,\"federation\", ship, fleet) || hasFaction(ship.captain,\"bajoran\", ship, fleet) || hasFaction(ship.captain,\"vulcan\", ship, fleet) && onePerShip(\"Shakedown Cruise Commander\");\n\t}\n},\n\n//Type 10 Phasers\n\"weapon:W222\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"federation\", ship, fleet) || hasFaction(ship,\"bajoran\", ship, fleet) || hasFaction(ship,\"vulcan\", ship, fleet) && onePerShip(\"Type 10 Phasers\");\n  }\n},\n\n// Dorsal Phaser Array\n\"weapon:W223\": {\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn ship && ( $factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || $factions.hasFaction(ship,\"vulcan\", ship, fleet) ) && ship.hull >= 4 && onePerShip(\"Dorsal Phaser Array\");\n  },\n\tintercept: {\n\t\tself: {\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif ( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\treturn attack;\n\t\t\t},\n\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\tif ( ship )\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + valueOf(ship,\"attack\",ship,fleet) +1;\n\t\t\t\t\treturn cost;\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Photon Torpedoes\n\"weapon:W224\":{\n\tattack: 0,\n\tintercept: {\n\t\tself: {\n\t\t\t// Attack is same as ship primary + 1\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\treturn attack;\n\t\t\t}\n\t\t}\n\t}\n},\n\n// Dorsal Torpedo Pod\n\"weapon:W225\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn ship.class.indexOf( \"Akira Class\" ) >= 0 && onePerShip(\"Dorsal Torpedo Pod\");\n\t}\n},\n\n//Quantum Torpedoes\n\"weapon:W226\":{\n\tcanEquip: onePerShip(\"Quantum Torpedoes\"),\n\tattack: 0,\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\tif( ship )\n\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t},\n\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\tif( ship.class == \"Galaxy Class\" || ship.class == \"Constitution Class\" || ship.class ==\"Miranda Class\" || ship.class ==\"Nor Class Orbital Space Station\" || ship.class == \"Vor'cha Class\" || ship.class ==\"D'Deridex Class\" || ship.class == \"Breen Battle Cruiser\" || ship.class == \"Cardassian Galor Class\" || ship.class == \"Negh'var Class\" || ship.class == \"D7 Class\" || ship.class == \"Romulan Science Vessel\" || ship.class == \"Valdore Class\" || ship.class == \"D'Kora Class\" || ship.class == \"Jem'Hadar Attack Ship\" || ship.class == \"Romulan Bird-Of-Prey\" || ship.class == \"K't'inga Class\" || ship.class == \"B'Rel Class\" || ship.class == \"Cardassian Keldon Class\" || ship.class == \"Romulan Scout Ship\" || ship.class == \"K'Vort Class\" || ship.class == \"Excelsior Class\" || ship.class == \"Nebula Class\" || ship.class == \"Raptor Class\" || ship.class == \"Jem'Hadar Battleship\" || ship.class == \"Nova Class\" || ship.class == \"Bajoran Scout Ship\" || ship.class == \"Borg Sphere\" || ship.class == \"Kazon Raider\" || ship.class == \"Species 8472 Bioship\" || ship.class == \"Intrepid Class\" || ship.class == \"Tholian Vessel\" || ship.class == \"Gorn Raider\" || ship.class == \"D'Kyr Class\" || ship.class == \"Bajoran Interceptor\" || ship.class == \"Borg Tactical Cube\" || ship.class == \"Maquis Raider\" || ship.class == \"Saber Class\" || ship.class == \"Suurok Class\" || ship.class == \"Jem'Hadar Battle Cruiser\" || ship.class == \"Constitution Refit Class\" || ship.class == \"Borg Type 03\" || ship.class == \"Aerie Class\" || ship.class == \"Constellation Class\" || ship.class == \"Federation NX Class\" || ship.class == \"Borg Scout Cube\" || ship.class == \"Predator Class\" || ship.class == \"Borg Octahedron\" || ship.class == \"Reman Warbird\" || ship.class == \"Klingon Bird-Of-Prey\" || ship.class == \"Borg Cube\" || ship.class == \"Vidiian Battle Cruiser\" || ship.class == \"Hirogen Warship\" || ship.class == \"Romulan Drone Ship\" || ship.class == \"Type 7 Shuttlecraft\" || ship.class == \"Oberth class\" || ship.class == \"Terran NX Class\" || ship.class == \"Krenim Weapon Ship\" || ship.class == \"Prometheus Class\" || ship.class == \"Olympic Class\" || ship.class == \"Dauntless Class\" || ship.class == \"Ferengi Shuttle\" || ship.class == \"Delta Flyer Class Shuttlecraft\" || ship.class == \"Scorpion Class Attack Squadron\" || ship.class == \"Cardassian ATR-4107\" || ship.class == \"Bajoran Solar Sailor\" || ship.class == \"Xindi Insectoid Starship\" || ship.class == \"Xindi Aquatic Cruiser\" || ship.class == \"Xindi Reptilian Warship\" || ship.class == \"Andorian Battle Cruiser\" || ship.class == \"Xindi Weapon\")\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) +2;\n\t\t\t\treturn cost;\n\t\t\t}\n\t\t\t}\n\t\t}\n},\n\n//Multi-Vector Assault Mode\n\t\"weapon:W227\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Prometheus Class\" && onePerShip(\"Multi-Vector Assault Mode\")\n\t\t}\n\t},\n\n//Ablative Hull Armor\n\t\"tech:T277\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Prometheus Class\" && onePerShip(\"Ablative Hull Armor\")\n\t\t}\n\t},\n\n//Regenerative Shields\n  \"tech:T278\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Prometheus Class\" && onePerShip(\"Regenerative Shields\")\n\t\t\t},\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) +1;\n\t\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Multiphasic Shielding\n\t\"tech:T279\": {\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship)\n\t\t\t\t\treturn resolve(card,ship,fleet,shields) +1;\n\t\t\t\t\treturn shields;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n//Multi-Spectrum Shielding\n\t\"tech:T280\": {\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship)\n\t\t\t\t\treturn resolve(card,ship,fleet,shields) +1;\n\t\t\t\t\treturn shields;\n\t\t\t\t},\n\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\tif( ship && (!hasFaction(ship,\"federation\",ship,fleet) && !hasFaction(ship,\"bajoran\",ship,fleet) && !hasFaction(ship,\"vulcan\",ship,fleet) ) )\n\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 1;\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n//EMH Mark I\n\"question:Q023\":{\n\tcanEquip: onePerShip(\"EMH Mark I\"),\n\tisSlotCompatible: function(slotTypes) {\n\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >=0;\n\t}\n},\n\n//Lasca\n\"crew:C389\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"federation\", ship, fleet) || hasFaction(ship,\"bajoran\", ship, fleet) || hasFaction(ship, \"vulcan\", ship, fleet);\n  },\n},\n\n\n//Federation Prototype\n \"starship_construction:Con001\":{\n\t// because of how the logic of the system works, these canEquip and canEquipFaction fields must be defined and are required - this should probably be fixed in the future\n\tcanEquip: true, \n\tcanEquipFaction: true, \n \tcanEquipConstruction: function(upgrade,ship,fleet) {\n\t\treturn ship.id == \"S404\" || ship.id == \"S386\" || ship.name.startsWith(\"U.S.S. \") && (ship.name.replace(\"U.S.S. \", \"\") == ship.class.replace(/ [Cc]lass/,\"\"))\n \t},\n\n \tupgradeSlots: [\n\t\t{\n\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t}\n\t]\n  },\n\n//Secrets of the Tal Shiar\n\n//Rekar\n\"captain:Cap014\":{\n\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\treturn ship && $factions.hasFaction( ship, \"federation\", ship, fleet ) ? 0 : 1;\n\t},\n\tintercept: {\n\t\tship: {\n\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\tif( card.type == \"crew\" && hasFaction(card,\"romulan\",ship,fleet) && hasFaction(ship,\"federation\",ship,fleet) )\n\t\t\t\t\treturn 0;\n\t\t\t\treturn factionPenalty;\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Varak\n\"crew:C380\":{\n\tupgradeSlots: [ { type: [\"crew\"] } ]\n},\n\n//Reman Helmsman\n\"crew:C383\":{\n\tintercept: {\n\t\tself: {\n\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\tif (ship && !hasFaction(ship,\"romulan\",ship,fleet) )\n\t\t\t\treturn resolve(upgrade,ship,fleet,cost) +2;\n\t\t\t\treturn cost;\n\t\t\t}\n\t\t}\n\t}\n},\n\n//T'Rul\n\"crew:C384\":{\n\tupgradeSlots: [ {\n\t\ttype: [\"tech\"],\n\t\trules: \"May equip Romulan Cloaking Decice for 0 SP\",\n\t\tcanEquip: function(upgrade) {\n\t\t\treturn upgrade.id == \"T276\";\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\tif( !$factions.match(card,ship,ship,fleet) )\n\t\t\t\t\t\treturn 1;\n\t\t\t\t\telse if( $factions.match(card,ship,ship,fleet) )\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t} ]\n},\n\n//Nevala\n\"crew:C385\":{\n\tintercept: {\n\t\tship: {\n\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\tif( card == ship.captain )\n\t\t\t\t\treturn resolve(card,ship,fleet,skill) + ( hasFaction(card,\"romulan\",ship,fleet) ? 3 : 1 );\n\t\t\t\treturn skill;\n\t\t\t}\n\t\t}\n\t}\n},\n\n// Covert Research\n\"talent:E210\": {\n\tcanEquipFaction: function(card,ship,fleet) {\n\t\treturn hasFaction(ship.captain,\"romulan\", ship, fleet);\n\t}\n},\n\n//Outflank\n\"talent:E211\": {\n\tcanEquip: onePerShip(\"Outflank\")\n},\n\n//Fire Everything!\n\"talent:E212\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"romulan\", ship, fleet) && hasFaction(ship.captain,\"romulan\", ship, fleet);\n\t}\n},\n\n// Thalaron Weapon\n\"weapon:W218\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn ship.class == \"Reman Warbird\";\n\t}\n},\n\n//Aft Disruptor Emitters\n\"weapon:W219\": {\n\tcanEquip: onePerShip(\"Aft Disruptor Emitters\"),\n\tintercept: {\n\t\tself: {\n\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\tif( ship && !$factions.hasFaction( ship, \"romulan\", ship, fleet ) )\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 2;\n\t\t\t\treturn cost;\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Disruptor Pulse\n\"weapon:W220\": {\n\tintercept: {\n\t\tself: {\n\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\tif( ship && !$factions.hasFaction( ship, \"romulan\", ship, fleet ) )\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 2;\n\t\t\t\treturn cost;\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Flanking Attack\n\"weapon:W221\": {\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"romulan\", ship, fleet);\n  }\n},\n\n//Improved Cloaking Device\n\"tech:T274\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn ship.class == \"Reman Warbird\";\n\t}\n},\n\n// Romulan Cloaking Device\n\t\"tech:T276\": {\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"romulan\", ship, fleet))\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 2;\n\t\t\t\t\treturn cost;\n\t\t\t\t},\n\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\treturn onePerShip(\"Romulan Cloaking Device\")(upgrade,ship,fleet);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n// Romulan Ale\n\t\"question:Q022\": {\n \t canEquip: function(upgrade,ship,fleet) {\n \t\t return onePerShip(\"Romulan Ale\")(upgrade,ship,fleet);\n \t },\n \t isSlotCompatible: function(slotTypes) {\n \t\t return $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n \t },\n\t intercept: {\n\t\t self: {\n\t\t\t cost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t if(ship && !$factions.hasFaction(ship,\"romulan\", ship, fleet))\n\t\t\t\t \treturn resolve(upgrade,ship,fleet,cost) +3;\n\t\t\t\treturn cost;\n\t\t\t }\n\t\t }\n\t },\n \t upgradeSlots: [\n \t\t {\n \t\t\t type: function(upgrade,ship) {\n \t\t\t\t return getSlotType(upgrade,ship);\n \t\t\t }\n \t\t }\n \t ],\n  },\n\n//Blood Oath\n\n//Dahar Master\n\t\"talent:E208\": {\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn (ship.captain && (ship.captain.name == \"Kor\" || ship.captain.name == \"Koloth\" || ship.captain.name == \"Kang\"));\n\t\t},\n    intercept: {\n\t\tfleet: {\n\t\t\t// Add Skill to Kor, Koloth and Kang\n\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\tif( card == ship.captain && ((card.name == \"Kor\") || (card.name == \"Kang\") || (card.name == \"Koloth\")) && hasDaharMaster(card))\n\t\t\t\t\treturn resolve(card,ship,fleet,skill) +1;\n\t\t\t\treturn skill;\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Kor\n\t\"captain:Cap004\": {\n\t\tupgradeSlots: [ {\n\t\t\ttype: [\"talent\"],\n\t\t\trules: \"Equip Dahar Master for 0 SP\",\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Dahar Master for free\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\tif( upgrade.name == \"Dahar Master\" )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t} ]\n},\n\n//I.K.S. K'Tanco\n\t\"ship:S336\": {\n\t\tupgradeSlots: [ {\n\t\t\ttype: [\"tech\"],\n\t\t\trules: \"Klingon Upgrade, 4 SP cost or less\",\n\t\t\tcanEquip: function(upgrade) {\n\t\t\t\treturn (upgrade.factions == \"klingon\" && upgrade.cost <= 4);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function() { return 0; }\n\t\t\t\t}\n\t\t\t}\n\t\t} ]\n\t},\n\n//Waylay\n\"weapon:W217\":{\n\tattack: 0,\n\tintercept: {\n\t\tself: {\n\t\t\t// Attack is same as ship primary + 1\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\treturn attack;\n\t\t\t}\n\t\t}\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn ship.hull <= 3;\n  },\n},\n\n//Concussive Charges\n\"weapon:W216\":{\n\tattack: 0,\n\tintercept: {\n\t\tself: {\n\t\t\t// Attack is same as ship primary\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\treturn attack;\n\t\t\t}\n\t\t}\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n   }\n},\n\n//A Death Worthy of Sto-Vo-Kor\n\"talent:E209\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship.captain,\"klingon\", ship, fleet);\n}},\n\n//Science Station\n\"tech:T273\":{\n\tupgradeSlots: [\n\t\t{\n\t\t\ttype: [\"tech\"]\n\t\t}\n\t]\n},\n\n//Federation Boldly Go Pack\n\n// U.S.S. Spector\n\"ship:S342\": {\nintercept: {\n\tship: {\n\t\t// Federation weapons are -1 SP\n\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\tif( ( $factions.hasFaction(upgrade,\"federation\", ship, fleet) || $factions.hasFaction(upgrade,\"bajoran\", ship, fleet) || $factions.hasFaction(upgrade,\"vulcan\", ship, fleet) ) && upgrade.type == \"weapon\" )\n\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\treturn cost;\n\t\t}\n\t}\n}\n},\n\n// Jadzia Dax\n\"captain:Cap008\": {\n\t// No faction penalty for Klingon Talent.\n\tupgradeSlots: cloneSlot( 1 ,\n\t\t{\n\t\t\ttype: [\"talent\"],\n\t\t\trules: \"No Faction Penalty for Klingon Elite Talent\",\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tfactionPenalty: {\n\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\tfn: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\t\tif( card.factions == \"klingon\" )\n\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t)\n},\n\n\n// Experimental Torpedo Bay\n\"weapon:W215\": {\n    // Upgrade slot for torpedo only of printed cost 5 or less\n    upgradeSlots: [{\n        type: [\"weapon\"],\n        rules: \"Torpedo Upgrade with Printed Cost 5 or less.\",\n        faceDown: true,\n        canEquip: function(upgrade) {\n            const allowedTorpedoIDs = [\"W250\", \"W240\", \"W241\", \"W248\", \"W204\", \"W192\", \"W191\", \"W183\", \"W177\", \"W161\", \"W160\", \"W158\", \"W157\", \"W008\", \"W004\", \"W003\", \"W002\", \"W009\", \"W154\", \"W152\", \"W145\", \"W142\", \"W141\", \"W137\", \"W128\", \"W122\", \"W120\", \"W119\", \"W118\", \"W117\", \"W116\", \"W114\", \"W112\", \"W105\", \"W100\", \"W088\", \"W082\", \"W081\", \"W079\", \"W078\", \"W074\", \"W072\", \"W067\", \"W059\", \"W050\", \"W039\", \"W038\", \"W031\", \"W195\", \"W016\", \"W119\", \"W226\", \"W224\", \"W236\", \"W237\", \"W252\", \"W253\"];\n            return allowedTorpedoIDs.includes(upgrade.id);\n        },\n        intercept: {\n            ship: {\n                canEquip: function(upgrade, ship, fleet) {\n                    var cost = valueOf(upgrade, \"cost\", ship, fleet);\n                    return cost <= 6;\n                },\n            \tfree: function() {\n                \treturn true;\n            \t},\n            \tfactionPenalty: function(upgrade, ship, fleet) {\n                \tconst factions = [\"federation\", \"klingon\", \"romulan\", \"bajoran\", \"vulcan\", \"dominion\", \"borg\", \"independent\", \"ferengi\", \"xindi\", \"kazon\", \"mirror-universe\", \"species-8472\"];\n                \tfor (let faction of factions) {\n                    \tif ($factions.hasFaction(ship, faction, ship, fleet)) {\n                        \treturn 0;\n                    \t}\n                \t}\n                \treturn 1;\n            \t}\n\t\t\t}\n        }\n    }]\n},\n\n// Ablative Armor\n\"tech:T271\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn ship.class.indexOf( \"Defiant Class\" ) >= 0;\n\t}\n},\n\n// Advanced Shields\n\"tech:T270\": {\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"federation\", ship, fleet) && ship.hull >= 5;\n  },\n\tintercept: {\n\t\tship: {\n\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\tif( card == ship )\n\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 2;\n\t\t\t\treturn shields;\n\t\t\t}\n\t\t}\n\t}\n},\n// Dorsal Torpedo Pod\n\"weapon:W214\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn ship.class.indexOf( \"Akira Class\" ) >= 0;\n\t}\n},\n// Phaser Cannons\n\"weapon:W213\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn ship.class.indexOf( \"Defiant Class\" ) >= 0;\n\t}\n},\n\n\t//Ezri Dax\n\t\"crew:C372\":{\n\t\tupgradeSlots: [\t{ type: [\"crew\"] } ]\n\t},\n\n//Alliance\n\t\t//Photon Torpedoes\n\t\t\"weapon:W204\":{\n\t\t\tattack: 0,\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary + 1\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n    //Battle-Hardened\n\t\t\"talent:E202\":{\n\t\t\tcanEquip: onePerShip(\"Battle-Hardened\")},\n\n\t\t//Calculating\n\t   \"talent:E200\":{\n\t\t\tcanEquip: onePerShip(\"Calculating\")},\n\n\t\t//Full Spread\n\t   \"weapon:W201\":{\n\t\t\tcanEquip: onePerShip(\"Full Spread\")},\n\n\t\t//Enhanced Targeting\n\t\t \"weapon:W207\":{\n\t\t\tcanEquip: onePerShip(\"Enhanced Targeting\")},\n\n\t\t//Overcharged Phasers\n\t\t \"weapon:W205\":{\n\t\t\tcanEquip: onePerShip(\"Overcharged Phasers\")},\n\n\t  //Dorsal Phaser Array\n\t\t \"weapon:W203\":{\n\t\t\tcanEquip: onePerShip(\"Dorsal Phaser Array\")},\n\n\t\t//Detection Grid\n\t\t \"tech:T255\":{\n\t\t\tcanEquip: onePerShip(\"Detection Grid\")},\n\n\t\t//Reinforced Shielding\n\t\t \"tech:T253\":{\n\t\t\tcanEquip: onePerShip(\"Reinforced Shielding\")},\n\n\t\t//Commander\n\t\t \"crew:C362\":{\n\t\t\tcanEquip: onePerShip(\"Commander\")},\n\n\t\t//Tactical Officer\n\t\t \"crew:C360\":{\n\t\t\tcanEquip: onePerShip(\"Tactical Officer\")},\n\n\t\t//Helmsman\n\t\t \"crew:C361\":{\n\t\t\tcanEquip: onePerShip(\"Helmsman\")},\n\n\t\t//Science Officer\n\t\t \"crew:C358\":{\n\t\t\tcanEquip: onePerShip(\"Science Officer\")},\n\n\t  //Operations Officer\n\t\t \"crew:C359\":{\n\t\t\tcanEquip: onePerShip(\"Operations Officer\")},\n\n\t\t//Generic Captain 0 XP\n\t\t\t\"captain:Cap118\": {\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\t/**\n\t\t\t\t\t\t * Cost function for 0 XP Star Trek Alliance Captain\n\t\t\t\t\t\t *\n\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t */\n\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\tvar modifier = 0;\n\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n\t\t\t//Generic Captain 1 XP\n\t\t\t\t\t\"captain:Cap119\": {\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 1 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\n\t\t\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t//Generic Captain 3 XP\n\t\t\t\t\t\"captain:Cap121\": {\n\t\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 3 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t//Generic Captain 4 or 5 XP\n\t\t\t\t\t\"captain:Cap122\": {\n\t\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 4 or 5 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t//Generic Captain 6 or 7 XP\n\t\t\t\t\t\"captain:Cap123\": {\n\t\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 6 or 7 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t//Generic Captain 8 or 9 XP\n\t\t\t\t\t\"captain:Cap124\": {\n\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 8 or 9 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t//Generic Captain 10 or 11 XP\n\t\t\t\t\t\"captain:Cap125\": {\n\t\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 10 or 11 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t//Generic Captain 12 XP\n\t\t\t\t\t\"captain:Cap126\": {\n\t\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 12 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t//Generic Captain 13 XP\n\t\t\t\t\t\"captain:Cap127\": {\n\t\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{},{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 13 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t//Generic Captain 14 XP\n\t\t\t\t\t\"captain:Cap128\": {\n\t\t\t\t\t\tupgradeSlots: [\n\t\t\t\t\t\t\t{},{},{},{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t],\n\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t/**\n\t\t\t\t\t\t\t\t * Cost function for 14 XP Star Trek Alliance Captain\n\t\t\t\t\t\t\t\t *\n\t\t\t\t\t\t\t\t * Removes Ship cost.\n\t\t\t\t\t\t\t\t */\n\t\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount, if over 30 it won't work.\n\t\t\t\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\t\t\t\tmodifier = 30\n\t\t\t\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t//Reinforced Shielding\n\t\t\t\t\t\t\"tech:T253\":{\n\t\t\t\t\t\t\tcanEquip: onePerShip(\"Reinforced Shielding\"),\n\t\t\t\t\t\t\tintercept: {\n\t\t\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 2;\n\t\t\t\t\t\t\t\t\t\treturn shields;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t//Core Starter Set :71120\n\t\t// Photon Torpedoes (Vor'cha Bonus)\n\t\t\"weapon:W120\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Vor'cha Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Gor Portas : 71128\n\t\t// Thot Gor\n\t\t\"captain:Cap641\": {\n\t\t\t// Reduce cost of all weapons by 1 SP\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tvar calculatedCost = cost;\n\t\t\t\t\t\tif( checkUpgrade(\"weapon\", upgrade, ship) )\n\t\t\t\t\t\t\tcalculatedCost = resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn calculatedCost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t//Energy Dissipator\n\t\t\"weapon:W111\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Breen\") < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//IKS Negh'var :71126\n\t\t// Photon Torpedoes (Negh'var Bonus)\n\t\t\"weapon:W114\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Negh'var Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//IKS Gr'oth :71125\n\n\t//RIS Apnex :71124\n\t\t// Varel\n\t\t\"crew:C193\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Romulan Science Vessel\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Muon Feedback Wave\n\t\t\"tech:T247\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Science Vessel\";\n\t\t\t}\n\t\t},\n\n\n\t//IRW Valdore :71123\n\n\t//USS Enterprise :71122\n\t\t// Christopher Pike\n\t\t\"captain:Cap644\": {\n\t\t\t// Reduce cost of all crew by 1 SP\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"crew\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// James T. Kirk\n\t\t\"captain:Cap905\": {\n\t\t\t// Two talent slots. Cost is overridden to be 3.\n\t\t\tupgradeSlots: cloneSlot( 2 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Fed Talents Cost Exactly 3 SP\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\t\tif( hasFaction(upgrade,\"federation\",ship,fleet) || hasFaction(upgrade,\"bajoran\",ship,fleet) || hasFaction(upgrade,\"vulcan\",ship,fleet) )\n\t\t\t\t\t\t\t\treturn 3;\n\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t},\n\n\t//USS Reliant :71121\n\t\t// Khan Singh\n\t\t\"captain:Cap814\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for upgrades\n\t\t\t\t\tfactionPenalty: function(card, ship, fleet, factionPenalty) {\n\t\t\t\t\t\tif( isUpgrade(card) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//GenCon 2013 Promo\n\t\t//Khan Singh\n\t\t\"captain:Cap645\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for Khan or Talents\n\t\t\t\t\tfactionPenalty: function(upgrade, ship, fleet, factionPenalty) {\n\t\t\t\t\t\treturn upgrade.type == \"captain\" || upgrade.type == \"talent\" ? 0 : factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Krayton : OP1Prize\n\n\t//5th Wing Patrol Ship :71271\n\t\t// Luaran\n\t\t\"captain:Cap325\": {\n\t\t\t// One Dominion upgrade is -2 SP. Argh.\n\t\t\t// This is a messy implementation. It requires recalculation of the candidate for each upgrade on the ship.\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\n\t\t\t\t\t\tvar candidate = false;\n\t\t\t\t\t\tvar candCost = 0;\n\n\t\t\t\t\t\t// Find the upgrade with the highest cost\n\t\t\t\t\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i, slot) {\n\t\t\t\t\t\t\tif( slot.occupant && $factions.hasFaction(slot.occupant,\"dominion\", ship, fleet) ) {\n\t\t\t\t\t\t\t\t// Note: This doesn't account for other cost modifiers. Can't use valueOf without huge recursion.\n\t\t\t\t\t\t\t\tvar occCost = resolve(slot.occupant,ship,fleet,slot.occupant.cost);\n\t\t\t\t\t\t\t\tif( occCost > candCost ) {\n\t\t\t\t\t\t\t\t\tcandidate = slot.occupant;\n\t\t\t\t\t\t\t\t\tcandCost = occCost;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Modify cost only if this is the candidate upgrade\n\t\t\t\t\t\tif( upgrade == candidate )\n\t\t\t\t\t\t\tcost = candCost - 2;\n\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Suicide Attack\n\t\t\"tech:T236\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && ship.class.indexOf(\"Jem'Hadar\") >= 0;\n\t\t\t}\n\t\t},\n\t\t// Phased Polaron Beam\n\t\t\"weapon:W103\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Jem'Hadar\") < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Omet'Iklan\n\t\t\"crew:C178\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && ship.class.indexOf(\"Jem'Hadar\") >= 0;\n\t\t\t}\n\t\t},\n\t\t// Virak'Kara\n\t\t\"crew:C177\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && ship.class.indexOf(\"Jem'Hadar\") >= 0;\n\t\t\t}\n\t\t},\n\t\t// Toman'Torax\n\t\t\"crew:C176\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && ship.class.indexOf(\"Jem'Hadar\") >= 0;\n\t\t\t}\n\t\t},\n\n\n\t//I.R.W. Praetus :71270\n\n\t//I.K.S. Kronos One :71269\n\n\t//U.S.S. Defiant :71268\n\t\t// Cloaking Device (Defiant)\n\t\t\"tech:T240\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.name != \"U.S.S. Defiant\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Red Shirt Crew\n\n\t//IKS Ch'tang :OP2Prize\n\n\t//P.W.B. Aj'Rmr :OP3Prize\n\n\t//Koranak :71275\n\t\t// Enhanced Weaponry\n\t\t\"weapon:W102\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Keldon Class\") >= 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Cloaking Device (Keldon)\n\t\t\"tech:T233\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Keldon Class\") < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//R.I.S. Vo :71274\n\n\t//I.K.S. Koraga :71273\n\n\t//U.S.S. Excelsior :71272\n\t\t// Styles\n\t\t\"captain:Cap323\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t//U.S.S. Sutherland :OP4Prize\n\n\t//I.K.S. Somraw :71448\n\t\t// Klingon Honor\n\t\t\"talent:E111\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"klingon\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Shockwave\n\t\t\"tech:T225\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Raptor Class\";\n\t\t\t}\n\t\t},\n\t\t// Tactical Sensors\n\t\t\"tech:T224\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Raptor Class\";\n\t\t\t}\n\t\t},\n\n\n\t//4th Division Battleship :71279\n\t\t\"captain:Cap717\": {\n\t\t\t// Two crew slots, each with -1 SP if equipped with Dominion crew\n\t\t\tupgradeSlots: [{/* Existing Talent Slot */} ].concat( cloneSlot( 2 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\trules: \"-1 SP if Dominion\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\t\t\tif( $factions.hasFaction(upgrade,\"dominion\", ship, fleet) )\n\t\t\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t))\n\t\t},\n\t\t// Kudak'Etan\n\t\t\"crew:C159\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && ship.class.indexOf(\"Jem'Hadar\") >= 0;\n\t\t\t}\n\t\t},\n\t\t// Ikat'Ika\n\t\t\"crew:C157\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Jem'Hadar\") < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Photon Torpedoes (Jem'Hadar Battleship Bonus)\n\t\t\"weapon:W097\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Jem'Hadar Battleship\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 2;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Phased Polaron Beam\n\t\t\"weapon:W096\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Jem'Hadar\") < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//I.R.W. Gal Gath'thong :71278\n\n\t//U.S.S. Equinox :71276\n\n\t//Emergency Medical Hologram\n\t\"question:Q024\":{\n\t\tcanEquip: onePerShip(\"EMH Mark I\"),\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >=0;\n\t\t}\n\t},\n\n\t//Rav Laerst :OP5Prize\n\t\t// Cold Storage Unit\n\t\t\"tech:T228\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Akorem :OP6Prize\n\t\t// Tahna Los\n\t\t\"captain:Cap524\": {\n\t\t\t// Add a Tech slot. Cost = 3. Can't have a ship/class specific restriction\n\t\t\t// TODO Add check for ship/class restriction. Woe is me.\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Existing Talent Slot */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\trules: \"Costs exactly 3 SP\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\t//Adds check for specific ship or class\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\tif (upgrade.text.includes('may only be purchased for the U.S.S. Voyager.') || upgrade.text.includes('Galor or Keldon Class Only') || upgrade.text.includes('This Upgrade may only be purchased for a Species 8472 ship'))\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\telse if(upgrade.id == \"T272\" || upgrade.id == \"T254\" || upgrade.id == \"T252\" || upgrade.id == \"T223\" || upgrade.id == \"T094\" || upgrade.id == \"T091\" || upgrade.id == \"T054\" || upgrade.id == \"T045\" || upgrade.id == \"T258\" || upgrade.id == \"T256\" || upgrade.id == \"T260\" || upgrade.id == \"T269\" || upgrade.id == \"T182\" || upgrade.id == \"T181\" || upgrade.id == \"T175\" || upgrade.id == \"T172\" || upgrade.id == \"T171\" || upgrade.id == \"T150\" || upgrade.id == \"T138\" || upgrade.id == \"T136\" || upgrade.id == \"127\" || upgrade.id == \"T103\" || upgrade.id == \"T102\" || upgrade.id == \"T238\" || upgrade.id == \"T237\" || upgrade.id == \"T232\" || upgrade.id == \"T230\" || upgrade.id == \"T212\" || upgrade.id == \"T208\" || upgrade.id == \"T204\" || upgrade.id == \"T200\" || upgrade.id == \"T088\" || upgrade.id == \"T087\" || upgrade.id == \"T086\" || upgrade.id == \"T033\" || upgrade.id == \"T031\" || upgrade.id == \"T027\" || upgrade.id == \"T015\" || upgrade.id == \"T002\" || upgrade.id == \"T280\" || upgrade.id == \"T279\" || upgrade.id == \"T255\" || upgrade.id == \"T253\" || upgrade.id == \"T268\" || upgrade.id == \"T267\" || upgrade.id == \"T180\" || upgrade.id == \"T178\" || upgrade.id == \"T167\" || upgrade.id == \"T164\" || upgrade.id == \"T162\" || upgrade.id == \"T161\" || upgrade.id == \"T157\" || upgrade.id == \"T156\" || upgrade.id == \"T153\" || upgrade.id == \"T151\" || upgrade.id == \"T146\" || upgrade.id == \"T130\" || upgrade.id == \"T129\" || upgrade.id == \"T122\" || upgrade.id == \"T118\" || upgrade.id == \"T106\" || upgrade.id == \"T101\" || upgrade.id == \"T100\" || upgrade.id == \"T249\" || upgrade.id == \"T248\" || upgrade.id == \"T242\" || upgrade.id == \"T241\" || upgrade.id == \"T239\" || upgrade.id == \"T234\" || upgrade.id == \"T231\" || upgrade.id == \"T214\" || upgrade.id == \"T202\" || upgrade.id == \"T084\" || upgrade.id == \"T083\" || upgrade.id == \"T077\" || upgrade.id == \"T076\" || upgrade.id == \"T074\" || upgrade.id == \"T071\" || upgrade.id == \"T069\" || upgrade.id == \"T066\" || upgrade.id == \"T052\" || upgrade.id == \"T030\" || upgrade.id == \"T026\" || upgrade.id == \"T019\" || upgrade.id == \"T016\" || upgrade.id == \"T004\")\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t//Upgrades cost 3 SP\n\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\tif( !$factions.match( card, ship, ship, fleet ) )\n\t\t\t\t\t\t\t\treturn 4;\n\t\t\t\t\t\t\telse if( $factions.match( card, ship, ship, fleet ) )\n\t\t\t\t\t\t\t\treturn 3;\n\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t//Borg Sphere 4270 :71283\n\t\t// Cutting Beam\n\t\t\"weapon:W094\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t//Nistrim Raider\n\n\t\t// Kazon Raiding Party\n\t\t\"crew:C152\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"kazon\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Masking Circuitry\n\t\t\"tech:T217\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"kazon\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Bioship Alpha :71281\n\t\t// Bio-Electric Interference\n\t\t\"tech:T221\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"species-8472\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Extraordinary Immune Response\n\t\t\"tech:T219\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"species-8472\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Quantum Singularity\n\t\t\"tech:T216\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"species-8472\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// The Weak Will Perish\n\t\t\"talent:E104\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"species-8472\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Biological Attack\n\t\t\"weapon:W095\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"species-8472\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Energy Blast\n\t\t\"weapon:W093\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Species 8472 Bioship\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 2;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Energy Focusing Ship\n\t\t\"weapon:W092\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"species-8472\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Voyager :71280\n\t\t// Ablative Generator\n\t\t\"tech:T222\": {\n\t\t\t// Equip only on Voyager\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.name == \"U.S.S. Voyager\";\n\t\t\t}\n\t\t},\n\t\t// B'elanna Torres\n\t\t\"crew:C154\": {\n\t\t\tname: \"B'Elanna Torres\",\n\t\t\tupgradeSlots: [ { type: [\"weapon\"] }, { type: [\"tech\"] } ]\n\t\t},\n\n\t\t//The Doctor\n\t\t\"question:Q025\":{\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >=0;\n\t\t\t}\n\t\t},\n\t\t// Transphasic Torpedoes\n\t\t\"weapon:W090\": {\n\t\t\t// Equip only on Voyager\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.name == \"U.S.S. Voyager\";\n\t\t\t}\n\t\t},\n\n\t//Red Alert Talent\n\n\t//Tholia One :OPWebPrize\n\t\t// Tholian Punctuality\n\t\t\"talent:E103\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t// TODO Tholians are Independent so can't easily tell their race\n\t\t\t\treturn ship.captain && ( ship.captain.name == \"Loskene\" || ship.captain.name.indexOf(\"Tholian\") >= 0 );\n\t\t\t}\n\t\t},\n\t\t// Energy Web\n\t\t\"weapon:W089\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Tholian Vessel\";\n\t\t\t}\n\t\t},\n\n\t//Full Alert Talent\n\n\t//S'Gorn :OPArenaPrize\n\n\t//D'Kyr :71446\n\t\t// Tavek\n\t\t\"captain:Cap322\": {\n\t\t\t// Add one crew slot\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\t// Vulcan High Command\n\t\t\"talent:E101\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain &&  $factions.hasFaction(ship,\"vulcan\", ship, fleet) &&  $factions.hasFaction(ship.captain,\"vulcan\", ship, fleet);\n\t\t\t},\n\t\t\tupgradeSlots: cloneSlot( 2 , { type: [\"tech\",\"crew\"] } )\n\t\t},\n\n\t//Interceptor 5 :71445\n\t\t// Warp Drive Refit\n\t\t\"tech:T212\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif ( ship && ship.classData && ship.classData.maneuvers && ship.classData.maneuvers.max )\n\t\t\t\t\treturn ( ship.classData.maneuvers.max < 4 );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t// Maneuverability\n\t\t\"tech:T211\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Bajoran Interceptor\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Phaser Strike\n\t\t\"weapon:W085\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull <= 3;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Bajoran Interceptor\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Tactical Cube :71444\n\t\t\"ship:S139\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Reduce cost of Borg Ablative Hull Armor\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( upgrade.name == \"Borg Ablative Hull Armor\" )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 3;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Assimilated Access Codes\n\t\t\"talent:E099\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"borg\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Full Assault\n\t\t\"weapon:W084\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Borg Tactical Cube\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 3;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Borg Missile\n\t\t\"weapon:W083\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\n\t//3rd Wing Attack Ship :3rd_wing_attack_ship\n\t\t// First Strike\n\t\t\"talent:E093\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull <= 3;\n\t\t\t}\n\t\t},\n\t\t// Ion Thrusters\n\t\t\"tech:T204\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Ion Thrusters\")\n\t\t},\n\n\n\t//Gavroche :gavroche\n\t\t// Sakonna\n\t\t\"crew:C134\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: {\n\t\t\t\t\t\t// Run this interceptor after all other penalties and discounts\n\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\tfn: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\t\tif( checkUpgrade(\"weapon\", upgrade, ship)\n\t\t\t\t\t\t\t     && upgrade.name != \"Torpedo Fusillade\" && upgrade.id != \"W057\" && upgrade.name != \"Aft Phaser Emitters\" && upgrade.id != \"W156\" && upgrade.id != \"W199\" && upgrade.id !=\"W223\") {\n\t\t\t\t\t\t\t\tcost = resolve(upgrade,ship,fleet,cost);\n\t\t\t\t\t\t\t\tif( cost <= 5 )\n\t\t\t\t\t\t\t\t\tcost -= 2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//I.K.S. B'Moth :i_k_s_b_moth\n\n\t//I.R.W. Vorta Vor :i_r_w_vorta_vor\n\n\t//U.S.S. Yeager :u_s_s_yaeger\n\n\t//Ti'Mur :71508\n\t\t// Vanik\n\t\t\"captain:Cap522\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// All Vulcan/Federation tech is -2 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\tif ( $factions.hasAnyFaction(upgrade,[\"federation\",\"bajoran\", \"vulcan\"], ship, fleet) && (upgrade.type == \"tech\" || getOccupiedSlot(upgrade, ship)?.type?.includes(\"tech\") ))\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 2;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Combat Vessel Variant\n\t\t\"tech:T201\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Suurok Class\";\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tattack: function(card,ship,fleet,attack) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\thull: function(card,ship,fleet,hull) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,hull) + 1;\n\t\t\t\t\t\treturn hull;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//2nd Division Cruiser :71524\n\t\t// Unnecessary Bloodshed\n\t\t\"talent:E087\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"dominion\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Volley of Torpedoes\n\t\t\"weapon:W075\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Jem'Hadar Battleship\" || ship.class == \"Jem'Hadar Battleship \" || ship.class == \"Jem'Hadar Battle Cruiser\";\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Enterprise (Refit) :71523\n\t\t// Self-Destruct Sequence\n\t\t\"talent:E090\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"federation\", ship, fleet ) || $factions.hasFaction(ship,\"bajoran\",ship,fleet) || $factions.hasFaction(ship,\"vulcan\",ship,fleet);\n\t\t\t}\n\t\t},\n\n\t//Soong :71522\n\t\t// Hugh\n\t\t\"captain:Cap424\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// All crew cost -1 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"crew\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t\t// No faction penalty for borg upgrades\n\t\t\t\t\tfactionPenalty: function(upgrade, ship, fleet, factionPenalty) {\n\t\t\t\t\t\tif( isUpgrade(upgrade) && $factions.hasFaction(upgrade,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Lore\n\t\t\"captain:Cap711\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t// Existing talent slot\n\t\t\t\t{},\n\t\t\t\t// Add one crew slot\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipFaction: {\n\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\tfn: function(card,ship,fleet,canEquipFaction) {\n\t\t\t\t\t\t\tif( card.type == \"talent\" )\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\treturn canEquipFaction;\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tfactionPenalty: {\n\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\tfn: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\t\tif( card.type == \"talent\" )\n\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Experimental Link\n\t\t\"talent:E088\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"borg\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Transwarp Conduit\n\t\t\"borg:B012\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Photon Torpedoes (Borg)\n\t\t\"weapon:W077\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && $factions.hasFaction(ship,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Forward Weapons Array\n\t\t\"weapon:W076\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Raven :71509\n\t\t// Multi-Adaptive Shields\n\t\t\"tech:T099\": {\n\t\t\tname: \"Multi-Adaptive Shields\",\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || $factions.hasFaction(ship,\"vulcan\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Reinforced Structural Integrity\n\t\t\"tech:T098\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.name != \"U.S.S. Raven\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//DS9 GenCon Promo 71786\n\t\t// T'Rul\n\t\t\"crew:C110\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Quark\n\t\t\"crew:C114\":{\n\t\t\ttext: \"At the start of the game, place 1 non-Borg [tech] or [weapon] Upgrade with a cost of 5 or less face down beneath this card. At any time, you may discard Quark to flip the Upgrade that is beneath this card face up and deploy it to your ship, even if it exceeds your ship's restrictions.\",\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\",\"tech\"],\n\t\t\t\t\trules: \"Non-Borg, 5SP or less\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\t\t\t// TODO Prevent use of upgrades without a defined cost (e.g. Dorsal Phaser Array)\n\t\t\t\t\t\t\t\tvar cost = valueOf(upgrade,\"cost\",ship,fleet);\n\t\t\t\t\t\t\t\treturn cost <= 5;\n\n\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t\t\t\t\treturn !$factions.hasFaction(upgrade,\"borg\", ship, fleet);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfree: function() {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t},\n\t\t\t\t}\n\t\t}\n\t}\n]\n},\n\t\t// Elim Garak\n\t\t\"crew:C109\": {\n\t\t\t//talents: 1,\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"No Faction Penalty\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tfactionPenalty: 0\n\t\t},\n\n\n\t//Assimilation Target Prime : 71510b\n\t\t\"ship:S106\": {\n\t\t\t// Restore class on card text\n\t\t\tclass: \"Galaxy Class\",\n\t\t\t// TODO use this field to pick the correct maneuver card\n\t\t\tclassId: \"galaxy__class_mu\",\n\t\t},\n\t\t\"ship:S107\": {\n\t\t\t// Restore class on card text\n\t\t\tclass: \"Galaxy Class\",\n\t\t\t// TODO use this field to pick the correct maneuver card\n\t\t\tclassId: \"galaxy__class_mu\",\n\t\t},\n\t\t\"ship:S108\": {\n\t\t\t// Restore class on card text\n\t\t\tclass: \"Galaxy Class\",\n\t\t\t// TODO use this field to pick the correct maneuver card\n\t\t\tclassId: \"galaxy__class_mu\",\n\t\t},\n\t\t\"ship:S105\": {\n\t\t\t// Restore class on card text\n\t\t\tclass: \"Galaxy Class\",\n\t\t\t// TODO use this field to pick the correct maneuver card\n\t\t\tclassId: \"galaxy__class_mu\",\n\t\t},\n\t\t// Fire All Weapons\n\t\t\"weapon:W070\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !(ship.class == \"Galaxy Class\" || ship.class == \"Intrepid Class\" || ship.class == \"Sovereign Class\") )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Stargazer :71510\n\t\t// Jean-Luc Picard 6\n\t\t\"captain:Cap629\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t// existing talent slot\n\t\t\t\t{},\n\t\t\t\t// Add one crew slot\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Tactical Station\n\t\t\"weapon:W170\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Ni'Var :71527\n\t\t// Sopek\n\t\t\"captain:Cap630\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t// existing talent slot\n\t\t\t\t{},\n\t\t\t\t// Add one crew slot\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Vulcan Commandos\n\t\t\"crew:C101\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"vulcan\", ship, fleet );\n\t\t\t}},\n\t\t// Combat Vessel Variant\n\t\t\"tech:T095\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\n\t\t\t\tif( ship.class != \"Suurok Class\" )\n\t\t\t\t\treturn false;\n\n\t\t\t\t// Only one per ship\n\t\t\t\treturn onePerShip(\"Combat Vessel Variant\")(upgrade,ship,fleet);\n\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tattack: function(card,ship,fleet,attack) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\thull: function(card,ship,fleet,hull) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,hull) + 1;\n\t\t\t\t\t\treturn hull;\n\t\t\t\t\t},\n\t\t\t\t\t// Prevent other CVV while this one equipped\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\treturn upgrade.name != \"Combat Vessel Variant\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Enterprise NX-01 :71526\n\t\t\"ship:S115\": {\n\t\t\tupgradeSlots: [ {\n\t\t\t\ttype: [\"tech\"],\n\t\t\t\trules: \"Free EHP Only\",\n\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\treturn upgrade.name == \"Enhanced Hull Plating\";\n\t\t\t\t},\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tcost: function() { return 0; }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} ]\n\t\t},\n\n\t\t// Jonathan Archer\n\t\t\"captain:Cap521\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t// existing talent slot\n\t\t\t\t{},\n\t\t\t\t//Adds 1 crew upgrade slot and 1 slot for Porthos (the best boy)\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\trules: \"Prothos Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.id == \"C447\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Enhanced Hull Plating\n\t\t\"tech:T096\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Enhanced Hull Plating\"),\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet) || $factions.hasFaction(ship,\"bajoran\",ship,fleet) || $factions.hasFaction(ship,\"vulcan\",ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// T'Pol\n\t\t\"crew:C107\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Scout Cube 608 :71525\n\t\t\"ship:S113\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet,canEquip) {\n\t\t\t\t\t\tif( checkUpgrade(\"borg\", upgrade, ship) && valueOf(upgrade,\"cost\",ship,fleet) > 5 )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"ship:S111\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet,canEquip) {\n\t\t\t\t\t\tif ( checkUpgrade(\"borg\", upgrade, ship) && valueOf(upgrade,\"cost\",ship,fleet) > 5 )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"captain:Cap317\": {\n\t\t\t// Can't equip if fleet contains Hugh\n\t\t\tcanEquip: function(upgrade, ship, fleet) {\n\t\t\t\treturn !$filter(\"fleetCardNamed\")(fleet, \"Hugh\");\n\t\t\t},\n\t\t\t// While equipped, can't equip a card named Hugh on any ship\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\tcanEquip: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Hugh\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquipCaptain: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Hugh\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Third of Five\n\t\t\"crew:C100\": {\n\t\t\t// Can't equip if fleet contains Hugh\n\t\t\tcanEquip: function(upgrade, ship, fleet) {\n\t\t\t\treturn !$filter(\"fleetCardNamed\")(fleet, \"Hugh\");\n\t\t\t},\n\t\t\t// While equipped, can't equip a card named Hugh on any ship\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\tcanEquip: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Hugh\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquipCaptain: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Hugh\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Scavenged Parts\n\t\t\"borg:B011\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Scavenged Parts\")\n\t\t},\n\t\t// Magnetometric Guided Charge\n\t\t\"weapon:W071\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"borg\");\n\t\t\t}\n\t\t},\n\n\n\t//Bok's Marauder : 71646a\n\t\t// Thought Maker\n\t\t\"tech:T090\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"ferengi\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Vengeance\n\t\t\"talen:E080\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"ferengi\", ship, fleet) && $factions.hasFaction(ship,\"ferengi\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t//Prakesh :71646b\n\t\t// Cloaking Device (Mirror)\n\t\t\"tech:T089\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"mirror-universe\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t\t\t// Haron\n\t\t\"captain:Cap315\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t// Add one weapon slot\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// All Kazon weapons are -1 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"weapon\", upgrade, ship) && $factions.hasFaction(upgrade,\"kazon\", ship, fleet) ) {\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Tractor Beam\n\t\t\"tech:T088\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Tractor Beam\")\n\t\t},\n\t\t// Photonic Charges\n\t\t\"weapon:W064\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship.class != \"Predator Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Scout 255 :71646d\n\t\t\"ship:S099\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet,canEquip) {\n\t\t\t\t\t\tif( checkUpgrade(\"borg\", upgrade, ship) && valueOf(upgrade,\"cost\",ship,fleet) > 5 )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Proton beam\n\t\t\"weapon:W062\": {\n\t\t\tname: \"Proton Beam\",\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Tal'Kir :71646e\n\t\t// Vulcan Logic\n\t\t\"talent:E079\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"vulcan\", ship, fleet) && $factions.hasFaction(ship,\"vulcan\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t//Avatar of Tomed :71511\n\t\t// Hive Mind\n\t\t\"borg:B007\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Hive Mind\")\n\t\t},\n\t\t// Borg Alliance\n\t\t\"talent:E078\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && !$factions.hasFaction(ship.captain,\"borg\", ship, fleet) && !$factions.hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"borg\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//U.S.S. Enterprise-E :71531\n\n\t\t// Picard 8\n\t\t\"captain:Cap807\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Existing Talent Slot */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\",\"tech\",\"weapon\",\"talent\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Advanced Shields\n\t\t\"tech:T085\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Advanced Shields\")\n\t\t},\n\t\t// William T. Riker (Ent-E)\n\t\t\"crew:C089\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Geordi LaForge\n\t\t\"crew:C088\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Photon Torpedoes (Sovereign)\n\t\t\"weapon:W058\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Sovereign Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Dorsal Phaser Array\n\t\t\"weapon:W057\": {\n\t\t\tattack: 0,\n\t\t\t// Equip only on a Federation ship with hull 4 or more\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && ( $factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || $factions.hasFaction(ship,\"vulcan\", ship, fleet) ) && ship.hull >= 4;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\t// Cost is primary weapon + 1\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Queen Vessel Prime :71530\n\t\t// Transwarp Signal\n\t\t\"borg:B006\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Transwarp Signal\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Borg Shield Matrix\n\t\t\"borg:B005\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Borg Shield Matrix\")\n\t\t},\n\t\t// Multi Kinetic Neutronic Mines\n\t\t\"weapon:W056\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Val Jean :71528\n\t\t// Calvin Hudson\n\t\t\"captain:Cap518\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\t// Reduce cost of all Upgrades by 1 SP if on Independent ship\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ($factions.hasFaction(ship,\"independent\", ship, fleet) || $factions.hasFaction(ship,\"ferengi\", ship, fleet) || $factions.hasFaction(ship,\"kazon\", ship, fleet) || $factions.hasFaction(ship,\"xindi\", ship, fleet) )&& isUpgrade(upgrade) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Chakotay\n\t\t\"captain:Cap626\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Existing Talent Slot */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\",\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Ramming Attack\n\t\t\"weapon:W060\":{\n\t\t\t// Equip only on a ship with hull 3 or less\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull <= 3;\n\t\t\t}\n\t\t},\n\n\t//Assimilated Vessel 80279 :71512\n\t\t\"ship:S087\": {\n\t\t\t// Can't join fleet with AV80279 in it\n\t\t\tcanJoinFleet: function(ship, ship2, fleet) {\n\t\t\t\tvar canJoin = true;\n\t\t\t\t$.each( fleet.ships, function(i, other) {\n\t\t\t\t\tif( other.name == \"Assimilated Vessel 80279\" ) {\n\t\t\t\t\t\tcanJoin = false;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn canJoin;\n\t\t\t},\n\t\t\t// If in fleet, don't allow AV80279 to join\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\tcanJoinFleet: function(ship, ship2, fleet) {\n\t\t\t\t\t\treturn ship.name != \"Assimilated Vessel 80279\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Data Node\n\t\t\"borg:T083\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Data Node\")\n\t\t},\n\t\t// Warrior Spirit\n\t\t\"talent:E071\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"klingon\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\n\t//Scimitar :71533\n\t\t// Shinzon Romulan Talents\n\t\t\"talent:E063\": {\n\t\t\tupgradeSlots: cloneSlot( 4 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Romulan Talent Only\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function() { return 0; },\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; },\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\tif( !$factions.hasFaction( card, \"romulan\", ship, fleet ) )\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t),\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && ship.captain.name == \"Shinzon\";\n\t\t\t},\n\t\t\tfactionPenalty: 0\n\t\t},\n\t\t// Secondary Shields\n\t\t\"tech:T080\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Reman Warbird\";\n\t\t\t}\n\t\t},\n\t\t// Improved Cloaking Device\n\t\t\"tech:T079\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Reman Warbird\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Thalaron Weapon\n\t\t\"weapon:W054\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Reman Warbird\";\n\t\t\t}\n\t\t},\n\t\t// Photon Torpedoes (Reman Warbird)\n\t\t\"weapon:W053\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Reman Warbird\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 2;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Chang's Bird of Prey : 71532\n\t\t// Prototype Cloaking Device\n\t\t\"tech:T081\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Klingon Bird-of-Prey\";\n\t\t\t}\n\t\t},\n\t\t// Cry Havoc\n\t\t\"talent:E068\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"klingon\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\n\t//I.S.S. Defiant :71529\n\t\t\"ship:S084\": {\n\t\t\tclass: \"Defiant Class\",\n\t\t\tclassId: \"defiant_class_mirror\"\n\t\t},\n\t\t\"ship:S080\": {\n\t\t\tclass: \"Defiant Class\",\n\t\t\tclassId: \"defiant_class_mirror\"\n\t\t},\n\t\t// Miles O'Brien MU\n\t\t\"captain:Cap516\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{}, // Existing talent slot\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Jennifer Sisko\n\t\t\"crew:C078\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Tactical Cube 001 :71513a\n\t\t// Borg Queen\n\t\t\"captain:Cap902\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{}, // Existing talent slot\n\t\t\t\t{\n\t\t\t\t\ttype: [\"borg\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Command Interface\n\t\t\"borg:E070\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Interplexing Beacon\n\t\t\"borg:B002\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Interplexing Beacon\")\n\t\t},\n\n\n\t//Assimilated Vessel 64758 :71513b\n\t\t\"ship:S070\": {\n\t\t\t// Can't join fleet with AV64758 in it\n\t\t\tcanJoinFleet: function(ship, ship2, fleet) {\n\t\t\t\tvar canJoin = true;\n\t\t\t\t$.each( fleet.ships, function(i, other) {\n\t\t\t\t\tif( other.name == \"Assimilated Vessel 64758\" ) {\n\t\t\t\t\t\tcanJoin = false;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn canJoin;\n\t\t\t},\n\t\t\t// If in fleet, don't allow AV64758 to join\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\tcanJoinFleet: function(ship, ship2, fleet) {\n\t\t\t\t\t\treturn ship.name != \"Assimilated Vessel 64758\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Truce\n\t\t\"talent:E060\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.captain && ship.captain.skill > 5 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Cube 112 :71792\n\t\t// Locutus\n\t\t\"captain:Cap901\": {\n\t\t\t// Can't equip if fleet contains Jean-Luc Picard\n\t\t\tcanEquipCaptain: function(upgrade, ship, fleet) {\n\t\t\t\treturn !$filter(\"fleetCardNamed\")(fleet, \"Jean-Luc Picard\");\n\t\t\t},\n\t\t\t// While equipped, can't equip a card named Jean-Luc Picard on any ship\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\tcanEquip: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Jean-Luc Picard\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquipCaptain: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Jean-Luc Picard\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t// 1st Wave Attack Fighters :71754\n\t\t// Cover Fire\n\t\t\"squadron:D016\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Cover Fire\")\n\t\t},\n\t\t// Flanking Attack\n\t\t\"squadron:D015\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Flanking Attack\")\n\t\t},\n\t\t// Support Ship\n\t\t\"squadron:D013\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Support Ship\")\n\t\t},\n\t\t// Aft Disruptor Wave Cannons\n\t\t\"squadron:D011\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Aft Disruptor Wave Cannons\")\n\t\t},\n\t\t// Galor Class Phaser Banks\n\t\t\"squadron:D010\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Galor Class Phaser Banks\")\n\t\t},\n\n\n\t//Regent's Flagship :71535\n\t\t\"ship:S067\": {\n\t\t\tclass: \"Negh'var Class\",\n\t\t\tclassId: \"negh_var_class_mirror\"\n\t\t},\n\t\t\"ship:S066\": {\n\t\t\tclass: \"Negh'var Class\",\n\t\t\tclassId: \"negh_var_class_mirror\"\n\t\t},\n\t\t// Elim Garak (Mirror)\n\t\t\"crew:C067\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( upgrade == ship.captain && $factions.hasFaction(ship,\"mirror-universe\", ship, fleet) )\n\t\t\t\t\t\t\tskill = resolve(upgrade,ship,fleet,skill) + 2;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Cloaking Device (Regent's Flagship)\n\t\t\"tech:T078\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.name != \"Regent's Flagship\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Photon Torpedoes (Negh'var Bonus) (Mirror)\n\t\t\"weapon:W050\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Negh'var Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Fina Prime :71534\n\t\t// Hypothermic Charge\n\t\t\"weapon:W052\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class.indexOf( \"Vidiian\" ) >= 0;\n\t\t\t}\n\t\t},\n\n\n\t//I.K.S. Pagh :71996\n\t\t// William T. Riker (Pagh)\n\t\t\"crew:C063\": {\n\t\t\ttalents: 1,\n\t\t\tfactionPenalty: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && $factions.hasFaction(ship,\"klingon\", ship, fleet) ? 0 : 1;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Tunneling Neutrino Beam\n\t\t\"tech:T069\": {\n\t\t\tfactionPenalty: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship && $factions.hasFaction(ship,\"klingon\", ship, fleet) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t// Phaser Array Retrofit\n\t\t\"weapon:W047\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Phaser Array Retrofit\")\n\t\t},\n\n\n\t//Alpha Hunter :71808\n\n\t\t// Monotanium Armor Plating\n\t\t\"tech:T076\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Monotanium Armor Plating\")\n\t\t},\n\t\t// Sensor Network\n\t\t\"tech:T075\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class.indexOf( \"Hirogen\" ) >= 0;\n\t\t\t}\n\t\t},\n\t\t// Intercept Course\n\t\t\"talent:E056\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class.indexOf( \"Hirogen\" ) >= 0;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.captain && ship.captain.name != \"Karr\" && ship.captain.name.indexOf(\"Hirogen\") < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Subnucleonic Beam\n\t\t\"weapon:W049\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf( \"Hirogen\" ) < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Turanj\n\t\t\"crew:C062\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Fighter Squadron 6 :71753\n\t\t// Defensive Maneuvers\n\t\t\"squadron:D009\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Defensive Maneuvers\")\n\t\t},\n\t\t// Support Ship\n\t\t\"squadron:D008\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Support Ship\")\n\t\t},\n\t\t// Attack Wave\n\t\t\"squadron:D006\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Attack Wave\")\n\t\t},\n\t\t// Attack Formation\n\t\t\"squadron:D004\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Attack Formation\")\n\t\t},\n\t\t// Cover Fire\n\t\t\"squadron:D002\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Cover Fire\")\n\t\t},\n\t\t// Coordinated Attack\n\t\t\"squadron:D001\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Coordinated Attack\")\n\t\t},\n\n\n\t//Prototype 01 :71536\n\t\t// Only Gareb or Romulan Drone Pilot as Captain\n\t\t\"ship:S061\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.name == \"Gareb\" ||  captain.name == \"Jhamel\" || captain.name == \"Romulan Drone Pilot\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"ship:S266\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.name == \"Gareb\" ||  captain.name == \"Jhamel\" || captain.name == \"Romulan Drone Pilot\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Gareb\n\t\t\"captain:Cap105\": {\n\t\t\t// Add a slot for another Captain\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"captain\"],\n\t\t\t\t\trules: \"Captain to place under Gareb\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t// No cost for this card\n\t\t\t\t\t\t\tcost: function() {\n\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t// Add talent slots for each talent on the chosen Captain\n\t\t\t\t\t\t\tonEquip: function(upgrade, ship, fleet) {\n\t\t\t\t\t\t\t\tupgrade.upgradeSlots = [];\n\t\t\t\t\t\t\t\tfor( var i = 0; i < upgrade.talents; i++ )\n\t\t\t\t\t\t\t\t\tupgrade.upgradeSlots.push({\n\t\t\t\t\t\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\t\t\t\t\t\tsource: \"Gareb\"\n\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t// TODO Check if this is correct\n\t\t\t\t\t\t\t\tupgrade.unique = false;\n\t\t\t\t\t\t\t\tupgrade.text = \"(Place underneath Gareb)\";\n\t\t\t\t\t\t\t\tupgrade.name = upgrade.name + \" (Gareb)\";\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t// Avoid any restrictions\n\t\t\t\t\t\t\tcanEquip: function() {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquipFaction: function() {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfactionPenalty: function() {\n\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\t// Set skill to chosen Captain's skill\n\t\t\tskill: function(captain,ship,fleet) {\n\t\t\t\tif( captain.upgradeSlots[0].occupant )\n\t\t\t\t\treturn captain.upgradeSlots[0].occupant.skill;\n\t\t\t\treturn 0;\n\t\t\t},\n\n\t\t\t// Set cost to chosen Captain's cost minus 3 SP\n\t\t\t// TODO This should be a self intercept. Also should take into account faction penalty etc?\n\t\t\tcost: function(captain,ship,fleet) {\n\t\t\t\tvar cost = 0;\n\t\t\t\tif( captain.upgradeSlots[0].occupant ) {\n\t\t\t\t\tcost = captain.upgradeSlots[0].occupant.cost - 3;\n\t\t\t\t}\n\t\t\t\treturn cost;\n\t\t\t},\n\n\t\t\t// Equip only on a Romulan Drone Ship\n\t\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t}\n\n\t\t},\n\t\t// Romulan Drone Pilot\n\t\t\"captain:Cap104\": {\n\t\t\t// Equip only on a Romulan Drone Ship\n\t\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t}\n\t\t},\n\t\t// Valdore\n\t\t\"captain:Cap621\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Talent */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Maneuvering Thrusters\n\t\t\"tech:T074\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Romulan Drone Ship\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Multi-Spectral Emitters\n\t\t\"tech:T073\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t}\n\t\t},\n\t\t// Backup Sequencer\n\t\t\"tech:T072\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t}\n\t\t},\n\t\t// Triphasic Emitter\n\t\t\"weapon:T071\": {\n\t\t\tname: \"Triphasic Emitters\",\n\t\t\trange: false,\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t\trules: \"Non-Borg, 5SP or less\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t\tcanEquip: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\t\t\tif( upgrade.printedValue == 0 || hasFaction(upgrade,\"borg\", ship, fleet) || valueOf(upgrade,\"cost\",ship,fleet) > 5 )\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Tholia One (Retail) :71795\n\t\t// Tholian Assembly\n\t\t\"talent:E051\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class.indexOf(\"Tholian\") >= 0 &&\n\t\t\t\t\t\tship.captain && ( ship.captain.name == \"Loskene\" || ship.captain.name.indexOf(\"Tholian\") >= 0 );\n\t\t\t}\n\t\t},\n\t\t// Tricobalt Warhead\n\t\t\"weapon:W045\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Tholian\") < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//I.R.W. Haakona :71794\n\t\t// Mendak\n\t\t\"captain:Cap618\": {\n\t\t\tcanEquipCaptain: function(card,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t\t\t},\n\t\t},\n\t\t\"admiral:A017\": {\n\t\t\tcanEquipAdmiral: function(card,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t\t\t},\n\t\t},\n\t\t// Romulan Helmsman\n\t\t\"crew:C059\": {\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Romulan Helmsman\")\n\t\t},\n\t\t// Make Them See Us!\n\t\t\"talent:E049\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"romulan\", ship, fleet) && ship.captain && $factions.hasFaction(ship.captain,\"romulan\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Romulan Sub Lieutenant\n\t\t\"crew:C057\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"romulan\", ship, fleet );\n\t\t\t}\n\t\t},\n\n\t\t// Romulan Security Officer\n\t\t// TODO Limit to max +3\n\t\t\"crew:C058\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\t\t\tif( card == ship.captain )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,skill) + 1;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Disruptor Pulse\n\t\t\"weapon:W044\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction( ship, \"romulan\", ship, fleet ) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Ogla-Razik\n\t\t// Karden\n\t\t\"crew:C061\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"kazon\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Haliz\n\t\t\"crew:C060\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"kazon\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t//U.S.S. Hood :71998p\n\t\t//Tachyon Detection Grid\n\t\t\"talent:T058\":{\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet) || $factions.hasFaction(ship,\"bajoran\",ship,fleet) || $factions.hasFaction(ship,\"vulcan\",ship,fleet);\n\t\t\t}\n\t\t},\n\t\t//Systems Upgrade\n\t\t\"tech:T057\": {\n\t\t\ttype: \"question\",\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Systems Upgrade\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ($factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || $factions.hasFaction(ship,\"vulcan\", ship, fleet));\n\t\t\t}\n\t\t},\n\t\t//Type 8 Phaser Array\n\t\t\"weapon:W034\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( ship.attack <= 3 )\n\t\t\t\t\treturn onePerShip(\"Type 8 Phaser Array\")(upgrade,ship,fleet);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\n\t//Reklar :71798\n\t\t// Coded Messages\n\t\t\"talent:E046\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"dominion\", ship, fleet );\n\t\t\t}\n\t\t},\n\t\t// Aft Weapons Array\n\t\t\"weapon:W041\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull >= 4;\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"dominion\", ship, fleet );\n\t\t\t}\n\t\t},\n\n\n\t//Gornarus :71797\n\t\t// Slar\n\t\t\"captain:Cap312\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Salvage Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"Salvage\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Improved Deflector Screens\n\t\t\"tech:T068\": {\n\t\t\t// Only one per ship and hull <= 3\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull <= 3 && onePerShip(\"Improved Deflector Screens\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Targeted Phaser Strike\n\t\t\"weapon:W042\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Gorn Raider\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//I.S.S. Enterprise :71796\n\t\t// Marlena Moreau\n\t\t\"crew:C051\": {\n\t\t\t// One Talent is -1 SP.\n\t\t\t// Like Luaran, this reduces the cost of Marlena rather than the talent.\n\t\t\t// TODO Find a better way?\n\t\t\tcost: function(upgrade,ship,fleet) {\n\t\t\t\tif( !ship )\n\t\t\t\t\treturn 3;\n\t\t\t\tvar candidate = false;\n\t\t\t\tvar candCost = 0;\n\t\t\t\t// Find a talent on the ship\n\t\t\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i, slot) {\n\t\t\t\t\tif( slot.occupant && slot.occupant != upgrade && slot.occupant.type == \"talent\" ) {\n\t\t\t\t\t\tvar occCost = valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t\t\t// Stop as soon as we have a Talent with cost > 0\n\t\t\t\t\t\tif( occCost > 0 ) {\n\t\t\t\t\t\t\tcandidate = slot.occupant;\n\t\t\t\t\t\t\tcandCost = occCost;\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t// Subtract 1 from Marlena's cost\n\t\t\t\treturn candCost > 0 ? 2 : 3;\n\t\t\t}\n\t\t},\n\t\t// Agony Booth - one per ship only\n\t\t\"tech:T066\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Agony Booth\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Tantalus Field\n\t\t\"talent:E045\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.name == \"I.S.S. Enterprise\";\n\t\t\t}\n\t\t},\n\n\n\t//Sakharov :71997p\n\t\t\"ship:S051\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\",\"tech\"],\n\t\t\t\t\trules: \"This Upgrade costs -2 SP\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 2;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Escape Transporter\n\t\t\"tech:T065\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class.indexOf(\"Shuttlecraft\") >= 0;\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"federation\", ship, fleet );\n\t\t\t}\n\t\t},\n\t\t// Warp Drive\n\t\t\"tech:T064\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class.indexOf(\"Shuttlecraft\") >= 0 && onePerShip(\"Warp Drive\")(upgrade,ship,fleet);\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"federation\", ship, fleet );\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Pegasus :71801\n\t\t\"ship:S047\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"tech\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// William T. Riker\n\t\t\"crew:C273\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 3;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Specialized Shields\n\t\t\"tech:T056\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull <= 3;\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"federation\", ship, fleet ) || $factions.hasFaction( ship, \"bajoran\", ship, fleet ) || $factions.hasFaction( ship, \"vulcan\", ship, fleet );\n\t\t\t}\n\t\t},\n\t\t\t\t// Phasing Cloaking Device\n\t\t\"tech:T055\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Oberth Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Dawn Velazquez\n\t\t\"crew:C044\":{\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction (ship,\"federation\",ship,fleet) || hasFaction(ship,\"bajoran\",ship,fleet) || hasFaction(ship,\"vulcan\",ship,fleet);\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull <= 3;\n\t\t\t}},\n\t\t// Eric Motz\n\t\t\"crew:C043\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//I.S.S. Avenger :71800\n\t\t\"captain:Cap415\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tfactionPenalty: function(upgrade,ship,fleet,factionPenalty) {\n\t\t\t\t\t\tif( isUpgrade(upgrade) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"crew:C049\": {\n\t\t\tcanEquip: onePerShip(\"Orion Tactical Officer\")\n\t\t},\n\t\t\"crew:C048\": {\n\t\t\tcanEquip: onePerShip(\"Andorian Helmsman\")\n\t\t},\n\t\t// Enhanced Hull Plating\n\t\t\"tech:T062\": {\n\t\t\tcanEquip: onePerShip(\"Enhanced Hull Plating\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"mirror-universe\", ship, fleet ) && ship.hull <= 4;\n\t\t\t}\n\t\t},\n\n\n\t//Kyana Prime :71799\n\t\t//Annorax\n\t\t\"captain:Cap805\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{}, // Existing talent slot\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Causality Paradox\n\t\t\"talent:E042\": {\n\t\t\t// Only equip on krenim weapon ship with Annorax or other Krenim captain.\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Krenim Weapon Ship\" && ship.captain && (ship.captain.name == \"Annorax\" || ship.captain.name == \"Obrist\" || ship.captain.name.indexOf(\"Krenim\") >= 0 );\n\t\t\t}\n\t\t},\n\t\t// Temporal Wave Front\n\t\t\"tech:T061\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Krenim Weapon Ship\";\n\t\t\t}\n\t\t},\n\t\t// Temporal Core\n\t\t\"tech:T060\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Krenim Weapon Ship\";\n\t\t\t}\n\t\t},\n\t\t// Spatial Distortion\n\t\t\"tech:T059\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Krenim Weapon Ship\";\n\t\t\t}\n\t\t},\n\t\t// Chroniton Torpedoes\n\t\t\"weapon:W036\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Krenim Weapon Ship\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 6;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Temporal Incursion\n\t\t\"weapon:W035\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Krenim Weapon Ship\";\n\t\t\t}\n\t\t},\n\n\n\t//IKS Korinar :71999p\n\n\t\t//Kurn\n\t\t\"captain:Cap410\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Mauk-to'Vor Only at 3SP\",\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\treturn upgrade.name == \"Mauk-to'Vor\";\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function() { return 3; }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tfactionPenalty: function() { return 0; }\n\t\t},\n\t\t// Klingon Stealth Team\n\t\t\"crew:C041\": {\n\t\t\tcanEquip: onePerShip(\"Klingon Stealth Team\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"klingon\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Mauk-to'Vor\n\t\t\"talent:E039\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"klingon\", ship, fleet) && $factions.hasFaction(ship.captain, \"klingon\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Ambush Attack\n\t\t\"weapon:W033\": {\n\t\t\tcanEquip: onePerShip(\"Ambush Attack\")\n\t\t},\n\n\n\t//IKS Ning'tao :71804\n\t\t\"captain:Cap804\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Talent */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Darok\n\t\t\"crew:C038\": {\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet);\n\t\t\t},\n\t\t},\n\t\t// Inverse Graviton Burst\n\t\t\"tech:T049\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"klingon\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Long Live the Empire!\n\t\t\"talent:E038\": {\n\t\t\t// Only equip if ship and captain matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"klingon\", ship, fleet) && ( !ship.captain || $factions.hasFaction(ship.captain, \"klingon\", ship, fleet) );\n\t\t\t},\n\t\t\t// Prevent non-faction-matching captain\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn $factions.hasFaction(captain, \"klingon\", ship, fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Ratosha :71803\n\t\t// Jaro Essa\n\t\t\"captain:Cap207\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"bajoran\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t\"admiral:A012\": {\n\t\t\tcanEquipAdmiral: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"bajoran\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Krim\n\t\t\"captain:Cap616\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{}, // Talent\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Assault Vessel Upgrade\n\t\t\"tech:T053\": {\n\t\t\ttype: \"question\",\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( ship.class == \"Bajoran Scout Ship\" ) {\n\t\t\t\t\treturn onePerShip(\"Assault Vessel Upgrade\")(upgrade,ship,fleet);\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tattack: function(card,ship,fleet,attack) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Bajoran Militia\n\t\t\"crew:C042\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"bajoran\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t//USS Prometheus :71802\n\t\t//The Doctor\n\t\t\"captain:Cap206\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"bajoran\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1;\n\t\t\t}},\n\t\t\t//EMH Mark II\n\t\t\t\"question:Q026\":{\n\t\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >=0;\n\t\t\t\t}\n\t\t\t},\n\t\t// Romulan Hijackers\n\t\t\"crew:C039\": {\n\t\t\t// Cannot equip if non-Romulan captain or crew\n\t\t\tcanEquip: function(card,ship,fleet){\n\n\t\t\t\tif( ship.captain && !$factions.hasFaction(ship.captain,\"romulan\", ship, fleet) )\n\t\t\t\t\treturn false;\n\n\t\t\t\tvar canEquip = true;\n\t\t\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i,slot) {\n\t\t\t\t\tif( slot.occupant && slot.occupant.type == \"crew\" && !$factions.hasFaction(slot.occupant,\"romulan\", ship, fleet) )\n\t\t\t\t\t\tcanEquip = false;\n\t\t\t\t});\n\n\t\t\t\treturn canEquip;\n\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Can only equip Romulan crew\n\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\tif( card.type == \"crew\" && !$factions.hasFaction(card,\"romulan\", ship, fleet) )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t},\n\t\t\t\t\t// Can only equip Romulan captain\n\t\t\t\t\tcanEquipCaptain: function(card,ship,fleet,canEquipCaptain) {\n\t\t\t\t\t\tif( !$factions.hasFaction(card,\"romulan\", ship, fleet) )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquipCaptain;\n\t\t\t\t\t},\n\t\t\t\t\t// All non-borg tech and weapon upgrades cost -1 SP\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( (card.type == \"tech\" || card.type == \"weapon\") && !$factions.hasFaction(card,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\tcost = resolve(card, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t\t// No faction penalty for romulan upgrades\n\t\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\tif( card.type == \"captain\" || isUpgrade(card) && $factions.hasFaction(card,\"romulan\", ship, fleet) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t},\n\t\t// Regenerative Shielding\n\t\t\"tech:T048\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.name != \"U.S.S. Prometheus\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Regenerative Shielding\")\n\t\t},\n\t\t// Ablative Hull Armor\n\t\t\"tech:T047\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn ship.class == \"Prometheus Class\";\n\t\t\t},\n\t\t},\n\t\t//Photon Torpedoes -Prometheus\n\t\t\"weapon:W031\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Prometheus Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}},\n\t\t// Multi-Vector Assault Mode\n\t\t\"weapon:W030\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn ship.class == \"Prometheus Class\" && onePerShip(\"Multi-Vector Assault Mode\");\n\t\t\t},\n\t\t},\n\n\n\t//U.S.S. Pasteur :71807\n\t\t// Inverse Tachyon Pulse\n\t\t\"tech:T015\": {\n\t\t\tcanEquip: onePerShip(\"Inverse Tachyon Pulse\")\n\t\t},\n\n\n\t//Kreechta :71806\n\t\t// Marauder\n\t\t\"talent:E025\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"ferengi\", ship, fleet) && $factions.hasFaction(ship.captain, \"ferengi\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Acquisition\n\t\t\"talent:E024\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"ferengi\", ship, fleet) && $factions.hasFaction(ship.captain, \"ferengi\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Tactical Officer\n\t\t\"crew:C025\": {\n\t\t\tcanEquip: onePerShip(\"Tactical Officer\")\n\t\t},\n\t\t// Ferengi Probe\n\t\t\"tech:T020\": {\n\t\t\tcanEquip: onePerShip(\"Ferengi Probe\")\n\t\t},\n\n\n\t//U.S.S. Dauntless :71805\n\t\t//Arturis\n\t\t\"captain:Cap306\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( ship && ship.class == \"Dauntless Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 5;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Auto-Navigation\n\t\t\"tech:T033\": {\n\t\t\tskill: 0,\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( ship && !ship.captain )\n\t\t\t\t\t\t\treturn 2;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Force Field\n\t\t\"tech:T030\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Dauntless Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Navigational Deflector\n\t\t\"tech:T029\": {\n\t\t\tcanEquip: onePerShip(\"Navigational Deflector\")\n\t\t},\n\t\t//Particle Synthesis\n\t\t\"tech:T028\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Dauntless Class\";\n\t\t\t}\n\t\t},\n\n\t//Q Continuum Cards :72000b\n\t\t// Q2\n\t\t\"question:Q001\":{\n\t\t\ttype: \"question\",\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 ||\n\t\t\t\t       $.inArray( \"weapon\", slotTypes ) >= 0 ||\n\t\t\t\t\t\t\t $.inArray( \"crew\", slotTypes ) >= 0 ||\n\t\t\t\t\t\t\t $.inArray( \"talent\", slotTypes ) >= 0;\n\t\t\t}\n\t\t},\n\n\t//I.R.W. Terix :72000p\n\t\t// Additional Phaser Array\n\t\t\"weapon:W010\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( ship.class == \"D'deridex Class\" )\n\t\t\t\t\treturn onePerShip(\"Additional Phaser Array\")(upgrade,ship,fleet);\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t// Long Range Scanners\n\t\t\"tech:T004\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"D'deridex Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 3;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//I.R.W. Vrax :72010\n\t\t// Coordinated Attack\n\t\t\"talent:E001\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"romulan\", ship, fleet) && ship.captain && $factions.hasFaction(ship.captain, \"romulan\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Bridge Officer\n\t\t\"crew:C002\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"romulan\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 2;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Bridge Officer\")\n\t\t},\n\n\n\t//I.K.S. T'Ong :72009\n\t\t// K'Temoc\n\t\t\"captain:Cap504\": {\n\t\t\t// Klingon talent\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Klingon Talents Only\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\t\t\treturn hasFaction(card,\"klingon\",ship,fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Klingon upgrades cost -1 SP\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( isUpgrade(card) && hasFaction(card,\"klingon\",ship,fleet) )\n\t\t\t\t\t\t\tcost = resolve(card,ship,fleet,cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t\t// Double faction penalty for non-klingon upgrades\n\t\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\tif( isUpgrade(card) && !hasFaction(card,\"klingon\",ship,fleet) )\n\t\t\t\t\t\t\tfactionPenalty = resolve(card,ship,fleet,factionPenalty) * 2;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"talent:E002\": {\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"klingon\",ship,fleet) && hasFaction(ship.captain,\"klingon\",ship,fleet);\n\t\t\t},\n\t\t},\n\t\t// Tactical Officer\n\t\t\"crew:C004\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"klingon\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 3;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Tactical Officer\")\n\t\t},\n\t\t// Cryogenic Stasis\n\t\t\"tech:T001\": {\n\t\t\tupgradeSlots: cloneSlot( 2 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\trules: \"Non-Borg, Combined cost 5 or less\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tcanEquip: function(card,ship,fleet,upgradeSlot) {\n\t\t\t\t\t\t// Non-Borg\n\t\t\t\t\t\tif( hasFaction(card,\"borg\",ship,fleet) )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t// Combined cost of 5 SP or less\n\t\t\t\t\t\tvar otherSlotCost = 0;\n\t\t\t\t\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i, slot) {\n\t\t\t\t\t\t\tif( upgradeSlot != slot && slot.occupant && slot.source == \"Cryogenic Stasis\" )\n\t\t\t\t\t\t\t\totherSlotCost = valueOf(slot.occupant,\"cost\",ship,fleet)\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn otherSlotCost + valueOf(card,\"cost\",ship,fleet) <= 5;\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t),\n\t\t},\n\n\n\t//U.S.S. Thunderchild :72008\n\t\t// Federation Task Force\n\t\t\"talent:E005\": {\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet) && $factions.hasFaction(ship.captain,\"federation\",ship,fleet) || $factions.hasFaction(ship,\"bajoran\",ship,fleet) && $factions.hasFaction(ship.captain,\"bajoran\",ship,fleet) || $factions.hasFaction(ship,\"vulcan\",ship,fleet) && $factions.hasFaction(ship.captain,\"vulcan\",ship,fleet);\n\t\t\t}\n\t\t},\n\n\t\t//Rapid Reload\n\t\t\"question:Q027\":{\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >=0 || $.inArray(\"weapon\", slotTypes) >=0;\n\t\t\t}\n\t\t},\n\n\t//U.S.S. Bellerophon :72001p\n\t\t// Tricobalt Device\n\t\t\"weapon:W025\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Intrepid Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Variable Geometry Pylons\n\t\t\"tech:T042\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( ship.class != \"Intrepid Class\" )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Variable Geometry Pylons\")(card,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t//Quark's Treasure :72013\n\t\t\"ship:S013\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\tif( card.type == \"crew\" || card.type == \"tech\")\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Zek\n\t\t\"captain:Cap201\": {\n\t\t\tcanEquipCaptain: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"ferengi\",ship,fleet);\n\t\t\t},\n\t\t},\n\t\t\"admiral:A005\": {\n\t\t\tcanEquipAdmiral: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"ferengi\",ship,fleet);\n\t\t\t},\n\t\t},\n\t\t//Brunt\n\t\t\"captain:Cap404\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Grand Nagus Only\",\n\t\t\t\t\tcanEquip: function(card) {\n\t\t\t\t\t\treturn card.name == \"Grand Nagus\";\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Smugglers\n\t\t\"talent:E015\": {\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship, \"ferengi\", ship, fleet) && hasFaction(ship.captain, \"ferengi\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t//Cargo Hold\n\t\t\"tech:T013\": {\n\t\t\tupgradeSlots: cloneSlot( 2,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\",\"tech\"],\n\t\t\t\t\trules: \"Combined cost 4SP or less\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,upgradeSlot) {\n\t\t\t\t\t\t// Combined cost of 4 SP or less\n\t\t\t\t\t\tvar otherSlotCost = 0;\n\t\t\t\t\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i, slot) {\n\t\t\t\t\t\t\tif( upgradeSlot != slot && slot.occupant && slot.source == \"Cargo Hold\" )\n\t\t\t\t\t\t\t\totherSlotCost = valueOf(slot.occupant,\"cost\",ship,fleet)\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn otherSlotCost + valueOf(card,\"cost\",ship,fleet) <= 4;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t),\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( !hasFaction(ship, \"ferengi\", ship, fleet) )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Cargo Hold\")(card,ship,fleet);\n\t\t\t},\n\t\t},\n\t\t//Inversion Wave\n\t\t\"tech:T012\": {\n\t\t\tcanEquip: onePerShip(\"Inversion Wave\")\n\t\t},\n\n\n\t//Bioship Beta :72012\n\t\t// Biological Weapon\n\t\t\"weapon:W024\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn ship.class == \"Species 8472 Bioship\";\n\t\t\t}\n\t\t},\n\t\t// Energy Blast\n\t\t\"weapon:W023\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn ship.class == \"Species 8472 Bioship\";\n\t\t\t}\n\t\t},\n\t\t// Biological Technology\n\t\t\"tech:T041\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( ship.class != \"Species 8472 Bioship\" )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Biological Technology\")(card,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Biogenic Field\n\t\t\"tech:T040\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( ship.class != \"Species 8472 Bioship\" )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Biogenic Field\")(card,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Electrodynamic Fluid\n\t\t\"tech:T039\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn ship.class == \"Species 8472 Bioship\";\n\t\t\t}\n\t\t},\n\t\t// Fluidic Space\n\t\t\"tech:T038\": {\n\t\t\tcanEquip: onePerShip(\"Fluidic Space\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"species-8472\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\n\t//U.S.S. Phoenix :72011\n\t\t//High Energy Sensor Sweep\n\t\t\"tech:T014\":{\n\t\t\tcanEquip: onePerShip(\"High Energy Sensor Sweep\")\n\t\t},\n\t\t//Arsenal\n\t\t\"weapon:W012\": {\n\t\t\tupgradeSlots: cloneSlot( 2, { type: [\"weapon\"] } ),\n\t\t\tcanEquip: onePerShip(\"Arsenal\")\n\t\t},\n\t\t//Aft Torpedo Launcher\n\t\t\"question:Q002\": {\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && (!hasFaction(ship,\"federation\", ship, fleet) && !hasFaction(ship,\"bajoran\", ship, fleet) && !hasFaction(ship,\"vulcan\", ship, fleet) ) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( ship.classData && ship.classData.rearArc )\n\t\t\t\t\treturn false;\n\t\t\t\treturn ship.hull >= 4;\n\t\t\t},\n\t\t},\n\n\n\t//U.S.S. Intrepid :72002p\n\t\t// Dual Phaser Banks\n\t\t\"weapon:W017\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( ship && (!hasFaction(ship,\"federation\", ship, fleet) && !hasFaction(ship,\"bajoran\", ship, fleet) && !hasFaction(ship,\"vulcan\", ship, fleet) ) )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Dual Phaser Banks\")(card,ship,fleet);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Constitution Class\" && ship.class != \"Constitution Refit Class\" )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 3;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t// Astrogator\n\t\t\"question:Q003\": {\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"federation\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( ship.class != \"Constitution Class\" && ship.class != \"Constitution Refit Class\" )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Astrogator\")(card,ship,fleet);\n\t\t\t},\n\t\t},\n\n\n\t//R.I.S. Talvath :72016\n\t\t\"captain:Cap303\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Secret Research Only\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\t\t\treturn card.name == \"Secret Research\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"talent:E009\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Romulan Science Vessel\" )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t\"tech:T008\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn ship && ship.class == \"Romulan Science Vessel\";\n\t\t\t}\n\t\t},\n\t\t\"tech:T007\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Romulan Science Vessel\" )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t\"tech:T006\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Romulan Science Vessel\" )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Signal Amplifier\")\n\t\t},\n\t\t\"tech:T010\": {\n\t\t\tcanEquip: onePerShip(\"Warp Core Ejection System\")\n\t\t},\n\t\t\"tech:T009\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn ship && ship.class == \"Romulan Science Vessel\";\n\t\t\t}\n\t\t},\n\n\n\t//I.K.S. Rotarran :72015\n\t\t\"captain:Cap701\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( isUpgrade(card) && hasFaction(card,\"klingon\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t//The Day is Ours!\n\t\t\"talent:E013\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"klingon\", ship, fleet) && hasFaction(ship.captain,\"klingon\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t//Jadzia Dax\n\t\t\"crew:C012\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\tif( hasFaction(ship,\"klingon\",ship,fleet) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Worf\n\t\t\"crew:C013\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\t\t\tif( card == ship.captain )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,skill) + ( hasFaction(card,\"klingon\",ship,fleet) ? 3 : 1 );\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Delta Flyer :72014\n\t\t// Tuvok\n\t\t\"captain:Cap507\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\trules: \"Costs -1 SP\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) - 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Parametallic Hull Plating\n\t\t\"tech:T027\": {\n\t\t\tcanEquip: onePerShip(\"Parametallic Hull Plating\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && (!hasFaction(ship,\"federation\", ship, fleet) && !hasFaction(ship,\"bajoran\", ship, fleet) && !hasFaction(ship,\"vulcan\", ship, fleet) ) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 3;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t// Immersion Shielding\n\t\t\"tech:T026\": {\n\t\t\tcanEquip: onePerShip(\"Immersion Shielding\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ( !hasFaction(ship,\"federation\", ship, fleet) && !hasFaction(ship,\"bajoran\", ship, fleet) && !hasFaction(ship,\"vulcan\", ship, fleet)) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 3;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tship: {\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t// Unimatrix Shielding\n\t\t\"tech:T025\": {\n\t\t\tcanEquip: onePerShip(\"Unimatrix Shielding\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && (!hasFaction(ship,\"federation\", ship, fleet) && !hasFaction(ship,\"bajoran\", ship, fleet) && !hasFaction(ship,\"vulcan\", ship, fleet) ) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tship: {\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 2;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t//Photon Torpedoes -Delta Flyer\n\t\t\"weapon:W019\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\trange: function(card,ship,fleet,range) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Shuttlecraft\") >= 0 )\n\t\t\t\t\t\t\treturn \"1 - 2\";\n\t\t\t\t\t\treturn range;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Hathaway :71201\n\t\t//Wesley Crusher\n\t\t\"crew:C217\": {\n\t\t\t//text: \"place up to 3 federation tech Upgrades, each 4 SP or less, face down under this card\",\n\t\t\tupgradeSlots: cloneSlot( 3 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\trules: \"FEDERATION TECH UPGRADES, 4SP OR LESS\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function() { return 0; },\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; },\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\tconsole.log(!$factions.hasFaction( card, \"federation\", ship, fleet ), valueOf(card,\"cost\",ship,fleet) > 4 )\n\t\t\t\t\t\t\t\tif( $factions.hasFaction( card, \"federation\", ship, fleet ) && (valueOf(card,\"cost\",ship,fleet) < 5) )\n\t\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t),\n\t\t\t//factionPenalty: 0\n\t\t},\n\t\t//Geordi La Forge\n\t\t\"crew:C215\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: {\n\t\t\t\t\t\t// Run this interceptor after all other penalties and discounts\n\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\tfn: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\t\tif( checkUpgrade(\"tech\", upgrade, ship) ) {\n\t\t\t\t\t\t\t\tcost = resolve(upgrade,ship,fleet,cost);\n\t\t\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Navigational Station - one per ship only\n\t\t\"tech:T104\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Navigational Station\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t\t// Kazon Gurad\n\t\t\"crew:C228\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Kazon Gurad\")(upgrade,ship,fleet);\n\t\t\t}},\n\t\t//Unremarkable Species\n\t\t\"question:Q004\": {\n\t\t\ttype: \"question\",\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\t//console.log($.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0);\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\tconsole.log(ship)\n\t\t\t\treturn !$factions.hasFaction(ship, \"borg\", ship, fleet);\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Unremarkable Species\")(upgrade,ship,fleet);\n\t\t\t },\n\t\t\t intercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"kazon\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t},\n\n\n\t//Scorpion 4 :71203\n\t\t// Cover Fire - one per ship only\n\t\t\"squadron:D023\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Cover Fire\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Torpedo Attack - one per ship only\n\t\t\"squadron:D021\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Torpedo Attack\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Support Ship - one per ship only\n\t\t\"squadron:D018\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Support Ship\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t//I.R.W. Belak :blind_belak\n\t\t// Lovok\n\t\t\"captain:Cap307\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Tal Shiar Only\",\n\t\t\t\t\tcanEquip: function(card) {\n\t\t\t\t\t\treturn card.name == \"Tal Shiar\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Tal Shiar\n\t\t\"talent:E034\": {\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship.captain,\"romulan\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\n\t// BIOSHIP OMEGA :blind_bioship\n\t\t\"captain:Cap205\": {\n\t\t\tcanEquipCaptain: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"species-8472\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t\"weapon:W022\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( !hasFaction(ship,\"species-8472\", ship, fleet) )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Energy Weapon\")(card,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t\"tech:T037\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( !hasFaction(ship,\"species-8472\", ship, fleet) )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Neuro Peptides\")(card,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t\"tech:T036\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"species-8472\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t\"tech:T035\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( !hasFaction(ship,\"species-8472\", ship, fleet) )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Resistant Hull\")(card,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t\t//ALDARA :blind_aldara\n\t\t\"weapon:W029\": {\n\t\t\tcanEquip: onePerShip(\"Aft Weapons Array\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Cardassian Galor Class\" )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t\"tech:T046\": {\n\t\t\tcanEquip: onePerShip(\"High Energy Subspace Field\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"dominion\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\n\t//U.S.S. Lakota :blind_lakota\n\t\t//Upgraded Phasers\n\t\t\"weapon:W014\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( valueOf(ship,\"attack\",ship,fleet) > 3 )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Upgraded Phasers\")(card,ship,fleet);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"federation\",ship,fleet) && !hasFaction(ship,\"bajoran\",ship,fleet) && !hasFaction(ship,\"vulcan\",ship,fleet))\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\n\t//I.K.S. Toh'Kaht :blind_tohkaht\n\t\t// Reactor Core\n\t\t\"tech:T002\": {\n\t\t\tcanEquip: onePerShip(\"Reactor Core\")\n\t\t},\n\n\t//I.K.S. Buruk :blind_buruk\n\t\t// Reactor Core\n\t\t\"tech:T034\": {\n\t\t\tcanEquip: onePerShip(\"Targeting Systems\")\n\t\t},\n\t\t// Kurak\n\t\t\"crew:C032\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"klingon\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\n\t//Interceptor 8 :blind_interceptor8\n\t\t//Pursuit\n\t\t\"talent:E027\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn valueOf(ship,\"hull\",ship,fleet) <= 3;\n\t\t\t},\n\t\t},\n\t\t//Ro Laren\n\t\t\"crew:C027\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"federation\",ship,fleet) || hasFaction(ship,\"bajoran\",ship,fleet) || hasFaction(ship,\"vulcan\",ship,fleet);\n\t\t\t},\n\t\t},\n\t\t//Phaser Strike\n\t\t\"weapon:W018\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn valueOf(ship,\"hull\",ship,fleet) <= 3;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class != \"Bajoran Interceptor\" )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t//Navigational Sensors\n\t\t\"tech:T023\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( ship.class != \"Bajoran Interceptor\" )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Navigational Sensors\")(card,ship,fleet);\n\t\t\t},\n\t\t},\n\n\n\t//Nistrim-Culluh\n\t\t//Ambition\n\t\t\"talent:E022\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"kazon\", ship, fleet) && hasFaction(ship.captain,\"kazon\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t//Stolen Technology\n\t\t\"tech:T018\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"kazon\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\n\t//Seleya :blind_seleya\n\t\t//V'Tosh Ka'Tur\n\t\t\"talent:E010\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"vulcan\", ship, fleet) && hasFaction(ship.captain,\"vulcan\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t//Solin\n\t\t\"crew:C008\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"vulcan\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t//Power Distribution Net\n\t\t\"tech:T011\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( !hasFaction(ship,\"vulcan\",ship,fleet) )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Power Distribution Net\")(card,ship,fleet);\n\t\t\t},\n\t\t},\n\n\n\t//Nunk's Marauder :blind_nunks_marauder\n\n\t//Robinson :71213\n\n\t//Dreadnought(old) :71212\n\t\t\"ship:S221\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function (captain, ship, fleet) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquipAdmiral: function (captain, ship, fleet) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Counter Measures - one per ship only, +5 SP on any ship except ATR-4107\n\t\t\"tech:T112\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Counter Measures\")(upgrade,ship,fleet);\n\t\t\t},\n\t\tintercept: {\n\t\t\tself: {\n\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\tif( ship && ship.class != \"Cardassian ATR-4107\" )\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\treturn cost;\n\t\t\t}}\n\t\t}},\n\t\t// Maintenance Crew\n\t\t\"question:Q005\": {\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Maintenance Crew\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// First Maje\n\t\t\"question:Q021\": {\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"kazon\",ship,fleet) && hasFaction(ship.captain,\"kazon\",ship,fleet);\n\t\t\t},\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\ttype: function(upgrade,ship) {\n\t\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t\t}\n\t\t\t\t },\n\t\t\t\t\t{type: [\"tech\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\t\t\tif( card == ship.captain )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,skill) + 2;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Denorious :71211\n\t\t//AKOREM LAAN\n\t\t\"captain:Cap219\":{\n\t\t\t//text: \"place up to 3 federation tech Upgrades, each 4 SP or less, face down under this card\",\n\t\t\tupgradeSlots: cloneSlot( 2 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Bajoran upgrades\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\n\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\t//console.log(!$factions.hasFaction( card, \"federation\", ship, fleet ), valueOf(card,\"cost\",ship,fleet) > 4 )\n\t\t\t\t\t\t\t\tif( $factions.hasFaction( card, \"bajoran\", ship, fleet ) )\n\t\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t),\n\t\t\t//factionPenalty: 0\n\t\t},\n\t\t//LEGENDARY HERO\n\t\t\"talent:E139\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t//console.log(factions.hasFaction(ship,\"bajoran\", ship, fleet))\n\t\t\t\treturn (ship.captain && $factions.hasFaction(ship.captain,\"bajoran\", ship, fleet)) && $factions.hasFaction(ship,\"bajoran\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t//D'Jarras\n\t\t\"talent:E138\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t//console.log(factions.hasFaction(ship,\"bajoran\", ship, fleet))\n\t\t\t\treturn (ship.captain && $factions.hasFaction(ship.captain,\"bajoran\", ship, fleet)) && $factions.hasFaction(ship,\"bajoran\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t//TACHYON EDDIES\n\t\t\"tech:T110\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t//console.log(onePerShip(\"TACHYON EDDIES\")(upgrade,ship,fleet), ship.class)\n\t\t\t\treturn onePerShip(\"TACHYON EDDIES\")(upgrade,ship,fleet);\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t//console.log(onePerShip(\"TACHYON EDDIES\")(upgrade,ship,fleet), ship.class)\n\t\t\t\t//console.log(factions.hasFaction(ship,\"bajoran\", ship, fleet))\n\t\t\t\treturn ( ship && ship.class == \"BAJORAN SOLAR SAILOR\" );\n\t\t\t}\n\t\t},\n\t\t//MAINSAILS\n\t\t\"tech:T109\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t//console.log(onePerShip(\"TACHYON EDDIES\")(upgrade,ship,fleet), ship.class)\n\t\t\t\treturn onePerShip(\"MAINSAILS\")(upgrade,ship,fleet);\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\n\t\t\t\treturn ( ship && ship.class == \"BAJORAN SOLAR SAILOR\" );\n\t\t\t}\n\t\t},\n\t\t//SOLAR SAIL POWERED\n\t\t\"tech:T108\": {\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\n\t\t\t\treturn ( ship && ship.class == \"BAJORAN SOLAR SAILOR\" );\n\t\t\t}\n\t\t},\n\n\n\t//Diaspora :72003p\n\t\t//Pulse-Firing Particle Cannon\n\t\t\"weapon:W019\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !hasFaction(ship,\"xindi\",ship,fleet) )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\t\t//Phase Deflector Pulse\n\t\t\"tech:T024\": {\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\tif( !hasFaction(ship,\"xindi\",ship,fleet) )\n\t\t\t\t\treturn false;\n\t\t\t\treturn onePerShip(\"Phase Deflector Pulse\")(card,ship,fleet);\n\t\t\t},\n\t\t},\n\n\t//Azati Prime :72004p\n\t\t// Ibix Dynasty\n\t\t\"talent:E036\": {\n\t\t\tupgradeSlots: cloneSlot( 2, { type: [\"weapon\"] } )\n\t\t},\n\t\t//Prototype Weapon\n\t\t\"weapon:W028\": {\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"xindi\",ship,fleet);\n\t\t\t}\n\t\t},\n\n\t//Xindus :72224p\n\t\t// Photon Torpedoes - +1 attack die if fielded on a Xindi Reptilian Warship\n\t\t\"weapon:W141\": {\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship && ship.class == \"Xindi Reptilian Warship\" )\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\treturn attack;\n\t\t\t}\n\t\t},\n\n\t// Temporal Cold War Cards : 72224gp\n\n\t\t// Vosk\n\t\t\"captain:Cap726\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for Khan or Talents\n\t\t\t\t\tfactionPenalty: function(upgrade, ship, fleet, factionPenalty) {\n\t\t\t\t\t\treturn upgrade.type == \"talent\" ? 0 : factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\n\t\t// Temporal Conduit - +5 SP if fielded on a non-Mirror Universe ship\n\t\t\"tech:T126\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"mirror-universe\", ship, fleet) )\n\t\t\t\t\t\t\t// Note, only add 4 since the existing faction penalty will also\n\t\t\t\t\t\t\t// be in play.\n\t\t\t\t\t\t\t// TODO Fix this logic to not apply the normal penalty, only 5 here\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//R.I.S. Pi :71222\n\t\t// Distress Signal - one per ship only\n\t\t\"tech:T103\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Distress Signal\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Gravition Field Generator - one per ship only\n\t\t\"tech:T102\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Gravition Field Generator\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Self Destruct Sequence - one per ship only\n\t\t\"tech:T101\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Self Destruct Sequence\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Valiant :71221\n\t\t//Tim Watters\n\t\t\"captain:Cap434\" : {\n\t\t\tupgradeSlots : [{}, {\n\t\t\t\ttype : [\"crew\"]\n\t\t\t}],\n\t\t},\n\t\t//Red Squad\n\t\t\"talent:E136\":{\n\t\t\tcanEquipFaction: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"federation\",ship,fleet) && hasFaction(ship.captain,\"federation\",ship,fleet) || hasFaction(ship,\"bajoran\",ship,fleet) && hasFaction(ship.captain,\"bajoran\",ship,fleet) || hasFaction(ship,\"vulcan\",ship,fleet) && hasFaction(ship.captain,\"vulcan\",ship,fleet) || hasFaction(ship,\"federation\",ship,fleet) && hasFaction(ship.captain,\"bajoran\",ship,fleet) || hasFaction(ship,\"federation\",ship,fleet) && hasFaction(ship.captain,\"vulcan\",ship,fleet) || hasFaction(ship,\"vulcan\",ship,fleet) && hasFaction(ship.captain,\"federation\",ship,fleet) || hasFaction(ship,\"vulcan\",ship,fleet) && hasFaction(ship.captain,\"bajoran\",ship,fleet) || hasFaction(ship,\"bajoran\",ship,fleet) && hasFaction(ship.captain,\"federation\",ship,fleet) || hasFaction(ship,\"bajoran\",ship,fleet) && hasFaction(ship.captain,\"vulcan\",ship,fleet);\n\t\t\t}},\n\n\n\t//Kumari :71223\n\n\t//Weapon Zero :71225\n\t\t// Arming Sequence - only on Xindi Weapon\n\t\t\"talent:E142\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ( ship && ship.class == \"Xindi Weapon\" );\n\t\t\t}\n\t\t},\n\t\t// Degra\n\t\t\"crew:C230\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"weapon\", upgrade, ship) && $factions.hasFaction(upgrade,\"xindi\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Destructive Blast - only on Xindi Weapon\n\t\t\"weapon:W136\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ( ship && ship.class == \"Xindi Weapon\" );\n\t\t\t}\n\t\t},\n\t\t// Rotating Emitters - only on Xindi Weapon\n\t\t\"weapon:W135\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ( ship && ship.class == \"Xindi Weapon\" );\n\t\t\t}\n\t\t},\n\t\t// Subspace Vortext - only on Xindi ship\n\t\t\"tech:T117\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"xindi\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t// Self-Destruct - only on Xindi Weapon\n\t\t\"tech:T116\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ( ship && ship.class == \"Xindi Weapon\" );\n\t\t\t}\n\t\t},\n\n\n\t//I.R.W. T'Met :72221p\n\t\t// TODO add a talent slot somehow or a way to add a talent card without the slot\n\t\t\"captain:Cap329\": {\n\t\t\t// ... if there is at least one other Romulan Ship in your starting fleet, Tebok my field 1 Romulan [talent] at a cost of -1 SP.\n\t\t\t// This is a messy implementation. It requires recalculation of the candidate for each upgrade on the ship.\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\n\t\t\t\t\t\tvar candidate = false;\n\t\t\t\t\t\tvar candCost = 0;\n\t\t\t\t\t\tvar romulanCount = 0;\n\n\t\t\t\t\t\t// Find if there are two romulan ships in the fleet\n\t\t\t\t\t\t$.each( fleet.ships, function(i, ship) {\n\t\t\t\t\t\t\tif ( $factions.hasFaction(ship,\"romulan\",ship,fleet) )\n\t\t\t\t\t\t\t\tromulanCount += 1;\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tif (romulanCount < 2)\n\t\t\t\t\t\t\treturn cost;\n\n\t\t\t\t\t\t// Find a talent on the ship\n\t\t\t\t\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i, slot) {\n\t\t\t\t\t\t\tif( slot.occupant && slot.occupant != upgrade && slot.occupant.type == \"talent\" && $factions.hasFaction(slot.occupant,\"romulan\",ship,fleet) ) {\n\t\t\t\t\t\t\t\tvar occCost = valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t\t\t\t\t// Stop as soon as we have a Talent with cost > 0\n\t\t\t\t\t\t\t\tif( occCost > 0 ) {\n\t\t\t\t\t\t\t\t\tcandidate = slot.occupant;\n\t\t\t\t\t\t\t\t\tcandCost = occCost;\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\t// Subtract 1 from Tebok's cost\n\t\t\t\t\t\treturn candCost > 0 ? cost - 1 : cost;\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Charing Weapons - one per ship only\n\t\t\"weapon:W134\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"CHARGING WEAPONS\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Self Repair Technology - one per ship only\n\t\t\"tech:T115\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"SELF REPAIR TECHNOLOGY\")(upgrade,ship,fleet);\n\t\t\t},\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"romulan\", ship, fleet );\n\t\t\t}\n\t\t},\n\n\n\t//I.K.S. Amar :72232\n\t\t// Stand By Torpedoes - one per ship only\n\t\t\"weapon:W139\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Stand By Torpedoes\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Klingon Helmsman - +5 SP if fielded on a non-Klingon ship\n\t\t\"crew:C234\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\tif ( ship && ship.classData && ship.classData.maneuvers )\n\t\t\t\t\t\t\tfor (i = 1; i < ship.classData.maneuvers.max; i++ )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ( ship.classData.maneuvers[i].about !== undefined )\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"klingon\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Klingon Navigator - one per ship only\n\t\t\"crew:C233\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Klingon Navigator\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t// I.R.W. Jazkal :72233\n\n\t//Vrax\n\t\"captain:Cap331\": {\n\t\tupgradeSlots: [ {\n\t\t\ttype: [\"talent\"]\n\t\t},\n\t\t{\n\t\t\ttype:\t[\"crew\"],\n\t\t\trules: \"Reman Bodyguards Only\",\n\t}\n]\n},\n\n\t// Prototype Cloaking Device - +5 SP for any non-Romulan ship, one per ship only\n\t\t\"tech:T121\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"romulan\", ship, fleet))\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\treturn onePerShip(\"Prototype Cloaking Device\")(upgrade,ship,fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Nijil\n\t\t\"crew:C235\": {\n\t\t\t//text: \"Add 1 [tech] Upgrade to your Upgrade Bar. That Upgrade costs -1 SP (min 1) and must be a Romulan [tech] Upgrade.\",\n\t\t\tupgradeSlots: cloneSlot( 1 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\t\t\tcost = resolve(upgrade,ship,fleet,cost) - 1;\n\t\t\t\t\t\t\t\tif (cost < 1)\n\t\t\t\t\t\t\t\t\tcost = 1;\n\t\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\tif( !$factions.hasFaction( card, \"romulan\", ship, fleet ) )\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t),\n\t\t},\n\t\t// Reman Bodyguards - one per ship only, if on ship with Vrax as captain -2 SP\n\t\t\"crew:C236\": {\n\t\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\tif ( onePerShip(\"Reman Bodyguards\")(upgrade,ship,fleet) )\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\tif ( onePerShip(\"Reman Bodyguards\")(upgrade,ship,fleet) && ship.captain && ( ship.captain.name == \"Vrax\" ) )\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.captain && ship.captain.name == \"Vrax\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) - 2;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t}\n\t\t\t},\n\t\t},\n\t\t// Disruptor Banks - one per ship only\n\t\t\"weapon:W140\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Disruptor Banks\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Montgolfier :72231\n\n\t//U.S.S. Constellation :72234p\n\t\t// Standby Battle Stations - check for battlestations icon in action bar of assigned ship\n\t\t\"talent:E145\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn (ship && !!~ship.actions.indexOf(\"battlestations\"));\n\t\t\t}\n\t\t},\n\t\t//Auxiliary Control Room\n\t\t\"question:Q007\":{\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Auxiliary Control Room\")(upgrade,ship,fleet);\n\t\t\t}},\n\t\t//Automated Distress Beacon\n\t\t\"question:Q006\":{\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Automated Distress Beacon\")(upgrade,ship,fleet);\n\t\t\t}},\n\n\n\t//U.S.S. Reliant :72235p\n\t\t//Khan Singh\n\t\t\"captain:Cap725\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for upgrades\n\t\t\t\t\tfactionPenalty: function(card, ship, fleet, factionPenalty) {\n\t\t\t\t\t\tif( isUpgrade(card) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t},\n\t\t\t\t\t//text: \"Up to 3 of the Upgrades you purchase for your ship cost exactly 4 SP each and are placed face down beside your Ship Card, the printed cost on those Upgrades cannot be greater than 6\",\n\t\t\t\t\t// Discounting up to 3 Upgrades that cost 5 or 6 sp\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t  var replacement_cost = false;\n\n\t\t\t\t\t  // Skip ship cards, save a little processing time\n\t\t\t\t\t  if (card.type != \"ship\") {\n\n\t\t\t\t\t    //Otherwise, grab all of the upgrade assigned to the ship\n\t\t\t\t\t    var candidates = [];\n\t\t\t\t\t    var occupied_slots = $filter(\"upgradeSlots\")(ship);\n\t\t\t\t\t    $.each(occupied_slots, function(i, slot) {\n\t\t\t\t\t\t\tif (slot.occupant && (slot.occupant.cost == 5 || slot.occupant.cost == 6))\n\t\t\t\t\t        candidates.push(slot);\n\t\t\t\t\t    });\n\n\t\t\t\t\t    // Only process if we have candidate cards\n\t\t\t\t\t    if (candidates.length){\n\n\t\t\t\t\t\t\t\t// Only worry about sorting if we have more than three candidates\n\t\t\t\t\t      if (candidates.length > 3){\n\t\t\t\t\t        candidates.sort(function(a,b){\n\t\t\t\t\t          return b.occupant.cost - a.occupant.cost;\n\t\t\t\t\t        });\n\t\t\t\t\t\t\t\t\tcandidates = candidates.slice(0, 3);\n\t\t\t\t\t      }\n\n\t\t\t\t\t\t\t\t// Now that we know the candidate cards for discount, apply the\n\t\t\t\t\t\t\t\t// discount if the current card is one of the candidates\n\t\t\t\t\t\t\t\tfor (var i = 0; i < candidates.length; i++){\n\t\t\t\t\t\t\t\t\tif (card.id == candidates[i].occupant.id){\n\t\t\t\t\t\t\t\t\t\treplacement_cost = true;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t    }\n\t\t\t\t\t  }\n\n\t\t\t\t\t\tvar return_value = 0;\n\t\t\t\t\t\tif (replacement_cost) return_value = 4;\n\t\t\t\t\t  else return_value = resolve(card, ship, fleet, cost);\n\n\t\t\t\t\t\treturn return_value;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//.K.S. Drovana :72241\n\t\t// Kurn\n\t\t\"captain:Cap539\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Klingon only\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\treturn $factions.hasFaction( card, \"klingon\", ship, fleet );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t// Emergency Power\n\t\t\"tech:T124\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Emergency Power\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Photon Torpedoes (Vor'cha Bonus)\n\t\t\"weapon:W142\": {\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Vor'cha Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//.R.W. Algeron :72242\n\t\t// Command Pod\n\t\t\"talent:E151\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ( ship && ship.class == \"D7 Class\" );\n\t\t\t}\n\t\t},\n\t\t// Romulan Technical Officer\n\t\t\"crew:C243\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Romulan Technical Officer\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Impulse Drive\n\t\t\"tech:T127\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Impulse Drive\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t// Borg Cube with Sphere Port 72255\n\t\t// I Am The Borg\n\t\t\"talent:E153\": {\n\t\t\trules: \"Borg Queen only\",\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && ship.captain.name == \"Borg Queen\";\n\t\t\t}\n\t\t},\n\t\t// Borg Support Vehicle Dock\n\t\t\"borg:B017\": {\n\t\t\trules: \"Borg Cube only\",\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ( ship && ship.class == \"Borg Cube\" );\n\t\t\t}\n\t\t},\n\t\t// Borg Support Vehicle Token\n\t\t\"question:Q008\":{\n\t\t\tcanEquip: onePerShip(\"Borg Support Vehicle Token\"),\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn upgrade && upgrade.name == \"Borg Support Vehicle Token\" ? 0 : 1 ;\n\t\t\t},\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0 || $.inArray( \"borg\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull <= 7;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(card, ship, fleet, cost) {\n\t\t\t\t\t\tvar modifier = 0;\n\t\t\t\t\t\tif (card.type == \"ship\" && ship.class == \"Borg Sphere\")\n\t\t\t\t\t\t\tmodifier = 15;\n\t\t\t\t\t\telse if (card.type == \"ship\")\n\t\t\t\t\t\t\tmodifier = 10;\n\t\t\t\t\t\treturn cost - modifier;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Temporal Vortex\n\t\t\"tech:T128\": {\n\t\t\trules: \"Borg ship only\",\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"borg\", ship, fleet );\n\t\t\t}\n\t\t},\n\n\n\t//Kruge's Bird-of-Prey :72236p\n\t\t// Kruge\n\t\t\"captain:Cap727\" : {\n\t\t\t\t\tupgradeSlots : [{}, {\n\t\t\t\t\t\t\ttype : [\"crew\"]\n\t\t\t\t\t\t}\n\t\t\t\t\t],\n\n\t\t\t\t},\n\n\t//H.M.S. Bounty :72260p\n\t\t//James T. Kirk\n\t\t\"captain:Cap821\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// All federation (Vulcan & Bajoren) crew cost -1 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\tif( checkUpgrade(\"crew\", upgrade, ship) && $factions.hasFaction(upgrade,\"federation\", ship, fleet) || $factions.hasFaction(upgrade,\"bajoran\", ship, fleet) || $factions.hasFaction(upgrade,\"vulcan\", ship, fleet) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Montgomery Scott\n\t\t\"crew:C248\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\", \"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t//U.S.S. Enterprise-A :72260gp\n\t\t//Torpedo Bay\n\t\t\"weapon:W146\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t\trules: \"Photon Torpedoes Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name.indexOf(\"Photon Torpedoes\") >= 0;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t//U.S.S. Venture :72253\n\t\t//Additional Phaser Arrays\n\t\t\"weapon:W149\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Additional Phaser Arrays\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t//High-Capacty Deflector Shield Grid\n\t\t\"tech:T131\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"High-Capacty Deflector Shield Grid\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t//Computer Core\n\t\t\"question:Q017\": {\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\t//console.log($.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0);\n\t\t\t\treturn $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//U.S.S. Cairo :72261p\n\t\t//Delta Shift\n\t\t\"question:Q009\": {\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\t//console.log($.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0);\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Delta Shift\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S Enterprise-B :72263\n\t\t//Holo-Communicator\n\t\t\"tech:T137\": {\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Holo-Communicator\")\n\t\t},\n\t\t//Full Reverse\n\t\t\"tech:T136\": {\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Full Reverse\")\n\t\t},\n\t\t//Deflector Control\n\t\t\"tech:T135\": {\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Deflector Control\")\n\t\t},\n\t\t//Resonance Burst\n\t\t\"tech:T134\": {\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Resonance Burst\")\n\t\t},\n\n\t//I.R.W. Rateg :72262p\n\t\t// Control Central\n\t\t\"tech:T133\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Control Central\")(upgrade,ship,fleet);\n\t\t\t}\n\t\t},\n\t\t// Main Batteries\n\t\t\"weapon:W150\": {\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Main Batteries\")(upgrade,ship,fleet);\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Kohlar’s Battle Cruiser :72270p\n\t\t//Kohlar\n\t\t\"captain:Cap333\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn upgrade.name == \"Kuvah'Magh\";\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t//Kuvah'Magh costs -2\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\tif( upgrade.name == \"Kuvah'Magh\" )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 2;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Orassin :72273\n\t\t//Thalen\n\t\t\"talent:E161\":{\n\t\t\t// -2 SP if equipped with Xindi weapon\n\t\t\tupgradeSlots: [{/* Existing Talent Slot */} ].concat( cloneSlot( 1 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t\trules: \"-2 SP if Xindi\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\t\t\tif( $factions.hasFaction(upgrade,\"xindi\", ship, fleet) )\n\t\t\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 2;\n\t\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t))},\n\t\t//Xindi Council\n\t\t\"talent:E160\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"xindi\", ship, fleet) && hasFaction(ship.captain,\"xindi\", ship, fleet);\n\t\t\t}},\n\t\t//Insecetoid Raiding Party\n\t\t\"crew:C259\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Xindi\") < 0)\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\treturn onePerShip(\"Insecetoid Raiding Party\")(upgrade,ship,fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}},\n\t\t//Pulse-Firing Particle Cannon\n\t\t\"weapon:W153\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Xindi\") < 0)\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Hatchery - Orassin\n\t\t\"tech:T139\": {\n\t\t\t// Equip only on a Xindi ship\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"xindi\", ship, fleet) && onePerShip(\"Hatchery\");\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\tsource: \"Face-down Xindi (free)\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\t\t\tcost = 0;\n\t\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\tif( !$factions.hasFaction( card, \"xindi\", ship, fleet ) )\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]},\n\n\n\t//I.K.S. Bortas :72280p\n\n\t//I.K.S. Hegh'ta :72281p\n\t\t// Auxiliary Power to Shields - I.K.S. Hegh'ta\n\t\t\"tech:T140\": {\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Auxiliary Power to Shields\")\n\t\t},\n\t\t// Course Change - I.K.S. Hegh'ta\n\t\t\"question:Q016\": {\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\t//console.log($.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0);\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0 || $.inArray( \"talent\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Course Change\")\n\t\t},\n\n\t//I.K.S. Toral :72282p\n\t\t//Lursa and B'Etor crew\n\t\t\"crew:C262\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && ship.captain.id == \"Cap439\";\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 4;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"crew:C261\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && ship.captain.id == \"Cap438\";\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 4;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Aft Shields\n\t\t\"tech:T141\":{\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Aft Shields\")\n\t\t},\n\n\t//Sela's Warbird :72282gp\n\t\t//Movar\n\t\t\"captain:Cap542\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\ttype: function(card,ship,fleet,type) {\n\t\t\t\t\t\tif( $.inArray(\"tech\",type) >= 0 || $.inArray(\"weapon\",type) >= 0 || $.inArray(\"crew\",type) >= 0 )\n\t\t\t\t\t\t\treturn type.concat([\"ship-resource\"]);\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Movar's Ability\n\t\t\"ship-resource:Rs01\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{ type: [\"talent\", \"tech\", \"weapon\", \"crew\"] }\n\t\t\t],\n\t\t\t//How do you remove a slot type?\n\t\t},\n\t\t//Klingon-Romulan Alliance\n\t\t\"talent:E166\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn ( hasFaction(ship,\"romulan\", ship, fleet) || hasFaction(ship,\"klingon\", ship, fleet) ) && ( hasFaction(ship.captain,\"romulan\", ship, fleet) || hasFaction(ship.captain,\"klingon\", ship, fleet ));\n\t\t}},\n\t\t//Tachyon Pulse\n\t\t\"tech:T142\":{\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Tachyon Pulse\")},\n\n\n\t//Calindra :72281\n\t\t//Xindi Torpedoes\n\t\t\"weapon:W154\":{intercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship && ship.class == \"Xindi Aquatic Cruiser\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}},\n\t\t//Biometric Hologram\n\t\t\"tech:T145\":{\n\t\t\t// One Per Ship & Xindi Ship Only\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"xindi\", ship, fleet);\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Biometric Hologram\")\n\t\t\t\t},\n\t\t//Subspace Vortex\n\t\t\"tech:T144\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Xindi\") < 0)\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Trellium-D\n\t\t\"tech:T143\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf(\"Xindi\") < 0)\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 4;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}},\n\t\t//Retaliation\n\t\t\"talent:E167\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain &&  $factions.hasFaction(ship,\"xindi\", ship, fleet) &&  $factions.hasFaction(ship.captain,\"xindi\", ship, fleet);\n\t\t}},\n\n\t/**\n\t//Yesterdays U.S.S. Enterprise-D\n\t\t// Jean-Luc Picard - Enterprise-D\n\t\t\"captain:Cap803\": {\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"bajoran\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( (card.type == \"tech\" || card.type == \"weapon\") && !$factions.hasFaction(card,\"borg\", ship, fleet) )\n\t\t\t\t\t\t\tcost = resolve(card, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t*/\n\t//72284p\n\t\t\"captain:Cap803\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t/**\n\t\t\t\t\t * Cost function for Diet Picard\n\t\t\t\t\t *\n\t\t\t\t\t * This Picard takes 2 SP off of the cost of the ship he is assigned\n\t\t\t\t\t * to and 1 SP off up to three upgrades for a total of 5 SP max.\n\t\t\t\t\t *\n\t\t\t\t\t * In this implementation, the extra points are taken off the 3 most\n\t\t\t\t\t * expensive cards in the current ship configuration that are assigned\n\t\t\t\t\t * to the ship itself.\n\t\t\t\t\t * TODO Upgrade values only sort on base card value, fix this at some point\n\t\t\t\t\t */\n\t\t\t\t\tcost:{\n\t\t\t\t\tpriority: 100,\n\t\t\t\t\tfn:\tfunction(card,ship,fleet,cost) {\n\t\t\t\t\t\tvar modifier = 0;\n\n\t\t\t\t\t\t// If we have intercepted the ship card, factor in the discount\n\t\t\t\t\t\tif ( card.type == \"ship\" )\n\t\t\t\t\t\t\tmodifier = 2;\n\n\t\t\t\t\t\t// Otherwise\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tvar candidates = [];\n\n\t\t\t\t\t\t\t// Grab all of the upgrades assigned to the ship\n\t\t\t\t\t\t\tvar occupied_slots = $filter(\"upgradeSlots\")(ship);\n\t\t\t\t\t\t\t$.each(occupied_slots, function(i, slot) {\n\t\t\t\t\t\t\t\tif (slot.occupant)\n\t\t\t\t\t\t\t\t\tcandidates.push(slot);\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// If there are no candidates, save some time and skip out\n\t\t\t\t\t\t\tif (candidates.length) {\n\n\t\t\t\t\t\t\t\t// If there are more than three, sort them by cost and grab the\n\t\t\t\t\t\t\t\t// three most valuable\n\t\t\t\t\t\t\t\tif (candidates.length > 3) {\n\t\t\t\t\t\t\t\t\tcandidates.sort(function(a, b) {\n\t\t\t\t\t\t\t\t\t\treturn b.occupant.cost - a.occupant.cost;\n\t\t\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t\t\tcandidates = candidates.slice(0, 3);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Now that we know the candidate cards for discount, apply the\n\t\t\t\t\t\t\t\t// discount if the current card is one of the candidates\n\t\t\t\t\t\t\t\tfor (var i = 0; i < candidates.length; i++) {\n\t\t\t\t\t\t\t\t\tif (card.id == candidates[i].occupant.id){\n\t\t\t\t\t\t\t\t\t\tmodifier = 1;\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - modifier;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Transporter - U.S.S. Enterprise-D\n\t\t\"tech:T146\": {\n\t\t\trules: \"Only one per ship\",\n\t\t\tcanEquip: onePerShip(\"Transporter\")\n\t\t},\n\t\t// Aft Phaser Emitters - U.S.S. Enterprise-D\n\t\t\"weapon:W155\": {\n\t\t\tattack: 0,\n\t\t\t// Equip only on a Federation ship with hull 4 or more\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"federation\", ship, fleet) || $factions.hasFaction(ship,\"bajoran\", ship, fleet) || ship.hull >= 4;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary - 1\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) - 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\t// Cost is primary weapon\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Natasha Yar - U.S.S. Enterprise-D\n\t\t\"crew:C266\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Muratas :72293\n\t\t//Dolim\n\t\t\"captain:Cap801\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add the \"weapon\" type to all Tech and Crew slots\n\t\t\t\t\ttype: function(card,ship,fleet,type) {\n\t\t\t\t\t\tif( $.inArray(\"tech\",type) >= 0 || $.inArray(\"crew\",type) >= 0 )\n\t\t\t\t\t\t\treturn type.concat([\"weapon\"]);\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t},\n\t\t\t\t\t// All Weapon type Upgrades cost -1 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif ( checkUpgrade(\"weapon\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Xindi Torpedoes - Reptilian\n\t\t\"weapon:W157\":{\n\t\t\tself: {\n\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship && ship.class == \"Xindi Reptilian Warship\" )\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,attack) + 1;\n\t\t\t\treturn attack;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t// Particle Beam Weapon - Muratas\n\t\t\"weapon:W156\": {\n\t\t\tattack: 0,\n\t\t\t// Equip only on a Xindi\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"xindi\", ship, fleet);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary + 1\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\t// Cost is primary weapon\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Reptilian Analysis Team\n\t\t\"crew:C267\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"xindi\", ship, fleet );\n\t\t\t},\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Reptilian Analysis Team\")\n\t\t},\n\t\t//Thermal Chamber\n\t\t\"tech:T148\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Xindi Reptilian Warship\";\n\t\t\t}\n\t\t},\n\t\t//Sensor Encoders\n\t\t\"tech:T147\":{\n\t\t\t// Only one per ship\n\t\t\tcanEquip: onePerShip(\"Sensor Encoders\"),\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Xindi Reptilian Warship\";\n\t\t\t}\n\t\t},\n\n\n\t//U.S.S. Defiant NCC-1764 :72290p\n\n\t//Delta Flyer II :72300p\n\t\t//Impulse Thrusters\n\t\t\"tech:T149\":{\n\t\t\tcanEquip: onePerShip(\"Impulse Thrusters\")\n\t\t},\n\n\t//U.S.S. Grissom :72011wp\n\t\t//J.T. Esteban\n\t\t\"captain:Cap335\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Captain's Discretion\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\tif( card.name != \"Captain's Discretion\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t\t},\n\t\t//Comm Station\n\t\t\"tech:T152\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: onePerShip(\"Comm Station\")\n\t\t},\n\t\t//Close-Range Scan\n\t\t\"tech:T1511\":{\n\t\t\tcanEquip: onePerShip(\"Close-Range Scan\")\n\t\t},\n\t\t//Genesis Effect\n\t\t\"tech:T150\":{\n\t\t\tname: \"Genesis Effect\",\n\t\t\trange: false,\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\trules: \"Crew, 5SP or less\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t\tcanEquip: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\t\t\tif( valueOf(upgrade,\"cost\",ship,fleet) > 5 )\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//William T. Riker\n\t\t\"crew:C273\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\t\t\tif( card == ship.captain )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,skill) + 3;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//I.K.S. Ves Batlh :72012wp\n\t\t//DNA Encoded Message\n\t\t\"talent:E172\":{\n\t\t\tupgradeSlots: cloneSlot( 3 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Klingon Talent Only\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function() { return 0; },\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; },\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\tif( !$factions.hasFaction( card, \"klingon\", ship, fleet ) )\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t},\n\t\t//Goroth\n\t\t\"crew:C278\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Dispersive Armor\n\t\t\"tech:T154\":{\n\t\t\tcanEquip: onePerShip(\"Dispersive Armor\")\n\t\t},\n\t\t//Photon Detonation\n\t\t\"question:Q010\":{\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0;\n\t\t\t}\n\t\t},\n\n\n\t//Dreadnought :72013wp\n\t\t\"ship:S265\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function (captain, ship, fleet) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquipAdmiral: function (captain, ship, fleet) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Captured\n\t\t\"question:Q011\": {\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Captured\"),\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tif( card == ship && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t},\n\t\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t//Plasma Pulse\n\t\t\"weapon:W162\":{\n\t\t\tcanEquip: onePerShip(\"Plasma Pulse\")\n\t\t},\n\t\t//Shield Adaption\n\t\t\"tech:T155\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.hull >= 4;\n\t\t\t}\n\t\t},\n\n\t//Prototype 02 :72014wp\n\t\t\"ship:S267\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.name == \"Gareb\" ||  captain.name == \"Jhamel\" || captain.name == \"Romulan Drone Pilot\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"ship:S266\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.name == \"Gareb\" || captain.name == \"Jhamel\" || captain.name == \"Romulan Drone Pilot\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Jhamel\n\t\t\"captain:Cap336\":{\n\t\t\t// Equip only on a Romulan Drone Ship\n\t\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t}\n\t\t},\n\t\t//Triphasic Emitters\n\t\t\"weapon:W166\": {\n\t\t\tname: \"Triphasic Emitters\",\n\t\t\trange: false,\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t\trules: \"Non-Borg, 5SP or less\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t\tcanEquip: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\t\t\tif( upgrade.printedValue == 0 || hasFaction(upgrade,\"borg\", ship, fleet) || valueOf(upgrade,\"cost\",ship,fleet) > 5 )\n\t\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Repair Protocol\n\t\t\"tech:T160\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Repair Protocol\")\n\t\t},\n\t\t//Tellarite Disruptor Banks\n\t\t\"weapon:W165\":{\n\t\t\tcanEquip: onePerShip(\"Tellarite Disruptor Banks\"),\n\t\t},\n\t\t//Evasive Protocol\n\t\t\"tech:T159\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Evasive Protocol\")\n\t\t},\n\t\t//Disguise Protocol\n\t\t\"tech:T158\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Disguise Protocol\")\n\t\t},\n\n\n\t//2017 Core Set\n\t\t//Duras\n\t\t\"captain:Cap656\":{\n\t\t\tupgradeSlots: cloneSlot( 1 ,\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Klingon And Romulan Talents Cost Exactly 3 SP\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\t\t\t\tif( hasFaction(upgrade,\"klingon\",ship,fleet) || hasFaction(upgrade,\"romulan\",ship,fleet) )\n\t\t\t\t\t\t\t\t\t\treturn 3;\n\t\t\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t// TODO Check if faction penalty should be applied\n\t\t\t\t\t\t\tfactionPenalty: function(upgrade, ship, fleet, factionPenalty) {\n\t\t\t\t\t\t\t\tif( hasFaction(upgrade,\"klingon\",ship,fleet) || hasFaction(upgrade,\"romulan\",ship,fleet) )\n\t\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t)\n\t\t},\n\t\t//Blood Oath\n\t\t\"talent:E174\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"klingon\", ship, fleet);\n\t\t\t}},\n\t\t//Tactical Station | One Per Ship\n\t\t\"weapon:W170\":{\n\t\t\tcanEquip: onePerShip(\"Tactical Station\"),\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Photon Torpedo 2017Core\n\t\t\"weapon:W169\":{\n\t\t\tattack: 0,\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary + 1\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Torpedo Fusillade\n\t\t\"weapon:W167\":{\n\t\t\tattack: 0,\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary weapon\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\t// Cost is primary weapon\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"crew:C290\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet);\n\t\t\t}},\n\n//2017 Romulan Faction Set  : 75001\n\n\t//Tomalak\n\t\"captain:Cap817\":{\n\t\tupgradeSlots: [\n\t\t\t{/* Talent */},\n\t\t\t{\n\t\t\t\ttype: [\"tech\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Tal Shiar\n\t\"talent:E177\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"romulan\", ship, fleet);\n\t\t}\n\t},\n\n\t//Interphase Generator\n\t\"tech:T248\":{\n\t\tcanEquip: onePerShip(\"Interphase Generator\")\n\t},\n\n\t//Reinforced Shields\n\t\"tech:T165\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Reinforced Shields\") && ship.hull >= 5;\n\t\t}\n\t},\n\n\t//Auxiliary Power Core\n\t\"tech:T166\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Auxiliary Power Core\") && ship.hull >= 4;\n\t\t},\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"romulan\", ship, fleet) )\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 2;\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Additional Weapons Array\n\t\"weapon:W171\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn (onePerShip(\"Additional Weapons Array\") && ship.class == \"D'deridex Class\");\n\t\t}\n\t},\n\n//2017 Dominion Faction Set  : 75002\n\n\t//All Power to Weapons\n\t\"talent:E180\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"dominion\", ship, fleet) && ship.hull >= 5;\n\t\t}\n\t},\n\n\t//Talak'Talan\n\t\"crew:C297\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn $factions.hasFaction(ship,\"dominion\", ship, fleet);\n\t\t}\n\t},\n\n\t//Duran'Adar\n\t\"crew:C298\":{\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: [\"tech\"]\n\t\t\t}\n\t\t]\n\t},\n\n\t//Disruptor Cannon\n\t\"weapon:W178\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Jem'Hadar Battleship\";\n\t\t}\n\t},\n\n\t//Phased Polaron Beams\n\t\"weapon:W176\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn (onePerShip(\"Phased Polaron Beams\") && ship.class == \"Jem'Hadar Attack Ship\");\n\t\t}\n\t},\n\n\t//Energy Dissipator\n\t\"weapon:W174\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Jem'Hadar Attack Ship\";\n\t\t}\n\t},\n\n\t//Minesweeper\n\t\"weapon:W175\":{\n\t\tcanEquip: onePerShip(\"Minesweeper\")\n\t},\n\n\t//Suicide Attack\n\t\"tech:T169\":{canEquip: function(upgrade,ship,fleet) {\n\t\t\treturn (onePerShip(\"Suicide Attack\") && ship.class == \"Jem'Hadar Attack Ship\");\n\t\t}\n\t},\n\n\t//Secondary Matter System\n\t\"tech:T168\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn $factions.hasFaction(ship,\"dominion\", ship, fleet);\n\t\t}\n\t},\n\n//D'Kora Card Pack : 73001\n\n\t\t//Lurin\n\t\t\"captain:Cap730\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction Lurin or Ferengi upgrades\n\t\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\tif( $factions.hasFaction(card,\"ferengi\", ship, fleet) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t},\n\t\t\t\t\t// Ferengi upgrades are -1\n\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\tif( isUpgrade(card) && hasFaction(card,\"ferengi\",ship,fleet) )\n\t\t\t\t\t\t\tcost = resolve(card,ship,fleet,cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Rules of Acquisition : 71806\n\t\t\"talent:E181\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"ferengi\", ship, fleet);\n\t\t\t}},\n\t\t//Kol\n\t\t\"crew:C301\":{canEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"ferengi\", ship, fleet);\n\t\t\t}},\n\n\t\t//Metaphasic Shields\n\t\t\"tech:T170\":{\n\t\t\tcanEquip: onePerShip(\"Metaphasic Shields\"),\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t//Borg Octahedron : 73001\n\t\t//Neural Transponder\n\t\t\"talent:E182\":{\n\t\t\tcanEquip: onePerShip(\"Neural Transponder\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"borg\", ship, fleet);\n\t\t\t}},\n\t\t//Neonatal Borg\n\t\t\"crew:C305\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: onePerShip(\"Neonatal Borg\"),\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add the \"crew\" type to all Tech and Borg slots\n\t\t\t\t\ttype: function(card,ship,fleet,type) {\n\t\t\t\t\tif( $.inArray(\"tech\",type) >= 0 || $.inArray(\"borg\",type) >= 0 || ( ship.hasFaction == \"borg\" ))\n\t\t\t\t\t\t\treturn type.concat([\"crew\"]);\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Tractor Beam\n\t\t\"weapon:W181\":{\n\t\t\tattack: 0,\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary weapon\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t//Trap Travesty\n\n\t//Ferengi Faction Pack: 75003\n\n\n\t\t//Daimon Solok\n\t\t\"captain:Cap446\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"]\n\t\t\t\t}, {\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\trules: \"Cost of 3sp or less\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function() { return 0; },\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\tif( (valueOf(card,\"cost\",ship,fleet) <= 4) && $factions.hasFaction( ship, \"federation\", ship, fleet ) || $factions.hasFaction( ship, \"klingon\", ship, fleet ) || $factions.hasFaction( ship, \"romulan\", ship, fleet ) || $factions.hasFaction( ship, \"dominion\", ship, fleet ) || $factions.hasFaction( ship, \"borg\", ship, fleet ) || $factions.hasFaction( ship, \"bajoran\", ship, fleet ) || $factions.hasFaction( ship, \"vulcan\", ship, fleet ) || $factions.hasFaction( ship, \"mirror-universe\", ship, fleet ) )\n\t\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t\telse if ( (valueOf(card,\"cost\",ship,fleet) <= 3) || $factions.hasFaction( ship, \"independent\", ship, fleet ) || $factions.hasFaction( ship, \"ferengi\", ship, fleet ) || $factions.hasFaction( ship, \"kazon\", ship, fleet ) || $factions.hasFaction( ship, \"xindi\", ship, fleet ))\n\t\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t}}}},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\trules: \"Cost of 3sp or less\",\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function() { return 0; },\n\t\t\t\t\t\t\tcanEquip: function(card,ship,fleet,canEquip) {\n\t\t\t\t\t\t\t\tif( (valueOf(card,\"cost\",ship,fleet) <= 4) && $factions.hasFaction( ship, \"federation\", ship, fleet ) || $factions.hasFaction( ship, \"klingon\", ship, fleet ) || $factions.hasFaction( ship, \"romulan\", ship, fleet ) || $factions.hasFaction( ship, \"dominion\", ship, fleet ) || $factions.hasFaction( ship, \"borg\", ship, fleet ) || $factions.hasFaction( ship, \"bajoran\", ship, fleet ) || $factions.hasFaction( ship, \"vulcan\", ship, fleet ) || $factions.hasFaction( ship, \"mirror-universe\", ship, fleet ) )\n\t\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t\telse if ( (valueOf(card,\"cost\",ship,fleet) <= 3) || $factions.hasFaction( ship, \"independent\", ship, fleet ) || $factions.hasFaction( ship, \"ferengi\", ship, fleet ) || $factions.hasFaction( ship, \"kazon\", ship, fleet ) || $factions.hasFaction( ship, \"xindi\", ship, fleet ))\n\t\t\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t\treturn false;\n\t\t\t\t}}}}\n\t\t\t]\n\t\t},\n\t\t//Gint - Captain\n\t\t\"captain:Cap223\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Grand Nagus Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"Grand Nagus\";\n\t\t\t\t\t}\n\t\t\t\t},{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"The Rules of Acquisition Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"The Rules Of Acquisition\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Gint - Admiral\n\t\t\"admiral:A033\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"Grand Nagus Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"Grand Nagus\";\n\t\t\t\t\t}\n\t\t\t\t},{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"The Rules of Acquisition Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"The Rules Of Acquisition\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Grand Nagus\n\t\t\"talent:E183\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"ferengi\", ship, fleet);\n\t\t\t}},\n\t\t//Kemocite\n\t\t\"tech:T172\":{\n\t\t\tcanEquip: onePerShip(\"Kemocite\")\n\t\t},\n\t\t\"weapon:W183\":{\n\t\t\tattack: 0,\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Gral\n\t\t\"crew:C310\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"ferengi\", ship, fleet);\n\t\t\t}},\n\t\t//Nava\n\t\t\"crew:C309\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"ferengi\", ship, fleet);\n\t\t\t}},\n\t\t//Grilka\n\t\t\"crew:C308\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) ? 0 : 1;\n\t\t\t}},\n\t\t//Vic Fontaine\n\t\t\"question:Q019\":{\n\t\t\ttype: \"question\",\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\t//Temporal Observatory\n\t\t\"question:Q020\":{\n\t\t\ttype: \"question\",\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0;\n\t\t\t}},\n\t\t//Bio-Mimetic Gel\n\t\t\"question:Q012\":{\n\t\t\ttype: \"question\",\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t//Gorn Raider Card Package\n\t\t//Gorn Hegemony\n\t\t\"talent:E184\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t// TODO Tholians are Independent so can't easily tell their race\n\t\t\t\treturn ship.captain && ( ship.captain.name == \"S'Sesslak\" || ship.captain.name == \"Lahr\" ||ship.captain.name.indexOf(\"Gorn\") >= 0 );\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Gorn Raider\";\n\t\t\t}\n\t\t},\n\t\t//Gorn Trooper\n\t\t\"crew:C314\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\t\t\tif( card == ship.captain )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,skill) + 1;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t //Meridor - Gorn Ale\n\t \"question:Q013\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Meridor - Gorn Ale\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"independent\", ship, fleet ) || onePerShip(\"Meridor - Gorn Ale\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) || onePerShip(\"Meridor - Gorn Ale\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"kazon\", ship, fleet ) || onePerShip(\"Meridor - Gorn Ale\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"xindi\", ship, fleet );\n\t\t},\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t},\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t],\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t}\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\t\t//Disruptor Bombardment\n\t\t\"weapon:W185\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Gorn Raider\" && onePerShip(\"Disruptor Bombardment\");\n\t\t\t}\n\t\t},\n\t\t//Gorn Sensors\n\t\t\"tech:T173\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Gorn Raider\" && onePerShip(\"Gorn Sensors\");\n\t\t\t}},\n\t\t//Enhanced Durability\n\t\t\"tech:T174\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Gorn Raider\" && onePerShip(\"Enhanced Durability\");\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t},\n\t\t\t\t\tagility: function(card,ship,fleet,agility) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,agility) + 1;\n\t\t\t\t\t\treturn agility;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//4th wing patrol ship\n\t\t\"weapon:W187\":{\n\t\t\tcanEquip: onePerShip(\"Tactical Command Reticle\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"dominion\", ship, fleet )\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\n\t//Fighter Squadron 3\n\t\t//Lead Squadron\n\t\t\"squadron:D032\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"squadron\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"squadron:D029\":{\n\t\t\tcanEquip: onePerShip(\"Defensive Maneuver Beta\"),\n\t\t},\n\t\t\"squadron:D028\":{\n\t\t\tcanEquip: onePerShip(\"Defensive Maneuver Theta\"),\n\t\t},\n\t\t\"squadron:D027\":{\n\t\t\tcanEquip: onePerShip(\"Flanking Maneuver Delta\"),\n\t\t},\n\t\t\"squadron:D031\":{\n\t\t\tcanEquip: onePerShip(\"Flanking Maneuver Epsilon\"),\n\t\t},\n\t\t\"squadron:D026\":{\n\t\t\tcanEquip: onePerShip(\"Flanking Attack Omega\"),\n\t\t},\n\t//Hirogen Hunting Vessel\n\t\t\"talent:E187\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t// TODO Tholians are Independent so can't easily tell their race\n\t\t\t\treturn ship.captain && ( ship.captain.name == \"Idrin\" || ship.captain.name == \"Karr\" ||ship.captain.name.indexOf(\"Hirogen\") >= 0 );\n\t\t\t}},\n\t\t\"crew:C320\":{\n\t\t\tcanEquip: onePerShip(\"Beta Hirogen\"),\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\t\t\tif( card == ship.captain )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,skill) + 1;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"crew:C321\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Hirogen Warship\";\n\t\t\t}},\n\t\t\"weapon:W188\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship && ship.class.indexOf( \"Hirogen\" ) < 0 )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"tech:T178\":{\n\t\t\tcanEquip: onePerShip(\"Tractor Beam\"),\n\t\t},\n\t\t\"tech:T177\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Stealth Mode\") && ship.class == \"Hirogen Warship\";\n\t\t\t}\n\t\t},\n\n\t\t//Optronic Data Core\n\t\t\"question:Q014\":{\n\t\t\tcanEquip: onePerShip(\"Optronic Data Core\"),\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//A Motley Fleet\n\n\t\t//Gurngouin\n\t\t\"ship:S313\":{\n\t\t\tupgradeSlots: [ {\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\trules: \"Free Inertial Compensators Only\",\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"Inertial Compensators\";\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function() { return 0; }\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} ]\n\t\t},\n\t\t//USS Dauntless\n\t\t\"ship:S316\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add the \"crew\" type to all Tech and Borg slots\n\t\t\t\t\ttype: function(card,ship,fleet,type) {\n\t\t\t\t\t\tif( ship.captain && $.inArray(type, ship.captain) >= 0 )\n\t\t\t\t\t\t\treturn type.concat([\"crew\"]);\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tupgradeSlots: [ {\n\t\t\t\ttype: [\"crew\"],\n\t\t\t\trules: \"Replace's Captain\",\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\t\treturn upgrade.cost + 3;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t} ]\n\t\t},\n\t\t//Thomas Riker\n\t\t\"captain:Cap658\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"federation\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"bajoran\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Arturis\n\t\t\"captain:Cap609\":{\n\t\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Dauntless Class\";\n\t\t\t}\n\t\t},\n\t\t//Jhamel\n\t\t\"captain:Cap336\":{\n\t\t\t// Equip only on a Romulan Drone Ship\n\t\t\tcanEquipCaptain: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Romulan Drone Ship\";\n\t\t\t}\n\t\t},\n\t\t//Maquis Tactics\n\t\t\"talent:E192\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"independent\", ship, fleet) || $factions.hasFaction(ship.captain,\"ferengi\", ship, fleet) || $factions.hasFaction(ship.captain,\"kazon\", ship, fleet) || $factions.hasFaction(ship.captain,\"xindi\", ship, fleet) ) && ship.class == \"Maquis Raider\";\n\t\t\t}\n\t\t},\n\t\t//Andorian Imperial Guard\n\t\t\"talent:E191\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t// TODO Tholians are Independent so can't easily tell their race\n\t\t\t\treturn ship.captain && ( ship.captain.name == \"Telev\" || ship.captain.name == \"Thy'Lek Shran\" ||ship.captain.name.indexOf(\"Andorian\") >= 0 );\n\t\t\t}},\n\t\t//Vidiian Sodality\n\t\t\"talent:E190\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\t// TODO Tholians are Independent so can't easily tell their race\n\t\t\t\treturn ship.captain && ( ship.captain.id == \"Cap706\" || ship.captain.id == \"Cap448\" || ship.captain.id == \"Cap034\" || ship.captain.name.idexOf(\"Vidiian\")) >= 0 ;\n\t\t\t},\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Vidiian Battle Cruiser\";\n\t\t\t}\n\t\t},\n\t\t//Tarah\n\t\t\"crew:C340\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Andorian Battle Cruiser\";\n\t\t\t}\n\t\t},\n\t\t//Hypothermic Charges\n\t\t\"weapon:W193\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Vidiian Battle Cruiser\";\n\t\t\t}\n\t\t},\n\t\t//Enhanced Phasers\n\t\t\"weapon:W194\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( ship.attack <= 2 )\n\t\t\t\t\treturn true;\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t//Enhanced Shield Emitters\n\t\t\"tech:T184\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Enhanced Shield Emitters\") && ship.class == \"Andorian Battle Cruiser\";\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 2;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Particle Synthesis\n\t\t\"tech:T251\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Particle Synthesis\") && ship.class == \"Dauntless Class\";\n\t\t\t}},\n\t\t//Inertial Compensators\n\t\t\"tech:T182\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\tif ( ship && ship.hull <= 3 && ship.classData && ship.classData.maneuvers )\n\t\t\t\t\t\t\tfor (i = 1; i < ship.classData.maneuvers.max; i++ )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif ( ship.classData.maneuvers[i].about !== undefined )\n\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Class 4 Cloaking Device\n\t\t\"tech:T183\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Class 4 Cloaking Device\") && ship.class == \"Maquis Raider\";\n\t\t\t}},\n\t\t//Repurposed Cargo Hold\n\t\t\"question:Q015\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Repurposed Cargo Hold\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"independent\", ship, fleet ) || onePerShip(\"Repurposed Cargo Hold\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) || onePerShip(\"Repurposed Cargo Hold\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"kazon\", ship, fleet ) || onePerShip(\"Repurposed Cargo Hold\")(upgrade,ship,fleet) && $factions.hasFaction( ship, \"xindi\", ship, fleet );\n\t\t\t},\n\t\t\tisSlotCompatible: function(slotTypes) {\n\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t},\n\t\t\tupgradeSlots: [ { type: [\"tech\", \"weapon\"] } ],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: function(captain, ship, fleet, cost) {\n\t\t\t\t\t\tif (captain.id === \"Cap037\") {\n\t\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\n\t//Kelvin Timeline  75005\n\t\t\"captain:Cap820\":{\n\t\tupgradeSlots: [\t{}, { type: [\"crew\"] } ]\n\t\t},\n\t\t//Chrisopher Pike\n\t\t\"admiral:A034\":{\n\t\tupgradeSlots: [\t{}, { type: [\"crew\"] } ]\n\t\t},\n\n\t\t\"talent:E189\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"klingon\", ship, fleet);\n\t\t}},\n\t\t\"crew:C336\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t\"crew:C335\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"]\n\t\t\t\t}\n\t\t\t]},\n\t\t\"crew:C330\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\t\t\t// TODO Prevent use of upgrades without a defined cost (e.g. Dorsal Phaser Array)\n\t\t\t\t\t\t\t\tvar cost = valueOf(upgrade,\"cost\",ship,fleet);\n\t\t\t\t\t\t\t\treturn cost <= 4;\n\n\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfree: function() {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t]},\n\t\t\"crew:C322\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet);\n\t\t\t}},\n\t\t\"crew:C323\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet) && onePerShip(\"Klingon First Officer\");\n\t\t\t}},\n\t\t\"crew:C324\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet) ;\n\t\t\t}},\n\t\t\"crew:C325\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet) ;\n\t\t\t}},\n\t\t\"weapon:W189\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Constitution Class (Kelvin)\" && onePerShip(\"Full Spread Phasers\");\n\t\t\t}},\n\t\t\"weapon:W192\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Constitution Class (Kelvin)\" ;\n\t\t\t},\n\t\t\tattack: 0,\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary + 1\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"weapon:W191\":{\n\t\t\tattack: 0,\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary + 1\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"weapon:W190\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.class == \"Warbird Class\" ;\n\t\t\t}\n\t\t},\n\t\t\"tech:T179\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet) && onePerShip(\"Klingon Cloaking Device\");\n\t\t\t}},\n\t\t\"tech:T180\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Future Technology\");\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\t\t\t// TODO Prevent use of upgrades without a defined cost (e.g. Dorsal Phaser Array)\n\t\t\t\t\t\t\t\tvar cost = valueOf(upgrade,\"cost\",ship,fleet);\n\t\t\t\t\t\t\t\treturn cost <= 4;\n\n\t\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfree: function() {\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for romulan or borg upgrades\n\t\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\tif( (card.type == \"tech\" && $factions.hasFaction(card,\"romulan\", ship, fleet)) || (card.type == \"weapon\" && $factions.hasFaction(card,\"romulan\", ship, fleet)) || (card.type == \"tech\" && $factions.hasFaction(card,\"borg\", ship, fleet)) || (card.type == \"weapon\" && $factions.hasFaction(card,\"borg\", ship, fleet)) )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// The Animated Series : 75006\n\n\t\t// The USS Enterprise\n\n\t\t//Robert April\n\t\t\"captain:Cap825\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Skill is +1 on a Connie\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( ship.class == \"Constitution Class\" )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 1;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}},\n\t\t//Worthy Oponet\n\t\t\"talent:E197\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"klingon\", ship, fleet);\n\t\t\t}},\n\t\t//Legacy Of the Name\n\t\t\"talent:E196\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn ship.captain && $factions.hasFaction(ship.captain,\"federation\", ship, fleet);\n\t\t\t}},\n\t\t//Kali\n\t\t\"crew:C345\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet) ;\n\t\t}},\n\t\t//Kaz\n\t\t\"crew:C356\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship,\"klingon\", ship, fleet) ;\n\t\t}},\n\t\t//Harcourt Fenton Mudd\n\t\t\"crew:C349\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for Khan or Talents\n\t\t\t\t\tfactionPenalty: function(upgrade, ship, fleet, factionPenalty) {\n\t\t\t\t\t\treturn upgrade.id == \"C349\" ? 0 : factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Full Power Phaser Barrage\n\t\t\"weapon:W197\":{\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary except on Constution Class\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}},\n\n\t\t//Magnetic Pulse\n\t\t\"weapon:W196\":{\n\t\t\tcanEquip: onePerShip(\"Magnetic Pulse\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\t// Attack is same as ship primary + 1\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Resistance is Futile : 75007\n\n\t\t//Assimilation Target Prime : 71510b\n\t\t\"ship:S318\": {\n\t\t\t// Restore class on card text\n\t\t\tclass: \"Galaxy Class\",\n\t\t\t// TODO use this field to pick the correct maneuver card\n\t\t\tclassId: \"galaxy__class_mu\",\n\n\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for upgrades\n\t\t\t\t\tfactionPenalty: function(card, ship, fleet, factionPenalty) {\n\t\t\t\t\t\tif( card )\n\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t},\n\t\t\t\t\t// Add mirror-universe faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tif( card == ship && factions.indexOf(\"mirror-universe\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"mirror-universe\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t},\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"tech\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Borg Queen\n\t\t\"captain:Cap911\":{\n\t\t\t\tcanEquipCaptain: function(card,ship,fleet) {\n\t\t\t\t\treturn hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t\t}\n\t\t\t},\n\t\t// Locutus\n\t\t\"captain:Cap910\":{\n\t\t\t// Can't equip if fleet contains Jean-Luc Picard\n\t\t\tcanEquipCaptain: function(upgrade, ship, fleet) {\n\t\t\t\treturn !$filter(\"fleetCardNamed\")(fleet, \"Jean-Luc Picard\");\n\t\t\t},\n\t\t\t\tcanEquipCaptain: function(card,ship,fleet) {\n\t\t\t\t\treturn hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\t// While equipped, can't equip a card named Jean-Luc Picard on any ship\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\tcanEquip: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Jean-Luc Picard\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquipCaptain: function(upgrade, ship, fleet, canEquip) {\n\t\t\t\t\t\tif( upgrade.name == \"Jean-Luc Picard\" )\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\treturn canEquip;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tship:{\n\t\t\t\t\tfactionPenalty: {\n\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\tfn: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\t\t\tif( card.type == \"crew\" )\n\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\treturn factionPenalty;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Three of Nine\n\t\t\"crew:C352\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t}},\n\t\t//Crosis\n\t\t\"crew:C345\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(card,ship,fleet,skill) {\n\t\t\t\t\t\tif( card == ship.captain )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,skill) + ( hasFaction(card,\"borg\",ship,fleet) ? 3 : 1 );\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Seven of Nine\n\t\t\"crew:C351\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"borg\"]\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcost: {\n\t\t\t\t\t\t// Run this interceptor after all other penalties and discounts\n\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\tfn: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\t\tif( checkUpgrade(\"borg\", upgrade, ship) ) {\n\t\t\t\t\t\t\t\tcost = resolve(upgrade,ship,fleet,cost);\n\t\t\t\t\t\t\t\tcost -= 1;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Blanna Torres\n\t\t\"crew:C357\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"borg\"],\n\t\t\t\t\trules: \"-1SP for each Empty Slot\",\n\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\t\t\tvar candidates = 0;\n\t\t\t\t\t\t\t\tvar UpgradeBarSlots = $.inArray( ship.upgrades )\n\t\t\t\t\t\t// Count the number of empty upgrade slots\n\t\t\t\t\t\t$.each( $filter(\"upgradeSlots\")(ship), function(i, slot) {\n\t\t\t\t\t\t\tif( slot.occupant == null && slot.type !== \"talent\" ) {\n\t\t\t\t\t\t\t\t// For Each count suptract form cost.\n\t\t\t\t\t\t\t\tcandidates = candidates + 1;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tcost = cost - candidates;\n\t\t\t\t\t\tif (cost < 0) {\n\t\t\t\t\t\t\tcost = 0;\n\t\t\t\t\t\t};\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t}}]\n\t\t},\n\t\t//Intergrated Borg Technology\n\t\t\"tech:T252\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// No faction penalty for this card\n\t\t\t\t\tfactionPenalty: function(upgrade, ship, fleet, factionPenalty) {\n\t\t\t\t\t\treturn upgrade.id == \"T252\" ? 0 : factionPenalty;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"borg\"]\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\t\t//Advanced Proton Beam\n\t\t\"weapon:W200\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"borg\", ship, fleet )\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}},\n\t\t//Bio-Molecular Torpedo\n\t\t\"weapon:W199\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"borg\", ship, fleet )\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn attack;\n\t\t\t\t\t},\n\t\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\t\tif( ship )\n\t\t\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t//Borg Multi Adaptive Shields\n\t\t\"borg:B020\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"borg\", ship, fleet )\n\t\t\t},\n\t\t\tcanEquip: onePerShip(\"Borg Multi-Adaptive Shields\")\n\t\t},\n\t\t//Technological Distinctivness\n\t\t\"borg:B022\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction( ship, \"borg\", ship, fleet )\n\t\t\t}},\n\t\t//Collective Consciousness\n\t\t\"talent:E195\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship.captain,\"borg\", ship, fleet);\n\t\t\t}\n\t\t},\n\t\t//Root Command\n\t\t\"talent:E194\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"borg\", ship, fleet);\n\t\t\t}},\n\t\t//Ocular Implants\n\t\t\"talent:E193\":{\n\t\t\tcanEquip: onePerShip(\"Ocular Implants\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"borg\", ship, fleet) && hasFaction(ship.captain,\"borg\", ship, fleet);\n\t\t\t}},\n\n\t//Vulcan Faction Pack 75008\n\n//U.S.S. T'Kumbra\n\"ship:S335\":{\n\tintercept: {\n\t\tship: {\n\t\t\tcost: function(card, ship, fleet, cost) {\n\t\t\tif($factions.hasFaction(card,\"vulcan\", ship, fleet) && card.type == \"captain\")\n\t\t\t\t\treturn resolve(card, ship, fleet, cost) - 1;\n\t\t  if($factions.hasFaction(card,\"vulcan\", ship, fleet) && card.type == \"admiral\")\n\t\t  \t\treturn resolve(card, ship, fleet, cost) - 1;\n\t\t\tif($factions.hasFaction(card,\"vulcan\", ship, fleet) && card.type == \"crew\")\n\t\t\t \t\treturn resolve(card, ship, fleet, cost) - 1;\n\t\t\t\treturn cost;\n\t\t  \t},\n\t\t\t}\n\t\t}\n\t},\n\n\t//T'Paal\n\t\t\"crew:C369\":{\n\t\t\t\tupgradeSlots: [ {\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\trules: \"0 SP Stone of Gol\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tcanEquip: function(upgrade) {\n\t\t\t\t\t\treturn upgrade.name == \"Stone of Gol\";\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcost: function(card,ship,fleet,cost) {\n\t\t\t\t\t\t\t\tif( !$factions.match(card,ship, ship, fleet) )\n\t\t\t\t\t\t\t\t\treturn 1;\n\t\t\t\t\t\t\t\telse if( $factions.match(card,ship,ship,fleet) )\n\t\t\t\t\t\t\t\t\treturn 0;\n\t\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} ]\n\t},\n\n\t//Stone of Gol\n\t\t\"tech:T267\":{\n\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\t\tif( ship && !$factions.hasFaction(ship,\"vulcan\", ship, fleet) )\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + 5;\n\t\t\t\t\treturn cost;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t},\n\n\t\t//Live Long And Prosper\n\t\t\"talent:E198\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"vulcan\", ship, fleet) && hasFaction(ship.captain,\"vulcan\", ship, fleet);\n\t\t}},\n\n\t\t//Logic is the beginning of wisdom\n\t\t\"talent:E207\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"vulcan\", ship, fleet) && hasFaction(ship.captain,\"vulcan\", ship, fleet);\n\t\t}},\n\n\t\t//Photonic Auto-Cannon\n\t\t\"weapon:W212\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"vulcan\", ship, fleet) && onePerShip(\"Photonic Auto-Cannon\");\n\t\t}},\n\n\t\t//Aft Particle Beam\n\t\t\"weapon:W211\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"vulcan\", ship, fleet);\n\t\t}},\n\n\t\t//Katric Ark\n\t\t\"tech:T264\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"vulcan\", ship, fleet);\n\t\t}},\n\n\t\t//Science Vessel Variant\n\t\t\"tech:T266\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Science Vessel Variant\") && (ship.class == \"D'Kyr Class\" || ship.class == \"Suurok Class\");\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tagility: function(card,ship,fleet,agility) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,agility) + 1;\n\t\t\t\t\t\treturn agility;\n\t\t\t\t\t},\n\t\t\t\t\thull: function(card,ship,fleet,hull) {\n\t\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\t\treturn resolve(card,ship,fleet,hull) + 1;\n\t\t\t\t\t\t\treturn hull;\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t//Combat Vessel Variant\n\t\t\"tech:T265\":{\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn onePerShip(\"Combat Vessel Variant\") && (ship.class == \"D'Kyr Class\" || ship.class == \"Suurok Class\");\n\t\t\t},\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tattack: function(card,ship,fleet,attack) {\n\t\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\t\treturn resolve(card,ship,fleet,attack) + 1;\n\t\t\t\t\t\t\treturn attack;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t},\n\n\t//The Cardassian Union\n\t\t//Gul Dukat\n\t\t\"captain:Cap826\":{\n\t\t\tcanEquipCaptain: function(card,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"dominion\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t\t//Kanar\n\t\t\"question:Q018\":{\n\t\t\tcanEquip: onePerShip(\"Kanar\"),\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"dominion\", ship, fleet);\n\t\t\t},\tisSlotCompatible: function(slotTypes) {\n\t\t\t\t\t//console.log($.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0);\n\t\t\t\t\treturn $.inArray( \"tech\", slotTypes ) >= 0 || $.inArray( \"weapon\", slotTypes ) >= 0 || $.inArray( \"crew\", slotTypes ) >= 0;\n\t\t\t\t},\n\t\t\t\tupgradeSlots: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t},\n\n\t\t//Gul Broca\n\t\t\"crew:C363\":{\n\t\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\t\treturn hasFaction(ship,\"dominion\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t\t//Enabran Tain Captain\n\t\t\"captain:Cap827\":{\n\t\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\tif( hasFaction(ship,\"romulan\",ship,fleet) )\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\treturn factionPenalty;\n\t\t  \t\t}\n\t  \t\t}\n\t  \t}\n\t  },\n\t\t//Enabran Tain Admiral\n\t\t\"admiral:A036\":{\n\t\t\tintercept: {\n\t\t\tself: {\n\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\t\t\t\t\tif( hasFaction(ship,\"romulan\",ship,fleet) )\n\t\t\t\t\t\treturn 0;\n\t\t\t\t\treturn factionPenalty;\n\t\t  \t\t}\n\t  \t\t}\n\t  \t}\n\t  },\n\n\t\t//Gul Damar\n\t\t\"crew:C364\":{\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 2;\n\t\t\t\t\treturn skill;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Tora Ziyal\n\t\"crew:C365\":{\n\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\treturn ship && $factions.hasFaction( ship, \"federation\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1;\n\t\t}\n},\n\n\t//Obsidian Order\n\t\"talent:E204\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship,\"dominion\", ship, fleet);\n\t\t},\n\t\tcanEquip: onePerShip(\"Obsidian Order\"),\n\t},\n\n\t//Multiple Dorsal Arrays\n\t\"weapon:W208\":{\n\t\tcanEquip: onePerShip(\"Multiple Dorsal Arrays\"),\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn ship.class == \"Cardassian Galor Class\";\n\t\t}\n\t},\n\n\t//Enhanced Resonance Field Grid\n\t\"weapon:W209\":{\n\t\tcanEquip: onePerShip(\"Enhanced Resonance Field Grid\")\n\t},\n\n\t//Phase Disruptor Array\n\t\"weapon:W210\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Phase Disruptor Array\") && (ship.class == \"Cardassian Galor Class\" || ship.class == \"Cardassian Keldon Class\");\n\t\t}\n\t},\n\n\t//Sensor Ghost\n\t\"tech:T260\":{\n\t\tcanEquip: onePerShip(\"Sensor Ghost\")\n\t},\n\n\t//Uridium Alloy\n\t\"tech:T261\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Uridium Alloy\") && (ship.class == \"Cardassian Galor Class\" || ship.class == \"Cardassian Keldon Class\");\n\t\t}\n\n\t},\n\n\t//Type-3 Galor Class\n\t\"tech:T262\":{\n\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\treturn onePerShip(\"Type-3 Galor Class\") && ship.class == \"Cardassian Galor Class\";\n\t\t},\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 2;\n\t\t\t\t\treturn shields;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\t//Legion Crew Module\n\t\"tech:T263\":{\n\t\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship,\"dominion\", ship, fleet);\n\t\t},\n\t\tupgradeSlots: cloneSlot( 2, { type: [\"crew\"] } )\n\t},\n\n//Faction Penalty For Subfactions\n\t\t//Federation\n\t\t\":\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"bajoran\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Bajoran\n\t\t\":\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"federation\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"vulcan\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Vulcan\n\t\t\":\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"bajoran\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"federation\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//independent\n\t\t\":\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"kazon\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"xindi\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Ferengi\n\t\t\":\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"independent\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"kazon\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"xindi\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Kazon\n\t\t\":\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"independent\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"xindi\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\t\t//Xindi\n\t\t\":\":{\n\t\t\tfactionPenalty: function(upgrade, ship, fleet) {\n\t\t\t\treturn ship && $factions.hasFaction( ship, \"ferengi\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"kazon\", ship, fleet ) ? 0 : 1 && $factions.hasFaction( ship, \"independent\", ship, fleet ) ? 0 : 1;\n\t\t\t}\n\t\t},\n\n\n\n\n\n\t// RESOURCES\n\n\t//Sickbay\n\t\t\"resource:R042\": {\n\t\t\tslotType: \"ship-resource\",\n\t\t\tcost: 0,\n\t\t\thideCost: true,\n\t\t\tshowShipResourceSlot: function(card,ship,fleet) {\n\t\t\t\tif( ship.resource && ship.resource.type == \"ship-resource\" )\n\t\t\t\t\treturn true;\n\n\t\t\t\tvar show = true;\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tshow = false;\n\t\t\t\t} );\n\t\t\t\treturn show;\n\t\t\t},\n\t\t\tonRemove: function(resource,ship,fleet) {\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\t\"ship-resource:R042a\":{\n\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\treturn valueOf(ship,\"hull\",ship,fleet) >= 4;\n\t\t\t}\n\t\t},\n\n\n\t //Front Line Retrofit\n\t\t\"resource:R040\": {\n\t\t\tslotType: \"ship-resource\",\n\t\t\tcost: 0,\n\t\t\thideCost: true,\n\t\t\tshowShipResourceSlot: function(card,ship,fleet) {\n\t\t\t\tif( ship.resource && ship.resource.type == \"ship-resource\" )\n\t\t\t\t\treturn true;\n\n\t\t\t\tvar show = true;\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tshow = false;\n\t\t\t\t} );\n\t\t\t\treturn show;\n\t\t\t},\n\t\t\tonRemove: function(resource,ship,fleet) {\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\t\t\"ship-resource:Rs40\":{\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t},\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 1;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t},\n\n\t\t//Captains Chair\n\t\t//\"ship-resource:R039a\":{\n\t\t//\tcanEquip: function(upgrade,ship,fleet) {\n\t\t//\t\treturn ship.captain.skill >= 5;\n\t\t//\t}\n\t\t//},\n\n\t\t\"resource:R039\":{\n\t\t\tslotType: \"ship-resource\",\n\t\t\tcost: 0,\n\t\t\thideCost: true,\n\t\t\tshowShipResourceSlot: function(card,ship,fleet) {\n\t\t\t\tif( ship.resource && ship.resource.type == \"ship-resource\" )\n\t\t\t\t\treturn true;\n\n\t\t\t\tvar show = true;\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tshow = false;\n\t\t\t\t} );\n\t\t\t\treturn show;\n\t\t\t},\n\t\t\tonRemove: function(resource,ship,fleet) {\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\n\n\t\t\"resource:R033\": {\n\t\t\tslotType: \"ship-resource\",\n\t\t\tcost: 0,\n\t\t\thideCost: true,\n\t\t\tshowShipResourceSlot: function(card,ship,fleet) {\n\t\t\t\tif( ship.resource && ship.resource.type == \"ship-resource\" )\n\t\t\t\t\treturn true;\n\n\t\t\t\tvar show = true;\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tshow = false;\n\t\t\t\t} );\n\t\t\t\treturn show;\n\t\t\t},\n\t\t\tonRemove: function(resource,ship,fleet) {\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\n\t\t//Fleet Commander (ship)\n\t\t\"ship-resource:R033a\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"captain\"],\n\t\t\t\t\trules: \"Fleet Commander\"\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 1;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t},\n\t\t\t\t\tshields: function(card,ship,fleet,shields) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,shields) + 1;\n\t\t\t\t\t\treturn shields;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"ship-resource:R033b\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"captain\"],\n\t\t\t\t\trules: \"Fleet Commander\"\n\t\t\t\t}\n\t\t\t],\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tskill: function(upgrade,ship,fleet,skill) {\n\t\t\t\t\t\tif( upgrade == ship.captain )\n\t\t\t\t\t\t\treturn resolve(upgrade,ship,fleet,skill) + 1;\n\t\t\t\t\t\treturn skill;\n\t\t\t\t\t},\n\t\t\t\t\thull: function(card,ship,fleet,hull) {\n\t\t\t\t\t\tif( card == ship )\n\t\t\t\t\t\t\treturn resolve(card,ship,fleet,hull) + 1;\n\t\t\t\t\t\treturn hull;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t  \tif( upgrade || (upgrade && upgrade.hullconstraint == \"4+\" && ship.hull >= 3) || (upgrade && upgrade.hullconstraint == \"5+\" && ship.hull >= 4) || (upgrade && upgrade.hullconstraint == \"3-\" && ship.hull <= 2))\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"resource:R010\": {\n\t\t\tslotType: \"fleet-captain\",\n\t\t\tcost: 0,\n\t\t\thideCost: true,\n\t\t\tshowShipResourceSlot: function(card,ship,fleet) {\n\t\t\t\tif( ship.resource && ship.resource.type == \"fleet-captain\" )\n\t\t\t\t\treturn true;\n\n\t\t\t\tvar show = true;\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tshow = false;\n\t\t\t\t} );\n\t\t\t\treturn show;\n\t\t\t},\n\t\t\tonRemove: function(resource,ship,fleet) {\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010a\": {\n\t\t\t// Only equip if captain matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"federation\", ship, fleet) && ( !ship.captain || ship.captain.unique && $factions.hasFaction(ship.captain, \"federation\", ship, fleet) );\n\t\t\t},\n\t\t\t// Prevent non-faction-matching captain\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique && $factions.hasFaction(captain, \"federation\", ship, fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010b\": {\n\t\t\t// Only equip if ship and captain matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"dominion\", ship, fleet) && ( !ship.captain || ship.captain.unique && $factions.hasFaction(ship.captain, \"dominion\", ship, fleet) );\n\t\t\t},\n\t\t\t// Prevent non-faction-matching captain\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique && $factions.hasFaction(captain, \"dominion\", ship, fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010c\": {\n\t\t\t// Only equip if ship and captain matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"romulan\", ship, fleet) && ( !ship.captain || ship.captain.unique && $factions.hasFaction(ship.captain, \"romulan\", ship, fleet) );\n\t\t\t},\n\t\t\t// Prevent non-faction-matching captain\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique && $factions.hasFaction(captain, \"romulan\", ship, fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010d\": {\n\t\t\t// Only equip if ship and captain matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"klingon\", ship, fleet) && ( !ship.captain || ship.captain.unique && $factions.hasFaction(ship.captain, \"klingon\", ship, fleet) );\n\t\t\t},\n\t\t\t// Prevent non-faction-matching captain\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique && $factions.hasFaction(captain, \"klingon\", ship, fleet);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010e\": {\n\t\t\t// Only equip if captain unique\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn !ship.captain || ship.captain.unique;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Only allow unique captain\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique;\n\t\t\t\t\t},\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tfactions = factions || card.factions;\n\t\t\t\t\t\tif( card == ship.captain && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tfleet: {\n\t\t\t\t\t// All crew cost -1 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"crew\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010f\": {\n\t\t\t// Only equip if captain unique\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn !ship.captain || ship.captain.unique;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Only allow unique captain\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique;\n\t\t\t\t\t},\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tfactions = factions || card.factions;\n\t\t\t\t\t\tif( card == ship.captain && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tfleet: {\n\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010g\": {\n\t\t\t//  Only equip if captain unique\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn !ship.captain || ship.captain.unique;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Only allow unique captain\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique;\n\t\t\t\t\t},\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet) {\n\t\t\t\t\t\tvar factions = card.factions;\n\t\t\t\t\t\tif( card == ship.captain && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfleet: {\n\t\t\t\t\t// All weapon cost -1 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"weapon\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"fleet-captain:R010h\": {\n\t\t\t// Only equip if captain unique\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn !ship.captain || ship.captain.unique;\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Only allow unique captain\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.unique;\n\t\t\t\t\t},\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet) {\n\t\t\t\t\t\tvar factions = card.factions;\n\t\t\t\t\t\tif( card == ship.captain && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfleet: {\n\t\t\t\t\t// All tech cost -1 SP\n\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\tif( checkUpgrade(\"tech\", upgrade, ship) )\n\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 1;\n\t\t\t\t\t\treturn cost;\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"resource:R015\": {\n\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"faction\"],\n\t\t\t\t\tsource: \"Select Factions for Officer Exchange Program\",\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"faction\"],\n\t\t\t\t\tsource: \"Select Factions for Officer Exchange Program\",\n\t\t\t\t}\n\t\t\t],\n\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\t// Zero faction penalty for captains, admirals and crew\n\t\t\t\t\tfactionPenalty: function(card,ship,fleet,factionPenalty) {\n\n\t\t\t\t\t\tvar factionA = fleet.resource.upgradeSlots[0].occupant;\n\t\t\t\t\t\tvar factionB = fleet.resource.upgradeSlots[1].occupant;\n\n\t\t\t\t\t\t// Fail if user hasn't assigned two faction cards yet\n\t\t\t\t\t\tif( !factionA || !factionB )\n\t\t\t\t\t\t\treturn factionPenalty;\n\n\t\t\t\t\t\t// Only apply to captains, admirals and crew\n\t\t\t\t\t\tif( card.type != \"captain\" && card.type != \"admiral\" && card.type != \"crew\" )\n\t\t\t\t\t\t\treturn factionPenalty;\n\n\t\t\t\t\t\t// Check that the card and ship are of the chosen factions\n\t\t\t\t\t\tif( $factions.match( card, factionA ) && $factions.match( ship, factionB ) || $factions.match( card, factionB ) && $factions.match( ship, factionA ) )\n\t\t\t\t\t\t\treturn 0;\n\n\t\t\t\t\t\treturn factionPenalty;\n\n\t\t\t\t\t},\n\n\t\t\t\t\t// Cost -1 SP for captains and admirals\n\t\t\t\t\tcost: function(card, ship, fleet, cost) {\n\n\t\t\t\t\t\tvar factionA = fleet.resource.upgradeSlots[0].occupant;\n\t\t\t\t\t\tvar factionB = fleet.resource.upgradeSlots[1].occupant;\n\n\t\t\t\t\t\t// Fail if user hasn't assigned two faction cards yet\n\t\t\t\t\t\tif( !factionA || !factionB )\n\t\t\t\t\t\t\treturn cost;\n\n\t\t\t\t\t\t// Only apply to captains and admirals\n\t\t\t\t\t\tif( card.type != \"captain\" && card.type != \"admiral\" )\n\t\t\t\t\t\t\treturn cost;\n\n\t\t\t\t\t\t// Check that the card and ship are of the chosen factions\n\t\t\t\t\t\tif( $factions.match( card, factionA ) && $factions.match( ship, factionB ) || $factions.match( card, factionB ) && $factions.match( ship, factionA ) )\n\t\t\t\t\t\t\treturn resolve(card, ship, fleet, cost) - 1;\n\n\t\t\t\t\t\treturn cost;\n\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\n\t\t\"resource:R011\": {\n\n\t\t\thideCost: true,\n\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\t// Add the \"officer\" type to all crew slots\n\t\t\t\t\ttype: function(card,ship,fleet,type) {\n\t\t\t\t\t\tif( $.inArray(\"crew\",type) >= 0 )\n\t\t\t\t\t\t\treturn type.concat([\"officer\"]);\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\n\t\t\"officer:R011a\": {\n\t\t\tskill: 4,\n\t\t\ttalents: 1,\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Crew slot added by loader */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\tsource: \"First Officer\",\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\t\"officer:R011b\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Crew slot added by loader */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t\tsource: \"Tactical Officer\",\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\t\"officer:R011c\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Crew slot added by loader */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\tsource: \"Operations Officer\",\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\t\"officer:R011d\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{/* Crew slot added by loader */},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\tsource: \"Science Officer\",\n\t\t\t\t}\n\t\t\t]\n\t\t},\n\n\t\t// Sideboard\n\t\t\"resource:R003\": {\n\t\t\tclass: \"Sideboard\",\n\t\t\tfactions: $factions.listCodified,\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"captain\"],\n\t\t\t\t\tsource: \"Sideboard\",\n\t\t\t\t\trules: \"Combined cost 20 SP or less\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,upgradeSlot) {\n\n\t\t\t\t\t\tvar total = 0;\n\t\t\t\t\t\t$.each( fleet.resource.upgradeSlots, function(i,slot) {\n\t\t\t\t\t\t\tif( slot.occupant && slot != upgradeSlot )\n\t\t\t\t\t\t\t\ttotal += valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tvar cost = valueOf(card,\"cost\",ship,fleet);\n\t\t\t\t\t\treturn total + cost <= 20;\n\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t// Remove all restrictions\n\t\t\t\t\t\t\tcanEquip: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquipFaction: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; }\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\tsource: \"Sideboard\",\n\t\t\t\t\trules: \"Combined cost 20 SP or less\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,upgradeSlot) {\n\n\t\t\t\t\t\tvar total = 0;\n\t\t\t\t\t\t$.each( fleet.resource.upgradeSlots, function(i,slot) {\n\t\t\t\t\t\t\tif( slot.occupant && slot != upgradeSlot )\n\t\t\t\t\t\t\t\ttotal += valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tvar cost = valueOf(card,\"cost\",ship,fleet);\n\t\t\t\t\t\treturn total + cost <= 20;\n\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t// Remove all restrictions\n\t\t\t\t\t\t\tcanEquip: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquipFaction: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; }\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\tsource: \"Sideboard\",\n\t\t\t\t\trules: \"Combined cost 20 SP or less\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,upgradeSlot) {\n\n\t\t\t\t\t\tvar total = 0;\n\t\t\t\t\t\t$.each( fleet.resource.upgradeSlots, function(i,slot) {\n\t\t\t\t\t\t\tif( slot.occupant && slot != upgradeSlot )\n\t\t\t\t\t\t\t\ttotal += valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tvar cost = valueOf(card,\"cost\",ship,fleet);\n\t\t\t\t\t\treturn total + cost <= 20;\n\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t// Remove all restrictions\n\t\t\t\t\t\t\tcanEquip: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquipFaction: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; }\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\tsource: \"Sideboard\",\n\t\t\t\t\trules: \"Combined cost 20 SP or less\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,upgradeSlot) {\n\n\t\t\t\t\t\tvar total = 0;\n\t\t\t\t\t\t$.each( fleet.resource.upgradeSlots, function(i,slot) {\n\t\t\t\t\t\t\tif( slot.occupant && slot != upgradeSlot )\n\t\t\t\t\t\t\t\ttotal += valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tvar cost = valueOf(card,\"cost\",ship,fleet);\n\t\t\t\t\t\treturn total + cost <= 20;\n\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t// Remove all restrictions\n\t\t\t\t\t\t\tcanEquip: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquipFaction: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; }\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t\tsource: \"Sideboard\",\n\t\t\t\t\trules: \"Combined cost 20 SP or less\",\n\t\t\t\t\tcanEquip: function(card,ship,fleet,upgradeSlot) {\n\n\t\t\t\t\t\tvar total = 0;\n\t\t\t\t\t\t$.each( fleet.resource.upgradeSlots, function(i,slot) {\n\t\t\t\t\t\t\tif( slot.occupant && slot != upgradeSlot )\n\t\t\t\t\t\t\t\ttotal += valueOf(slot.occupant,\"cost\",ship,fleet);\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tvar cost = valueOf(card,\"cost\",ship,fleet);\n\t\t\t\t\t\treturn total + cost <= 20;\n\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\t// Remove all restrictions\n\t\t\t\t\t\t\tcanEquip: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tcanEquipFaction: {\n\t\t\t\t\t\t\t\tpriority: 100,\n\t\t\t\t\t\t\t\tfn: function() { return true; }\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tfactionPenalty: function() { return 0; }\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t]\n\t\t},\n\n\t\t// Flagship\n\t\t\"resource:R004\": {\n\t\t\tslotType: \"flagship\",\n\t\t\tcost: 0,\n\t\t\thideCost: true,\n\t\t\tshowShipResourceSlot: function(card,ship,fleet) {\n\t\t\t\tif( ship.resource && ship.resource.type == \"flagship\" )\n\t\t\t\t\treturn true;\n\n\t\t\t\tvar show = true;\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tshow = false;\n\t\t\t\t} );\n\t\t\t\treturn show;\n\t\t\t},\n\t\t\tonRemove: function(resource,ship,fleet) {\n\t\t\t\t$.each( fleet.ships, function(i,ship) {\n\t\t\t\t\tif( ship.resource )\n\t\t\t\t\t\tdelete ship.resource;\n\t\t\t\t} );\n\t\t\t}\n\t\t},\n\n\t\t// Romulan\n\t\t\"flagship:R004a\": {\n\t\t\t// Only equip if ship matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"romulan\", ship, fleet);\n\t\t\t}\n\t\t},\n\n\t\t// Klingon\n\t\t\"flagship:R004b\": {\n\t\t\t// Only equip if ship matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"klingon\", ship, fleet);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( upgrade || (upgrade && upgrade.hullconstraint == \"4+\" && ship.hull >= 3) || (upgrade && upgrade.hullconstraint == \"5+\" && ship.hull >= 4) ||  (upgrade && upgrade.hullconstraint == \"3-\" && ship.hull <= 2))\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Dominion\n\t\t\"flagship:R004c\": {\n\t\t\t// Only equip if ship matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"dominion\", ship, fleet);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( upgrade || (upgrade && upgrade.hullconstraint == \"4+\" && ship.hull >= 3) || (upgrade && upgrade.hullconstraint == \"5+\" && ship.hull >= 4) ||  (upgrade && upgrade.hullconstraint == \"3-\" && ship.hull <= 2))\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Federation\n\t\t\"flagship:R004e\": {\n\t\t\t// Only equip if ship matches faction\n\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\treturn $factions.hasFaction(ship, \"federation\", ship, fleet);\n\t\t\t},\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\tif( upgrade || (upgrade && upgrade.hullconstraint == \"4+\" && ship.hull >= 3) || (upgrade && upgrade.hullconstraint == \"5+\" && ship.hull >= 4) ||  (upgrade && upgrade.hullconstraint == \"3-\" && ship.hull <= 2) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Independent (Rom)\n\t\t\"flagship:R004f\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tif( card == ship && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Independent (Klingon)\n\t\t\"flagship:R004g\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tif( card == ship && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\tif( upgrade || (upgrade && upgrade.hullconstraint == \"4+\" && ship.hull >= 3) || (upgrade && upgrade.hullconstraint == \"5+\" && ship.hull >= 4) || (upgrade && upgrade.hullconstraint == \"3-\" && ship.hull <= 2) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Independent (Dominion)\n\t\t\"flagship:R004h\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tif( card == ship && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\tif( upgrade || (upgrade && upgrade.hullconstraint == \"4+\" && ship.hull >= 3) || (upgrade && upgrade.hullconstraint == \"5+\" && ship.hull >= 4) || (upgrade && upgrade.hullconstraint == \"3-\" && ship.hull <= 2) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// Independent (Federation)\n\t\t\"flagship:R004i\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\t// Add independent faction to captain\n\t\t\t\t\tfactions: function(card,ship,fleet,factions) {\n\t\t\t\t\t\tif( card == ship && factions.indexOf(\"independent\") < 0 )\n\t\t\t\t\t\t\treturn factions.concat([\"independent\"]);\n\t\t\t\t\t\treturn factions;\n\t\t\t\t\t},\n\t\t\t\t\tcanEquip: function(upgrade,ship,fleet) {\n\t\t\t\t\t\tif( upgrade || (upgrade && upgrade.hullconstraint == \"4+\" && ship.hull >= 3) || (upgrade && upgrade.hullconstraint == \"5+\" && ship.hull >= 4) || (upgrade && upgrade.hullconstraint == \"3-\" && ship.hull <= 2) )\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t// EMERGENCY FORCE FIELD RESOURCE\n\t\t\"resource:R020\": {\n\t\t\tcost: function(card,ship,fleet) {\n\t\t\t\tif( !fleet )\n\t\t\t\t\treturn 0;\n\t\t\t\tvar shields = 0;\n\t\t\t\t$.each( fleet.ships || [], function(i,ship) {\n\t\t\t\t\tshields += valueOf(ship,\"shields\",ship,fleet);\n\t\t\t\t} );\n\t\t\t\treturn Math.ceil( shields/2 );\n\t\t\t}\n\t\t},\n\n\n\t\t//Improved Hull\n\t\t\"resource:R029\":{\n\n\t\t},\n\n\n\n\n\t\t// BALANCE OF TERROR\n\t\t\"talent:E035\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"talent\"],\n\t\t\t\t\trules: \"\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\t\t\treturn $factions.match(card,ship) && valueOf(card,\"cost\",ship,fleet) <= 5;\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: onePerShip(\"Balance of Terror\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: {\n\t\t\t\t\t\tpriority: 1000,\n\t\t\t\t\t\tfn: function() { return 3; }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"crew:C035\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"crew\"],\n\t\t\t\t\trules: \"\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\t\t\treturn $factions.match(card,ship) && valueOf(card,\"cost\",ship,fleet) <= 5;\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: onePerShip(\"Balance of Terror\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: {\n\t\t\t\t\t\tpriority: 1000,\n\t\t\t\t\t\tfn: function() { return 3; }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"tech:T044\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"tech\"],\n\t\t\t\t\trules: \"\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\t\t\treturn $factions.match(card,ship) && valueOf(card,\"cost\",ship,fleet) <= 5;\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: onePerShip(\"Balance of Terror\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: {\n\t\t\t\t\t\tpriority: 1000,\n\t\t\t\t\t\tfn: function() { return 3; }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\t\"weapon:W027\": {\n\t\t\tupgradeSlots: [\n\t\t\t\t{\n\t\t\t\t\ttype: [\"weapon\"],\n\t\t\t\t\trules: \"\",\n\t\t\t\t\tfaceDown: true,\n\t\t\t\t\tcanEquip: function(card,ship,fleet) {\n\t\t\t\t\t\treturn $factions.match(card,ship) && valueOf(card,\"cost\",ship,fleet) <= 5;\n\t\t\t\t\t},\n\t\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tfree: function() { return true; },\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t],\n\t\t\tcanEquip: onePerShip(\"Balance of Terror\"),\n\t\t\tintercept: {\n\t\t\t\tself: {\n\t\t\t\t\tcost: {\n\t\t\t\t\t\tpriority: 1000,\n\t\t\t\t\t\tfn: function() { return 3; }\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t//Senior Staff\n\t\t\"resource:R036\":{\n\t\t\t//Add Ship Resource to all crew\n\t\t\tintercept: {\n\t\t\t\tfleet: {\n\t\t\t\t\ttype: function(card,ship,fleet,type) {\n\t\t\t\t\t\tif( $.inArray(\"crew\",type) >= 0 )\n\t\t\t\t\t\t\treturn type.concat([\"ship-resource\"]);\n\t\t\t\t\t\treturn type;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\"ship-resource:R036a\":{\n\t\t\tupgradeSlots: [\n\t\t\t\t{ type: [\"crew\"] },\n\t\t\t\t{ type: [\"talent\"],\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\t// Reduce cost of Borg Ablative Hull Armor\n\t\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) + 1;\n\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} ]\n\t\t},\n\n\t\t\"ship:S362\": {\n\t\t\t\tintercept: {\n\t\t\t\t\tship: {\n\t\t\t\t\t\tcost: function(upgrade, ship, fleet, cost) {\n\t\t\t\t\t\t\t// if starship_construction 'Federation Prototype' equipped then -2 SP for all 'prometheus restricted' upgrades\n\t\t\t\t\t\t\tif( ship && ship.construction && ship.construction.id == \"Con001\"\n\t\t\t\t\t\t\t\t&& (upgrade.text.includes('may only be purchased for a Prometheus Class ship') || upgrade.text.includes('Prometheus Class Only') || upgrade.id == \"T277\" || upgrade.id == \"T278\" || upgrade.id == \"W227\" ) )\n\t\t\t\t\t\t\t\treturn resolve(upgrade, ship, fleet, cost) - 2;\n\t\t\t\t\t\t\treturn cost;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t},\n\n// Alliance Builder\n//Federation\n\n//Defiant Class\n\t\"ship:AS0007\": {\n\t\tintercept: {\n\t\t\tship: {\n\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\treturn captain.id == \"AC0003\" || captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n//Saber Class\n\t\t\"ship:AS0008\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0003\" || captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Intrepid Class\n\t\t\"ship:AS0009\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Intrepid Class\n\t\t\"ship:AS0010\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Galaxy Class\n\t\t\"ship:AS0011\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Galaxy Class\n\t\t\t\"ship:AS0012\": {\n\t\t\t\tintercept: {\n\t\t\t\t\t\tship: {\n\t\t\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\t\t\treturn captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\n//Nebula Class\n\t\t\"ship:AS0013\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Nebula Class\n\t\t\"ship:AS0014\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0004\" || captain.id == \"AC0005\" || captain.id == \"AC0006\" || captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Prometheus Class\n\t\t\"ship:AS0015\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Prometheus Class\n\t\t\"ship:AS0016\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\treturn captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n//Sovereign Class\n\t\t\"ship:AS0017\": {\n\t\t\tintercept: {\n\t\t\t\tship: {\n\t\t\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\t\t\treturn captain.id == \"AC0007\" || captain.id == \"AC0008\";\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\n\n\"captain:AC0001\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n\"captain:AC0002\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n\"captain:AC0003\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n\"captain:AC0004\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n\"captain:AC0005\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n\"captain:AC0006\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n\"captain:AC0007\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n\"captain:AC0008\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"federation\",ship,fleet);\n\t}\n},\n//Operations Officer\n \"crew:AP1001\":{\n\tcanEquip: onePerShip(\"Operations Officer\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n\t//Tactical Officer\n\t\"crew:AP1002\":{\n\tcanEquip: onePerShip(\"Tactical Officer\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Helmsman\n \"crew:AP1003\":{\n\tcanEquip: onePerShip(\"Helmsman\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Science Officer\n\t\"crew:AP1004\":{\n\tcanEquip: onePerShip(\"Science Officer\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Commander\n\t\"crew:AP1005\":{\n\tcanEquip: onePerShip(\"Commander\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Calculating\n \"talent:AP1006\":{\n\tcanEquip: onePerShip(\"Calculating\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Battle-Hardened\n\"talent:AP1009\":{\n\tcanEquip: onePerShip(\"Battle-Hardened\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Detection Grid\n\t\"tech:AP1013\":{\n\tcanEquip: onePerShip(\"Detection Grid\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Reinforced Shielding\n\t\"tech:AP1014\":{\n\tcanEquip: onePerShip(\"Reinforced Shielding\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Photon Torpedoes\n\"weapon:AP1018\":{\n\tattack: 0,\n\tintercept: {\n\t\tself: {\n\t\t\t// Attack is same as ship primary + 1\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\treturn attack;\n\t\t\t}\n\t\t}\n\t}\n},\n//Dorsal Phaser Array\n \"weapon:AP1020\":{\n\tcanEquip: onePerShip(\"Dorsal Phaser Array\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Overcharged Phasers\n \"weapon:AP1021\":{\n\tcanEquip: onePerShip(\"Overcharged Phasers\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Full Spread\n\"weapon:AP1022\":{\ncanEquip: onePerShip(\"Full Spread\") && function(upgrade,ship,fleet){\n\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n}},\n//Enhanced Targeting\n \"weapon:AP1023\":{\n\tcanEquip: onePerShip(\"Enhanced Targeting\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//+1 Elite Talent Slot\n\t\"talent:AE001\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 1, { type: [\"talent\"] } )\n\t},\n//+2 Elite Talent Slots\n\t\"talent:AE004\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 2, { type: [\"talent\"] } )\n\t},\n//+3 Elite Talent Slots\n\t\"talent:AE007\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 3, { type: [\"talent\"] } )\n\t},\n//+1 Upgrade Slots\n\t\"question:AQ001\":{\n\t\tcanEquip: onePerShip(\"Upgrade Slots\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ($factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t\t},\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >= 0 || $.inArray(\"weapon\", slotTypes) >= 0;\n\t\t},\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n//+2 Upgrade Slots\n\"question:AQ004\":{\n\tcanEquip: onePerShip(\"Upgrade Slots\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ($factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t},\n\tisSlotCompatible: function(slotTypes) {\n\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >= 0 || $.inArray(\"weapon\", slotTypes) >= 0;\n\t},\n\tupgradeSlots: [\n\t\t{\n\t\t\ttype: function(upgrade,ship) {\n\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\ttype: [\"tech\",\"weapon\",\"crew\"],\n\t\t},\n\t\t{\n\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t}\n\t]\n},\n\n\t// Alliance Part II: Klingons //\n\n\t//K'Vort Class\n\"ship:AS0023\": {\n\tintercept: {\n\t\tship: {\n\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\treturn captain.id == \"AC0011\" || captain.id == \"AC0012\" || captain.id == \"AC0013\" || captain.id == \"AC0014\" || captain.id == \"AC0015\" || captain.id == \"AC0016\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n//Vor'cha Class\n\"ship:AS0024\": {\n\tintercept: {\n\t\tship: {\n\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\treturn captain.id == \"AC0011\" || captain.id == \"AC0012\" || captain.id == \"AC0013\" || captain.id == \"AC0014\" || captain.id == \"AC0015\" || captain.id == \"AC0016\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n//Negh'Var Class\n\"ship:AS0025\": {\n\tintercept: {\n\t\tship: {\n\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\treturn captain.id == \"AC0015\" || captain.id == \"AC0016\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n//Negh'Var Class\n\"ship:AS0026\": {\n\tintercept: {\n\t\tship: {\n\t\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\t\treturn captain.id == \"AC0015\" || captain.id == \"AC0016\";\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t},\n\n\"captain:AC0009\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n\"captain:AC0010\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n\"captain:AC0011\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n\"captain:AC0012\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n\"captain:AC0013\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n\"captain:AC0014\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n\"captain:AC0015\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n\"captain:AC0016\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Coordinated Assault\n\"talent:AP2001\":{\n\tcanEquip: function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Battle Plan\n\"talent:AP2002\":{\n\tcanEquip: function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Engineering Officer\n\"crew:AP2003\":{\n\tcanEquip: onePerShip(\"Engineering Officer\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Extend Shields\n\"tech:AP2004\":{\n\tcanEquip: onePerShip(\"Extend Shields\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"federation\", ship, fleet))\n\t}},\n//Science Officer\n\"crew:AP2005\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Science Officer\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Helmsman\n\"crew:AP2006\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Helmsman\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Tactical Officer\n\"crew:AP2007\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Tactical Officer\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Operations Officer\n\"crew:AP2009\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Operations Officer\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Weapons Officer\n\"crew:AP2010\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Weapons Officer\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//First Officer\n\"crew:AP2011\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"First Officer\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Reckless Assault\n\"talent:AP2012\":{\n\tcanEquip: onePerShip(\"Reckless Assault\") && function(upgrade,ship,fleet) {\n\t\treturn ( $factions.hasFaction(ship.captain,\"klingon\", ship, fleet));\n\t}\n},\n//Evasive Maneuvers\n\"talent:AP2013\":{\n\tcanEquip: onePerShip(\"Evasive Maneuvers\") && function(upgrade,ship,fleet) {\n\t\treturn ship.class.indexOf(\"K'Vort Class\") >= 0 && ( $factions.hasFaction(ship.captain,\"klingon\", ship, fleet));\n\t}\n},\n//Glory To The Empire!\n\"talent:AP2014\": {\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Fight With Honor\n\"talent:AP2016\":{\n\tcanEquip: onePerShip(\"Fight With Honor\"),\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Strafing Run\n\t\"talent:AP2018\":{\n\t\tcanEquip: onePerShip(\"Strafing Run\") && function(upgrade,ship,fleet) {\n\t\t\treturn (ship.class == \"K'Vort Class\" || ship.class == \"B'Rel Class\") && ( $factions.hasFaction(ship.captain,\"klingon\", ship, fleet));\n\t\t}\n\t},\n//Eye For An Eye\n\"talent:AP2019\":{\n\tcanEquip: onePerShip('Eye For An Eye'),\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Forward Battery\n\"weapon:AP2021\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Forward Battery\") && (ship.class == \"Vor'cha Class\" || ship.class == \"Negh'var Class\")},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n\t},\n//Disruptor Overcharge\n\"weapon:AP2022\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Disruptor Overcharge\") && (ship.class == \"Vor'cha Class\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Photon Torpedoes\n\"weapon:AP2023\":{\n\tattack: 0,\n\tintercept: {\n\t\tself: {\n\t\t\t// Attack is same as ship primary + 1\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet) + 1;\n\t\t\t\treturn attack;\n\t\t\t}\n\t\t}\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Torpedo Fusillade\n\"weapon:AP2025\":{\n\tattack: 0,\n\tintercept: {\n\t\tself: {\n\t\t\t// Attack is same as ship primary weapon\n\t\t\tattack: function(upgrade,ship,fleet,attack) {\n\t\t\t\tif( ship )\n\t\t\t\t\treturn valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\treturn attack;\n\t\t\t},\n\t\t\t// Cost is primary weapon\n\t\t\tcost: function(upgrade,ship,fleet,cost) {\n\t\t\t\tif( ship )\n\t\t\t\t\treturn resolve(upgrade,ship,fleet,cost) + valueOf(ship,\"attack\",ship,fleet);\n\t\t\t\treturn cost;\n\t\t\t}\n\t\t}\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Converging Fire\n\"weapon:AP2026\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Converging Fire\") && (ship.class == \"Vor'cha Class\" || ship.class == \"Negh'var Class\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//Secondary Relays\n\"tech:AP2027\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Secondary Relays\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Reactor Vent\n\"tech:AP2028\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Reactor Vent\");\n\t},\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Targeting Array\n\"tech:AP2029\":{\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship, fleet);\n\t}\n},\n//Secondary Cloaking Coil\n\"tech:AP2030\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Secondary Cloaking Coil\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Reinforced Hull\n\"tech:AP2031\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Reinforced Hull\") && ship.hull >=4;\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t},\n\tintercept: {\n\t\tship: {\n\t\t\thull: function(card,ship,fleet,hull) {\n\t\t\t\tif( card == ship )\n\t\t\t\t\treturn resolve(card,ship,fleet,hull) + 2;\n\t\t\t\treturn hull;\n\t\t\t}\n\t\t}\n\t},\n},\n//Passive Sensors\n\"tech:AP2032\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Passive Sensors\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\", ship, fleet);\n\t}\n},\n//Enhanced Thrusters\n\"tech:AP2033\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Enhanced Thrusters\") && (ship.class == \"K'Vort Class\" || ship.class == \"B'Rel Class\");\n\t},\n\tcanEquipFaction: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"klingon\",ship,fleet);\n\t}\n},\n//+1 Elite Talent Slot\n\t\"talent:AE002\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"klingon\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 1, { type: [\"talent\"] } )\n\t},\n//+2 Elite Talent Slots\n\t\"talent:AE005\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"klingon\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 2, { type: [\"talent\"] } )\n\t},\n//+3 Elite Talent Slots\n\t\"talent:AE008\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"klingon\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 3, { type: [\"talent\"] } )\n\t},\n//+1 Upgrade Slots\n\t\"question:AQ002\":{\n\t\tcanEquip: onePerShip(\"Upgrade Slots\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ($factions.hasFaction(ship.captain,\"klingon\", ship, fleet))\n\t\t},\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >= 0 || $.inArray(\"weapon\", slotTypes) >= 0;\n\t\t},\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n//+2 Upgrade Slots\n\"question:AQ005\":{\n\tcanEquip: onePerShip(\"Upgrade Slots\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ($factions.hasFaction(ship.captain,\"klingon\", ship, fleet))\n\t},\n\tisSlotCompatible: function(slotTypes) {\n\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >= 0 || $.inArray(\"weapon\", slotTypes) >= 0;\n\t},\n\tupgradeSlots: [\n\t\t{\n\t\t\ttype: function(upgrade,ship) {\n\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\ttype: [\"tech\",\"weapon\",\"crew\"],\n\t\t},\n\t\t{\n\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t}\n\t]\n},\n\n//Alliance Part III: Romulan //\n\n//Valdore Class\n\"ship:AS0029\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0020\" || captain.id == \"AC0021\" || captain.id == \"AC0022\" || captain.id == \"AC0023\" || captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Valdore Class\n\"ship:AS0030\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0020\" || captain.id == \"AC0021\" || captain.id == \"AC0022\" || captain.id == \"AC0023\" || captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n//D'Deridx Class\n\"ship:AS0031\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0021\" || captain.id == \"AC0022\" || captain.id == \"AC0023\" || captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n//D'Deridx Class\n\"ship:AS0032\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0021\" || captain.id == \"AC0022\" || captain.id == \"AC0023\" || captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n//D'Deridx Class\n\"ship:AS0033\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0021\" || captain.id == \"AC0022\" || captain.id == \"AC0023\" || captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n//D'Deridx Class\n\"ship:AS0034\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0021\" || captain.id == \"AC0022\" || captain.id == \"AC0023\" || captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Reman Warbird\n\"ship:AS0035\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n//Reman Warbird\n\"ship:AS0036\": {\nintercept: {\n\tship: {\n\t\tcanEquipCaptain: function(captain,ship,fleet) {\n\t\t\t\treturn captain.id == \"AC0024\";\n\t\t\t}\n\t\t}\n\t}\n},\n\n\"captain:AC0017\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n\"captain:AC0018\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n\"captain:AC0019\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n\"captain:AC0020\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n\"captain:AC0021\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n\"captain:AC0022\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n\"captain:AC0023\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n\"captain:AC0024\": {\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn $factions.hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n},\n//+1 Elite Talent Slot\n\t\"talent:AE003\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"romulan\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 1, { type: [\"talent\"] } )\n\t},\n//+2 Elite Talent Slots\n\t\"talent:AE006\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"romulan\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 2, { type: [\"talent\"] } )\n\t},\n//+3 Elite Talent Slots\n\t\"talent:AE009\":{\n\t\tcanEquip: onePerShip(\"Talent Slot\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ( $factions.hasFaction(ship.captain,\"romulan\", ship, fleet))\n\t\t},\n\t\tupgradeSlots: cloneSlot( 3, { type: [\"talent\"] } )\n\t},\n//+1 Upgrade Slots\n\t\"question:AQ003\":{\n\t\tcanEquip: onePerShip(\"Upgrade Slots\") && function(upgrade,ship,fleet){\n\t\t\treturn ship.captain && ($factions.hasFaction(ship.captain,\"romulan\", ship, fleet))\n\t\t},\n\t\tisSlotCompatible: function(slotTypes) {\n\t\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >= 0 || $.inArray(\"weapon\", slotTypes) >= 0;\n\t\t},\n\t\tupgradeSlots: [\n\t\t\t{\n\t\t\t\ttype: function(upgrade,ship) {\n\t\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t\t}\n\t\t]\n\t},\n//+2 Upgrade Slots\n\"question:AQ006\":{\n\tcanEquip: onePerShip(\"Upgrade Slots\") && function(upgrade,ship,fleet){\n\t\treturn ship.captain && ($factions.hasFaction(ship.captain,\"romulan\", ship, fleet))\n\t},\n\tisSlotCompatible: function(slotTypes) {\n\t\treturn $.inArray(\"tech\", slotTypes) >= 0 || $.inArray(\"crew\", slotTypes) >= 0 || $.inArray(\"weapon\", slotTypes) >= 0;\n\t},\n\tupgradeSlots: [\n\t\t{\n\t\t\ttype: function(upgrade,ship) {\n\t\t\t\treturn getSlotType(upgrade,ship);\n\t\t\t}\n\t\t},\n\t\t{\n\t\t\ttype: [\"tech\",\"weapon\",\"crew\"],\n\t\t},\n\t\t{\n\t\t\ttype: [\"tech\",\"weapon\",\"crew\"]\n\t\t}\n\t]\n},\n\n//Engineer\n\"crew:AP3001\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Engineer\");\n\t}\n},\n\n//Cunning\n\"talent:AP3002\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Cunning\");\n\t}\n},\n\n//Disruptor Sweep\n\"weapon:AP3003\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Disruptor Sweep\");\n\t}\n},\n\n//Thruster Efficiency\n\"tech:AP3004\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Thruster Efficiency\") && (ship.class == \"K'Vort Class\" || ship.class == \"B'Rel Class\");\n\t}\n},\n\n//Helmsman\n\"crew:AP3006\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Helmsman\");\n\t}\n},\n\n//Engineer\n\"crew:AP3007\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Engineer\");\n\t}\n},\n\n//Science Officer\n\"crew:AP3009\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Science Officer\");\n\t}\n},\n\n//Sub-Commander\n\"crew:AP3010\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Sub-Commander\");\n\t}\n},\n\n//Tactical Officer\n\"crew:AP3014\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Tactical Officer\");\n\t}\n},\n\n//Ops Officer\n\"crew:AP3011\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Ops Officer\");\n\t}\n},\n\n//Suspicious\n\"talent:AP3015\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Suspicious\");\n\t}\n},\n\n//Opportunistic\n\"talent:AP3016\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Opportunistic\");\n\t}\n},\n\n//Ambush Tactics\n\"talent:AP3019\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Suspicious\") && function(upgrade,ship,fleet){\n\t\t\treturn hasFaction(ship,\"romulan\",ship,fleet);\n\t\t}\n\t}\n},\n\n//Heavy Disruptor\n\"weapon:AP3020\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Heavy Disruptor\") && (ship.class == \"D'deridex Class\");\n\t}\n},\n\n//Heavy Plasma Torpedo\n\"weapon:AP3021\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Heavy Plasma Torpedo\") && (ship.class == \"D'deridex Class\");\n\t}\n},\n\n//Ventral Disruptors\n\"weapon:AP3022\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Ventral Disruptors\");\n\t}\n},\n\n//Integrated Cloak\n\"weapon:AP3023\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Integrated Cloak\") && function(upgrade,ship,fleet) {\n\t\t\treturn hasFaction(ship,\"romulan\",ship,fleet);\n\t\t}\n\t}\n},\n\n//Ventral Thrusters\n\"tech:AP3026\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Ventral Thrusters\");\n\t}\n},\n\n//Muon Feedback Beam\n\"tech:AP3027\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Muon Feedback Beam\");\n\t}\n},\n\n//Plasma Coil Overcharge\n\"tech:AP3030\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn onePerShip(\"Plasma Coil Overcharge\");\n\t}\n},\n\n//Deep Cloak\n\"tech:AP3031\":{\n\tcanEquip: function(upgrade,ship,fleet) {\n\t\treturn hasFaction(ship,\"romulan\",ship,fleet);\n\t}\n}\n\n\n\n\t};\n}]);\n","var module = angular.module(\"utopia-card-ship-class\", []);\n\nmodule.directive( \"cardShipClass\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tshipClass: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-ship-class.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\t\t\t\n\t\t\t$scope.abs = Math.abs;\n\t\t\t\n\t\t\t$scope.speeds = [];\n\t\t\t\n\t\t\tvar m = $scope.shipClass.maneuvers;\n\t\t\t\n\t\t\tfor( var speed = m.max; speed >= m.min; speed-- ) {\n\t\t\t\tif( speed != 0 || m[\"0\"] )\n\t\t\t\t\t$scope.speeds.push(speed);\n\t\t\t}\n\t\t\t\n\t\t\tif( $scope.speeds.length < 7 && m.min > -2 )\n\t\t\t\t$scope.speeds.push(9);\n\t\t\tif( $scope.speeds.length < 7 && m.min > -1 )\n\t\t\t\t$scope.speeds.push(9);\n\t\t\t\n\t\t\twhile( $scope.speeds.length < 7 )\n\t\t\t\t$scope.speeds.unshift(9);\n\t\t\t\n\t\t\t$scope.getBaseTileName = function(ship) {\n\t\t\t\treturn ship.unique ? ship.name : ship.class;\n\t\t\t}\n\t\t\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-ship\", []);\n\nmodule.directive( \"cardShip\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-ship.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-token\", []);\n\nmodule.directive( \"cardToken\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\ttoken: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-token.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card-upgrade\", []);\n\nmodule.directive( \"cardUpgrade\", function() {\n\n\treturn {\n\n\t\tscope: {\n\t\t\tupgrade: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"=\"\n\t\t},\n\n\t\ttemplateUrl: \"card-upgrade.html\",\n\n\t\tcontroller: [ \"$scope\", function($scope) {\n\n\t\t\t$scope.range = function(size) {\n\t\t\t\treturn new Array(size);\n\t\t\t};\n\t\t\t\n\t\t\t$scope.isDefined = function(value) {\n\t\t\t\treturn value !== undefined;\n\t\t\t};\n\t\t\n\t\t}]\n\n\t};\n\n} );","var module = angular.module(\"utopia-card\", [\"utopia-tooltip\", \"utopia-card-ship\", \"utopia-card-ship-class\", \"utopia-card-upgrade\", \"utopia-card-resource\", \"utopia-dragdrop\", \"utopia-valueof\"]);\n\nmodule.directive( \"card\", function() {\n\t\n\treturn  {\n\t\t\n\t\tscope: {\n\t\t\tcard: \"=\",\n\t\t\tship: \"=\",\n\t\t\tfleet: \"=\",\n\t\t\tdragStore: \"=\",\n\t\t\tdragSource: \"@\",\n\t\t},\n\t\t\n\t\trestrict: \"E\",\n\t\t\n\t\ttemplateUrl: \"card.html\",\n\t\t\n\t};\n\t\n} );\n\nmodule.filter( \"icons\", function() {\n\n\treturn function( text ) {\n\t\treturn text.replace( /\\[([^\\]]*)\\]/g, \"<i class='fs fs-$1'></i>\" ).replace( /\\n/g, \"<br/>\" );\n\t};\n\n});","angular.module('utopia').run(['$templateCache', function($templateCache) {\n  'use strict';\n\n  $templateCache.put('fleet-builder.html',\n    \"<div class=\\\"fleet-open-export\\\" ng-show=\\\"!searchOptions.showExport\\\">\\n\" +\n    \"\t<button class=\\\"fleet-search-bigger\\\" ng-click=\\\"searchOptions.showExport = true\\\"><i class=\\\"fa fa-chevron-left\\\"></i> Export</button>\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"fleet-open-search\\\" ng-show=\\\"searchOptions.columns < 1\\\">\\n\" +\n    \"\t<button class=\\\"fleet-search-bigger\\\" ng-click=\\\"searchOptions.columns = 1\\\">Search <i class=\\\"fa fa-chevron-right\\\"></i></button>\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"fleet-ship-container\\\" ng-repeat=\\\"ship in fleet.ships track by $index\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"fleet-ship-top\\\">\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-left\\\" ng-class=\\\"{'fleet-ship-top-left-first':$first}\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-title font-staw\\\" ng-class=\\\"{'fleet-ship-title-long': ship.name.length >= 18, 'fleet-ship-title-longer': ship.name.length >= 21}\\\">{{ ship.name }}</div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-spacer\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-title fleet-ship-cost font-staw\\\">{{ getTotalCost(ship,fleet) }} SP</div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-spacer\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-spacer\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"toggle-button-value pull-left\\\" ng-class=\\\"{'toggle-button-value-active': !ship.hideEmptySlots}\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-title fleet-ship-cost font-staw\\\">\\n\" +\n    \"\t\t\t<button class=\\\"title-button\\\" ng-click=\\\"ship.hideEmptySlots = !ship.hideEmptySlots\\\">Show Empty Slots</button>\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-right\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\t<div class=\\\"fleet-ship-middle\\\">\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-left\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-inner\\\">\\n\" +\n    \"\\n\" +\n    \"\t\t\t<div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\">\\n\" +\n    \"\t\t\t\t<card card=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div><!--\\n\" +\n    \"\t\t\tStupid whitespace breaks card alignment\\n\" +\n    \"\t\t --><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\">\\n\" +\n    \"\t\t\t\t<card card=\\\"ship.classData\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div><!--\\n\" +\n    \"\t\t --><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-show=\\\"!ship.squadron && fleet.resource && (fleet.resource|valueOf:'showShipResourceSlot':ship:fleet)\\\" droppable can-drop=\\\"$item.type == fleet.resource.slotType\\\" drop=\\\"setShipResource(fleet,ship,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes([fleet.resource.slotType])\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t<div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t\t\t<i class=\\\"fs fs-{{fleet.resource.slotType}}\\\"></i><br/>{{fleet.resource.slotType|removeDashes}}\\n\" +\n    \"\t\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t<card card=\\\"ship.resource\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div><!--\\n\" +\n    \"\\n\" +\n    \"\t\t --><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-hide=\\\"ship.squadron\\\" droppable can-drop=\\\"$item.type == 'captain' && $item != ship.captain\\\" drop=\\\"setShipCaptain(fleet,ship,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(['captain'])\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t<div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t\t\t<i class=\\\"fs fs-captain\\\"></i><br/>Captain\\n\" +\n    \"\t\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t<card card=\\\"ship.captain\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div><!--\\n\" +\n    \"\\n\" +\n    \"\t\t --><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-hide=\\\"!ship.admiral && ( ship.squadron || ship.hideEmptySlots || fleetHasAdmiral(fleet) )\\\"\\n\" +\n    \"\t\t\t\tdroppable can-drop=\\\"$item.type == 'admiral' && $item != ship.admiral\\\" drop=\\\"setShipAdmiral(fleet,ship,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(['admiral'])\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t<div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t\t\t<i class=\\\"fs fs-admiral\\\"></i><br/>Admiral\\n\" +\n    \"\t\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t<card card=\\\"ship.admiral\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div><!--\\n\" +\n    \"\\n\" +\n    \"\t\t\t--><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-hide=\\\"!ship.ambassador && ( ship.squadron || ship.hideEmptySlots || fleetHasAmbassador(fleet) )\\\"\\n\" +\n    \"\t\t\t\t droppable can-drop=\\\"$item.type == 'ambassador' && $item != ship.ambassador\\\" drop=\\\"setShipAmbassador(fleet,ship,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t <div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(['ambassador'])\\\">\\n\" +\n    \"\t\t\t\t\t <div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t <div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t\t\t <i class=\\\"fs fs-ambassador\\\"></i><br/>Ambassador\\n\" +\n    \"\t\t\t\t\t\t </div>\\n\" +\n    \"\t\t\t\t\t </div>\\n\" +\n    \"\t\t\t\t </div>\\n\" +\n    \"\t\t\t\t <card card=\\\"ship.ambassador\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t </div>\\n\" +\n    \"\t\t\t <!--\\n\" +\n    \"\t\t\t--><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-hide=\\\"!ship.construction && ( ship.squadron || ship.hideEmptySlots )\\\"\\n\" +\n    \"\t\t\tdroppable can-drop=\\\"$item.type == 'starship_construction' && $item != ship.starship_construction\\\" drop=\\\"setShipConstruction(fleet,ship,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(['starship_construction'])\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t\t<i class=\\\"fs fs-starship_construction\\\"></i><br/>Starship Construction\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t\t<card card=\\\"ship.construction\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t</div><!--\\n\" +\n    \"\\n\" +\n    \"\t\t--><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-mouseenter=\\\"hover = true\\\" ng-mouseleave=\\\"hover = false\\\"\\n\" +\n    \"\t\t\t\tng-repeat=\\\"upgradeSlot in ship|upgradeSlots\\\" ng-hide=\\\"!upgradeSlot.occupant && (ship.hideEmptySlots || (upgradeSlot|valueOf:'hide':ship:fleet))\\\"\\n\" +\n    \"\t\t\t\tdroppable can-drop=\\\"isUpgradeCompatible($item, upgradeSlot, ship, fleet)\\\" drop=\\\"setUpgrade(fleet,ship,upgradeSlot,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(upgradeSlot.type)\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-title\\\" ng-class=\\\"{'card-drop-target-title-hover':hover || upgradeSlot.occupant == dragStore.item}\\\" ng-show=\\\"upgradeSlot.source && upgradeSlot.source != 'ship'\\\">{{upgradeSlot.source}}<div ng-show=\\\"upgradeSlot.rules\\\">{{upgradeSlot.rules}}</div></div>\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t<div class=\\\"card-drop-target-type\\\" ng-repeat=\\\"type in upgradeSlot|valueOf:'type':ship:fleet\\\">\\n\" +\n    \"\t\t\t\t\t\t\t<i class=\\\"fs fs-{{type}}\\\"></i><br/>{{type|removeDashes}}\\n\" +\n    \"\t\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t<div class=\\\"card-drop-target-subtitle\\\">{{upgradeSlot|valueOf:'show':ship:fleet}}</div>\\n\" +\n    \"\t\t\t\t<card card=\\\"upgradeSlot.occupant\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"fleet-ship-bottom\\\" ng-show=\\\"$last && searchOptions.columns < 1 && !fleet.resource\\\">\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-bottom-left\\\" ng-class=\\\"{'fleet-ship-bottom-left-long': fleet.ships.length > 0 || fleet.resource}\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"fleet-ship-container\\\" ng-hide=\\\"loading || ( searchOptions.columns < 1 && !fleet.resource )\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"fleet-ship-top\\\">\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-left\\\" ng-class=\\\"{'fleet-ship-top-left-first': fleet.ships.length == 0}\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-title font-staw\\\">Fleet Total</div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-spacer\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-title fleet-ship-cost font-staw\\\">{{ getFleetCost(fleet) }} SP</div>\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-top-right\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"fleet-ship-middle\\\">\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-left\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-inner\\\">\\n\" +\n    \"\\n\" +\n    \"\t\t\t<div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-hide=\\\"searchOptions.columns < 1\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(['ship'])\\\"\\n\" +\n    \"\t\t\t\t\tdroppable can-drop=\\\"$item.type == 'ship'\\\" drop=\\\"addFleetShip(fleet,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-title\\\" ng-if=\\\"!isMobile\\\">Click to search this card type</div>\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-title\\\" ng-if=\\\"isMobile\\\">Tap to search this card type</div>\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t<div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t\t\t<i class=\\\"fs fs-ship\\\"></i><br/>Ship\\n\" +\n    \"\t\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t<div ng-show=\\\"!isMobile\\\" class=\\\"card-drop-target-subtitle\\\">Drag here to add to fleet</div>\\n\" +\n    \"\t\t\t\t\t<div ng-show=\\\"isMobile && (!dragStore.item || dragStore.item.type != 'ship')\\\" class=\\\"card-drop-target-subtitle\\\">Tap a ship card to select it</div>\\n\" +\n    \"\t\t\t\t\t<div ng-show=\\\"isMobile && dragStore.item && dragStore.item.type == 'ship'\\\" class=\\\"card-drop-target-subtitle\\\">Tap here to add selected ship to fleet</div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t</div><!--\\n\" +\n    \"\\n\" +\n    \"\t\t\t--><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" droppable can-drop=\\\"$item.type == 'resource' && $item != fleet.resource\\\" drop=\\\"setFleetResource(fleet,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(['resource'])\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-title\\\"></div>\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t<div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t\t\t<i class=\\\"fs fs-resource\\\"></i><br/>Resource\\n\" +\n    \"\t\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-subtitle\\\"></div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t<card card=\\\"fleet.resource\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div><!--\\n\" +\n    \"\\n\" +\n    \"\t\t\t--><div class=\\\"card-container\\\" ng-class=\\\"{'zoom':zoom}\\\" ng-repeat=\\\"upgradeSlot in fleet.resource.upgradeSlots\\\"\\n\" +\n    \"\t\t\t\tdroppable can-drop=\\\"isUpgradeCompatible($item, upgradeSlot) && $item != upgradeSlot.occupant\\\" drop=\\\"setUpgrade(fleet,fleet.resource,upgradeSlot,$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-outer card-drop-target font-staw\\\" ng-click=\\\"setSearchTypes(upgradeSlot.type)\\\">\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-title\\\">{{upgradeSlot.source}}<div ng-show=\\\"upgradeSlot.rules\\\">{{upgradeSlot.rules}}</div></div>\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t\t\t<div class=\\\"card-drop-target-type\\\" ng-repeat=\\\"type in upgradeSlot.type\\\">\\n\" +\n    \"\t\t\t\t\t\t\t<i class=\\\"fs fs-{{type}}\\\"></i><br/>{{type|removeDashes}}\\n\" +\n    \"\t\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t\t<div class=\\\"card-drop-target-subtitle\\\"></div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t\t<card card=\\\"upgradeSlot.occupant\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\" drag-store=\\\"dragStore\\\"></card>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"fleet-ship-bottom\\\">\\n\" +\n    \"\t\t<div class=\\\"fleet-ship-bottom-left fleet-ship-bottom-left-long\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('fleet-export.html',\n    \"<div class=\\\"fleet-close-export\\\" ng-show=\\\"searchOptions.showExport\\\">\\n\" +\n    \"\t<button class=\\\"fleet-search-bigger\\\" ng-click=\\\"searchOptions.showExport = false\\\"><i class=\\\"fa fa-chevron-right\\\"></i> Export</button>\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div class=\\\"export-container\\\">\\n\" +\n    \"\t<div class=\\\"u-search-header\\\"><div class=\\\"u-search-header-text\\\">Copy Text Listing</div></div>\\n\" +\n    \"\t<label class=\\\"export-option\\\"><input type=\\\"checkbox\\\" ng-model=\\\"showSetNames\\\">Include Expansion Names</label>\\n\" +\n    \"\t<!-- New checkbox here for the table-top simulator option. -->\\n\" +\n    \"\t<label class=\\\"export-option\\\"><input type=\\\"radio\\\" ng-model=\\\"exportType\\\" value=\\\"traditional\\\">Traditional Export</label>\\n\" +\n    \"\t<label class=\\\"export-option\\\"><input type=\\\"radio\\\" ng-model=\\\"exportType\\\" value=\\\"tts\\\">Table-Top Sim Export</label>\\n\" +\n    \"\t<!-- <label class=\\\"export-option\\\"><input type=\\\"radio\\\" ng-model=\\\"exportType\\\" value=\\\"fleetSheet\\\">Export JSON for Fleet Sheet</label> -->\\n\" +\n    \"\t<textarea class=\\\"export-text\\\" ng-model=\\\"fleetText\\\"></textarea>\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('fleet-list.html',\n    \"<div class=\\\"container-fluid\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"row\\\" >\\n\" +\n    \"\t\t<div class=\\\"col-md-4\\\">\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"</div>\"\n  );\n\n\n  $templateCache.put('search-filter-group.html',\n    \"<div class=\\\"u-search-header\\\" ng-click=\\\"showContent = !showContent\\\"><div class=\\\"u-search-header-text\\\">{{title}}</div></div>\\n\" +\n    \"<div class=\\\"u-search-content\\\" ng-show=\\\"showContent\\\" ng-transclude></div>\"\n  );\n\n\n  $templateCache.put('search.html',\n    \"<div class=\\\"u-search\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"search-query-container\\\">\\n\" +\n    \"\t\t<input class=\\\"u-search-query\\\" ng-model=\\\"search.query\\\" placeholder=\\\"Search\\\" spellcheck=\\\"false\\\" autocorrect=\\\"off\\\">\\n\" +\n    \"\t\t<button ng-click=\\\"resetSearch()\\\">Reset</button>\\n\" +\n    \"\t\t<button ng-click=\\\"showAdvanced = !showAdvanced\\\">Advanced</button>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div ng-show=\\\"showAdvanced && (!dragStore.item || dragStore.source == 'search')\\\">\\n\" +\n    \"\\n\" +\n    \"\t\t<div class=\\\"u-search-size\\\">\\n\" +\n    \"\t\t\t<button class=\\\"u-search-smaller\\\" ng-click=\\\"modifySearchColumns(-1)\\\"><i class=\\\"fa fa-chevron-left\\\"></i></button>\\n\" +\n    \"\t\t\t<div class=\\\"u-search-size-text\\\">Resize Search Results</div>\\n\" +\n    \"\t\t\t<button class=\\\"u-search-bigger\\\" ng-click=\\\"modifySearchColumns(1)\\\"><i class=\\\"fa fa-chevron-right\\\"></i></button>\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\\n\" +\n    \"\t\t<search-filter-group title=\\\"Faction\\\" open>\\n\" +\n    \"\t\t\t<span ng-repeat=\\\"(faction,data) in search.factions\\\">\\n\" +\n    \"\t\t\t\t<label class=\\\"u-label\\\"><input type=\\\"checkbox\\\" ng-model=\\\"data.search\\\" > <div class=\\\"u-faction card-faction-{{faction}}\\\"></div> {{faction|removeDashes}}</label>\\n\" +\n    \"\t\t\t</span>\\n\" +\n    \"\t\t</search-filter-group>\\n\" +\n    \"\\n\" +\n    \"\t\t<search-filter-group title=\\\"Type\\\" open>\\n\" +\n    \"\t\t\t<span class=\\\"u-search-type\\\" ng-repeat=\\\"(type,data) in search.types\\\">\\n\" +\n    \"\t\t\t\t<label class=\\\"u-label\\\"><input type=\\\"checkbox\\\" ng-model=\\\"data.search\\\" > <i class=\\\"fs fs-{{type}}\\\"></i> {{type|removeDashes}}</label>\\n\" +\n    \"\t\t\t</span>\\n\" +\n    \"\t\t</search-filter-group>\\n\" +\n    \"\\n\" +\n    \"\t\t<search-filter-group title=\\\"Uniqueness\\\" open>\\n\" +\n    \"\t\t\t<span>\\n\" +\n    \"\t\t\t\t<label class=\\\"u-label\\\"><input type=\\\"checkbox\\\" ng-model=\\\"search.unique\\\"> <i class=\\\"fs fs-unique\\\"></i> Unique</label>\\n\" +\n    \"\t\t\t</span>\\n\" +\n    \"\t\t\t<span>\\n\" +\n    \"\t\t\t\t<label class=\\\"u-label\\\"><input type=\\\"checkbox\\\" ng-model=\\\"search.generic\\\"> <i class=\\\"fs\\\"></i> Generic</label>\\n\" +\n    \"\t\t\t</span>\\n\" +\n    \"\t\t</search-filter-group>\\n\" +\n    \"\\n\" +\n    \"\t\t<search-filter-group title=\\\"Order By\\\" open>\\n\" +\n    \"\t\t\t<div class=\\\"u-search-filter-comment\\\">\\n\" +\n    \"\t\t\t\tOrder results by <select ng-model=\\\"search.sortBy\\\" ng-options=\\\"sortable.value as sortable.name for sortable in sortables\\\"></select>\\n\" +\n    \"\t\t\t\t<select ng-model=\\\"search.ascending\\\"><option value=\\\"true\\\">Ascending</option><option value=\\\"false\\\">Descending</option></select>\\n\" +\n    \"\t\t\t\t<div class=\\\"u-order-default\\\" ng-show=\\\"search.sortBy != defaults.search.sortBy || search.ascending != defaults.search.ascending\\\">\\n\" +\n    \"\t\t\t\t\t<button ng-click=\\\"defaults.search.sortBy = search.sortBy; defaults.search.ascending = search.ascending\\\">Set as Default</button>\\n\" +\n    \"\t\t\t\t\t<div>Default order is saved in browser for future sessions.</div>\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t</search-filter-group>\\n\" +\n    \"\\n\" +\n    \"\t\t<search-filter-group title=\\\"Custom Filter\\\" open>\\n\" +\n    \"\t\t\t<div class=\\\"u-search-filter-comment\\\" ng-init=\\\"search.filterOperator = '<'\\\">\\n\" +\n    \"\t\t\t\t<select ng-model=\\\"search.filterField\\\"><option value=\\\"\\\">- No Filter -</option><option ng-repeat=\\\"sortable in sortables\\\" value=\\\"{{sortable.value}}\\\">{{sortable.name}}</option></select>\\n\" +\n    \"\t\t\t\t<select ng-model=\\\"search.filterOperator\\\"><option value=\\\"<\\\">&lt;</option><option value=\\\"<=\\\">&lt;=</option><option value=\\\"=\\\">=</option><option value=\\\">=\\\">&gt;=</option><option value=\\\">\\\">&gt;</option></select>\\n\" +\n    \"\t\t\t\t<input ng-model=\\\"search.filterValue\\\" placeholder=\\\"Value\\\"></input>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t\t<div class=\\\"u-search-filter-comment\\\">\\n\" +\n    \"\t\t\t\tFilter On Maneuver: <select ng-model=\\\"search.maneuverType\\\"><option value=\\\"\\\">Any</option><option ng-repeat=\\\"maneuver in maneuvers\\\" value=\\\"{{maneuver.value}}\\\">{{maneuver.name}}</option></select>\\n\" +\n    \"\t\t\t\t<select ng-model=\\\"search.maneuverDifficulty\\\"><option value=\\\"\\\">Any</option><option ng-repeat=\\\"difficulty in difficulty_list\\\" value=\\\"{{difficulty.value}}\\\">{{difficulty.name}}</option></select>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t</search-filter-group>\\n\" +\n    \"\\n\" +\n    \"\t\t<search-filter-group title=\\\"Owned Expansions\\\">\\n\" +\n    \"\t\t  <div class=\\\"u-search-filter-comment\\\">\\n\" +\n    \"\t\t    Expansion filter settings are stored in your browser for future sessions. Uncheck the expansions you don't own. New expansions are automatically checked. These settings are not affected by the \\\"Reset\\\" button.\\n\" +\n    \"\t\t  </div>\\n\" +\n    \"\t\t  <div class=\\\"u-search-filter-comment\\\">\\n\" +\n    \"\t\t    <label class=\\\"u-label\\\"><input type=\\\"checkbox\\\" ng-model=\\\"search.ignoreSetsFilter\\\"> Temporarily show all cards</label>\\n\" +\n    \"\t\t  </div>\\n\" +\n    \"\t\t  <button ng-click=\\\"uncheckAllSets()\\\">Uncheck all sets</button>\\n\" +\n    \"\t\t  <button ng-click=\\\"checkAllSets()\\\">Check all sets</button>\\n\" +\n    \"\t\t  <button ng-click=\\\"exportSets()\\\">Export Sets</button>\\n\" +\n    \"\t\t  <div class=\\\"u-search-filter-comment\\\">Import Sets...</div>\\n\" +\n    \"\t\t  <input type=\\\"file\\\" multiple onchange=\\\"angular.element(this).scope().importSets(this)\\\">\\n\" +\n    \"\t\t  <div ng-repeat=\\\"set in setList | orderBy:'-releaseDate'\\\" class=\\\"u-search-set\\\" ng-hide=\\\"search.ignoreSetsFilter\\\">\\n\" +\n    \"\t\t    <label class=\\\"u-label\\\"><input type=\\\"checkbox\\\" ng-model=\\\"search.sets[set.id].search\\\" ng-init=\\\"search.sets[set.id].search === (set.name === 'Builder') ? false : true\\\"> {{set.parentSet}}: {{set.name}}</label>\\n\" +\n    \"\t\t  </div>\\n\" +\n    \"\t\t</search-filter-group>\\n\" +\n    \"\\n\" +\n    \"\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\" +\n    \"\\n\" +\n    \"<div ng-init=\\\"resultLimit = 10\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"u-loading\\\" ng-show=\\\"loading\\\">Loading cards...</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-container\\\" ng-show=\\\"dragStore.item && dragStore.source != 'search'\\\" droppable can-drop=\\\"true\\\" drop=\\\"$emit('removeFromFleetDropped',$item)\\\" drag-store=\\\"dragStore\\\">\\n\" +\n    \"\t\t<div class=\\\"card-outer card-drop-target font-staw\\\">\\n\" +\n    \"\t\t\t<div class=\\\"card-drop-target-inner\\\">\\n\" +\n    \"\t\t\t\t<div class=\\\"card-drop-target-type\\\">\\n\" +\n    \"\t\t\t\t\t<i class=\\\"fs fs-captain\\\"></i><br/>Remove From Fleet\\n\" +\n    \"\t\t\t\t</div>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div ng-hide=\\\"dragStore.item && dragStore.source != 'search'\\\">\\n\" +\n    \"\\n\" +\n    \"\t\t<div class=\\\"card-container\\\" ng-repeat=\\\"card in cards | cardFilter:search | sortBy:search.sortBy:search.ascending | limitTo:resultLimit*search.columns\\\">\\n\" +\n    \"\t\t\t<card card=\\\"card\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"search\\\"></card>\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\\n\" +\n    \"\t\t<div>\\n\" +\n    \"\t\t\t<button class=\\\"u-show-more\\\" ng-hide=\\\"loading\\\" ng-click=\\\"resultLimit = resultLimit + 10\\\">Show More</button>\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('card-faction.html',\n    \"<div class=\\\"card-outer card-faction font-staw\\\" ng-class=\\\"{ 'dragging': faction == dragStore.item }\\\" draggable drag-item=\\\"faction\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-faction-image card-faction-{{faction.factions[0]}}\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-faction-name\\\">{{faction.name | uppercase}}</div>\\n\" +\n    \"\\n\" +\n    \"</div>\"\n  );\n\n\n  $templateCache.put('card-resource.html',\n    \"<div class=\\\"card-outer card-resource font-staw\\\" ng-class=\\\"{ 'dragging': resource == dragStore.item }\\\" draggable drag-item=\\\"resource\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-resource-header\\\">\\n\" +\n    \"\t\t<span class=\\\"card-title\\\" ng-class=\\\"{'card-title-long': resource.name.length > 20}\\\">{{resource.name | uppercase}}<span ng-hide=\\\"resource.hideCost\\\"> ({{resource|valueOf:'cost':ship:fleet}} SP)</span></span>\\n\" +\n    \"\t\t\\n\" +\n    \"\t</div>\\n\" +\n    \"\t\\n\" +\n    \"\t<div class=\\\"card-resource-header pull-right\\\">\\n\" +\n    \"\t\t<i ng-if=\\\"resource.opBanned\\\" class=\\\"card-OP-banned-icon fs fs-opBanned\\\"></i>\\n\" +\n    \"\t</div>\\n\" +\n    \"\t\\n\" +\n    \"\t<div class=\\\"card-text\\\">\\n\" +\n    \"\t\t<div class=\\\"card-text-inner font-staw-alt\\\" ng-bind-html=\\\"resource.text | icons\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"</div>\"\n  );\n\n\n  $templateCache.put('card-ship-class.html',\n    \"<div class=\\\"card-outer card-ship card-shipclass font-staw\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-shipclass-arcs arc-faction-{{ship.factions[0]}}\\\">\\n\" +\n    \"\t\t<div class=\\\"arc arc-fill arc-fore-90\\\" ng-show=\\\"shipClass.frontArc == 90\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"arc arc-fill arc-fore-180\\\" ng-show=\\\"shipClass.frontArc == 180\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"arc arc-rear-90\\\" ng-show=\\\"shipClass.rearArc == 90\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"arc-hole\\\"></div>\\n\" +\n    \"\t\t<div class=\\\"arc-name\\\">{{getBaseTileName(ship)}}</div>\\n\" +\n    \"\t\t<div class=\\\"arc-stats\\\">\\n\" +\n    \"\t\t\t<div class=\\\"arc-stat card-ship-stat-attack text-center\\\">{{ship|valueOf:'attack':ship:fleet}}</div>\\n\" +\n    \"\t\t\t<div class=\\\"arc-stat card-ship-stat-agility text-center\\\">{{ship|valueOf:'agility':ship:fleet}}</div>\\n\" +\n    \"\t\t\t<div class=\\\"arc-stat card-ship-stat-hull text-center\\\">{{ship|valueOf:'hull':ship:fleet}}</div>\\n\" +\n    \"\t\t\t<div class=\\\"arc-stat card-ship-stat-shields text-center\\\">{{ship|valueOf:'shields':ship:fleet}}</div>\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\t\t<div class=\\\"arc-actions\\\"><i ng-repeat=\\\"action in ship.actions\\\" class=\\\"fs fs-{{action}}\\\"></i></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<!-- <div class=\\\"card-image\\\" ng-class=\\\"{'card-image-large': Object.keys(shipClass.maneuvers).length > 9}\\\"></div> -->\\n\" +\n    \"\t<div ng-class=\\\"(shipClass.id == 'borg_cube' || shipClass.id == 'kelvin_constitution_class') ? 'card-image-large' : 'card-image'\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-corner-top-left pull-left\\\">\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner pull-right\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\t<div class=\\\"card-corner-top-right pull-right\\\">\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner card-corner-inner-faction\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\t<div class=\\\"card-title-container text-center\\\">\\n\" +\n    \"\t\t<span class=\\\"card-shipclass-title\\\" ng-class=\\\"{'card-title-long': shipClass.name.length >= 20 }\\\">{{shipClass.name | uppercase}}</span>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div ng-class=\\\"(shipClass.id == 'borg_cube' || shipClass.id == 'kelvin_constitution_class') ? 'card-border-left-tall pull-left' : 'card-border-left pull-left'\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t<div ng-class=\\\"(shipClass.id == 'borg_cube' || shipClass.id == 'kelvin_constitution_class') ? 'card-border-right-tall pull-right' : 'card-border-right pull-right'\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t<div ng-class=\\\"(shipClass.id == 'borg_cube' || shipClass.id == 'kelvin_constitution_class') ? 'card-class-maneuvers-tall' : 'card-class-maneuvers'\\\">\\n\" +\n    \"\t\t<div class=\\\"card-maneuver-row\\\" ng-repeat=\\\"speed in speeds track by $index\\\">\\n\" +\n    \"\t\t\t<div class=\\\"card-maneuver-box\\\" ng-class=\\\"{'speed-reverse': speed < 0}\\\"><span ng-show=\\\"speed != 9\\\">{{abs(speed)}}</span></div>\\n\" +\n    \"\t\t\t<div class=\\\"card-maneuver-box\\\" ng-class=\\\"{'card-maneuver-box-highlight': shipClass.maneuvers[speed].turn || shipClass.maneuvers[speed]['90-degree-rotate']}\\\">\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-turn-left speed-{{shipClass.maneuvers[speed].turn}}\\\" ng-show=\\\"shipClass.maneuvers[speed].turn\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-90-rotate-left speed-{{shipClass.maneuvers[speed]['90-degree-rotate']}}\\\" ng-show=\\\"shipClass.maneuvers[speed]['90-degree-rotate']\\\"></i>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t\t<div class=\\\"card-maneuver-box\\\" ng-class=\\\"{'card-maneuver-box-highlight': shipClass.maneuvers[speed].bank || shipClass.maneuvers[speed].spin || shipClass.maneuvers[speed].flank || shipClass.maneuvers[speed]['45-degree-rotate']}\\\">\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-bank-left speed-{{shipClass.maneuvers[speed].bank}}\\\" ng-show=\\\"shipClass.maneuvers[speed].bank\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-spin-left speed-{{shipClass.maneuvers[speed].spin}}\\\" ng-show=\\\"shipClass.maneuvers[speed].spin\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-left-flank speed-{{shipClass.maneuvers[speed].flank}}\\\" ng-show=\\\"shipClass.maneuvers[speed].flank\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-45-rotate-left speed-{{shipClass.maneuvers[speed]['45-degree-rotate']}}\\\" ng-show=\\\"shipClass.maneuvers[speed]['45-degree-rotate']\\\"></i>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t\t<div class=\\\"card-maneuver-box\\\" ng-class=\\\"{'card-maneuver-box-highlight': shipClass.maneuvers[speed].straight || shipClass.maneuvers[speed].stop}\\\">\\n\" +\n    \"\t\t\t\t<i class=\\\"fs speed-{{shipClass.maneuvers[speed].straight}}\\\" ng-class=\\\"{'fs-forward': speed > 0, 'fs-reverse': speed < 0}\\\" ng-show=\\\"shipClass.maneuvers[speed].straight\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-stop speed-{{shipClass.maneuvers[speed].stop}}\\\" ng-show=\\\"shipClass.maneuvers[speed].stop\\\"></i>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t\t<div class=\\\"card-maneuver-box\\\" ng-class=\\\"{'card-maneuver-box-highlight': shipClass.maneuvers[speed].bank || shipClass.maneuvers[speed].spin || shipClass.maneuvers[speed].flank || shipClass.maneuvers[speed]['45-degree-rotate']}\\\">\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-bank-right speed-{{shipClass.maneuvers[speed].bank}}\\\" ng-show=\\\"shipClass.maneuvers[speed].bank\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-spin-right speed-{{shipClass.maneuvers[speed].spin}}\\\" ng-show=\\\"shipClass.maneuvers[speed].spin\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-right-flank speed-{{shipClass.maneuvers[speed].flank}}\\\" ng-show=\\\"shipClass.maneuvers[speed].flank\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-45-rotate-right speed-{{shipClass.maneuvers[speed]['45-degree-rotate']}}\\\" ng-show=\\\"shipClass.maneuvers[speed]['45-degree-rotate']\\\"></i>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t\t<div class=\\\"card-maneuver-box\\\" ng-class=\\\"{'card-maneuver-box-highlight': shipClass.maneuvers[speed].turn || shipClass.maneuvers[speed]['90-degree-rotate']}\\\">\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-turn-right speed-{{shipClass.maneuvers[speed].turn}}\\\" ng-show=\\\"shipClass.maneuvers[speed].turn\\\"></i>\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-90-rotate-right speed-{{shipClass.maneuvers[speed]['90-degree-rotate']}}\\\" ng-show=\\\"shipClass.maneuvers[speed]['90-degree-rotate']\\\"></i>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t\t<div class=\\\"card-maneuver-box\\\" ng-class=\\\"{'card-maneuver-box-highlight': shipClass.maneuvers[speed].about}\\\">\\n\" +\n    \"\t\t\t\t<i class=\\\"fs fs-come-about speed-{{shipClass.maneuvers[speed].about}}\\\" ng-show=\\\"shipClass.maneuvers[speed].about\\\"></i>\\n\" +\n    \"\t\t\t</div>\\n\" +\n    \"\t\t</div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-corner-bottom-left pull-left\\\">\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-corner-bottom-right pull-right\\\">\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-border-bottom\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t<div style=\\\"clear: both\\\"></div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('card-ship.html',\n    \"<div class=\\\"card-outer card-ship font-staw\\\" ng-class=\\\"{ 'card-unique': ship.unique, 'card-mirror': ship.mirror, 'dragging': ship == dragStore.item }\\\" draggable drag-item=\\\"ship\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-image\\\">\\n\" +\n    \"\t\t\t<img ng-if=\\\"ship.image\\\" ng-src=\\\"{{ship.image}}\\\" />\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-corner-top-left pull-left\\\"><i ng-if=\\\"ship.unique\\\" class=\\\"card-unique-icon fs fs-unique pull-left\\\"></i>\\n\" +\n    \"\t<div class=\\\"card-corner-top-left pull-left\\\"><i ng-if=\\\"ship.alliancelogo\\\" class=\\\"card-alliancelogo-icon fs fs-alliancelogo pull-left\\\"></i></div>\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner pull-right\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\t<div class=\\\"card-corner-top-right pull-right\\\"><i ng-repeat=\\\"faction in ship|valueOf:'factions':ship:fleet\\\" class=\\\"card-ship-faction card-faction-{{faction}} card-faction-{{$index}} fs fs-empty\\\" ng-class=\\\"{'card-factions-multiple': (ship|valueOf:'factions':ship:fleet).length > 1}\\\"></i>\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner card-corner-inner-faction\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\t<div class=\\\"card-title-container text-center\\\">\\n\" +\n    \"\t\t<span class=\\\"card-title\\\" ng-class=\\\"{'card-title-long': ship.name.length >= 20 }\\\">{{ship.name | uppercase}}</span>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-ship-stats pull-left\\\">\\n\" +\n    \"\t\t<div class=\\\"card-ship-stat card-ship-stat-attack text-right\\\" tooltip-show=\\\"fleet\\\" tooltip=\\\"ship|valueOf:'attack':ship:fleet:false:{modifiers:true}\\\" tooltip-position=\\\"e\\\"><span class=\\\"card-skill-plus\\\" ng-show=\\\"ship.isShipModifier\\\">+</span>{{ship|valueOf:'attack':ship:fleet}}</div>\\n\" +\n    \"\t\t<div class=\\\"card-ship-stat card-ship-stat-agility text-right\\\" tooltip-show=\\\"fleet\\\" tooltip=\\\"ship|valueOf:'agility':ship:fleet:false:{modifiers:true}\\\" tooltip-position=\\\"e\\\"><span class=\\\"card-skill-plus\\\" ng-show=\\\"ship.isShipModifier\\\">+</span>{{ship|valueOf:'agility':ship:fleet}}</div>\\n\" +\n    \"\t\t<div class=\\\"card-ship-stat card-ship-stat-hull text-right\\\" tooltip-show=\\\"fleet\\\" tooltip=\\\"ship|valueOf:'hull':ship:fleet:false:{modifiers:true}\\\" tooltip-position=\\\"e\\\"><span class=\\\"card-skill-plus\\\" ng-show=\\\"ship.isShipModifier\\\">+</span>{{ship|valueOf:'hull':ship:fleet}}</div>\\n\" +\n    \"\t\t<div class=\\\"card-ship-stat card-ship-stat-shields text-right\\\" tooltip-show=\\\"fleet\\\" tooltip=\\\"ship|valueOf:'shields':ship:fleet:false:{modifiers:true}\\\" tooltip-position=\\\"e\\\"><span class=\\\"card-skill-plus\\\" ng-show=\\\"ship.isShipModifier\\\">+</span>{{ship|valueOf:'shields':ship:fleet}}</div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-border-right pull-right\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-ship-silhouette pull-left\\\">\\n\" +\n    \"\t  <i class=\\\"card-ship-silhouette-icon\\\" style=\\\"background-image: url(img/ships/sil_{{ship.classId}}.png)\\\"></i>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-ship-class-container text-center\\\">\\n\" +\n    \"\t\t<span class=\\\"card-ship-class\\\" ng-class=\\\"{'card-ship-class-long': ship.class.length >= 25 }\\\">{{ship.class | uppercase}}</span>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-text font-staw-alt\\\"><div class=\\\"card-text-inner\\\" ng-bind-html=\\\"ship.text | icons\\\" ng-class=\\\"{'card-text-inner-long': ship.text.length > 230 }\\\"></div></div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-ship-action-bar text-center\\\">\\n\" +\n    \"\t\t<i ng-repeat=\\\"action in ship.actions\\\" class=\\\"fs fs-{{action}}\\\"></i>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-corner-bottom-right pull-right\\\">\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-ship-cost pull-right\\\">{{ship|valueOf:'cost':ship:fleet}}</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-ship-upgrade-bar\\\">\\n\" +\n    \"\t\t<i ng-repeat=\\\"upgrade in ship.upgrades track by $index\\\" class=\\\"fs fs-{{upgrade.type[0]}}\\\" ng-class=\\\"{'card-ship-upgrade-occupied': upgrade.occupant}\\\"></i>\\n\" +\n    \"\t</div>\\n\" +\n    \"\t<div style=\\\"clear: both\\\"></div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('card-token.html',\n    \"<div class=\\\"card-outer card-token font-staw\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-token-header\\\">\\n\" +\n    \"\t\t<span class=\\\"card-title\\\" ng-class=\\\"{'card-title-long': token.name.length > 20}\\\">{{token.name | uppercase}}</span>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-text\\\">\\n\" +\n    \"\t\t<div class=\\\"card-text-inner font-staw-alt\\\" ng-bind-html=\\\"token.text | icons\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"</div>\"\n  );\n\n\n  $templateCache.put('card-upgrade.html',\n    \"<div class=\\\"card-outer card-upgrade font-staw\\\" ng-class=\\\"{ 'card-unique': upgrade.unique, 'card-OnePerShip': upgrade.OnePerShip, 'card-factionFederation': upgrade.factionFederation, 'card-FrontArc': upgrade.FrontArc, 'card-RearArc': upgrade.RearArc, 'card-Hull': upgrade.Hull, 'card-mirror': upgrade.mirror, 'dragging': upgrade == dragStore.item }\\\" draggable drag-item=\\\"upgrade\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-image\\\">\\n\" +\n    \"\t\t<img ng-if=\\\"upgrade.image\\\" ng-src=\\\"{{upgrade.image}}\\\" />\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-corner-top-left pull-left\\\">\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.unique\\\" class=\\\"card-unique-icon fs fs-unique pull-left\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.OnePerShip\\\" class=\\\"card-OnePerShip-icon fs fs-OnePerShip pull-left\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.specialization\\\" class=\\\"card-specialization-icon fs fs-specialization pull-left\\\"></i>\\n\" +\n    \"\t\t<div class=\\\"card-corner-inner pull-right\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-title-container text-left\\\">\\n\" +\n    \"\t\t<span ng-if=\\\"upgrade.showType\\\" class=\\\"card-captain pull-right\\\">{{upgrade.type|uppercase|removeDashes}}</span>\\n\" +\n    \"\t\t<span ng-if=\\\"upgrade|valueOf:'attack':ship:fleet\\\" class=\\\"card-weapon-attack pull-right\\\" tooltip-show=\\\"ship\\\" tooltip=\\\"upgrade|valueOf:'attack':ship:fleet:false:{modifiers:true}\\\">{{upgrade|valueOf:'attack':ship:fleet}}</span>\\n\" +\n    \"\t\t<span class=\\\"card-title\\\"\\n\" +\n    \"\t\t\tng-class=\\\"{ 'card-title-long': upgrade.name.length >= 24 || (upgrade.showType && upgrade.name.length + upgrade.type.length >= 24) || (upgrade.attack && upgrade.name.length >= 20),\\n\" +\n    \"\t\t\t\t\t\t'card-title-super-long': upgrade.name.length >= 31 || upgrade.showType && upgrade.name.length + upgrade.type.length >= 31,\\n\" +\n    \"\t\t\t}\\\">{{upgrade.name | uppercase}}</span>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-border-left pull-left\\\">\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainFederation\\\" class=\\\"card-captainFederation-icon fs fs-captainFederation\\\" title=\\\"Federation Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainBajoren\\\" class=\\\"card-captainBajoren-icon fs fs-captainBajoren\\\" title=\\\"Bajoran Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainVulcan\\\" class=\\\"card-captainVulcan-icon fs fs-captainVulcan\\\" title=\\\"Vulcan Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainKlingon\\\"  class=\\\"card-captainKlingon-icon fs fs-captainKlingon\\\" title=\\\"Klingon Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainRomulan\\\" class=\\\"card-captainRomulan-icon fs fs-captainRomulan\\\" title=\\\"Romulan Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainDominion\\\" class=\\\"card-captainDominion-icon fs fs-captainDominion\\\" title=\\\"Dominion Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainIndependent\\\" class=\\\"card-captainIndependent-icon fs fs-captainIndependent\\\" title=\\\"Indpendent Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainFerengi\\\" class=\\\"card-captainFerengi-icon fs fs-captainFerengi\\\" title=\\\"Ferengi Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainKazon\\\" class=\\\"card-captainKazon-icon fs fs-captainKazon\\\" title=\\\"Kazon Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainXindi\\\" class=\\\"card-captainXindi-icon fs fs-captainXindi\\\" title=\\\"'Xindi Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainBorg\\\" class=\\\"card-captainBorg-icon fs fs-captainBorg\\\" title=\\\"Borg Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captain8472\\\" class=\\\"card-captain8472-icon fs fs-captain8472\\\" title=\\\"Species 8472 Captain Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.captainMU\\\" class=\\\"card-captainMU-icon fs fs-captainMU\\\" title=\\\"Mirror Universe Captain Required\\\"></i>\\n\" +\n    \"\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipFederation\\\" class=\\\"card-shipFederation-icon fs fs-card-shipFederation\\\" title=\\\"Federation Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipBajoren\\\" class=\\\"card-shipBajoren-icon fs fs-card-shipBajoren\\\" title=\\\"Bajoran Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipVulcan\\\" class=\\\"card-shipVulcan-icon fs fs-card-shipVulcan\\\" title=\\\"Vulcan Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipKlingon\\\" class=\\\"card-shipKlingon-icon fs fs-shipKlingon\\\" title=\\\"Klingon Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipRomulan\\\" class=\\\"card-shipRomulan-icon fs fs-shipRomulan\\\" title=\\\"Romulan Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipDominion\\\" class=\\\"card-shipDominion-icon fs fs-shipDominion\\\" title=\\\"Dominion Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipIndependent\\\" class=\\\"card-shipIndependent-icon fs fs-shipIndependent\\\" title=\\\"Independent Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipFerengi\\\" class=\\\"card-shipFerengi-icon fs fs-shipFerengi\\\" title=\\\"Ferengi Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipKazon\\\" class=\\\"card-shipKazon-icon fs fs-shipKazon\\\" title=\\\"Kazon Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipXindi\\\" class=\\\"card-shipXindi-icon fs fs-shipXindi\\\" title=\\\"Xindi Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipBorg\\\" class=\\\"card-shipBorg-icon fs fs-shipBorg\\\" title=\\\"Borg Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.ship8472\\\" class=\\\"card-ship8472-icon fs fs-ship8472\\\" title=\\\"Species 8472 Ship Required\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipMU\\\" class=\\\"card-shipMU-icon fs fs-shipMU\\\" title=\\\"Mirror Universe Ship Required\\\"></i>\\n\" +\n    \"\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costFederation\\\" class=\\\"card-costFederation-icon\\\">{{upgrade|valueOf:'costFederation':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costBajoren\\\" class=\\\"card-costBajoren-icon\\\">{{upgrade|valueOf:'costFederation':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costVulcan\\\" class=\\\"card-costVulcan-icon\\\">{{upgrade|valueOf:'costVulcan':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costKlingon\\\" class=\\\"card-costKlingon-icon\\\">{{upgrade|valueOf:'costKlingon':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costRomulan\\\" class=\\\"card-costRomulan-icon\\\">{{upgrade|valueOf:'costRomulan':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costHirogen\\\" class=\\\"card-costHirogen-icon\\\">{{upgrade|valueOf:'costHirogen':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costDominion\\\" class=\\\"card-costDominion-icon\\\">{{upgrade|valueOf:'costDominion':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costIndependent\\\" class=\\\"card-costIndependent-icon\\\">{{upgrade|valueOf:'costIndependent':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costFerengi\\\" class=\\\"card-costFerengi-icon\\\">{{upgrade|valueOf:'costFerengi':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costKazon\\\" class=\\\"card-costKazon-icon\\\">{{upgrade|valueOf:'costKazon':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costXindi\\\" class=\\\"card-costXindi-icon\\\">{{upgrade|valueOf:'costXindi':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costBorg\\\" class=\\\"card-costBorg-icon\\\">{{upgrade|valueOf:'costBorg':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.cost8472\\\" class=\\\"card-cost8472-icon\\\">{{upgrade|valueOf:'cost8472':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.costMU\\\" class=\\\"card-costMU-icon\\\">{{upgrade|valueOf:'costMU':ship:fleet}}</i>\\n\" +\n    \"\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.attackConstraint\\\" class=\\\"card-attackConstraint-icon\\\" title=\\\"Must have an Attack Value of {{upgrade|valueOf:'attackConstraint':ship:fleet}}\\\">{{upgrade|valueOf:'attackConstraint':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.hullConstraint\\\" class=\\\"card-hullConstraint-icon\\\" title=\\\"Must Have a Hull Value of {{upgrade|valueOf:'hullConstraint':ship:fleet}}\\\">{{upgrade|valueOf:'hullConstraint':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shieldConstraint\\\" class=\\\"card-shieldConstraint-icon\\\" title=\\\"Must Have Shield Value of {{upgrade|valueOf:'shieldConstraint':ship:fleet}}\\\">{{upgrade|valueOf:'shieldConstraint':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.csConstraint\\\" class=\\\"card-csConstraint-icon\\\" title=\\\"Must Have a Captain Skill of {{upgrade|valueOf:'csConstraint':ship:fleet}}\\\">{{upgrade|valueOf:'csConstraint':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.errata\\\" class=\\\"card-errata-icon\\\">{{upgrade|valueOf:'errata':ship:fleet}}</i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.FrontArc\\\" class=\\\"card-FrontArc-icon fs fs-FrontArc\\\" title=\\\"Forward Firing Arc\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.RearArc\\\" class=\\\"card-RearArc-icon fs fs-RearArc\\\" title=\\\"Secondary Firing Arc\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.arc360\\\" class=\\\"card-360Arc-icon fs fs-360Arc\\\" title=\\\"360-Degree Firing Arc\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.shipLimit\\\" class=\\\"card-shipLimit-icon fs fs-shipLimit\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.constitutionLimit\\\" class=\\\"card-constitutionLimit-icon fs fs-constitutionLimit\\\" title=\\\"Constitution Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.akiraLimit\\\" class=\\\"card-akiraLimit-icon fs fs-akiraLimit\\\" title=\\\"Akira Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.droneLimit\\\" class=\\\"card-doneLimit-icon fs fs-droneLimit\\\" title=\\\"Romulan Drone Ship\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.andorianLimit\\\" class=\\\"card-andorianLimit-icon fs fs-andorianLimit\\\" title=\\\"Andorian Battle Cruiser\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.attackshipLimit\\\" class=\\\"card-attackshipLimit-icon fs fs-attackshipLimit\\\" title=\\\"Jem'Hadar Attack Ship\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.battleshipLimit\\\" class=\\\"card-battleshipLimit-icon fs fs-battleshipLimit\\\" tittle=\\\"Jem'Hadar Battleship\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.dreadnaughtLimit\\\" class=\\\"card-dreadnaughtLimit-icon fs fs-dreadnaughtLimit\\\" tittle=\\\"Cardassian ATR-4107\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.dauntlessLimit\\\" class=\\\"card-dauntlessLimit-icon fs fs-dauntlessLimit\\\" title=\\\"Dauntless Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.dderidexLimit\\\" class=\\\"card-dderidexLimit-icon fs fs-dderidexLimit\\\" title=\\\"D'Deridex Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.dkyrLimit\\\" class=\\\"card-dkyrLimit-icon fs fs-dkyrLimit\\\" title=\\\"D'Kyr Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.defiantLimit\\\" class=\\\"card-defiantLimit-icon fs fs-defiantLimit\\\" title=\\\"Defiant Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.gornLimit\\\" class=\\\"card-gornLimit-icon fs fs-gornLimit\\\" title=\\\"Gorn Raider\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.hirogenLimit\\\" class=\\\"card-hirogenLimit-icon fs fs-hirogenLimit\\\" title=\\\"Hirogen Warship\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.maquisraiderLimit\\\" class=\\\"card-maquisraiderLimit-icon fs fs-maquisraiderLimit\\\" title=\\\"Maquis Raider\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.prometheusLimit\\\" class=\\\"card-prometheusLimit-icon fs fs-prometheusLimit\\\" title=\\\"Prometheus Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.excelsiorLimit\\\" class=\\\"card-excelsiorLimit-icon fs fs-excelsiorLimit\\\" title=\\\"Excelsior Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.nxLimit\\\" class=\\\"card-nxLimit-icon fs fs-nxLimit\\\" title=\\\"Federation NX Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.deltaflyerLimit\\\" class=\\\"card-deltaflyerLimit-icon fs fs-deltaflyerLimit\\\" title=\\\"Delta Flyer Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.intrepidLimit\\\" class=\\\"card-intrepidLimit-icon fs fs-intrepidLimit\\\" title=\\\"Intrepid Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.novaLimit\\\" class=\\\"card-novaLimit-icon fs fs-novaLimit\\\" title=\\\"Nova Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.aerieLimit\\\" class=\\\"card-aerieLimit-icon fs fs-aerieLimit\\\" title=\\\"Aerie Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.numiriLimit\\\" class=\\\"card-numiriLimit-icon fs fs-numiriLimit\\\" title=\\\"Numiri Patrol Ship\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.neradaLimit\\\" class=\\\"card-neradaLimit-icon fs fs-neradaLimit\\\" title=\\\"Nerada-Type\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.sovereignLimit\\\" class=\\\"card-sovereignLimit-icon fs fs-sovereignLimit\\\" title=\\\"Sovereign Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.constitutionkLimit\\\" class=\\\"card-constitutionkLimit-icon fs fs-constitutionkLimit\\\" title=\\\"Constitution (Kelvin) Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.remanLimit\\\" class=\\\"card-remanLimit-icon fs fs-remanLimit\\\" title=\\\"Reman Warbird\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.kvortLimit\\\" class=\\\"card-kvortLimit-icon fs fs-kvortLimit\\\" title=\\\"K'Vort Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.brelLimit\\\" class=\\\"card-brelLimit-icon fs fs-brelLimit\\\" title=\\\"B'Rel Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.vorchaLimit\\\" class=\\\"card-vorchaLimit-icon fs fs-vorchaLimit\\\" title=\\\"Vor'cha Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.neghvarLimit\\\" class=\\\"card-neghvarLimit-icon fs fs-neghvarLimit\\\" title=\\\"Negh'Var Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.galorLimit\\\" class=\\\"card-galorLimit-icon fs fs-galorLimit\\\" title=\\\"Cardassian Galor Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.keldonLimit\\\" class=\\\"card-keldonLimit-icon fs fs-keldonLimit\\\" title=\\\"Cardassian Keldon Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.suurokLimit\\\" class=\\\"card-suurokLimit-icon fs fs-suurokLimit\\\" title=\\\"Suurok Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.vidiianLimit\\\" class=\\\"card-vidiianLimit-icon fs fs-vidiianLimit\\\" title=\\\"Vidiian Battle Cruiser\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.warbirdLimit\\\" class=\\\"card-warbirdLimit-icon fs fs-warbirdLimit\\\" title=\\\"Warbird Class\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.faq\\\" class=\\\"card-faq-icon fs fs-faq\\\"></i>\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.opBanned\\\" class=\\\"card-OP-banned-icon fs fs-opBanned\\\" title=\\\"Banned from OP Play\\\"></i>\\n\" +\n    \"\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-text\\\">\\n\" +\n    \"\t\t<div ng-if=\\\"upgrade.range\\\" class=\\\"card-weapon-range pull-right\\\">{{upgrade|valueOf:'range':ship:fleet}}</div>\\n\" +\n    \"\t\t<div class=\\\"card-text-inner font-staw-alt\\\" ng-bind-html=\\\"upgrade.text | icons\\\" ng-class=\\\"{'card-text-inner-long': upgrade.text.length > 300, 'card-text-inner-super-long': upgrade.text.length > 530, 'text-left': upgrade.range }\\\"></div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-upgrade-cost pull-right\\\"><div ng-repeat=\\\"faction in upgrade|valueOf:'factions':ship:fleet\\\" class=\\\"card-upgrade-faction card-faction-{{ (upgrade|valueOf:'factions':ship:fleet).length - $index}}\\\"><div class=\\\"card-upgrade-faction-black\\\"></div><div class=\\\"card-upgrade-faction-icon card-faction-{{faction}}\\\"></div></div><div class=\\\"card-upgrade-cost-value\\\" ng-class=\\\"{'card-upgrade-cost-free': '{{upgrade|valueOf:'free':ship:fleet}}' }\\\" tooltip-show=\\\"ship\\\" tooltip=\\\"upgrade|valueOf:'cost':ship:fleet:false:{modifiers:true}\\\">{{upgrade|valueOf:'cost':ship:fleet}}</div></div>\\n\" +\n    \"\\n\" +\n    \"\t<div ng-if=\\\"upgrade.type == 'captain' || upgrade.type == 'admiral' || (upgrade|valueOf:'skill':ship:fleet)\\\" class=\\\"card-skill-container pull-left\\\">\\n\" +\n    \"\t\t<div class=\\\"card-skill\\\" tooltip-show=\\\"ship\\\" tooltip=\\\"upgrade|valueOf:'skill':ship:fleet:false:{modifiers:true}\\\" tooltip-position=\\\"nw-alt\\\"><span class=\\\"card-skill-plus\\\" ng-show=\\\"upgrade.isSkillModifier && upgrade.skill >= 0\\\">+</span>{{upgrade|valueOf:'skill':ship:fleet}}</div>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"\t<div ng-if=\\\"!(upgrade|valueOf:'skill':ship:fleet) && upgrade.type != 'captain' && upgrade.type != 'admiral' \\\" class=\\\"card-upgrade-type pull-left fs fs-{{upgrade.type}}\\\"></div>\\n\" +\n    \"\\n\" +\n    \"\t<div class=\\\"card-border-bottom\\\">\\n\" +\n    \"\t\t<i ng-if=\\\"upgrade.talents\\\" ng-repeat=\\\"talent in range(upgrade.talents) track by $index\\\" class=\\\"fs fs-talent\\\"></i>\\n\" +\n    \"\t\t<i ng-repeat=\\\"slot in upgrade.upgradeSlots track by $index\\\" ng-if=\\\"slot.showOnCard\\\" class=\\\"fs fs-{{slot.type[0]}}\\\" ng-class=\\\"{'card-upgrades-long': upgrade.upgradeSlots.length > 2}\\\"></i>\\n\" +\n    \"\t</div>\\n\" +\n    \"\\n\" +\n    \"<i ng-if=\\\"upgrade.alliance\\\" class=\\\"card-alliance-icon fs fs-alliance\\\">\\n\" +\n    \"\\n\" +\n    \"\t<div style=\\\"clear: both\\\"></div>\\n\" +\n    \"\\n\" +\n    \"</div>\\n\"\n  );\n\n\n  $templateCache.put('card.html',\n    \"<div ng-if=\\\"card\\\" ng-switch on=\\\"card.type\\\">\\n\" +\n    \"\t<card-ship \t\t\tng-switch-when=\\\"ship\\\" ship=\\\"card\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\" fleet=\\\"fleet\\\"></card-ship>\\n\" +\n    \"\t<card-ship \t\t\tng-switch-when=\\\"flagship\\\" ship=\\\"card\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\" fleet=\\\"fleet\\\"></card-ship>\\n\" +\n    \"\t<card-ship-class\tng-switch-when=\\\"ship-class\\\" ship-class=\\\"card\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\"></card-ship-class>\\n\" +\n    \"\t<card-resource \t\tng-switch-when=\\\"resource\\\" resource=\\\"card\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\"></card-resource>\\n\" +\n    \"\t<card-token \t\tng-switch-when=\\\"token\\\" token=\\\"card\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\"></card-token>\\n\" +\n    \"\t<card-faction \t\tng-switch-when=\\\"faction\\\" faction=\\\"card\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\"></card-faction>\\n\" +\n    \"\t<card-upgrade \t\tng-switch-default upgrade=\\\"card\\\" drag-store=\\\"dragStore\\\" drag-source=\\\"dragSource\\\" ship=\\\"ship\\\" fleet=\\\"fleet\\\"></card-upgrade>\\n\" +\n    \"</div>\"\n  );\n\n}]);\n"],"names":["module","angular","directive","scope","dragItem","dragStore","dragSource","link","element","prop","on","ev","$apply","item","source","addClass","originalEvent","dataTransfer","effectAllowed","setData","removeClass","preventDefault","drop","canDrop","$item","$filter","fleet","cards","searchOptions","templateUrl","controller","$scope","isMobile","$watch","location","hash","btoa","toJson","saveFleet","$on","card","removeFromFleet","zoom","setSearchTypes","types","$","each","typeName","typeOption","search","inArray","columns","addFleetShip","ship","other","findOtherInFleet","valueOf","console","log","copy","ships","push","getUpgradeSlots","isUpgradeCompatible","upgrade","upgradeSlot","occupant","slotTypes","type","isSlotCompatible","isUniqueClash","unique","name","mirror","saveCard","saved","upgrades","upgradeSlots","id","resource","captain","admiral","ambassador","construction","i","slot","savedSlot","length","loadCard","savedCard","findCardById","promulgate","result","setShipResource","setShipCaptain","setShipAdmiral","setShipAmbassador","setShipConstruction","savedUpgrade","setUpgrade","canEquip","slotType","fleetHasAdmiral","hasAdmiral","fleetHasAmbassador","hasAmbassador","clash","j","replaceWith","found","splice","getTotalCost","cost","totalCost","getFleetCost","setFleetResource","savedFleet","match","hashFleet","loadFleet","savedShip","fromJson","atob","substring","e","hideEmptySlots","sets","find","focus","$this","this","select","window","setTimeout","mouseup","unbind","fleetText","showSetNames","ttsExportStyle","fleetToText","res","ttsText","fleetData","exportType","cardToFleetData","card_stack","data","typeConvert","faction","factionConvert","factions","priority","class","grep","n","sort","a","b","index","slice","JSON","stringify","cardToAltTextTTS","text","cardToText","href","split","replace","indent","hideCost","names","free","countSlotCost","skill","set","resB","factionList","federation","klingon","romulan","dominion","borg","species-8472","kazon","xindi","bajoran","ferengi","vulcan","independent","mirror-universe","q-continuum","updatedFactionList","error","join","cardType","crew","talent","tech","weapon","squadron","cardLoader","missionSets","missionList","viewer","activeSet","setCards","Object","keys","sourceID","missionSet","missionSetCards","displaySort","filter","$factions","options","map","generic","ignoreSetsFilter","setSelected","filterField","filterOperator","filterValue","value","query","toLowerCase","indexOf","hasAFaction","noneSelected","maneuverType","hasFilteredManeuver","maneuvers","classData","speed","direction_keys","isNumeric","direction","maneuver_object","difficulty","parseInt","Math","abs","maneuver","maneuverDifficulty","hasFaction","sortBy","ascending","setList","defaults","localStorage","resetSearch","modifySearchColumns","amount","resultLimit","list","sortables","difficulty_list","uncheckAllSets","exportSets","filename","ownedSets","encodedSets","encodeURIComponent","document","createElement","setAttribute","style","display","body","appendChild","click","removeChild","importSets","inputFile","rawSetData","importFile","files","reader","FileReader","onload","event","target","processSetsImport","info","readAsText","importedData","importedSets","parse","errorCount","reload","checkAllSets","title","transclude","attrs","undefined","open","showContent","shipClasses","token","setId","tooltip","tooltipPosition","tooltipShow","restrict","initialised","show","icons","powerTip","placement","div","mod","append","html","factory","userAgent","navigator","vendor","opera","test","substr","drag","activeFleet","loading","$broadcast","keypress","which","ctrlKey","shipClass","speeds","m","max","min","unshift","getBaseTileName","range","size","Array","isDefined","wrapInterceptors","interceptors","destArr","Function","interceptor","fn","shipCardNamed","upgradeSlotsFilter","let","primeFactionLookup","getPrimeFactions","cardFactions","reduce","primeFactions","cardFaction","primeFaction","includes","primeFactionMatch","otherFaction","some","cardPrimeFaction","hasAnyFaction","f","matchByPrimeFaction","listCodified","$http","cardRules","callback","isDuplicate","dupe","shipDefaults","canJoinFleet","intercept","captainDefaults","canEquipCaptain","canEquipFaction","showType","admiralDefaults","canEquipAdmiral","isSkillModifier","ambassadorDefaults","canEquipAmbassador","constructionDefaults","canEquipConstruction","upgradeDefaults","resourceDefaults","get","success","copies","loadShip","extend","ship2","numShipsHull4Plus","numSquadrons","hull","penalty","captains","loadCaptain","factionPenalty","talents","admirals","loadAdmiral","ambassadors","starship_construction","dir","resources","others","loadOther","flagship","talentAdd","rules","showOnCard","emptyTalentSlot","slots","techAdd","weaponAdd","crewAdd","attack","agility","shields","of","concat","classId","hasTokenInfo","tokenId","tokenData","onePerShip","alreadyEquipped","isUpgrade","upgradeTypes","resolve","cloneSlot","count","getSlotType","checkUpgrade","returnValue","countsAsUpgrade","captain:Cap101","captain:Cap112","captain:Cap115","captain:Cap111","captain:Cap114","captain:Cap113","captain:Cap116","ship:S404","captain:Cap039","captain:Cap042","captain:Cap050","admiral:A044","crew:C436","crew:C440","crew:C444","CanEquip","crew:C445","crew:C446","crew:C447","crew:C463","crew:C465","crew:C468","crew:C472","crew:C476","crew:C477","crew:C478","talent:E233","talent:E234","talent:E235","talent:E236","talent:E237","crew:C483","weapon:W251","tech:T312","weapon:W247","weapon:W249","tech:T308","tech:T309","tech:T311","question:Q034","self","question:Q035","question:Q036","question:Q037","starship_construction:Con003","starship_construction:Con004","captain:Cap037","captain:Cap031","crew:C427","crew:C432","crew:C434","crew:C435","talent:E232","weapon:W243","weapon:W244","weapon:W245","weapon:W246","tech:T302","tech:T303","tech:T304","tech:T305","tech:T306","tech:T307","question:Q032","question:Q033","question:Q031","ship:S386","captain:Cap022","captain:Cap023","captain:Cap024","crew:C405","captain:Cap025","captain:Cap028","otherSlotCost","question:Q028","crew:C410","crew:C413","crew:C418","crew:C422","crew:C423","crew:C426","talent:E231","weapon:W241","weapon:W242","tech:T296","tech:T297","tech:T298","tech:T299","tech:T300","tech:T301","question:Q029","question:Q030","starship_construction:Con002","crew:C398","talent:E224","weapon:W233","tech:T289","crew:C399","crew:C401","crew:C400","crew:C403","crew:C404","crew:C402","talent:E229","talent:E228","talent:E227","weapon:W238","weapon:W237","weapon:W235","weapon:W234","tech:T294","tech:T293","tech:T290","tech:T292","talent:E219","talent:E222","talent:E221","talent:E223","weapon:W228","weapon:W229","weapon:W232","weapon:W231","weapon:W230","tech:T288","tech:T283","tech:T285","tech:T281","tech:T287","tech:T286","tech:T282","crew:C397","crew:C396","crew:C395","crew:C392","crew:C391","crew:C394","crew:C393","talent:E213","talent:E214","talent:E215","weapon:W222","weapon:W223","weapon:W224","weapon:W225","weapon:W226","weapon:W227","tech:T277","tech:T278","tech:T279","tech:T280","question:Q023","crew:C389","starship_construction:Con001","startsWith","captain:Cap014","crew:C380","crew:C383","crew:C384","crew:C385","talent:E210","talent:E211","talent:E212","weapon:W218","weapon:W219","weapon:W220","weapon:W221","tech:T274","tech:T276","question:Q022","talent:E208","foundDaharMasterTalent","forEach","captain:Cap004","ship:S336","weapon:W217","weapon:W216","talent:E209","tech:T273","ship:S342","captain:Cap008","weapon:W215","faceDown","tech:T271","tech:T270","weapon:W214","weapon:W213","crew:C372","weapon:W204","talent:E202","talent:E200","weapon:W201","weapon:W207","weapon:W205","weapon:W203","tech:T255","tech:T253","crew:C362","crew:C360","crew:C361","crew:C358","crew:C359","captain:Cap118","modifier","captain:Cap119","captain:Cap121","captain:Cap122","captain:Cap123","captain:Cap124","captain:Cap125","captain:Cap126","captain:Cap127","captain:Cap128","weapon:W120","captain:Cap641","calculatedCost","weapon:W111","weapon:W114","crew:C193","tech:T247","captain:Cap644","captain:Cap905","captain:Cap814","captain:Cap645","captain:Cap325","candidate","candCost","occCost","tech:T236","weapon:W103","crew:C178","crew:C177","crew:C176","tech:T240","weapon:W102","tech:T233","captain:Cap323","talent:E111","tech:T225","tech:T224","captain:Cap717","crew:C159","crew:C157","weapon:W097","weapon:W096","question:Q024","tech:T228","captain:Cap524","weapon:W094","crew:C152","tech:T217","tech:T221","tech:T219","tech:T216","talent:E104","weapon:W095","weapon:W093","weapon:W092","tech:T222","crew:C154","question:Q025","weapon:W090","talent:E103","weapon:W089","captain:Cap322","talent:E101","tech:T212","tech:T211","weapon:W085","ship:S139","talent:E099","weapon:W084","weapon:W083","talent:E093","tech:T204","crew:C134","captain:Cap522","slotUpgrade","tech:T201","talent:E087","weapon:W075","talent:E090","captain:Cap424","captain:Cap711","talent:E088","borg:B012","weapon:W077","weapon:W076","tech:T099","tech:T098","crew:C110","crew:C114","crew:C109","ship:S106","ship:S107","ship:S108","ship:S105","weapon:W070","captain:Cap629","weapon:W170","captain:Cap630","crew:C101","tech:T095","ship:S115","captain:Cap521","tech:T096","crew:C107","ship:S113","ship:S111","captain:Cap317","crew:C100","borg:B011","weapon:W071","tech:T090","talen:E080","tech:T089","captain:Cap315","tech:T088","weapon:W064","ship:S099","weapon:W062","talent:E079","borg:B007","talent:E078","captain:Cap807","tech:T085","crew:C089","crew:C088","weapon:W058","weapon:W057","borg:B006","borg:B005","weapon:W056","captain:Cap518","captain:Cap626","weapon:W060","ship:S087","canJoin","borg:T083","talent:E071","talent:E063","tech:T080","tech:T079","weapon:W054","weapon:W053","tech:T081","talent:E068","ship:S084","ship:S080","captain:Cap516","crew:C078","captain:Cap902","borg:E070","borg:B002","ship:S070","talent:E060","captain:Cap901","squadron:D016","squadron:D015","squadron:D013","squadron:D011","squadron:D010","ship:S067","ship:S066","crew:C067","tech:T078","weapon:W050","weapon:W052","crew:C063","tech:T069","weapon:W047","tech:T076","tech:T075","talent:E056","weapon:W049","crew:C062","squadron:D009","squadron:D008","squadron:D006","squadron:D004","squadron:D002","squadron:D001","ship:S061","ship:S266","captain:Cap105","onEquip","captain:Cap104","captain:Cap621","tech:T074","tech:T073","tech:T072","weapon:T071","printedValue","talent:E051","weapon:W045","captain:Cap618","admiral:A017","crew:C059","talent:E049","crew:C057","crew:C058","weapon:W044","crew:C061","crew:C060","talent:T058","tech:T057","weapon:W034","talent:E046","weapon:W041","captain:Cap312","tech:T068","weapon:W042","crew:C051","tech:T066","talent:E045","ship:S051","tech:T065","tech:T064","ship:S047","crew:C273","tech:T056","tech:T055","crew:C044","crew:C043","captain:Cap415","crew:C049","crew:C048","tech:T062","captain:Cap805","talent:E042","tech:T061","tech:T060","tech:T059","weapon:W036","weapon:W035","captain:Cap410","crew:C041","talent:E039","weapon:W033","captain:Cap804","crew:C038","tech:T049","talent:E038","captain:Cap207","admiral:A012","captain:Cap616","tech:T053","crew:C042","captain:Cap206","question:Q026","crew:C039","tech:T048","tech:T047","weapon:W031","weapon:W030","tech:T015","talent:E025","talent:E024","crew:C025","tech:T020","captain:Cap306","tech:T033","tech:T030","tech:T029","tech:T028","question:Q001","weapon:W010","tech:T004","talent:E001","crew:C002","captain:Cap504","talent:E002","crew:C004","tech:T001","talent:E005","question:Q027","weapon:W025","tech:T042","ship:S013","captain:Cap201","admiral:A005","captain:Cap404","talent:E015","tech:T013","tech:T012","weapon:W024","weapon:W023","tech:T041","tech:T040","tech:T039","tech:T038","tech:T014","weapon:W012","question:Q002","rearArc","weapon:W017","question:Q003","captain:Cap303","talent:E009","tech:T008","tech:T007","tech:T006","tech:T010","tech:T009","captain:Cap701","talent:E013","crew:C012","crew:C013","captain:Cap507","tech:T027","tech:T026","tech:T025","weapon:W019","crew:C217","crew:C215","tech:T104","crew:C228","question:Q004","squadron:D023","squadron:D021","squadron:D018","captain:Cap307","talent:E034","captain:Cap205","weapon:W022","tech:T037","tech:T036","tech:T035","weapon:W029","tech:T046","weapon:W014","tech:T002","tech:T034","crew:C032","talent:E027","crew:C027","weapon:W018","tech:T023","talent:E022","tech:T018","talent:E010","crew:C008","tech:T011","ship:S221","tech:T112","question:Q005","question:Q021","captain:Cap219","talent:E139","talent:E138","tech:T110","tech:T109","tech:T108","tech:T024","talent:E036","weapon:W028","weapon:W141","captain:Cap726","tech:T126","tech:T103","tech:T102","tech:T101","captain:Cap434","talent:E136","talent:E142","crew:C230","weapon:W136","weapon:W135","tech:T117","tech:T116","captain:Cap329","romulanCount","weapon:W134","tech:T115","weapon:W139","crew:C234","about","crew:C233","captain:Cap331","tech:T121","crew:C235","crew:C236","weapon:W140","talent:E145","actions","question:Q007","question:Q006","captain:Cap725","replacement_cost","candidates","occupied_slots","captain:Cap539","tech:T124","weapon:W142","talent:E151","crew:C243","tech:T127","talent:E153","borg:B017","question:Q008","tech:T128","captain:Cap727","captain:Cap821","crew:C248","weapon:W146","weapon:W149","tech:T131","question:Q017","question:Q009","tech:T137","tech:T136","tech:T135","tech:T134","tech:T133","weapon:W150","captain:Cap333","talent:E161","talent:E160","crew:C259","weapon:W153","tech:T139","tech:T140","question:Q016","crew:C262","crew:C261","tech:T141","captain:Cap542","ship-resource:Rs01","talent:E166","tech:T142","weapon:W154","tech:T145","tech:T144","tech:T143","talent:E167","captain:Cap803","tech:T146","weapon:W155","crew:C266","captain:Cap801","weapon:W157","weapon:W156","crew:C267","tech:T148","tech:T147","tech:T149","captain:Cap335","tech:T152","tech:T1511","tech:T150","talent:E172","crew:C278","tech:T154","question:Q010","ship:S265","question:Q011","weapon:W162","tech:T155","ship:S267","captain:Cap336","weapon:W166","tech:T160","weapon:W165","tech:T159","tech:T158","captain:Cap656","talent:E174","weapon:W169","weapon:W167","crew:C290","captain:Cap817","talent:E177","tech:T248","tech:T165","tech:T166","weapon:W171","talent:E180","crew:C297","crew:C298","weapon:W178","weapon:W176","weapon:W174","weapon:W175","tech:T169","tech:T168","captain:Cap730","talent:E181","crew:C301","tech:T170","talent:E182","crew:C305","weapon:W181","captain:Cap446","captain:Cap223","admiral:A033","talent:E183","tech:T172","weapon:W183","crew:C310","crew:C309","crew:C308","question:Q019","question:Q020","question:Q012","talent:E184","crew:C314","question:Q013","weapon:W185","tech:T173","tech:T174","weapon:W187","squadron:D032","squadron:D029","squadron:D028","squadron:D027","squadron:D031","squadron:D026","talent:E187","crew:C320","crew:C321","weapon:W188","tech:T178","tech:T177","question:Q014","ship:S313","ship:S316","captain:Cap658","captain:Cap609","talent:E192","talent:E191","talent:E190","idexOf","crew:C340","weapon:W193","weapon:W194","tech:T184","tech:T251","tech:T182","tech:T183","question:Q015","captain:Cap820","admiral:A034","talent:E189","crew:C336","crew:C335","crew:C330","crew:C322","crew:C323","crew:C324","crew:C325","weapon:W189","weapon:W192","weapon:W191","weapon:W190","tech:T179","tech:T180","captain:Cap825","talent:E197","talent:E196","crew:C345","crew:C356","crew:C349","weapon:W197","weapon:W196","ship:S318","captain:Cap911","captain:Cap910","crew:C352","crew:C351","crew:C357","tech:T252","weapon:W200","weapon:W199","borg:B020","borg:B022","talent:E195","talent:E194","talent:E193","ship:S335","crew:C369","tech:T267","talent:E198","talent:E207","weapon:W212","weapon:W211","tech:T264","tech:T266","tech:T265","captain:Cap826","question:Q018","crew:C363","captain:Cap827","admiral:A036","crew:C364","crew:C365","talent:E204","weapon:W208","weapon:W209","weapon:W210","tech:T260","tech:T261","tech:T262","tech:T263",":","resource:R042","showShipResourceSlot","onRemove","ship-resource:R042a","resource:R040","ship-resource:Rs40","resource:R039","resource:R033","ship-resource:R033a","ship-resource:R033b","resource:R010","fleet-captain:R010a","fleet-captain:R010b","fleet-captain:R010c","fleet-captain:R010d","fleet-captain:R010e","fleet-captain:R010f","fleet-captain:R010g","fleet-captain:R010h","resource:R015","factionA","factionB","resource:R011","officer:R011a","officer:R011b","officer:R011c","officer:R011d","resource:R003","total","resource:R004","flagship:R004a","flagship:R004b","flagship:R004c","flagship:R004e","flagship:R004f","flagship:R004g","flagship:R004h","flagship:R004i","resource:R020","ceil","resource:R029","talent:E035","crew:C035","tech:T044","weapon:W027","resource:R036","ship-resource:R036a","ship:S362","ship:AS0007","ship:AS0008","ship:AS0009","ship:AS0010","ship:AS0011","ship:AS0012","ship:AS0013","ship:AS0014","ship:AS0015","ship:AS0016","ship:AS0017","captain:AC0001","captain:AC0002","captain:AC0003","captain:AC0004","captain:AC0005","captain:AC0006","captain:AC0007","captain:AC0008","crew:AP1001","crew:AP1002","crew:AP1003","crew:AP1004","crew:AP1005","talent:AP1006","talent:AP1009","tech:AP1013","tech:AP1014","weapon:AP1018","weapon:AP1020","weapon:AP1021","weapon:AP1022","weapon:AP1023","talent:AE001","talent:AE004","talent:AE007","question:AQ001","question:AQ004","ship:AS0023","ship:AS0024","ship:AS0025","ship:AS0026","captain:AC0009","captain:AC0010","captain:AC0011","captain:AC0012","captain:AC0013","captain:AC0014","captain:AC0015","captain:AC0016","talent:AP2001","talent:AP2002","crew:AP2003","tech:AP2004","crew:AP2005","crew:AP2006","crew:AP2007","crew:AP2009","crew:AP2010","crew:AP2011","talent:AP2012","talent:AP2013","talent:AP2014","talent:AP2016","talent:AP2018","talent:AP2019","weapon:AP2021","weapon:AP2022","weapon:AP2023","weapon:AP2025","weapon:AP2026","tech:AP2027","tech:AP2028","tech:AP2029","tech:AP2030","tech:AP2031","tech:AP2032","tech:AP2033","talent:AE002","talent:AE005","talent:AE008","question:AQ002","question:AQ005","ship:AS0029","ship:AS0030","ship:AS0031","ship:AS0032","ship:AS0033","ship:AS0034","ship:AS0035","ship:AS0036","captain:AC0017","captain:AC0018","captain:AC0019","captain:AC0020","captain:AC0021","captain:AC0022","captain:AC0023","captain:AC0024","talent:AE003","talent:AE006","talent:AE009","question:AQ003","question:AQ006","crew:AP3001","talent:AP3002","weapon:AP3003","tech:AP3004","crew:AP3006","crew:AP3007","crew:AP3009","crew:AP3010","crew:AP3014","crew:AP3011","talent:AP3015","talent:AP3016","talent:AP3019","weapon:AP3020","weapon:AP3021","weapon:AP3022","weapon:AP3023","tech:AP3026","tech:AP3027","tech:AP3030","tech:AP3031","str","hidden","toCheck","shift","field","globalInterceptors","shipInterceptors","interceptorsFilter","modifiers","dataBefore","run","$templateCache","put"],"mappings":"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B,QAAdd,EAAQc,IAA8B,OAAdd,EAAQc,IAA6B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQc,IAA8B,QAAdd,EAAQ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"}